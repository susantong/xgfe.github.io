<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>xgfe</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://xgfe.github.io/"/>
  <updated>2018-08-24T10:40:42.000Z</updated>
  <id>http://xgfe.github.io/</id>
  
  <author>
    <name>xgfe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Category ä¸Extension ç›¸å…³çŸ¥è¯†</title>
    <link href="http://xgfe.github.io/2018/08/24/wanglibin/category%E4%B8%8EExtension%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/"/>
    <id>http://xgfe.github.io/2018/08/24/wanglibin/categoryä¸Extensionç›¸å…³çŸ¥è¯†/</id>
    <published>2018-08-24T10:40:42.000Z</published>
    <updated>2018-08-24T10:40:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»Category å’Œ Extension çš„ç›¸å…³çŸ¥è¯†ä»¥åŠä½¿ç”¨ã€‚<br><a id="more"></a></p>
<h1 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h1><h2 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h2><ul>
<li>Categoryçš„èƒŒæ™¯å’Œæ¦‚å¿µ</li>
<li>Categoryçš„å£°æ˜åŠå®ç°</li>
<li>Categoryçš„ä½¿ç”¨</li>
<li>Categoryæ‰©å±•å±æ€§ï¼ˆå˜é‡ï¼‰</li>
</ul>
<h2 id="Extension"><a href="#Extension" class="headerlink" title="Extension"></a>Extension</h2><ul>
<li>Extensionçš„æ ¼å¼</li>
<li>Extensionçš„å®ç°</li>
</ul>
<h2 id="Categoryå’ŒExtensionçš„åŒºåˆ«"><a href="#Categoryå’ŒExtensionçš„åŒºåˆ«" class="headerlink" title="Categoryå’ŒExtensionçš„åŒºåˆ«"></a>Categoryå’ŒExtensionçš„åŒºåˆ«</h2><h3 id="ä¸€ã€Category"><a href="#ä¸€ã€Category" class="headerlink" title="ä¸€ã€Category"></a>ä¸€ã€Category</h3><h4 id="1ã€Categoryçš„èƒŒæ™¯å’Œæ¦‚å¿µ"><a href="#1ã€Categoryçš„èƒŒæ™¯å’Œæ¦‚å¿µ" class="headerlink" title="1ã€Categoryçš„èƒŒæ™¯å’Œæ¦‚å¿µ"></a>1ã€Categoryçš„èƒŒæ™¯å’Œæ¦‚å¿µ</h4><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦å¯¹å·²æœ‰ç±»è¿›è¡ŒåŠŸèƒ½ä¸Šçš„æ‰©å±•ï¼Œåœ¨å­¦ä¹ â€œç±»åˆ«â€ä¹‹å‰ï¼Œå¸¸ç”¨çš„ç±»æ‰©å±•æ–¹å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ul>
<li>åŸæœ‰ç±»çš„ä¿®æ”¹</li>
<li>ç»§æ‰¿</li>
<li>protocolï¼ˆåè®®ï¼‰</li>
</ul>
<p>é’ˆå¯¹ä»¥ä¸Šä¸‰ç§æ‰©å±•æ–¹å¼ï¼Œ</p>
<ol>
<li><p>ç¬¬ä¸€ç§ä¸ºæœ€åŸå§‹çš„æ–¹æ³•ï¼›</p>
</li>
<li><p>ç¬¬äºŒç§åœ¨ç»§æ‰¿çˆ¶ç±»çš„åŒæ—¶ï¼Œä¹Ÿæ‰©å±•è‡ªå·±ï¼ŒåŒ…æ‹¬ï¼ˆæ–¹æ³•å’Œå˜é‡ï¼‰ã€‚ä½†æ˜¯åœ¨é¢å‘å¯¹è±¡çš„å¼€å‘åŸåˆ™ä¸­â€œä¼˜å…ˆä½¿ç”¨ç»„åˆæ…ç”¨ç»§æ‰¿â€ï¼Œå› ä¸ºç»§æ‰¿åœ¨ä¸€å®šç¨‹åº¦ä¸Šç ´åäº†å°è£…æ€§ã€å­ç±»éšçˆ¶ç±»å˜åŠ¨ã€‚</p>
</li>
<li><p>ç¬¬ä¸‰ç§åè®®ï¼Œä¸»è¦æ˜¯ä¾é å®ç°ç±»çš„å…·ä½“æ–¹æ³•å®ç°ï¼Œå½“æ‰©å±•åŠŸèƒ½æ—¶ï¼Œéœ€è¦ä¿®æ”¹åŸæœ‰ç±»ï¼Œåè®®å®šä¹‰è¿‡å¤šï¼Œå®ç°ç±»è¿‡äºåºå¤§ã€‚</p>
</li>
</ol>
<p>é‚£ä¹ˆï¼Œåœ¨ocä¸­ï¼Œå½“æˆ‘ä»¬æƒ³é¿å…ä¸Šè¿°ä¸¤ç§æ‰©å±•æ–¹å¼çš„ç¼ºç‚¹ï¼Œåˆæƒ³åªå¯¹ç°æœ‰ç±»è¿›è¡Œæ‰©å±•äº›æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ç”¨å»ä¿®æ”¹åŸæœ‰ç±»ä»¥åŠä½¿ç”¨å®ƒçš„åœ°æ–¹çš„ä»£ç ï¼Œå°±ç”¨åˆ°äº†Categoryï¼ˆç±»åˆ«ï¼‰ã€‚</p>
<p>ç±»åˆ«æ˜¯OCçš„ç‰¹æœ‰è¯­æ³•ï¼Œå¯ä»¥é€šè¿‡åœ¨ç±»ä¸Šå£°æ˜å’Œå®ç°æ–¹æ³•æ¥æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½ã€‚åŸåˆ™ä¸Šåªèƒ½å¢åŠ æ–¹æ³•ï¼ˆåŒ…æ‹¬å¯¹è±¡æ–¹æ³•å’Œç±»æ–¹æ³•ï¼‰ï¼Œä¸èƒ½å¢åŠ æˆå‘˜å˜é‡ã€‚</p>
<h4 id="2ã€Categoryçš„å£°æ˜åŠå®ç°"><a href="#2ã€Categoryçš„å£°æ˜åŠå®ç°" class="headerlink" title="2ã€Categoryçš„å£°æ˜åŠå®ç°"></a>2ã€Categoryçš„å£°æ˜åŠå®ç°</h4><pre><code>@interface éœ€æ‰©å±•çš„ç±» ï¼ˆç±»åˆ«çš„åç§°ï¼‰
-ï¼ˆvoidï¼‰appendMethod;
@end

@implementation éœ€æ‰©å±•çš„ç±» ï¼ˆç±»åˆ«çš„åç§°ï¼‰
-ï¼ˆvoidï¼‰appendMethod{
}
@end
</code></pre><h4 id="3ã€Categoryçš„ä½¿ç”¨"><a href="#3ã€Categoryçš„ä½¿ç”¨" class="headerlink" title="3ã€Categoryçš„ä½¿ç”¨"></a>3ã€Categoryçš„ä½¿ç”¨</h4><p>å¦‚æœéœ€è¦æ‰©å±•ä¸€ä¸ªç±»ï¼Œå®šä¹‰å¥½æ­¤ç±»çš„Category ï¼Œåˆ™å¯ä»¥é€šè¿‡è¯¥ç±»çš„å¯¹è±¡ç›´æ¥è°ƒç”¨Categoryä¸­çš„æ‰©å±•æ–¹æ³•ã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨Categoryä¸­ä¹Ÿå¯ä»¥è®¿é—®åŸæœ‰ç±».hä¸­çš„å±æ€§å’Œæ–¹æ³•ã€‚</p>
<p>.hæ–‡ä»¶ï¼š</p>
<pre><code>#import &lt;Foundation/Foundation.h&gt;

@interface pson : NSObject&lt;NSCoding&gt;
@property (nonatomic, copy) NSString *name;
@property (nonatomic, assign) NSInteger age;
- (void) run;
+ (void) jump;
@end
</code></pre><p>.mæ–‡ä»¶</p>
<pre><code>#import &quot;pson.h&quot;

@implementation pson

-(void) run{
    NSLog(@&quot;run&quot;);
}
+(void) jump{
    NSLog(@&quot;jump&quot;);
}
@end
</code></pre><p>ä¸ºpsonç±»æ·»åŠ eatæ–¹æ³•ï¼ŒCategoryçš„.mæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>pson+eat.hæ–‡ä»¶</p>
<pre><code>#import &quot;pson.h&quot;

@interface pson (eat)
@property (nonatomic, strong) NSString *food;
-(void) eat;

@end
</code></pre><p>pson+eat.mæ–‡ä»¶</p>
<pre><code>#import &quot;pson+eat.h&quot;

@implementation pson (eat)
-(void) eat{
   //è°ƒç”¨åŸæœ‰ç±»çš„å…¬å…±æ–¹æ³•
[self run];
//è°ƒç”¨åŸæœ‰ç±»çš„éç§æœ‰å±æ€§
NSLog(@&quot;%@&quot;,self.name);
}
+(void) drink{
    NSLog(@&quot;drink&quot;);
}
@end
</code></pre><p>åœ¨mainæ–¹æ³•ä¸­</p>
<pre><code>pson *me = [[pson alloc] init];
    [me run];
    //è°ƒç”¨æ‰©å±•ç±»ä¸­çš„å¯¹è±¡æ–¹æ³•
    [me eat];
    //è°ƒç”¨æ‰©å±•ç±»ä¸­çš„ç±»æ–¹æ³•
    [pson drink]
</code></pre><h4 id="4ã€Categoryæ‰©å±•å±æ€§ï¼ˆå˜é‡ï¼‰"><a href="#4ã€Categoryæ‰©å±•å±æ€§ï¼ˆå˜é‡ï¼‰" class="headerlink" title="4ã€Categoryæ‰©å±•å±æ€§ï¼ˆå˜é‡ï¼‰"></a>4ã€Categoryæ‰©å±•å±æ€§ï¼ˆå˜é‡ï¼‰</h4><p>ç”±äºCategoryæœ¬è´¨ä¸Šæ˜¯ä¸ªæŒ‡å‘ç±»å‹çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œåœ¨ç»“æ„ä½“ä¸­åªæœ‰æ–¹æ³•çš„åˆ—è¡¨ï¼Œæ²¡æœ‰å±æ€§çš„åˆ—è¡¨ï¼Œæ‰€ä»¥ç†è®ºä¸Šåªèƒ½å¢åŠ æ–¹æ³•ä¸èƒ½å¢åŠ å±æ€§ã€‚</p>
<p>å¦‚ä½•é€šè¿‡Categoryæ¥æ‰©å±•å±æ€§å‘¢ï¼Ÿ</p>
<p>æ— æ³•æ·»åŠ å±æ€§çš„æ ¹æœ¬åŸå› æ˜¯ï¼šåœ¨Categoryä¸­@propertyå£°æ˜å±æ€§ï¼Œç³»ç»Ÿä¸ä¼šç”Ÿæˆ_æˆå‘˜å˜é‡å’Œsetterã€getterã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼šæ‰‹åŠ¨æ·»åŠ setterå’Œgetteræ–¹æ³•ï¼Œé‡‡ç”¨çš„å°±æ˜¯ï¼šå…³è”å¼•ç”¨ï¼ˆobjc_setAssociatedObjectå’Œobjc_getAssociatedObjectï¼‰</p>
<p>å…¶ä¸­ï¼Œ</p>
<p>objc_setAssociatedObjectï¼Œæ¥æ”¶4ä¸ªå‚æ•°ï¼šæƒ³å…³è”åˆ°æ•°æ®çš„å¯¹è±¡ã€è·å–æ•°æ®çš„é”®å€¼ã€å­˜å‚¨å¼•ç”¨çš„å€¼ã€å…³è”çš„ç­–ç•¥ï¼›</p>
<p>objc_getAssociatedObjectï¼Œæ¥æ”¶2ä¸ªå‚æ•°ï¼šå…³è”åˆ°æ•°æ®çš„å¯¹è±¡ã€é”®å€¼</p>
<p>å¸¸è§çš„å…³è”ç­–ç•¥ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>ä¸€ä¸ªæ™®é€šæ ‡é¢˜</th>
<th>ä¸€ä¸ªæ™®é€šæ ‡é¢˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>OBJC <em> ASSOCIATION </em> ASSIGN</td>
<td>æŒ‡å®šå€¼å°†è¢«ç®€å•èµ‹å€¼ã€æ²¡æœ‰ä¿ç•™å’Œé‡Šæ”¾</td>
</tr>
<tr>
<td>OBJC <em> ASSOCIATION </em> RETAIN _ NONATOMIC</td>
<td>æŒ‡å®šå€¼é€šè¿‡éçº¿ç¨‹å®‰å…¨çš„æ–¹å¼èµ‹å€¼å¹¶ä¿ç•™</td>
</tr>
<tr>
<td>OBJC <em> ASSOCIATION </em> COPY _ NONATOMIC</td>
<td>æŒ‡å®šå€¼é€šè¿‡éçº¿ç¨‹å®‰å…¨çš„æ–¹å¼å¤åˆ¶</td>
</tr>
<tr>
<td>OBJC <em> ASSOCIATION </em> RETAIN</td>
<td>æŒ‡å®šå€¼é€šè¿‡çº¿ç¨‹å®‰å…¨çš„æ–¹å¼èµ‹å€¼å¹¶ä¿ç•™</td>
</tr>
<tr>
<td>OBJC <em> ASSOCIATION </em> COPY</td>
<td>æŒ‡å®šå€¼é€šè¿‡çº¿ç¨‹å®‰å…¨çš„æ–¹å¼å¤åˆ¶</td>
</tr>
</tbody>
</table>
<p>å…·ä½“å®ç°ä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>Categoryçš„.hæ–‡ä»¶</p>
<pre><code>#import &quot;pson.h&quot;

@interface pson (eat)
@property (nonatomic, strong) NSString *food;
-(void) eat;
+(void) drink;
@end
</code></pre><p>Categoryçš„.mæ–‡ä»¶</p>
<pre><code>#import &quot;pson+eat.h&quot;
#import &quot;objc/runtime.h&quot;
static NSString *key = @&quot;personEatKey&quot;;

@implementation pson (eat)
-(void) eat{
    NSLog(@&quot;eat&quot;);
}

-(void) setFood:(NSString *)food{
    objc_setAssociatedObject(self, &amp;key, food,     OBJC_ASSOCIATION_COPY);
}

-(NSString *) food{
    return objc_getAssociatedObject(self, &amp;key);
}
@end
</code></pre><p>mainæ–¹æ³•ä¸­çš„ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<pre><code>#import &lt;Foundation/Foundation.h&gt;
#import &quot;pson.h&quot;
#import &quot;pson+eat.h&quot;
int main(int argc, const char * argv[]) {
    @autoreleasepool {

        pson *me = [[pson alloc] init];
        [me eat];
        me.food = @&quot;é¸¡è›‹&quot;;
        NSLog(@&quot;%@&quot;,me.food);

    }
    return 0;
}
</code></pre><h3 id="äºŒã€Extension"><a href="#äºŒã€Extension" class="headerlink" title="äºŒã€Extension"></a>äºŒã€Extension</h3><p>Extension æ˜¯Categoryçš„ç‰¹ä¾‹ï¼Œå°‘äº†ç±»åˆ«çš„åç§°ï¼Œæ˜¯åŒ¿ååˆ†ç±»ã€‚å£°æ˜ç§æœ‰æ–¹æ³•å’Œå±æ€§çš„æœºåˆ¶ã€‚å…·ä½“å®ç°åœ¨åŸæœ‰ç±»çš„.mæ–‡ä»¶ä¸­ã€‚</p>
<h4 id="1ã€Extensionçš„æ ¼å¼"><a href="#1ã€Extensionçš„æ ¼å¼" class="headerlink" title="1ã€Extensionçš„æ ¼å¼"></a>1ã€Extensionçš„æ ¼å¼</h4><pre><code>@interface XXX ()
    //ç§æœ‰å±æ€§
    //ç§æœ‰æ–¹æ³•ï¼ˆå¦‚æœä¸å®ç°ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥è­¦,Method definition for &apos;XXX&apos; not foundï¼‰
@end
</code></pre><h4 id="2ã€Extensionçš„å®ç°"><a href="#2ã€Extensionçš„å®ç°" class="headerlink" title="2ã€Extensionçš„å®ç°"></a>2ã€Extensionçš„å®ç°</h4><ul>
<li>é€šè¿‡å•ç‹¬çš„.hå£°æ˜ï¼Œåœ¨åŸæœ‰ç±»çš„.mä¸­å¯¼å…¥ã€‚</li>
<li>ç›´æ¥åœ¨åŸæœ‰ç±»çš„.mä¸­ä½¿ç”¨ã€‚</li>
</ul>
<h2 id="Categoryå’ŒExtensionçš„åŒºåˆ«-1"><a href="#Categoryå’ŒExtensionçš„åŒºåˆ«-1" class="headerlink" title="Categoryå’ŒExtensionçš„åŒºåˆ«"></a>Categoryå’ŒExtensionçš„åŒºåˆ«</h2><ul>
<li>CategoryåŸåˆ™ä¸Šåªèƒ½å¢åŠ æ–¹æ³•ï¼›è€ŒExtensionæ–¹æ³•å’Œå˜é‡éƒ½å¯ä»¥ã€‚</li>
<li>Extensionå£°æ˜æ–¹æ³•æ²¡æœ‰è¢«å®ç°ï¼Œç¼–è¯‘å™¨æŠ¥è­¦ã€‚Categoryåœ¨è¿è¡Œæ—¶æ·»åŠ ã€Extensionæ˜¯ç¼–è¯‘é˜¶æ®µã€‚</li>
<li>Extensionæ²¡æœ‰è‡ªå·±ç‹¬ç«‹çš„å®ç°éƒ¨åˆ†ã€‚</li>
<li>Extensionæ˜¯ç§æœ‰ã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»Category å’Œ Extension çš„ç›¸å…³çŸ¥è¯†ä»¥åŠä½¿ç”¨ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="wanglibin" scheme="http://xgfe.github.io/categories/wanglibin/"/>
    
    
      <category term="OC" scheme="http://xgfe.github.io/tags/OC/"/>
    
      <category term="Category" scheme="http://xgfe.github.io/tags/Category/"/>
    
      <category term="Extension" scheme="http://xgfe.github.io/tags/Extension/"/>
    
  </entry>
  
  <entry>
    <title>Day.js æºç å­¦ä¹ </title>
    <link href="http://xgfe.github.io/2018/07/11/guanxiaofeng/Dayjs/"/>
    <id>http://xgfe.github.io/2018/07/11/guanxiaofeng/Dayjs/</id>
    <published>2018-07-11T04:00:00.000Z</published>
    <updated>2018-07-31T07:49:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>dayjs æ˜¯ä¸€ä¸ªè½»é‡çš„ JavaScript æ—¶é—´æ—¥æœŸå¤„ç†åº“ï¼Œå…¶ç”¨æ³•ï¼ˆapiï¼‰å’Œ Moment.js å®Œå…¨ä¸€æ ·ã€‚<br><a id="more"></a></p>
<p>ğŸ“š<a href="https://github.com/iamkun/dayjs/blob/master/docs/zh-cn/API-reference.md" target="_blank" rel="external">å®˜æ–¹ API æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰</a></p>
<h2 id="ä¸€-ç‰¹æ€§"><a href="#ä¸€-ç‰¹æ€§" class="headerlink" title="ä¸€ ç‰¹æ€§"></a>ä¸€ ç‰¹æ€§</h2><ul>
<li>å’Œ Moment.js ç›¸åŒçš„ API å’Œç”¨æ³•</li>
<li>ä¸å¯å˜æ•°æ®ï¼ˆImmutableï¼‰</li>
<li>æ”¯æŒé“¾å¼æ“ä½œï¼ˆChainableï¼‰</li>
<li>l18n å›½é™…åŒ–</li>
<li>ä»… 2kb å¤§å°</li>
<li>å…¨æµè§ˆå™¨å…¼å®¹</li>
</ul>
<p>åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().startOf(<span class="string">'month'</span>).add(<span class="number">1</span>, <span class="string">'day'</span>).set(<span class="string">'year'</span>, <span class="number">2018</span>).format(<span class="string">'YYYY-MM-DD HH:mm:ss'</span>);</div></pre></td></tr></table></figure></p>
<h2 id="äºŒ-è§£æ"><a href="#äºŒ-è§£æ" class="headerlink" title="äºŒ è§£æ"></a>äºŒ è§£æ</h2><h3 id="æ„é€ å™¨-dayjs-existing-string-number-Date-Dayjs"><a href="#æ„é€ å™¨-dayjs-existing-string-number-Date-Dayjs" class="headerlink" title="æ„é€ å™¨ dayjs(existing?: string | number | Date | Dayjs)"></a>æ„é€ å™¨ dayjs(existing?: string | number | Date | Dayjs)</h3><p>ä»æºç å¯ä»¥çœ‹å‡ºï¼Œè°ƒç”¨ dayjs æ—¶ä¼šè¿”å›ä¸€ä¸ª Dayjs å¯¹è±¡ï¼ŒDayjs æ„é€ å™¨è°ƒç”¨äº† parseDate æ–¹æ³•ï¼Œè¿”å›äº†ä¸€ä¸ªå…¨æ–°çš„åŒ…å« Javascript Date å¯¹è±¡çš„ Dayjs çš„å¯¹è±¡ï¼›å…¶ä»–çš„å€¼éƒ½æ˜¯æ ¹æ® Javascript Date å¯¹è±¡å¾—æ¥çš„ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// éƒ¨åˆ†æºç </span></div><div class="line"><span class="keyword">const</span> dayjs = <span class="function">(<span class="params">date, c</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span> (isDayjs(date)) &#123;</div><div class="line">    <span class="keyword">return</span> date.clone()</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">const</span> cfg = c || &#123;&#125;</div><div class="line">  cfg.date = date</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Dayjs(cfg) <span class="comment">// eslint-disable-line no-use-before-define</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> parseDate = <span class="function">(<span class="params">date</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">let</span> reg</div><div class="line">  <span class="keyword">if</span> (date === <span class="literal">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="literal">NaN</span>) <span class="comment">// Treat null as an invalid date</span></div><div class="line">  <span class="keyword">if</span> (Utils.isUndefined(date)) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">  <span class="keyword">if</span> (date <span class="keyword">instanceof</span> <span class="built_in">Date</span>) <span class="keyword">return</span> date</div><div class="line">  <span class="comment">// eslint-disable-next-line no-cond-assign</span></div><div class="line">  <span class="keyword">if</span> ((<span class="keyword">typeof</span> date === <span class="string">'string'</span>)</div><div class="line">    &amp;&amp; (<span class="regexp">/.*[^Z]$/i</span>.test(date)) <span class="comment">// looking for a better way</span></div><div class="line">    &amp;&amp; (reg = date.match(C.REGEX_PARSE))) &#123;</div><div class="line">    <span class="comment">// 2018-08-08 or 20180808</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(</div><div class="line">      reg[<span class="number">1</span>], reg[<span class="number">2</span>] - <span class="number">1</span>, reg[<span class="number">3</span>] || <span class="number">1</span>,</div><div class="line">      reg[<span class="number">5</span>] || <span class="number">0</span>, reg[<span class="number">6</span>] || <span class="number">0</span>, reg[<span class="number">7</span>] || <span class="number">0</span>, reg[<span class="number">8</span>] || <span class="number">0</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(date) <span class="comment">// timestamp</span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dayjs</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(cfg) &#123;</div><div class="line">    <span class="keyword">this</span>.parse(cfg) <span class="comment">// for plugin</span></div><div class="line">  &#125;</div><div class="line">  parse(cfg) &#123;</div><div class="line">    <span class="keyword">this</span>.$d = parseDate(cfg.date)</div><div class="line">    <span class="keyword">this</span>.init(cfg)</div><div class="line">  &#125;</div><div class="line">  init(cfg) &#123;</div><div class="line">    <span class="keyword">this</span>.$y = <span class="keyword">this</span>.$d.getFullYear()</div><div class="line">    <span class="keyword">this</span>.$M = <span class="keyword">this</span>.$d.getMonth()</div><div class="line">    <span class="keyword">this</span>.$D = <span class="keyword">this</span>.$d.getDate()</div><div class="line">    <span class="keyword">this</span>.$W = <span class="keyword">this</span>.$d.getDay()</div><div class="line">    <span class="keyword">this</span>.$H = <span class="keyword">this</span>.$d.getHours()</div><div class="line">    <span class="keyword">this</span>.$m = <span class="keyword">this</span>.$d.getMinutes()</div><div class="line">    <span class="keyword">this</span>.$s = <span class="keyword">this</span>.$d.getSeconds()</div><div class="line">    <span class="keyword">this</span>.$ms = <span class="keyword">this</span>.$d.getMilliseconds()</div><div class="line">    <span class="keyword">this</span>.$L = <span class="keyword">this</span>.$L || parseLocale(cfg.locale, <span class="literal">null</span>, <span class="literal">true</span>) || L</div><div class="line">  &#125;</div><div class="line">  <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ init å®ä¾‹æ–¹æ³•ä¸­ï¼Œä½¿ç”¨å®ä¾‹å±æ€§ $dï¼ˆä¸º JavaScript åŸç”Ÿ Date å¯¹è±¡ï¼‰æ¥è·å– å¹´ã€æœˆã€æ—¥ã€å‘¨ã€æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ï¼Œä¸”ä¿å­˜åœ¨å®ä¾‹ä¸­ã€‚å¹¶ä¸”è°ƒç”¨ parseLocale å‡½æ•°æ¥è·å–è¯­è¨€ï¼Œèµ‹å€¼ç»™ Dayjs å®ä¾‹çš„ $L å±æ€§ã€‚</p>
<p>å¯ä¼ å‚æ•°æœ‰5ç±»ï¼š  </p>
<h5 id="1-å½“å‰æ—¶é—´"><a href="#1-å½“å‰æ—¶é—´" class="headerlink" title="1.å½“å‰æ—¶é—´"></a>1.å½“å‰æ—¶é—´</h5><p>dayjs æœ¬è´¨ä¸Šæ˜¯ä¸ªå‡½æ•°ï¼Œå› æ­¤å¯ä»¥ç›´æ¥è¿è¡Œè¯¥å‡½æ•°ï¼Œå¾—åˆ°åŒ…å«å½“å‰æ—¶é—´å’Œæ—¥æœŸçš„ Dayjs å¯¹è±¡ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs();</div></pre></td></tr></table></figure></p>
<h5 id="2-æ ‡å‡†çš„-ISO-8601-æ—¶é—´å­—ç¬¦ä¸²"><a href="#2-æ ‡å‡†çš„-ISO-8601-æ—¶é—´å­—ç¬¦ä¸²" class="headerlink" title="2.æ ‡å‡†çš„ ISO 8601 æ—¶é—´å­—ç¬¦ä¸²"></a>2.æ ‡å‡†çš„ ISO 8601 æ—¶é—´å­—ç¬¦ä¸²</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs(<span class="string">"2018-07-14"</span>);</div></pre></td></tr></table></figure>
<h5 id="3-è§£æ-Unix-æ—¶é—´æˆ³-æ¯«ç§’"><a href="#3-è§£æ-Unix-æ—¶é—´æˆ³-æ¯«ç§’" class="headerlink" title="3.è§£æ Unix æ—¶é—´æˆ³(æ¯«ç§’)"></a>3.è§£æ Unix æ—¶é—´æˆ³(æ¯«ç§’)</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs(<span class="number">1531469940578</span>);</div></pre></td></tr></table></figure>
<h5 id="4-è§£æ-Date-å¯¹è±¡"><a href="#4-è§£æ-Date-å¯¹è±¡" class="headerlink" title="4.è§£æ Date å¯¹è±¡"></a>4.è§£æ Date å¯¹è±¡</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2018</span>,<span class="number">5</span>,<span class="number">3</span>));</div></pre></td></tr></table></figure>
<h5 id="5-è§£æ-dayjs-å¯¹è±¡"><a href="#5-è§£æ-dayjs-å¯¹è±¡" class="headerlink" title="5.è§£æ dayjs å¯¹è±¡"></a>5.è§£æ dayjs å¯¹è±¡</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs(dayjs());</div></pre></td></tr></table></figure>
<h3 id="å…‹éš†"><a href="#å…‹éš†" class="headerlink" title="å…‹éš†"></a>å…‹éš†</h3><p>dayjs å¯¹è±¡æ˜¯ä¸å¯å˜çš„å¦‚æœè¦å¤åˆ¶å¯¹è±¡ï¼Œéœ€è¦è°ƒç”¨ .clone()ï¼Œæˆ–è€…æ˜¯åœ¨è§£æä¸€ä¸ª dayjs å¯¹è±¡ã€‚ å‘ dayjs() é‡Œä¼ å…¥ä¸€ä¸ª Dayjs å¯¹è±¡ä¹Ÿèƒ½å®ç°åŒæ ·çš„æ•ˆæœã€‚<br><figure class="highlight console"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dayjs().clone();</div><div class="line">dayjs(Dayjs);</div></pre></td></tr></table></figure></p>
<p>éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> wrapper = <span class="function">(<span class="params">date, instance</span>) =&gt;</span> dayjs(date, &#123; <span class="attr">locale</span>: instance.$L &#125;)</div><div class="line">clone() &#123;</div><div class="line">  <span class="keyword">return</span> wrapper(<span class="keyword">this</span>.toDate(), <span class="keyword">this</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>æ£€æµ‹å½“å‰ Dayjs å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ—¶é—´ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().isValid();</div></pre></td></tr></table></figure></p>
<p>éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">isValid() &#123;</div><div class="line">  <span class="keyword">return</span> !(<span class="keyword">this</span>.$d.toString() === <span class="string">'Invalid Date'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ä¸‰-è·å–-è®¾ç½®"><a href="#ä¸‰-è·å–-è®¾ç½®" class="headerlink" title="ä¸‰ è·å–+è®¾ç½®"></a>ä¸‰ è·å–+è®¾ç½®</h2><h5 id="è·å–å„ç§æ—¶é—´"><a href="#è·å–å„ç§æ—¶é—´" class="headerlink" title="è·å–å„ç§æ—¶é—´"></a>è·å–å„ç§æ—¶é—´</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dayjs().year();        <span class="comment">// å¹´</span></div><div class="line">dayjs().month();       <span class="comment">// æœˆ</span></div><div class="line">dayjs().date();        <span class="comment">// æ—¥</span></div><div class="line">dayjs().day();         <span class="comment">// æ˜ŸæœŸ(æ˜ŸæœŸå¤© 0, æ˜ŸæœŸå…­ 6)</span></div><div class="line">dayjs().hour();        <span class="comment">// æ—¶</span></div><div class="line">dayjs().minute();      <span class="comment">// åˆ†</span></div><div class="line">dayjs().second();      <span class="comment">// ç§’</span></div><div class="line">dayjs().millisecond(); <span class="comment">// æ¯«ç§’</span></div></pre></td></tr></table></figure>
<h5 id="è®¾ç½®å„ç§æ—¶é—´"><a href="#è®¾ç½®å„ç§æ—¶é—´" class="headerlink" title="è®¾ç½®å„ç§æ—¶é—´"></a>è®¾ç½®å„ç§æ—¶é—´</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dayjs().set(unit : <span class="built_in">String</span>, <span class="attr">value</span> : Int);</div><div class="line">dayjs().set(<span class="string">'date'</span>, <span class="number">1</span>);</div><div class="line">dayjs().set(<span class="string">'month'</span>, <span class="number">3</span>); <span class="comment">// å››æœˆ</span></div><div class="line">dayjs().set(<span class="string">'second'</span>, <span class="number">30</span>);</div></pre></td></tr></table></figure>
<p>è®¾ç½®æ—¶é—´ä¹Ÿæ˜¯é€šè¿‡è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set(string, int) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.clone().$set(string, int)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="å››-æ ¼å¼åŒ–æ˜¾ç¤º"><a href="#å››-æ ¼å¼åŒ–æ˜¾ç¤º" class="headerlink" title="å›› æ ¼å¼åŒ–æ˜¾ç¤º"></a>å›› æ ¼å¼åŒ–æ˜¾ç¤º</h2><p>æ ¼å¼åŒ–æ˜¾ç¤ºå’Œ momentjs ä¸€æ ·ï¼Œé€šè¿‡ .format() å³å¯ï¼Œè¿”å›çš„æ˜¯ String ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dayjs().format(<span class="built_in">String</span>);</div><div class="line">dayjs().format();             <span class="comment">// "2018-07-13T20:10:31+08:00"</span></div><div class="line">dayjs().format(<span class="string">'YYYY-MM-DD'</span>); <span class="comment">// "2018-07-13"</span></div><div class="line">dayjs().format(<span class="string">'YYYY/MM/DD'</span>); <span class="comment">// "2018/07/13"</span></div></pre></td></tr></table></figure></p>
<h2 id="äº”-æ“ä½œ"><a href="#äº”-æ“ä½œ" class="headerlink" title="äº” æ“ä½œ"></a>äº” æ“ä½œ</h2><h5 id="å¢åŠ å’Œå‡å°‘"><a href="#å¢åŠ å’Œå‡å°‘" class="headerlink" title="å¢åŠ å’Œå‡å°‘"></a>å¢åŠ å’Œå‡å°‘</h5><p>åœ¨æ­¤ä¹‹å‰å…ˆçœ‹çœ‹æºç å®ç°çš„é€»è¾‘ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">// éƒ¨åˆ†æºç </span></div><div class="line">add(number, units) &#123;</div><div class="line">  number = <span class="built_in">Number</span>(number) <span class="comment">// eslint-disable-line no-param-reassign</span></div><div class="line">  <span class="keyword">const</span> unit = Utils.prettyUnit(units)</div><div class="line">  <span class="keyword">const</span> instanceFactory = <span class="function">(<span class="params">u, n</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> date = <span class="keyword">this</span>.set(C.DATE, <span class="number">1</span>).set(u, n + number)</div><div class="line">    <span class="keyword">return</span> date.set(C.DATE, <span class="built_in">Math</span>.min(<span class="keyword">this</span>.$D, date.daysInMonth()))</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (unit === C.M) &#123;</div><div class="line">    <span class="keyword">return</span> instanceFactory(C.M, <span class="keyword">this</span>.$M)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (unit === C.Y) &#123;</div><div class="line">    <span class="keyword">return</span> instanceFactory(C.Y, <span class="keyword">this</span>.$y)</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">let</span> step</div><div class="line">  <span class="keyword">switch</span> (unit) &#123;</div><div class="line">    <span class="keyword">case</span> C.MIN:</div><div class="line">      step = C.MILLISECONDS_A_MINUTE</div><div class="line">      <span class="keyword">break</span></div><div class="line">    <span class="keyword">case</span> C.H:</div><div class="line">      step = C.MILLISECONDS_A_HOUR</div><div class="line">      <span class="keyword">break</span></div><div class="line">    <span class="keyword">case</span> C.D:</div><div class="line">      step = C.MILLISECONDS_A_DAY</div><div class="line">      <span class="keyword">break</span></div><div class="line">    <span class="keyword">case</span> C.W:</div><div class="line">      step = C.MILLISECONDS_A_WEEK</div><div class="line">      <span class="keyword">break</span></div><div class="line">    <span class="keyword">case</span> C.S:</div><div class="line">      step = C.MILLISECONDS_A_SECOND</div><div class="line">      <span class="keyword">break</span></div><div class="line">    <span class="keyword">default</span>: <span class="comment">// ms</span></div><div class="line">      step = <span class="number">1</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">const</span> nextTimeStamp = <span class="keyword">this</span>.valueOf() + (number * step)</div><div class="line">  <span class="keyword">return</span> wrapper(nextTimeStamp, <span class="keyword">this</span>)</div><div class="line">&#125;</div><div class="line">subtract(number, string) &#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.add(number * <span class="number">-1</span>, string)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ Dayjs ç±»ä¸­ addã€subtract ç­‰æ–¹æ³•ï¼Œéƒ½ä¼šé€šè¿‡ wrapper è¿”å›ä¸€ä¸ªæ–°çš„ Dayjs å®ä¾‹ï¼Œæ˜¯é€šè¿‡ä½¿ç”¨ Dayjs ç±»ä¸­çš„ clone() æ–¹æ³•å®ç°çš„ã€‚æ‰€ä»¥ï¼Œé€šè¿‡è¿™ä¸ª clone() æ–¹æ³•ï¼Œå®ç°äº† dayjs çš„ immutable ç‰¹æ€§ã€‚<br>å½“å¢åŠ æˆ–å‡å°‘çš„å•ä½æ˜¯å¹´æˆ–æœˆæ—¶ï¼Œä¼šå…ˆå°†æ—¥è®¾ç½®ä¸º1ï¼Œç„¶åå†åŠ å‡ï¼Œæœ€åå†æ¯”è¾ƒå½“å‰æœˆçš„æ€»å¤©æ•°å’ŒåŸæ¥çš„å¤©æ•°ï¼ˆä¸»è¦æ˜¯è§£å†³åƒ2æœˆåªæœ‰28å¤©è¿™ç±»é—®é¢˜ï¼‰ï¼Œå–è¾ƒå°çš„å€¼å†è¿”å›ï¼›å¯¹äºå¤©ï¼å‘¨ï¼æ—¶ï¼åˆ†ï¼ç§’åˆ™æ˜¯æŒ‰ç…§æ—¶é—´æˆ³æ¥è®¡ç®—ï¼Œå†é€šè¿‡ wrapper è¿”å›ä¸€ä¸ªæ–°çš„ Date å¯¹è±¡ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dayjs().add(value : <span class="built_in">Number</span>, <span class="attr">unit</span> : <span class="built_in">String</span>);</div><div class="line">dayjs().add(<span class="number">5</span>, <span class="string">'day'</span>);</div><div class="line">dayjs().subtract(value : <span class="built_in">Number</span>, <span class="attr">unit</span> : <span class="built_in">String</span>);</div><div class="line">dayjs().subtract(<span class="number">2</span>, <span class="string">'year'</span>);</div></pre></td></tr></table></figure></p>
<h5 id="å¼€å¤´å’Œæœ«å°¾"><a href="#å¼€å¤´å’Œæœ«å°¾" class="headerlink" title="å¼€å¤´å’Œæœ«å°¾"></a>å¼€å¤´å’Œæœ«å°¾</h5><p>è¿”å›å½“å‰æ—¶é—´çš„å¼€å¤´æ—¶é—´çš„ Dayjs å¯¹è±¡ï¼Œå¦‚æœˆä»½çš„ç¬¬ä¸€å¤©ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dayjs().startOf(unit : <span class="built_in">String</span>);</div><div class="line">dayjs().startOf(<span class="string">'year'</span>).format(<span class="string">'YYYY-MM-DD'</span>);  <span class="comment">// 2018-01-01</span></div></pre></td></tr></table></figure></p>
<p>è¿”å›å½“å‰æ—¶é—´çš„æœ«å°¾æ—¶é—´çš„ Dayjs å¯¹è±¡ï¼Œå¦‚æœˆä»½çš„æœ€åä¸€å¤©ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dayjs().endOf(unit : <span class="built_in">String</span>);</div><div class="line">dayjs().endOf(<span class="string">'month'</span>).format(<span class="string">'YYYY-MM-DD'</span>); <span class="comment">// 2018-07-31</span></div></pre></td></tr></table></figure>
<h2 id="å…­-æ—¶é—´å·®"><a href="#å…­-æ—¶é—´å·®" class="headerlink" title="å…­ æ—¶é—´å·®"></a>å…­ æ—¶é—´å·®</h2><p>æ—¶é—´å·®æ˜¯ä¸¤ä¸ª dayjs å¯¹è±¡çš„ä¹‹å·®æ‰€å¾—çš„æ¯«ç§’æ•°ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dayjs().diff(Dayjs, unit);</div><div class="line">dayjs().diff(dayjs(<span class="string">'2000-2-1'</span>), <span class="string">'years'</span>); <span class="comment">// 18</span></div></pre></td></tr></table></figure></p>
<p>æºç é€»è¾‘æ˜¯å…ˆè®¡ç®—å‡ºä¸¤ä¸ªæ—¶é—´ç›¸å·®çš„æ¯«ç§’æ•°å’Œæœˆæ•°ï¼Œå†æ ¹æ®ä¼ å…¥çš„å•ä½å»é€‰æ‹©è®¡ç®—ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">diff(input, units, float) &#123;</div><div class="line">    <span class="keyword">const</span> unit = Utils.prettyUnit(units)</div><div class="line">    <span class="keyword">const</span> that = dayjs(input)</div><div class="line">    <span class="keyword">const</span> diff = <span class="keyword">this</span> - that</div><div class="line">    <span class="keyword">let</span> result = Utils.monthDiff(<span class="keyword">this</span>, that)</div><div class="line">    <span class="keyword">switch</span> (unit) &#123;</div><div class="line">      <span class="keyword">case</span> C.Y:</div><div class="line">        result /= <span class="number">12</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> C.M:</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> C.Q:</div><div class="line">        result /= <span class="number">3</span></div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> C.W:</div><div class="line">        result = diff / C.MILLISECONDS_A_WEEK</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> C.D:</div><div class="line">        result = diff / C.MILLISECONDS_A_DAY</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> C.H:</div><div class="line">        result = diff / C.MILLISECONDS_A_HOUR</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> C.MIN:</div><div class="line">        result = diff / C.MILLISECONDS_A_MINUTE</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">case</span> C.S:</div><div class="line">        result = diff / C.MILLISECONDS_A_SECOND</div><div class="line">        <span class="keyword">break</span></div><div class="line">      <span class="keyword">default</span>: <span class="comment">// milliseconds</span></div><div class="line">        result = diff</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> float ? result : Utils.absFloor(result)</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h2 id="ä¸ƒ-å…¶ä»–æ–¹æ³•"><a href="#ä¸ƒ-å…¶ä»–æ–¹æ³•" class="headerlink" title="ä¸ƒ å…¶ä»–æ–¹æ³•"></a>ä¸ƒ å…¶ä»–æ–¹æ³•</h2><h5 id="è·å–-unix-æ¯«ç§’æ—¶é—´æˆ³ï¼š"><a href="#è·å–-unix-æ¯«ç§’æ—¶é—´æˆ³ï¼š" class="headerlink" title="è·å– unix æ¯«ç§’æ—¶é—´æˆ³ï¼š"></a>è·å– unix æ¯«ç§’æ—¶é—´æˆ³ï¼š</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().valueOf(); <span class="comment">// 1531633650522</span></div></pre></td></tr></table></figure>
<h5 id="è·å–-unix-ç§’çº§æ—¶é—´æˆ³ï¼š"><a href="#è·å–-unix-ç§’çº§æ—¶é—´æˆ³ï¼š" class="headerlink" title="è·å– unix ç§’çº§æ—¶é—´æˆ³ï¼š"></a>è·å– unix ç§’çº§æ—¶é—´æˆ³ï¼š</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().unix(); <span class="comment">// 1531633677</span></div></pre></td></tr></table></figure>
<h5 id="è¿”å›æœˆä»½çš„å¤©æ•°ï¼š"><a href="#è¿”å›æœˆä»½çš„å¤©æ•°ï¼š" class="headerlink" title="è¿”å›æœˆä»½çš„å¤©æ•°ï¼š"></a>è¿”å›æœˆä»½çš„å¤©æ•°ï¼š</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().daysInMonth(); <span class="comment">// 31</span></div></pre></td></tr></table></figure>
<h5 id="è·å–-Date-å¯¹è±¡ï¼š"><a href="#è·å–-Date-å¯¹è±¡ï¼š" class="headerlink" title="è·å– Date å¯¹è±¡ï¼š"></a>è·å– Date å¯¹è±¡ï¼š</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().toDate(); <span class="comment">// Sun Jul 15 2018 13:48:41 GMT+0800 (CST)</span></div></pre></td></tr></table></figure>
<h5 id="è·å–æ•°ç»„æ ¼å¼ï¼š"><a href="#è·å–æ•°ç»„æ ¼å¼ï¼š" class="headerlink" title="è·å–æ•°ç»„æ ¼å¼ï¼š"></a>è·å–æ•°ç»„æ ¼å¼ï¼š</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().toArray(); <span class="comment">//[2018, 6, 13, 20, 34, 13, 424];</span></div></pre></td></tr></table></figure>
<h5 id="è·å–å¯¹è±¡æ ¼å¼ï¼š"><a href="#è·å–å¯¹è±¡æ ¼å¼ï¼š" class="headerlink" title="è·å–å¯¹è±¡æ ¼å¼ï¼š"></a>è·å–å¯¹è±¡æ ¼å¼ï¼š</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dayjs().toObject();<span class="comment">// &#123;years: 2018, months: 6, date: 13, hours: 20, minutes: 34...&#125;</span></div></pre></td></tr></table></figure>
<h2 id="å…«-dayjs-æ’ä»¶ç”¨æ³•"><a href="#å…«-dayjs-æ’ä»¶ç”¨æ³•" class="headerlink" title="å…« dayjs æ’ä»¶ç”¨æ³•"></a>å…« dayjs æ’ä»¶ç”¨æ³•</h2><p>dayjs çš„æ’ä»¶ï¼Œé€šè¿‡æŒ‚è½½åˆ° dayjs å‡½æ•°ä¸‹çš„ extend å‡½æ•°åŠ è½½ï¼Œç„¶åä½¿ç”¨ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> plugin <span class="comment">// å¯¼å…¥æ’ä»¶</span></div><div class="line">dayjs.extend(plugin, options) <span class="comment">// åŠ è½½æ’ä»¶çš„åŒæ—¶ï¼ŒåŠ å…¥æ’ä»¶æ‰€éœ€è¦çš„å‚æ•°</span></div></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨å®˜æ–¹çš„ IsLeapYear æ’ä»¶(åˆ¤æ–­æ˜¯å¦æ˜¯é—°å¹´):<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> isLeapYear <span class="keyword">from</span> <span class="string">'dayjs/plugin/isLeapYear'</span></div><div class="line">dayjs.extend(isLeapYear)</div><div class="line">dayjs(<span class="string">'2000-01-01'</span>).isLeapYear() <span class="comment">// true</span></div><div class="line">dayjs(<span class="string">'2018-01-01'</span>).isLeapYear() <span class="comment">// false</span></div></pre></td></tr></table></figure></p>
<p>dayjs.extend() æ–¹æ³•ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå³æ’ä»¶ï¼ˆå‡½æ•°ï¼‰å’Œæ’ä»¶çš„é€‰é¡¹ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æ‰©å±•æ’ä»¶çš„æ–¹æ³•</span></div><div class="line"><span class="comment">// pluginï¼šæ’ä»¶å‡½æ•°</span></div><div class="line"><span class="comment">// optionï¼šæ’ä»¶çš„é€‰é¡¹</span></div><div class="line">dayjs.extend = <span class="function">(<span class="params">plugin, option</span>) =&gt;</span> &#123;</div><div class="line">  <span class="comment">// æ’ä»¶å‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°</span></div><div class="line">  <span class="comment">// 1.æ’ä»¶é€‰é¡¹ 2.Dayjs ç±» 3.dayjs å‡½æ•°</span></div><div class="line">  <span class="comment">// æ’ä»¶çš„æ–¹æ³•éƒ½æ˜¯æŒ‚è½½åœ¨ Dayjs ç±»çš„åŸå‹å¯¹è±¡ä¸Šçš„ï¼ˆDayjs.prototypeï¼‰ã€‚</span></div><div class="line">  plugin(option, Dayjs, dayjs)</div><div class="line">  <span class="keyword">return</span> dayjs</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>IsLeapYear çš„æºç å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> (o, c) =&gt; &#123;</div><div class="line">  <span class="keyword">const</span> proto = c.prototype</div><div class="line">  proto.isLeapYear = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> ((<span class="keyword">this</span>.$y % <span class="number">4</span> === <span class="number">0</span>) &amp;&amp; (<span class="keyword">this</span>.$y % <span class="number">100</span> !== <span class="number">0</span>)) || (<span class="keyword">this</span>.$y % <span class="number">400</span> === <span class="number">0</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å°† isLeapYear å‡½æ•°æŒ‚è½½åˆ° Dayjs ç±»çš„åŸå‹ä¸Šï¼Œæ‰€ä»¥æ¯ä¸ª Dayjs å®ä¾‹éƒ½å¯ä»¥ä½¿ç”¨ isLeapYear æ–¹æ³•ã€‚</p>
<hr>
<h2 id="æ„Ÿè°¢"><a href="#æ„Ÿè°¢" class="headerlink" title="æ„Ÿè°¢"></a>æ„Ÿè°¢</h2><p> ç‰¹åˆ«æ„Ÿè°¢ DaisyXL å’Œ Young çš„æ”¯æŒå’Œåˆ†æï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;dayjs æ˜¯ä¸€ä¸ªè½»é‡çš„ JavaScript æ—¶é—´æ—¥æœŸå¤„ç†åº“ï¼Œå…¶ç”¨æ³•ï¼ˆapiï¼‰å’Œ Moment.js å®Œå…¨ä¸€æ ·ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="guanxiaofeng" scheme="http://xgfe.github.io/categories/guanxiaofeng/"/>
    
    
      <category term="dayjs" scheme="http://xgfe.github.io/tags/dayjs/"/>
    
      <category term="momentjs" scheme="http://xgfe.github.io/tags/momentjs/"/>
    
  </entry>
  
  <entry>
    <title>Web å‰ç«¯å®‰å…¨ç§‘æ™®ä¹‹ XSS</title>
    <link href="http://xgfe.github.io/2018/06/13/wangpeiyu/web-security-XSS/"/>
    <id>http://xgfe.github.io/2018/06/13/wangpeiyu/web-security-XSS/</id>
    <published>2018-06-13T03:00:00.000Z</published>
    <updated>2018-08-24T03:26:27.000Z</updated>
    
    <content type="html"><![CDATA[<p>Web å‰ç«¯çš„å®‰å…¨ä¸»è¦æœ‰ä¸‰ç±»ï¼šXSSã€CSRFã€ç•Œé¢æ“ä½œåŠ«æŒã€‚</p>
<p>XSSï¼ˆCross Site Scriptingï¼‰ï¼Œå³è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ï¼Œæ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„ Script ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­çš„ Script ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p>
<p>CSRFï¼ˆCross Site Request Forgeryï¼‰ï¼Œå³è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œé€šè¿‡ä¼ªè£…æ¥è‡ªå—ä¿¡ä»»ç”¨æˆ·çš„è¯·æ±‚æ¥åˆ©ç”¨å—ä¿¡ä»»çš„ç½‘ç«™ã€‚</p>
<p>ç•Œé¢åŠ«æŒæ“ä½œæ˜¯ä¸€ç§åŸºäºè§†è§‰æ¬ºéª—çš„Webä¼šè¯åŠ«æŒæ”»å‡»ï¼ŒåŒ…æ‹¬ç‚¹å‡»åŠ«æŒã€æ‹–æ”¾åŠ«æŒå’Œè§¦å±åŠ«æŒä¸‰ç§ç±»å‹ã€‚</p>
<p>åœ¨ OWASP TOP 10ä¸­ï¼ŒXSS ä¸€ç›´éƒ½æ˜¯ååˆ—å‰èŒ…ï¼Œæœ‰äº† XSS æ¼æ´ï¼Œå°±æ„å‘³ç€å¯ä»¥æ³¨å…¥ä»»æ„çš„ JavaScriptï¼Œè¢«æ”»å‡»è€…çš„ä»»æ„æ“ä½œéƒ½å¯ä»¥è¿›è¡Œæ¨¡æ‹Ÿï¼Œä»»ä½•éšç§ä¿¡æ¯éƒ½å¯ä»¥è·å–åˆ°ã€‚åŸºäºä¸Šè¿°èƒŒæ™¯ï¼Œæœ¬æ–‡å°†å¯¹ XSS æ”»å‡»çš„åŸç†ã€ç±»å‹åŠé˜²å¾¡è¿›è¡Œä»‹ç»ã€‚</p>
<a id="more"></a>
<h2 id="XSS-åŸç†"><a href="#XSS-åŸç†" class="headerlink" title="XSS åŸç†"></a>XSS åŸç†</h2><p>è·¨ç«™è„šæœ¬çš„é‡ç‚¹åœ¨è„šæœ¬ä¸Šï¼Œç»å¤§å¤šæ•°çš„ XSS ä¼šé‡‡ç”¨ä¸€æ®µè¿œç¨‹æˆ–è€…ç¬¬ä¸‰æ–¹åŸŸä¸Šçš„è„šæœ¬èµ„æºï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯æ”»å‡»ä»£ç å®¹æ˜“æ§åˆ¶ã€‚script æ ‡ç­¾å¯ä»¥åµŒå…¥ç¬¬ä¸‰æ–¹èµ„æºï¼Œè¿™æ˜¯æµè§ˆå™¨å…è®¸çš„ï¼Œå¯¹äºåµŒå…¥çš„è„šæœ¬å†…å®¹ï¼Œä¼šä¸æœ¬åŸŸçš„è„šæœ¬å†…å®¹ä¸€æ ·ï¼Œåœ¨æ•´ä¸ªè„šæœ¬ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªåœºæ™¯ä¸­çš„å„ç§åŠŸèƒ½éƒ½å¯ä»¥ç”±åµŒå…¥çš„è„šæœ¬å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ JavaScript èƒ½åšåˆ°ä»€ä¹ˆæ•ˆæœï¼ŒXSS çš„å¨åŠ›å°±æœ‰å¤šå¤§ã€‚</p>
<p>JavaScript å¯ä»¥ç”¨ç”¨æ¥è·å–çš„ Cookieã€æ”¹å˜ç½‘é¡µå†…å®¹ã€URL è·³è½¬ï¼Œé‚£ä¹ˆå­˜åœ¨ XSS æ¼æ´çš„ç½‘ç«™ï¼Œå°±å¯ä»¥ç›—å–ç”¨æˆ· Cookieã€é»‘æ‰é¡µé¢ã€å¯¼èˆªåˆ°æ¶æ„ç½‘ç«™ï¼Œè€Œæ”»å‡»è€…éœ€è¦åšçš„ä»…ä»…æ˜¯å‘ Web é¡µé¢ä¸­æ³¨å…¥ JavaScript ä»£ç ã€‚</p>
<p>XSS æ”»å‡»åŸç†ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><p>æ”»å‡»è€…å¯¹æŸå«æœ‰æ¼æ´çš„æœåŠ¡å™¨å‘èµ· XSS æ”»å‡»ï¼ˆæ³¨å…¥ JS ä»£ç ï¼‰ã€‚</p>
</li>
<li><p>è¯±ä½¿å—å®³è€…æ‰“å¼€å—åˆ°æ”»å‡»çš„æœåŠ¡å™¨ URLï¼ˆé‚®ä»¶ã€ç•™è¨€ç­‰ï¼Œæ­¤æ­¥éª¤å¯é€‰é¡¹ï¼‰ã€‚</p>
</li>
<li><p>å—å®³è€…åœ¨ Web æµè§ˆå™¨ä¸­æ‰“å¼€ URLï¼Œæ¶æ„è„šæœ¬æ‰§è¡Œã€‚</p>
</li>
</ul>
<p>XSS æ„é€ çš„ä¾‹å­ï¼š</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// ç›®æ ‡ç½‘ç«™åœ¨æœåŠ¡ç«¯å°†ç”¨æˆ·è¾“å…¥å†…å®¹ç›´æ¥æ‹¼æ¥åˆ°è¿”å› HTML é‡Œ</div><div class="line">res.body = &apos;...&lt;div&gt;&apos; + data.ç”¨æˆ·è¾“å…¥çš„å†…å®¹ + &apos;&lt;/div&gt;...&apos;</div><div class="line"></div><div class="line">// æ”»å‡»è€…åœ¨é¡µé¢ä¸­æäº¤äº†è¿™æ ·çš„å†…å®¹ï¼š</div><div class="line">&lt;script&gt;alert(123)&lt;/script&gt;</div></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// ç›®æ ‡ç½‘ç«™åœ¨æœåŠ¡ç«¯å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ç›´æ¥æ‹¼æ¥åˆ°äº†é¡µé¢å…ƒç´ çš„å±æ€§ä¸­</div><div class="line">res.body = &apos;...&lt;img src=&quot; + data.ç”¨æˆ·è¾“å…¥çš„å›¾ç‰‡åœ°å€ + &quot;&gt;...&apos;</div><div class="line"></div><div class="line">// æ”»å‡»è€…åœ¨é¡µé¢ä¸­æäº¤äº†è¿™æ ·çš„å†…å®¹ï¼š</div><div class="line">&quot; /&gt;&lt;script&gt;alert(123)&lt;/script&gt;</div></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// ç›®æ ‡ç½‘ç«™åœ¨é¡µé¢ä¸­å°†é€šè¿‡ AJAX å–å¾—çš„ç”¨æˆ·è¾“å…¥çš„å†…å®¹å¡«åˆ°é¡µé¢ä¸­</div><div class="line">div.innerHTML = data.ç”¨æˆ·è¾“å…¥çš„å†…å®¹</div><div class="line"></div><div class="line">// ä¸åŒäºç›´æ¥æ‹¼æ¥ï¼ŒinnerHTML ä¸­çš„ script æ ‡ç­¾ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†æ˜¯æ”»å‡»è€…å¯ä»¥è¿™ä¹ˆå†™ï¼š</div><div class="line">&lt;img src=&quot;x.png&quot; onload=&quot;alert(123)&quot;&gt;</div></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// ç›®æ ‡ç½‘ç«™åœ¨é¡µé¢ä¸­å°†é€šè¿‡ AJAX å–å¾—çš„ç”¨æˆ·è¾“å…¥çš„å†…å®¹å¡«åˆ°é¡µé¢å…ƒç´ çš„å±æ€§ä¸­</div><div class="line">a.href = data.ç”¨æˆ·è¾“å…¥çš„é“¾æ¥</div><div class="line"></div><div class="line">// ä¸åŒäºç›´æ¥æ‹¼æ¥ï¼Œç»™å…ƒç´ çš„å±æ€§èµ‹å€¼æ—¶å†…å®¹æ€»ä¼šè¢«å½“æˆå­—ç¬¦ä¸²ï¼Œä½†æ˜¯æ”»å‡»è€…å¯ä»¥è¿™ä¹ˆå†™ï¼Œå¦‚ç”¨æˆ·ç‚¹äº†é“¾æ¥å°±ä¼šå—åˆ°æ”»å‡»ï¼š</div><div class="line">javascript:alert(123)</div></pre></td></tr></table></figure>
</code></pre><h2 id="XSS-ç±»å‹"><a href="#XSS-ç±»å‹" class="headerlink" title="XSS ç±»å‹"></a>XSS ç±»å‹</h2><p>XSS æœ‰ä¸‰ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯åå°„å‹ XSSã€å­˜å‚¨å‹ XSSã€DOM XSSï¼Œä¸‹é¢åˆ†åˆ«å¯¹è¿™ä¸‰ç§ XSS è¿›è¡Œä»‹ç»ã€‚</p>
<h3 id="åå°„å‹-XSS"><a href="#åå°„å‹-XSS" class="headerlink" title="åå°„å‹ XSS"></a>åå°„å‹ XSS</h3><p>åå°„å‹ XSS ä¹Ÿè¢«ç§°ä¸ºéæŒä¹…æ€§ XSSï¼Œæ˜¯æœ€å®¹æ˜“å‡ºç°çš„ä¸€ç§ XSS æ¼æ´ï¼ŒæŒ‡çš„æ˜¯å‘é€è¯·æ±‚æ—¶ï¼ŒXSS ä»£ç å‡ºç°åœ¨ URL ä¸­ï¼Œä½œä¸ºè¾“å…¥æäº¤åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è§£æåå“åº”ï¼Œåœ¨å“åº”å†…å®¹ä¸­å‡ºç°è¿™æ®µ XSS ä»£ç ï¼Œæœ€åè¢«æµè§ˆå™¨è§£ææ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ä¸€æ¬¡åå°„ï¼Œæ•…ç§°ä¸ºåå°„å‹ XSSã€‚å®ƒçš„æ•°æ®æµå‘æ˜¯ï¼šæµè§ˆå™¨ -&gt; åç«¯ -&gt; æµè§ˆå™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// æœåŠ¡ç«¯ä»£ç </div><div class="line">&lt;?php</div><div class="line">    echo $_GET[&apos;x&apos;];</div><div class="line">?&gt;</div><div class="line"></div><div class="line">// åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥</div><div class="line">http://xssdemo.wpy.com/domxss.html#alert(1)</div></pre></td></tr></table></figure>
<p><img src="http://vfile.meituan.net/xgfe/a7271f75b155dbab2e0c3fb758cbe111100565.png" alt="åå°„å‹XSS"></p>
<h3 id="å­˜å‚¨å‹-XSS"><a href="#å­˜å‚¨å‹-XSS" class="headerlink" title="å­˜å‚¨å‹ XSS"></a>å­˜å‚¨å‹ XSS</h3><p>å­˜å‚¨å‹ XSS åˆè¢«ç§°ä¸ºæ°¸ä¹…æ€§ XSSï¼Œæ˜¯æœ€å±é™©çš„ä¸€ç§è·¨ç«™è„šæœ¬ï¼ŒæŒ‡çš„æ˜¯å‘é€è¯·æ±‚æ—¶ï¼Œæäº¤çš„ XSS ä»£ç ä¼šå­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼ˆä¸ç®¡æ˜¯æ•°æ®åº“ã€å†…å­˜è¿˜æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œä¸‹æ¬¡è¯·æ±‚ç›®æ ‡é¡µé¢æ—¶ä¸ç”¨å†æäº¤ XSS ä»£ç ï¼Œå­˜å‚¨å‹ XSS çš„æ”»å‡»æ˜¯æœ€éšè”½çš„ï¼Œå…¶å±å®³æ€§ä¹Ÿæ›´å¤§ã€‚ä¸åå°„å‹ XSS å’Œ DOM XSS ç›¸æ¯”ï¼Œå­˜å‚¨å‹ XSS çš„æ‰§è¡Œä¸éœ€è¦æ‰‹åŠ¨è§¦å‘ã€‚æœ€å…¸å‹çš„ä¾‹å­æ˜¯ç•™è¨€æ¿ XSSï¼Œç”¨æˆ·æäº¤ä¸€æ¡åŒ…å« XSS ä»£ç çš„ç•™è¨€å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œç›®æ ‡ç”¨æˆ·æŸ¥çœ‹ç•™è¨€æ¿æ—¶ï¼Œé‚£äº›ç•™è¨€çš„å†…å®¹å°±ä¼šä»æ•°æ®åº“æŸ¥è¯¢å‡ºæ¥å¹¶æ˜¾ç¤ºï¼Œæµè§ˆå™¨å‘ç°æœ‰ XSS ä»£ç ï¼Œå°±å½“åšæ­£å¸¸çš„ HTML ä¸ JS è§£ææ‰§è¡Œï¼Œäºæ˜¯å°±è§¦å‘äº† XSS æ”»å‡»ã€‚å®ƒçš„æ•°æ®æµå‘æ˜¯ï¼šæµè§ˆå™¨ -&gt; åç«¯ -&gt; æ•°æ®åº“ -&gt; åç«¯ -&gt; æµè§ˆå™¨ã€‚</p>
<h3 id="DOM-XSS"><a href="#DOM-XSS" class="headerlink" title="DOM XSS"></a>DOM XSS</h3><p>DOM XSS æŒ‡çš„æ˜¯ XSS ä»£ç å¹¶ä¸éœ€è¦æœåŠ¡å™¨è§£æå“åº”çš„ç›´æ¥å‚ä¸ï¼Œè§¦å‘ XSS é çš„å°±æ˜¯æµè§ˆå™¨ç«¯çš„ DOM è§£æï¼Œå¯ä»¥è®¤ä¸ºå®Œå…¨æ˜¯å®¢æˆ·ç«¯çš„äº‹æƒ…ã€‚å®ƒçš„æ•°æ®æµå‘æ˜¯ï¼šURL-&gt;æµè§ˆå™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// å®¢æˆ·ç«¯çš„è„šæœ¬</div><div class="line">&lt;script&gt;eval(location.hash.substr(1));&lt;/script&gt;</div><div class="line"></div><div class="line">// ç”¨æˆ·ç‚¹å‡»è¿™ä¸ª URL# åçš„å†…å®¹ä¸ä¼šå‘é€åˆ°æœåŠ¡ç«¯ï¼Œä»…åœ¨å®¢æˆ·ç«¯è¢«æ¥æ”¶å¹¶è§£é‡Šæ‰§è¡Œã€‚</div><div class="line">http://xssdemo.wpy.com/domxss.html#alert(1)</div></pre></td></tr></table></figure>
<p><img src="http://vfile.meituan.net/xgfe/919bcf853c27bbd16656cfa83b8b6ef887889.png" alt="DOM XSS"></p>
<h4 id="DOM-XSS-åœºæ™¯ä¸€ï¼šåœ¨å‰ç«¯å®ç°é¡µé¢è·³è½¬"><a href="#DOM-XSS-åœºæ™¯ä¸€ï¼šåœ¨å‰ç«¯å®ç°é¡µé¢è·³è½¬" class="headerlink" title="DOM XSS åœºæ™¯ä¸€ï¼šåœ¨å‰ç«¯å®ç°é¡µé¢è·³è½¬"></a>DOM XSS åœºæ™¯ä¸€ï¼šåœ¨å‰ç«¯å®ç°é¡µé¢è·³è½¬</h4><p>åœ¨å‰ç«¯å®ç°é¡µé¢è·³è½¬ï¼Œå‰ç«¯é€šå¸¸ä¼šé€šè¿‡ JavaScript å®ç°è·³è½¬ï¼Œæœ€å¸¸ç”¨åˆ°çš„æ–¹æ³•æœ‰: location.href / location.replace() / location.assign()ã€‚ åœ¨è¯¥åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡ä¼ªåè®®â€œjavascript:â€ã€â€œdata:â€åœ¨æµè§ˆå™¨ä¸‹æ‰§è¡Œè„šæœ¬ã€‚ä½†æ˜¯è¿™ç§é€šè¿‡ä¼ªåè®®è¿›è¡Œæ”»å‡»å·²ç»éšç€å‰ç«¯å·¥ç¨‹å¤„ç†å¯¹ç›¸å…³è·³è½¬ä»£ç é€»è¾‘åšäº†å¾ˆå¥½çš„å®Œå–„ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šå†å‡ºç°ä¸Šè¿°çš„è¿™ç§æƒ…å†µã€‚ä½†æ˜¯å¦‚ä¸‹ä¸¤ç§æƒ…å†µå´ä¸º Web æ”»å‡»æ‰“å¼€äº†å¤©çª—ï¼š</p>
<ul>
<li><p>ä½¿ç”¨ indexOf åˆ¤æ–­ URL å‚æ•°æ˜¯å¦åˆæ³•ï¼ŒindexOf() æ–¹æ³•å¯è¿”å›æŸä¸ªæŒ‡å®šçš„å­—ç¬¦ä¸²å€¼åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ã€‚è¯¥æ–¹æ³•å°†ä»å¤´åˆ°å°¾åœ°æ£€ç´¢å­—ç¬¦ä¸² stringObjectï¼Œçœ‹å®ƒæ˜¯å¦å«æœ‰å­ä¸² searchvalueã€‚æ‰€ä»¥å¦‚æœ URL ä¸­åŒ…å«äº†ä¼ªä»£ç åŠæ”»å‡»ä»£ç ï¼Œå°±ä¼šè¢«æ”»å‡»ã€‚</p>
</li>
<li><p>æ­£åˆ™è¡¨è¾¾å¼åˆ¤æ–­ URL æ˜¯å¦åˆæ³•ï¼Œä¸ºäº†é¿å…ä½¿ç”¨ indexOf åˆ¤æ–­ URL å¸¦æ¥çš„ç¼ºé™·ï¼Œæœ‰äº›å¼€å‘äººå‘˜ä¼šæƒ³åˆ°ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†å¿˜äº†ä¸€ä¸ªç¥å¥‡çš„ç¬¦å·â€œ^â€ï¼ŒåŠ ä¸Šå’Œä¸åŠ ä¸Šï¼Œè¿‡æ»¤çš„æ•ˆæœå…·æœ‰å¤©å£¤ä¹‹åˆ«ï¼Œå¦‚æœæ²¡æœ‰åŠ â€œ^â€ï¼Œæ”»å‡»è€…ä»ç„¶å¯ä»¥ç»•è¿‡æ­£åˆ™çš„è¿‡æ»¤ï¼Œåœ¨URLä¸­æ¤å…¥ä¼ªä»£ç å’Œæ”»å‡»ä»£ç ã€‚</p>
</li>
<li><p>ä¿®å¤æ–¹æ¡ˆï¼šåœ¨å‰ç«¯å®ç°é¡µé¢è·³è½¬ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæ­£ç¡®çš„è¿‡æ»¤å®ç°æ–¹æ³•æ˜¯ï¼Œä¸¥æ ¼é™åˆ¶è·³è½¬èŒƒå›´ã€‚ä¸€æ–¹é¢è¦é™åˆ¶èƒ½å¤Ÿè·³è½¬é¡µé¢çš„åè®®ï¼šåªèƒ½æ˜¯ httpã€https æˆ–æ˜¯å…¶ä»–æŒ‡å¯æ§åè®®ï¼›å¦ä¸€æ–¹é¢ï¼Œè¦ä¸¥æ ¼é™åˆ¶è·³è½¬çš„èŒƒå›´ï¼Œå¦‚æœä¸šåŠ¡åªè¦è·³è½¬åˆ°æŒ‡å®šçš„å‡ ä¸ªé¡µé¢ï¼Œå¯ä»¥ç›´æ¥ä»æ•°ç»„ä¸­å–å€¼åˆ¤æ–­æ˜¯å¦è¿™å‡ ä¸ªé¡µé¢ï¼Œå¦‚æœè·³è½¬èŒƒå›´ç¨å¤§ï¼Œæ­£ç¡®ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å°†è·³è½¬URLä¸¥æ ¼é™åˆ¶åˆ°å¯æ§èŒƒå›´å†…ã€‚ </p>
</li>
</ul>
<h4 id="DOM-XSS-åœºæ™¯äºŒï¼šå–å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œ"><a href="#DOM-XSS-åœºæ™¯äºŒï¼šå–å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œ" class="headerlink" title="DOM XSS åœºæ™¯äºŒï¼šå–å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œ"></a>DOM XSS åœºæ™¯äºŒï¼šå–å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œ</h4><p>é™¤æ¥æ”¶ URL å‚æ•°ç»åç«¯å¤„ç†æœ€ååœ¨å‰ç«¯å±•ç¤ºå¤–ï¼Œåœ¨ Web å‰ç«¯é€šè¿‡ JavaScript è·å–ä¸åŒæ¥æºçš„å‚æ•°å€¼ï¼Œä¸ç»åç«¯å¤„ç†å³åˆ»åœ¨ Web é¡µé¢è¿›è¡Œå±•ç¤ºæˆ–åŠ¨æ€æ‰§è¡Œçš„ä¸šåŠ¡åœºæ™¯ä¹Ÿååˆ†å¸¸è§ï¼Œæƒ³è¦åœ¨å®¢æˆ·ç«¯å®ç°æ¥å—å‚æ•°å¹¶å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œï¼Œå°±ä¸å¾—ä¸ç”¨åˆ° innerHTMLã€document.writeã€evalã€‚å› ä¸º JavaScript å–å€¼çš„æ¥æºçº·ç¹å¤æ‚ï¼Œå¦‚æœå¿˜è®°åšè½¬ä¹‰å¤„ç†ï¼Œæˆ–è¿‡åˆ†ç›¸ä¿¡å–å€¼æ¥æºçš„æ•°æ®ï¼Œç›´æ¥å°†åˆ†ç¦»å‡ºçš„å‚æ•°å€¼äº¤ç»™ JavaScriptinnerHTMLã€document.writeã€evalå¤„ç†ï¼Œå°±æœ‰å¯èƒ½æ‹›æ¥ DOM-XSSã€‚ä¸‹é¢æ˜¯ä¸‰ç§å¸¸è§çš„ç¼ºé™·ï¼š </p>
<ul>
<li><p>ä» URL ä¸­çš„å–å‚æ•°å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œï¼Œå¦‚ç›´æ¥ä» URL çš„é”šå‚æ•°ï¼ˆå³ä½äº#åé¢çš„å‚æ•°ï¼‰ä¸­å–å€¼ï¼Œä¸ç»è¿‡ä»»ä½•å¤„ç†ç›´æ¥ innerHTML å†™å…¥é¡µé¢ï¼Œå¯¼è‡´æ”»å‡»è€…åªéœ€è¦æ„é€ å¦‚ä¸‹URLå³å¯å®Œæˆä¸€æ¬¡ DOM XSS æ”»å‡»ã€‚ç”±äºæ•´ä¸ªæ”»å‡»è¿‡ç¨‹åœ¨å®¢æˆ·ç«¯ä¾§å®Œæˆï¼Œä¸éœ€è¦å‘æœåŠ¡å™¨å‘é€ä»»ä½•è¯·æ±‚æ•°æ®ï¼Œæ‰€ä»¥å³ä¾¿ä¸šåŠ¡æ¥å…¥äº†å¯¹æŠ—åå°„å‹ XSS çš„ Web åº”ç”¨é˜²ç«å¢™ï¼ˆWAFï¼‰ï¼Œè¿™ç±» DOM XSS ä¹Ÿæ— æ³•è¢«æ„ŸçŸ¥ï¼Œæ”»å‡»è€…ä¾¿å¯ç•…é€šæ— é˜»çš„åˆ©ç”¨æ¼æ´å¯¹ç”¨æˆ·å¼€å±•æ”»å‡»ã€‚ </p>
</li>
<li><p>ä» Cookie ä¸­çš„å–å‚æ•°å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œï¼ŒåŸç†åŸºæœ¬åŒä» URL ä¸­çš„å–å‚æ•°å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œï¼Œåªæ˜¯æ¢äº†ä¸€ä¸ªå–å€¼æ¥æºè€Œå·²ã€‚</p>
</li>
<li><p>ä» LocalStorageã€Refererã€Window nameã€SessionStorageä¸­çš„å–å‚æ•°å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œ ï¼Œå¦‚å– window.name çš„å€¼ï¼Œæœ€åç›´æ¥ innerHTML åˆ°é¡µé¢ä¸­ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¡µé¢çš„ window.name æ”»å‡»è€…ä¸å¯æ§ï¼Œæ•…å¾€å¾€ä¼šè¢«è®¤ä¸ºæ¥æºç›¸å¯¹å¯ä¿¡ã€‚ä½†å€ŸåŠ©i frame çš„ name å±æ€§ï¼Œæ”»å‡»è€…å¯ä»¥å°†é¡µé¢çš„ window.name è®¾ç½®ä¸ºæ”»å‡»ä»£ç ï¼Œä»ç„¶å¯ä»¥æ„é€  DOM XSSã€‚</p>
</li>
<li><p>ä¿®å¤æ–¹æ¡ˆï¼š</p>
<ul>
<li><p>å†™å…¥é¡µé¢å‰å…ˆè½¬ä¹‰ã€‚åœ¨å–å€¼å†™å…¥é¡µé¢æˆ–åŠ¨æ€æ‰§è¡Œçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œåœ¨å°†å„ç§æ¥æºè·å–åˆ°çš„å‚æ•°å€¼ä¼ å…¥JavaScriptâ€œä¸‰å§å¦¹â€å‡½æ•°ï¼ˆinnerHTMLã€document.writeã€evalï¼‰å¤„ç†å‰ï¼Œå¯¹ä¼ å…¥æ•°æ®ä¸­çš„ HTML ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰å¤„ç†èƒ½é˜²æ­¢å¤§éƒ¨åˆ† DOM-XSS çš„äº§ç”Ÿã€‚æ­¤å¤–ï¼Œæ ¹æ®ä¸åŒä¸šåŠ¡çš„çœŸå®æƒ…å†µï¼Œè¿˜åº”ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé’ˆå¯¹ä¼ å…¥çš„æ•°æ®åšæ›´ä¸¥æ ¼çš„è¿‡æ»¤é™åˆ¶ï¼Œæ‰èƒ½ä¿è¯ä¸‡æ— ä¸€å¤±ã€‚ </p>
</li>
<li><p>æ…ç”¨å±é™©çš„â€œevalâ€ã€‚éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œç”±äº JavaScript ä¸­çš„ eval å‡½æ•°ååˆ†çµæ´»ï¼Œèƒ½å¤Ÿæ”¯æŒæ‰§è¡Œçš„å­—ç¬¦ä¸²ç¼–ç çº·ç¹å¤æ‚ã€‚å¼ºçƒˆå»ºè®®ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œä¸è¦ä½¿ç”¨ eval<br>å‡½æ•°å¤„ç†ä¸å¯æ§çš„å¤–éƒ¨æ•°æ®ã€‚ </p>
</li>
<li><p>ç¼–å†™å®‰å…¨çš„å‡½æ•°æ–¹æ³•ï¼Œä»çœ‹ä¼¼â€œå¯é â€çš„æ•°æ®æºè·å–å‚æ•°å€¼ã€‚æ— è®ºæ˜¯ä» Cookieï¼Œè¿˜æ˜¯ä»LocalStorageã€Refererã€Window nameã€SessionStorage ä¸­è·å–æ•°æ®ï¼Œéƒ½åº”ä½¿ç”¨å®‰å…¨çš„å‡½æ•°ï¼Œå¯¹ä¼ å…¥çš„æ•°æ®åšè¿‡æ»¤åï¼Œå†ä¼ é€’ç»™ç›¸å…³å‡½æ•°å†™å…¥é¡µé¢æˆ–æ‰§è¡Œã€‚ </p>
</li>
</ul>
</li>
</ul>
<h2 id="XSS-å±å®³"><a href="#XSS-å±å®³" class="headerlink" title="XSS å±å®³"></a>XSS å±å®³</h2><ul>
<li><p>ç›—å–ç”¨æˆ·çš„ Cookieï¼ŒCookie ç»å¸¸è¢«ç”¨æ¥å­˜å‚¨ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•è®¤è¯åçš„ sessionï¼Œä¹‹ååŒåŸŸå†…å‘å‡ºçš„è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Šè®¤è¯åçš„ä¼šè¯ä¿¡æ¯ã€‚å¦‚æœ Cookieè¢«ç›—å–ï¼Œæ”»å‡»è€…å°±å¯ä»¥ä¸ç”¨é€šè¿‡å¯†ç è€Œç›´æ¥ç™»å½•ç”¨æˆ·çš„è´¦æˆ·ã€‚Cookie çš„é‡è¦å­—æ®µï¼š[name] [value] [domain] [path] [expires] [httponly] [secure]ï¼Œå…¶å«ä¹‰ä¾æ¬¡æ˜¯ï¼šåç§°ã€å€¼ã€æ‰€å±åŸŸåã€æ‰€å±ç›¸å¯¹æ ¹è·¯å¾„ã€è¿‡æœŸæ—¶é—´ã€æ˜¯å¦æœ‰ HttpOnly æ ‡å¿—ã€æ˜¯å¦æœ‰ Secure æ ‡å¿—ã€‚å¦‚æœè®¾ç½®äº† HttpOnly æ ‡å¿—ï¼Œå®¢æˆ·ç«¯è„šæœ¬å°±æ— æ³•é€šè¿‡document.cookie è·å–è¯¥ Cookieï¼Œè¿™æ ·å°±èƒ½æœ‰æ•ˆåœ°é˜²å¾¡ XSS æ”»å‡»è·å– Cookieã€‚</p>
</li>
<li><p>æ„å»º GET å’Œ POST è¯·æ±‚ï¼Œå¦‚æœ Cookie è®¾ç½®äº† HttpOnly æ ‡å¿—ï¼Œåˆ™æ— æ³•ç›´æ¥åŠ«æŒ Cookie æ¥ä½¿ç”¨äº†ï¼Œä½†æ˜¯ XSS å¯ä»¥åœ¨ JavaScript ä¸­æ„å»º GET æˆ–è€… POST è¯·æ±‚ï¼Œæ¥å®ç°è‡ªå·±çš„æ”»å‡»ã€‚åªè¦è®©ç”¨æˆ·æ‰§è¡Œä¸‹é¢è¿™æ®µè„šæœ¬ï¼Œå°±èƒ½å‘èµ· GET è¯·æ±‚ï¼Œæ”»å‡»è€…é€šè¿‡ XSS è¯±å¯¼ç”¨æˆ·æ¥æ‰§è¡Œã€‚XSS çš„æ”»å‡»è¿‡ç¨‹éƒ½æ˜¯åœ¨æµè§ˆå™¨é€šè¿‡æ‰§è¡Œ JavaScript è„šæœ¬è‡ªåŠ¨è¿›è¡Œï¼Œç¼ºå°‘ä¸ç”¨æˆ·äº¤äº’çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚åœ¨ POST çš„è¯·æ±‚ä¸­ï¼Œå¦‚æœéœ€è¦è¾“å…¥éªŒè¯ç ï¼ŒJS ä»£ç æ— æ³•è§£æéªŒè¯ç ï¼Œæ”»å‡»ä¹Ÿå°±æ— æ³•å®ç°ã€‚ä½†æ˜¯é’ˆå¯¹éªŒè¯ç è¿™ç§æƒ…å†µï¼Œå¦‚æœ XSS å¯ä»¥é€šè¿‡æŠŠéªŒè¯ç çš„å›¾ç‰‡å‘åˆ°è¿œç«¯æ”»å‡»æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è§£æéªŒè¯ç ç„¶åæŠŠç»“æœè¿”å›ç»™ JS ä»£ç ï¼ŒJS è·å–åç»§ç»­è¿›è¡Œæ”»å‡»ï¼Œä¸è¿‡å°±æ˜¯æˆæœ¬æœ‰ç‚¹é«˜ã€‚</p>
</li>
<li><p>XSS é’“é±¼ï¼šä¸Šé¢æ¨¡æ‹Ÿç”¨æˆ·çš„ POST è¯·æ±‚è²Œä¼¼æˆæœ¬æœ‰ç‚¹é«˜ï¼Œæ”»å‡»è€…å¯ä»¥å°† XSS å’Œé’“é±¼ç»“åˆåœ¨ä¸€èµ·ï¼Œä¾‹å¦‚é€šè¿‡ JavaScript ä»£ç æ¨¡æ‹Ÿå‡ºç½‘ç«™çš„ç™»å½•æ¡†ï¼Œç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç åï¼ŒXSS å°†è¿™äº›ä¿¡æ¯å‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è¿›è¡Œæ”»å‡»ã€‚</p>
</li>
<li><p>è·å–ç”¨æˆ·ç³»ç»Ÿä¿¡æ¯ï¼Œæ­¤å¤– XSS è¿˜å¯ä»¥è¯†åˆ«ç”¨æˆ·çš„æµè§ˆå™¨ä¿¡æ¯ã€ç”¨æˆ·å®‰è£…çš„è½¯ä»¶ä»¥åŠç”¨æˆ·çœŸå®çš„ IP ç­‰ä¿¡æ¯ã€‚</p>
</li>
<li><p>XSS Wormï¼šè¿™æ˜¯ XSS çš„ä¸€ç§ç»ˆæåˆ©ç”¨æ–¹å¼ï¼Œç ´ååŠ›å’Œå½±å“åŠ›æ˜¯å·¨å¤§çš„ï¼Œä¸è •è™«ç—…æ¯’ä¸€æ ·å…·æœ‰â€œä¼ æŸ“æ€§â€ï¼Œä¸ç³»ç»Ÿç—…æ¯’çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯æ— æ³•å¯¹ç³»ç»Ÿåº•å±‚æ“ä½œã€‚XSS è •è™«æ˜¯é’ˆå¯¹æµè§ˆå™¨çš„æ”»å‡»ï¼Œç½‘ç«™è§„æ¨¡è¶Šå¤§ï¼Œæ”»å‡»æ•ˆæœå°±è¶Šå¤§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”¨æˆ·ç›´æ¥å‘ç”Ÿäº¤äº’è¡Œä¸ºçš„é¡µé¢ï¼Œå¦‚æœå­˜åœ¨å­˜å‚¨å‹ XSSï¼Œåˆ™æ¯”è¾ƒå®¹æ˜“å‘èµ· Worm æ”»å‡»ã€‚</p>
</li>
</ul>
<h2 id="XSS-é˜²å¾¡"><a href="#XSS-é˜²å¾¡" class="headerlink" title="XSS é˜²å¾¡"></a>XSS é˜²å¾¡</h2><ul>
<li><p>ä»»ä½•ç”±ç”¨æˆ·è¾“å‡ºçš„æ•°æ®éƒ½æ˜¯ä¸å¯ä¿¡çš„ã€‚</p>
</li>
<li><p>ä¸è¦åœ¨å¥‡æ€ªçš„åœ°æ–¹æ’å…¥ä¸å¯ä¿¡çš„æ•°æ®ã€‚</p>
<p><img src="http://vfile.meituan.net/xgfe/0a853e1b33a7dfaeb4aa47f12453026b97763.png" alt="ä¸å¯ä¿¡æ•°æ®"></p>
</li>
<li><p>è¿›è¡Œè¾“å…¥è¾“å‡ºæ£€æŸ¥ï¼Œå°†æœŸæœ›è¢«å½“æˆå­—ç¬¦ä¸²çš„ä¸å¯ä¿¡æ•°æ®è½¬ä¹‰åå†æ’å…¥æ–‡æ¡£ä¸­ï¼Œä¸åŒä½ç½®éœ€è¦ä½¿ç”¨ä¸åŒçš„è½¬ä¹‰é€»è¾‘ã€‚</p>
<p><img src="http://vfile.meituan.net/xgfe/3df441ed85fa308c54a059924acd16e0248873.png" alt="è¾“å…¥è¾“å‡ºæ£€æŸ¥"></p>
</li>
<li><p>å°†æœŸæœ›è¢«å½“æˆ HTML çš„ä¸å¯ä¿¡æ•°æ®ä½¿ç”¨ä¸“ä¸šçš„åº“æ¶ˆæ¯’åå†æ’å…¥æ–‡æ¡£ä¸­ã€‚</p>
</li>
<li><p>ä½¿ç”¨ HttpOnly çš„ Cookieï¼Œç»™å…³é”®çš„ Cookie è®¾ç½® HttpOnly å±æ€§ï¼Œè¿™æ ·èƒ½å¤Ÿé¿å… JS è¯»å– Cookieä¿¡æ¯ï¼Œè®¾ç½®åæœ‰åŠ©äºç¼“è§£ XSSï¼Œä½†æ˜¯ XSS é™¤äº†åŠ«æŒ Cookie ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·çš„èº«ä»½è¿›è¡Œæ“ä½œã€‚</p>
</li>
<li><p>ä½¿ç”¨å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰æ˜¯å¯¹æŠ— XSS çš„æ·±åº¦é˜²å¾¡ç­–ç•¥ï¼Œå†…å®¹å®‰å…¨ç­–ç•¥å¯ä»¥ä»¥ç™½åå•çš„æ–¹å¼é™å®šå“ªäº›åœ°æ–¹çš„å†…å®¹å¯ä»¥è¢«åŠ è½½å’Œæ‰§è¡Œï¼Œå¦‚æœä¸å­˜åœ¨å¯ä»¥é€šè¿‡æœ¬åœ°æ–‡ä»¶æ”¾ç½®æ¶æ„ä»£ç çš„å…¶ä»–æ¼æ´ï¼Œåˆ™è¯¥ç­–ç•¥æ˜¯æœ‰æ•ˆçš„ã€‚</p>
</li>
<li><p>ä½¿ç”¨è®¾è®¡ä¸Šå°±ä¼šè‡ªåŠ¨ç¼–ç æ¥è§£å†³XSSé—®é¢˜çš„æ¡†æ¶ï¼Œå¦‚ï¼šReact JSã€‚äº†è§£æ¯ä¸ªæ¡†æ¶çš„ XSS ä¿æŠ¤çš„å±€é™æ€§ï¼Œå¹¶é€‚å½“åœ°å¤„ç†æœªè¦†ç›–çš„ç”¨ä¾‹ã€‚</p>
</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><p><a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet" target="_blank" rel="external">XSSæ”»å‡»æ‰‹å†Œ</a></p>
</li>
<li><p><a href="https://www.owasp.org/index.php/XSS_Prevention_Cheat_Sheet" target="_blank" rel="external">XSSé˜²å¾¡æ‰‹å†Œ</a></p>
</li>
<li><p>ã€ŠWebå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜ã€‹</p>
</li>
<li><p>ã€ŠWebå®‰å…¨æ·±åº¦å‰–æã€‹</p>
</li>
<li><p>ã€Šç™½å¸½å­è®²Webå®‰å…¨ã€‹</p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Web å‰ç«¯çš„å®‰å…¨ä¸»è¦æœ‰ä¸‰ç±»ï¼šXSSã€CSRFã€ç•Œé¢æ“ä½œåŠ«æŒã€‚&lt;/p&gt;
&lt;p&gt;XSSï¼ˆCross Site Scriptingï¼‰ï¼Œå³è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ï¼Œæ¶æ„æ”»å‡»è€…å¾€ Web é¡µé¢é‡Œæ’å…¥æ¶æ„ Script ä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­çš„ Script ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;CSRFï¼ˆCross Site Request Forgeryï¼‰ï¼Œå³è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œé€šè¿‡ä¼ªè£…æ¥è‡ªå—ä¿¡ä»»ç”¨æˆ·çš„è¯·æ±‚æ¥åˆ©ç”¨å—ä¿¡ä»»çš„ç½‘ç«™ã€‚&lt;/p&gt;
&lt;p&gt;ç•Œé¢åŠ«æŒæ“ä½œæ˜¯ä¸€ç§åŸºäºè§†è§‰æ¬ºéª—çš„Webä¼šè¯åŠ«æŒæ”»å‡»ï¼ŒåŒ…æ‹¬ç‚¹å‡»åŠ«æŒã€æ‹–æ”¾åŠ«æŒå’Œè§¦å±åŠ«æŒä¸‰ç§ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ OWASP TOP 10ä¸­ï¼ŒXSS ä¸€ç›´éƒ½æ˜¯ååˆ—å‰èŒ…ï¼Œæœ‰äº† XSS æ¼æ´ï¼Œå°±æ„å‘³ç€å¯ä»¥æ³¨å…¥ä»»æ„çš„ JavaScriptï¼Œè¢«æ”»å‡»è€…çš„ä»»æ„æ“ä½œéƒ½å¯ä»¥è¿›è¡Œæ¨¡æ‹Ÿï¼Œä»»ä½•éšç§ä¿¡æ¯éƒ½å¯ä»¥è·å–åˆ°ã€‚åŸºäºä¸Šè¿°èƒŒæ™¯ï¼Œæœ¬æ–‡å°†å¯¹ XSS æ”»å‡»çš„åŸç†ã€ç±»å‹åŠé˜²å¾¡è¿›è¡Œä»‹ç»ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="wangpeiyu" scheme="http://xgfe.github.io/categories/wangpeiyu/"/>
    
    
      <category term="XSS" scheme="http://xgfe.github.io/tags/XSS/"/>
    
      <category term="Web å®‰å…¨" scheme="http://xgfe.github.io/tags/Web-%E5%AE%89%E5%85%A8/"/>
    
      <category term="å‰ç«¯å®‰å…¨" scheme="http://xgfe.github.io/tags/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Egg.js ä½“éªŒ</title>
    <link href="http://xgfe.github.io/2018/05/26/guanxiaofeng/Eggjs/"/>
    <id>http://xgfe.github.io/2018/05/26/guanxiaofeng/Eggjs/</id>
    <published>2018-05-26T07:00:00.000Z</published>
    <updated>2018-07-31T07:49:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Egg.js åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨ä»¥åŠæ¡†æ¶çš„æ‰©å±•ã€‚<br><a id="more"></a></p>
<h2 id="Egg-js-æ˜¯ä»€ä¹ˆ"><a href="#Egg-js-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Egg.js æ˜¯ä»€ä¹ˆ?"></a>Egg.js æ˜¯ä»€ä¹ˆ?</h2><p>ï»¿Egg.js æ˜¯ä¸€ä¸ªå¼ºçº¦æŸçš„ Node æ¡†æ¶ï¼Œè¿™ä¹Ÿæ˜¯å’Œ Express / Koa æœ€å¤§çš„ä¸åŒï¼Œåè€…å¯¹å¼€å‘è€…ç›¸å¯¹å®½æ¾ï¼Œä¸»è¦ä½“ç°åœ¨ç›®å½•ç»“æ„ã€ç¼–å†™æ–¹å¼ç­‰å‡å¯ä»¥è‡ªå®šä¹‰ï¼Œæ ‡å‡†çš„ mvc æ¨¡å¼æœ‰åƒå¥‡ç™¾æ€ªçš„å†™æ³•ã€‚</p>
<p> Egg.js å¥‰è¡Œã€çº¦å®šä¼˜äºé…ç½®ã€ï¼Œä»–è§„å®šä¸€å®šçš„çº¦å®šï¼Œè®©å¼€å‘è€…éƒ½æŒ‰ç…§ç»Ÿä¸€çš„çº¦å®šå»å¼€å‘ï¼Œé™ä½å›¢é˜Ÿåä½œæˆæœ¬ï¼Œå‡å°‘å·®å¼‚ï¼Œæ±‚åŒå­˜å¼‚ï¼Œæå‡é¡¹ç›®é˜…è¯»å’Œç»´æŠ¤æ€§ã€‚ä½†çº¦å®šä¸ç­‰äºæ‰©å±•æ€§å·®ï¼Œç›¸å Egg.js æœ‰å¾ˆé«˜çš„æ‰©å±•æ€§ã€‚</p>
<h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ï»¿ç‰¹æ€§"></a>ï»¿ç‰¹æ€§</h3><pre><code>* æä¾›åŸºäº Egg å®šåˆ¶ä¸Šå±‚æ¡†æ¶çš„èƒ½åŠ›
* é«˜åº¦å¯æ‰©å±•çš„æ’ä»¶æœºåˆ¶
* å†…ç½®å¤šè¿›ç¨‹ç®¡ç†
* åŸºäº Koa å¼€å‘ï¼Œæ€§èƒ½ä¼˜å¼‚
* æ¡†æ¶ç¨³å®šï¼Œæµ‹è¯•è¦†ç›–ç‡é«˜
* æ¸è¿›å¼å¼€å‘
</code></pre><h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><p>å®˜æ–¹æ¨èä½¿ç”¨è„šæ‰‹æ¶å¿«é€Ÿç”Ÿæˆé¡¹ç›®ï¼š</p>
<pre><code>$ npm install egg-init -g
$ egg-init egg-test --type=simple
$ cd egg-test
$ npm install
$ npm run dev
$ open localhost:7001
</code></pre><p>Egg.js ç»™æˆ‘ä»¬è§„å®šçš„ç›®å½•ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<pre><code>ï»¿egg-project
â”œâ”€â”€ package.json
â”œâ”€â”€ app.js (å¯é€‰)
â”œâ”€â”€ agent.js (å¯é€‰)
â”œâ”€â”€ app
|   â”œâ”€â”€ router.js
â”‚   â”œâ”€â”€ controller
â”‚   |   â””â”€â”€ home.js
â”‚   â”œâ”€â”€ service (å¯é€‰)
â”‚   |   â””â”€â”€ user.js
â”‚   â”œâ”€â”€ middleware (å¯é€‰)
â”‚   |   â””â”€â”€ response_time.js
â”‚   â”œâ”€â”€ schedule (å¯é€‰)
â”‚   |   â””â”€â”€ my_task.js
â”‚   â”œâ”€â”€ public (å¯é€‰)
â”‚   |   â””â”€â”€ reset.css
â”‚   â”œâ”€â”€ view (å¯é€‰)
â”‚   |   â””â”€â”€ home.tpl
â”‚   â””â”€â”€ extend (å¯é€‰)
â”‚       â”œâ”€â”€ helper.js (å¯é€‰)
â”‚       â”œâ”€â”€ request.js (å¯é€‰)
â”‚       â”œâ”€â”€ response.js (å¯é€‰)
â”‚       â”œâ”€â”€ context.js (å¯é€‰)
â”‚       â”œâ”€â”€ application.js (å¯é€‰)
â”‚       â””â”€â”€ agent.js (å¯é€‰)
â”œâ”€â”€ config
|   â”œâ”€â”€ plugin.js
|   â”œâ”€â”€ config.default.js
â”‚   â”œâ”€â”€ config.prod.js
|   â”œâ”€â”€ config.test.js (å¯é€‰)
|   â”œâ”€â”€ config.local.js (å¯é€‰)
|   â””â”€â”€ config.unittest.js (å¯é€‰)
â””â”€â”€ test
    â”œâ”€â”€ middleware
    |   â””â”€â”€ response_time.test.js
    â””â”€â”€ controller
        â””â”€â”€ home.test.js
</code></pre><p>ï»¿å…¶ä¸­åŒ…æ‹¬ controllerã€router ã€config ç­‰ç­‰ï¼Œç„¶åæˆ‘ä»¬éœ€è¦å…ˆæ·»åŠ ä¸€ä¸ªæ¸²æŸ“æ¨¡ç‰ˆï¼›Eggjs æä¾›äº†å¾ˆå¤š view æ¨¡ç‰ˆï¼Œè¿™é‡Œé€‰æ‹© Egg-view-ejs ä¸ºä¾‹ï¼Œå®‰è£…å®Œæ’ä»¶åéœ€è¦åœ¨ config é‡Œé¢å¼€å¯æ’ä»¶ï¼ŒåŒæ—¶éœ€è¦åœ¨ app æ–‡ä»¶å¤¹ä¸‹æ–°å»º view æ–‡ä»¶å¤¹ï¼Œæ”¾ç½®é¡µé¢æ–‡ä»¶ã€‚<br> é…ç½®éœ€è¦ç”¨çš„æ’ä»¶ï¼Œåœ¨ config / plugin.js ä¸­æ·»åŠ </p>
<pre><code>ï»¿exports.ejs = {
    enable: true,
    package: &apos;egg-view-ejs&apos;
};
// ä½¿ç”¨ mysql æ’ä»¶
exports.mysql = {
    enable: true,
    package: &apos;egg-mysql&apos;,
};
</code></pre><p>å¼€å¯æ’ä»¶ï¼Œconfig.default.js ä¸­å¢åŠ </p>
<pre><code>ï»¿config.view = {
    defaultViewEngine: &apos;ejs&apos;,
    mapping: {
        &apos;.html&apos;: &apos;ejs&apos;,
    }ï¼Œ
};
// è®¾ç½® mysql
config.mysql = {
    clients: {
        // clientId, è·å– client å®ä¾‹ï¼Œéœ€è¦é€šè¿‡ app.mysql.get(&apos;clientId&apos;) è·å–
        db: {
            ...
        }
    },
    // æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯
    app: true,
};
</code></pre><p>ï»¿å…¶ä¸­ defaultViewEngine è¡¨ç¤ºä½¿ç”¨çš„æ¨¡ç‰ˆï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿å¤šç§æ¨¡ç‰ˆã€‚mapping è®¾ç½®çš„å±æ€§åè¡¨ç¤º view ä¸­æ–‡ä»¶çš„æ‰©å±•åï¼Œå±æ€§å€¼è¡¨ç¤ºå¯¹åº”çš„æ¨¡æ¿ï¼›æ¥ä¸‹æ¥å°±å¯ä»¥ç¼–å†™ controller å’Œ router äº†ã€‚<br> å®šä¹‰ controllerï¼Œï»¿åœ¨ controller æ–‡ä»¶å¤¹ä¸‹çš„ home.js ä¸­ï¼š</p>
<pre><code>ï»¿const Controller = require(&apos;egg&apos;).Controller;

// eggjs æ¨èä½¿ç”¨ç±»å½¢å¼æ¥å®šä¹‰
class HomeController extends Controller {
  async index() {
      await this.ctx.render(&apos;site/home.html&apos;);
  }
}
module.exports = HomeController;
</code></pre><p>å®šä¹‰è·¯ routerï¼Œåœ¨ router.js æ–‡ä»¶ä¸­ï¼š</p>
<pre><code>ï»¿module.exports = app =&gt; {
    const { router, controller } = app;

    router.get(&apos;/&apos;, controller.home.index);
    router.get(&apos;/login&apos;, controller.login.index);
};
</code></pre><p>ï»¿Context å¯¹è±¡ä¸Šæä¾›äº† 3 ä¸ªæ¸²æŸ“æ¨¡ç‰ˆçš„æ¥å£ï¼Œè¿”å›å€¼å‡ä¸º Promise:</p>
<pre><code>ï»¿// render ï¼šæ¸²æŸ“æ¨¡ç‰ˆæ–‡ä»¶ï¼Œdata ä¸ºä¼ å…¥æ¨¡ç‰ˆçš„æ•°æ®ï¼Œå¹¶èµ‹å€¼ç»™ ctx.body
await ctx.render(&apos;home/index.tpl&apos;, data);
// renderView ï¼šæ¸²æŸ“æ¨¡ç‰ˆæ–‡ä»¶ï¼Œdata ä¸ºä¼ å…¥æ¨¡ç‰ˆçš„æ•°æ®ï¼Œéœ€è¦ä¸»åŠ¨èµ‹å€¼
ctx.body = await ctx.renderView(&apos;path/to/file.tpl&apos;, data);
// renderString ï¼šæ¸²æŸ“æ¨¡ç‰ˆå­—ç¬¦ä¸²ï¼Œdata ä¸ºä¼ å…¥æ¨¡ç‰ˆçš„æ•°æ®ï¼Œéœ€è¦ä¸»åŠ¨èµ‹å€¼
ctx.body = await ctx.renderString(&apos;hi, {{ name }}&apos;, data, {
    // éœ€è¦æŒ‡å®šæ¨¡æ¿å¼•æ“
    viewEngine: &apos;nunjucks&apos;,
});
</code></pre><h2 id="å†…ç½®åŸºç¡€å¯¹è±¡æ‰©å±•"><a href="#å†…ç½®åŸºç¡€å¯¹è±¡æ‰©å±•" class="headerlink" title="å†…ç½®åŸºç¡€å¯¹è±¡æ‰©å±•"></a>å†…ç½®åŸºç¡€å¯¹è±¡æ‰©å±•</h2><p>æ¡†æ¶åŒ…æ‹¬ä» Koa ç»§æ‰¿è€Œæ¥çš„ 4 ä¸ªå¯¹è±¡ï¼ˆ Applicationã€Contextã€Requestã€Response )ä»¥åŠæ¡†æ¶æ‰©å±•çš„ä¸€äº›å¯¹è±¡ï¼ˆ Controllerã€Serviceã€Helperã€Configã€Logger ï¼‰ã€‚</p>
<h3 id="Application-æ‰©å±•"><a href="#Application-æ‰©å±•" class="headerlink" title="Application æ‰©å±•"></a>Application æ‰©å±•</h3><p>app å¯¹è±¡æŒ‡çš„æ˜¯ Koa çš„å…¨å±€åº”ç”¨å¯¹è±¡ï¼Œå…¨å±€åªæœ‰ä¸€ä¸ªï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶è¢«åˆ›å»ºã€‚åœ¨ Controllerã€Middlewareã€Helperã€Service ä¸­éƒ½å¯ä»¥é€šè¿‡<br>this.app è®¿é—®åˆ° Application å¯¹è±¡ã€‚æ¡†æ¶ä¼šæŠŠ app/extend/application.js ä¸­å®šä¹‰çš„å¯¹è±¡ä¸ Koa Application çš„ prototype å¯¹è±¡è¿›è¡Œåˆå¹¶ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶ä¼šåŸºäºæ‰©å±•åçš„ prototype ç”Ÿæˆ app å¯¹è±¡ã€‚è¿™æ ·èƒ½åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ Application ä¸­æ‰©å±•çš„æ–¹æ³•ã€‚</p>
<pre><code>ï»¿// app/extend/application.js
module.exports = {
  foo(params) {
    // this å°±æ˜¯ app å¯¹è±¡ï¼Œåœ¨å…¶ä¸­å¯ä»¥è°ƒç”¨ app ä¸Šçš„å…¶ä»–æ–¹æ³•ï¼Œæˆ–è®¿é—®å±æ€§
  },
};
</code></pre><h3 id="Context-æ‰©å±•"><a href="#Context-æ‰©å±•" class="headerlink" title="ï»¿Context æ‰©å±•"></a>ï»¿Context æ‰©å±•</h3><p>Context æŒ‡çš„æ˜¯ Koa çš„è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œè¿™æ˜¯è¯·æ±‚çº§åˆ«çš„å¯¹è±¡ï¼Œæ¯æ¬¡è¯·æ±‚ç”Ÿæˆä¸€ä¸ª Context å®ä¾‹ï¼Œé€šå¸¸æˆ‘ä»¬ä¹Ÿç®€å†™æˆ ctxã€‚åœ¨æ‰€æœ‰çš„æ–‡æ¡£ä¸­ï¼ŒContext å’Œ ctx éƒ½æ˜¯æŒ‡ Koa çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚å¦‚ä¸‹åšçš„æ˜¯å¯¹æ•°æ®è¿”å›çš„æ‰©å±•ï¼š</p>
<pre><code>ï»¿// app/extend/context.js
module.exports = {
  returnJson(code,data,msg) {
    // this å°±æ˜¯ ctx å¯¹è±¡ï¼Œåœ¨å…¶ä¸­å¯ä»¥è°ƒç”¨ ctx ä¸Šçš„å…¶ä»–æ–¹æ³•ï¼Œæˆ–è®¿é—®å±æ€§
    this.body={code,data,msg};
    return
  }
};
åœ¨ controller ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•äº†
async info() {
    const userId = this.ctx.query.id;
    const res = await this.ctx.service.getInfo(userId);
    this.ctx.returnJson(0, res, &quot;è¯·æ±‚æˆåŠŸ&quot;);
}
</code></pre><h3 id="Request-å’Œ-Response-æ‰©å±•"><a href="#Request-å’Œ-Response-æ‰©å±•" class="headerlink" title="ï»¿Request å’Œ Response æ‰©å±•"></a>ï»¿Request å’Œ Response æ‰©å±•</h3><p> ï»¿ctx ä¸Šçš„å¾ˆå¤šå±æ€§å’Œæ–¹æ³•éƒ½è¢«ä»£ç†åˆ° request å’Œ response å¯¹è±¡ä¸Šï¼Œå¯¹äºè¿™äº›å±æ€§å’Œæ–¹æ³•ä½¿ç”¨ ctx å’Œä½¿ç”¨ request å»è®¿é—®å®ƒä»¬æ˜¯ç­‰ä»·çš„ï¼Œä¾‹å¦‚ ctx.url === ctx.request.urlã€ctx.status === ctx.response.status ã€‚<br> æ¡†æ¶ä¼šæŠŠ app/extend/request.js ä¸­å®šä¹‰çš„å¯¹è±¡ä¸å†…ç½® request çš„ prototype å¯¹è±¡è¿›è¡Œåˆå¹¶ï¼Œåœ¨å¤„ç†è¯·æ±‚æ—¶ä¼šåŸºäºæ‰©å±•åçš„ prototype ç”Ÿæˆ request å¯¹è±¡ï¼›Response çš„æ‰©å±•å’Œ Request ç›¸åŒã€‚</p>
<pre><code>ï»¿// app/extend/request.js
module.exports = {
  get foo() {
    return this.get(&apos;request-foo&apos;);
  },
};
// app/extend/response.js
module.exports = {
  set bar(value) {
    this.set(&apos;response-bar&apos;, value);
  },
};
</code></pre><h3 id="Helper-æ‰©å±•"><a href="#Helper-æ‰©å±•" class="headerlink" title="ï»¿Helper æ‰©å±•"></a>ï»¿Helper æ‰©å±•</h3><p>ï»¿Helper å‡½æ•°ç”¨æ¥æä¾›ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•æˆ–è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œå¯ä»¥å°†é¡¹ç›®ä¸­ç”¨çš„å¤šçš„å‡½æ•°å°è£…åœ¨æˆå¯¹çš„å‡½æ•°ï¼Œå¹¶ä¸” Helper å¯¹è±¡å¯ä»¥åœ¨ ctx å¯¹è±¡é‡Œé¢è®¿é—®åˆ°ã€‚</p>
<pre><code>ï»¿// app/extend/helper.js
module.exports = {
  foo(param) {
    // this æ˜¯ helper å¯¹è±¡ï¼Œåœ¨å…¶ä¸­å¯ä»¥è°ƒç”¨å…¶ä»– helper æ–¹æ³•
    // this.ctx =&gt; context å¯¹è±¡
    // this.app =&gt; application å¯¹è±¡
  },
};
</code></pre><h2 id="service-æœåŠ¡å±‚"><a href="#service-æœåŠ¡å±‚" class="headerlink" title="ï»¿service æœåŠ¡å±‚"></a>ï»¿service æœåŠ¡å±‚</h2><p>ï»¿service å°±æ˜¯åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹ç”¨äºåšä¸šåŠ¡é€»è¾‘å°è£…çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œæ¯”å¦‚è¦å±•ç°çš„ä¿¡æ¯éœ€è¦ä»æ•°æ®åº“è·å–ï¼Œè¿˜è¦ç»è¿‡ä¸€å®šçš„è§„åˆ™è®¡ç®—ï¼Œæ‰èƒ½è¿”å›ç”¨æˆ·æ˜¾ç¤ºã€‚å¯ä»¥å°†æ•°æ®é€»è¾‘çš„å¤„ç†éƒ½æ”¾åœ¨ service ä¸­</p>
<pre><code>ï»¿const Service = require(&apos;egg&apos;).Service;

class UserService extends Service {
  async find(uid) {
    const user = await app.mysql.get(&apos;db&apos;).query(`select * from user where uid = ${uid}`);
    return user;
  }
}
module.exports = UserService;
</code></pre><h2 id="Middleware-ä¸­é—´ä»¶"><a href="#Middleware-ä¸­é—´ä»¶" class="headerlink" title="ï»¿Middleware ä¸­é—´ä»¶"></a>ï»¿Middleware ä¸­é—´ä»¶</h2><p>ï»¿Egg çš„ä¸­é—´ä»¶å½¢å¼å’Œ Koa çš„ä¸­é—´ä»¶å½¢å¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åŸºäºæ´‹è‘±åœˆæ¨¡å‹ã€‚çº¦å®šä¸­é—´ä»¶æ˜¯ä¸€ä¸ªæ”¾ç½®åœ¨ app/middleware ç›®å½•ä¸‹çš„å•ç‹¬æ–‡ä»¶ï¼Œå®ƒéœ€è¦ exports ä¸€ä¸ªæ™®é€šçš„ functionï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p>
<pre><code>options: ä¸­é—´ä»¶çš„é…ç½®é¡¹ï¼Œæ¡†æ¶ä¼šå°† app.config[${middlewareName}] ä¼ é€’è¿›æ¥ã€‚
app: å½“å‰åº”ç”¨ Application çš„å®ä¾‹ã€‚
</code></pre><p>ï»¿å®šä¹‰ä¸€ä¸ªä¸­é—´ä»¶ï¼š</p>
<pre><code>ï»¿module.exports = (options,app) =&gt; {
    return async function checkLogin() {
        if(!(this.session &amp;&amp; this.session.userid)){
            this.redirect(&apos;/login&apos;);
            return;
        };
        // åˆ·æ–° session æ—¶é—´
        this.session.save();
    };
}
</code></pre><p>ï»¿åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨é€šè¿‡é…ç½®æ¥åŠ è½½è‡ªå®šä¹‰çš„ä¸­é—´ä»¶ï¼Œå¹¶å†³å®šå®ƒä»¬çš„é¡ºåºã€‚é…ç½®æœ€ç»ˆå°†åœ¨å¯åŠ¨æ—¶åˆå¹¶åˆ° app.config.appMiddleware ä¸­ã€‚åœ¨ config.default.js ä¸­é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code>ï»¿// é…ç½®éœ€è¦çš„ä¸­é—´ä»¶ï¼Œæ•°ç»„é¡ºåºå³ä¸ºä¸­é—´ä»¶çš„åŠ è½½é¡ºåº
config.middleware= [&apos;checkLogin&apos;];

// é…ç½® checkLogin ä¸­é—´ä»¶çš„é…ç½®
config.checkLogin= {
    // è®¾ç½®éœ€è¦å¿½ç•¥æ£€æŸ¥çš„è·¯å¾„
    ignore: &apos;/login&apos;
};
</code></pre><p> ï»¿åˆ©ç”¨ä¸Šè¿°å®šä¹‰çš„ä¸­é—´ä»¶ï¼Œå¦‚ä¸‹æ˜¯åšçš„ä¸€ä¸ªç®€å•çš„ç™»å½•</p>
<pre><code>ï»¿// router.js
module.exports = app =&gt; {
    const { router, controller } = app;

    router.get(&apos;/login&apos;, controller.login.index);
    router.post(&apos;/login/vaild&apos;, controller.login.valid);
    // ç™»é™†åè·å–ç”¨æˆ·å
    router.get(&apos;/user/admin&apos;, controller.login.userinfo);
    // é€€å‡ºç™»å½•
    router.get(&apos;/logout&apos;, controller.login.logout);
}
// app/controller/login.js
module.exports = app =&gt; {
    class LoginController extends app.Controller {

        async index() {
                await this.ctx.render(&apos;site/login.html&apos;);
        }

        async valid() {
            const name = this.ctx.request.body.username;
            const pwd = this.ctx.request.body.password;
            if (!name || !pwd) {
                // 1è¡¨ç¤ºæ²¡æœ‰å¡«å†™
                this.ctx.returnJson(1,&apos;&apos;,&quot;è¯·å¡«å†™å¸å·å’Œå¯†ç ã€‚&quot;)
                return;
            }
            const user = await app.mysql.get(&apos;db&apos;).query(`select id,username  from user WHERE username= &apos;${name}&apos; AND password =&apos;${pwd}&apos;`);
            if (user.length != 0) {
                // ç™»å½•æˆåŠŸï¼Œä¸‹å‘ session
                this.ctx.session.username = user[0].username;
                this.ctx.session.userid = user[0].id;
                // è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º3å°æ—¶
                this.ctx.session.maxAge = 3 * 3600 * 1000;
                // è°ƒç”¨ rotateCsrfSecret åˆ·æ–°ç”¨æˆ·çš„ CSRF token
                this.ctx.rotateCsrfSecret();
                this.ctx.returnJson(0, &apos;&apos;, &quot;ç™»å½•æˆåŠŸ&quot;);
            } else {
                this.ctx.returnJson(2,&apos;&apos;,&quot;å¸å·æˆ–å¯†ç é”™è¯¯&quot;);
            };
        }

        async userinfo() {
            const uid = this.ctx.query.uid;
            let user = await this.ctx.service.UserService.find(uid)
            this.ctx.returnJson(0,user ,&quot;æ“ä½œæˆåŠŸ&quot;);
        }

        async logout() {
            this.ctx.session = null;
            this.ctx.redirect(&apos;/login&apos;);
        }
    }
    return LoginController;
};
</code></pre><p>åœ¨è¿™é‡Œé¢é‡åˆ°ä¸€ä¸ªå‘å°±æ˜¯é€šè¿‡ get è¯·æ±‚å’Œ post è¯·æ±‚æ—¶ï¼Œè·å–å‚æ•°çš„æ–¹å¼ä¸ä¸€æ ·ã€‚</p>
<pre><code>* åœ¨ get è¯·æ±‚ä¸­è¦é€šè¿‡ this.ctx.query å»è·å–å‚æ•°ï¼›åœ¨ post è¯·æ±‚ä¸­æ˜¯é€šè¿‡ this.ctx.request.body å»è·å–å‚æ•°ã€‚
</code></pre><p>ï»¿è¿™äº›åªæ˜¯ Eggjs çš„ä¸€å°éƒ¨åˆ†å†…å®¹ï¼Œæ¡†æ¶è¿˜æœ‰å¾ˆå¤šæ‰©å±•ï¼Œæ’ä»¶ï¼Œè¿›ç¨‹ç®¡ç†ç­‰ç­‰ï¼Œæ¥ä¸‹æ¥ä¼šé€šè¿‡è‡ªå·±çš„å­¦ä¹ æ…¢æ…¢æ€»ç»“ï¼Œæœ‰ä¸å¯¹çš„åœ°æ–¹è¿˜å¸Œæœ›å„ä½å‰è¾ˆæŒ‡å‡ºã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»äº† Egg.js åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨ä»¥åŠæ¡†æ¶çš„æ‰©å±•ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="guanxiaofeng" scheme="http://xgfe.github.io/categories/guanxiaofeng/"/>
    
    
      <category term="nodejs" scheme="http://xgfe.github.io/tags/nodejs/"/>
    
      <category term="Eggjs" scheme="http://xgfe.github.io/tags/Eggjs/"/>
    
  </entry>
  
  <entry>
    <title>æµ…è°ˆ WEB ç¼“å­˜</title>
    <link href="http://xgfe.github.io/2018/05/07/zhangjihu/%E6%B5%85%E8%B0%88web%E7%BC%93%E5%AD%98/"/>
    <id>http://xgfe.github.io/2018/05/07/zhangjihu/æµ…è°ˆwebç¼“å­˜/</id>
    <published>2018-05-06T16:00:00.000Z</published>
    <updated>2018-07-31T07:49:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ web å‰ç«¯å¼€å‘ä¸­ï¼Œç½‘é¡µååº”é€Ÿåº¦æ˜¯åˆ¤æ–­ä¸€ä¸ªç½‘ç«™çš„æ€§èƒ½æœ€é‡è¦çš„æŒ‡æ ‡ä¹‹ä¸€ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç¼“å­˜ç­–ç•¥å¯ä»¥æé«˜ç½‘é¡µè®¿é—®é€Ÿåº¦ï¼Œå‡å°‘å»¶è¿Ÿï¼Œå‡å°‘å¸¦å®½ï¼Œé™ä½ç½‘ç»œè´Ÿè·ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ¢³ç†ä¸€ä¸‹ Web ç¼“å­˜çš„å·¥ä½œæ–¹å¼ã€‚</p>
<a id="more"></a>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Web ç¼“å­˜æ˜¯æŒ‡ä¸€ä¸ª Web èµ„æºï¼ˆå¦‚ html é¡µé¢ï¼Œå›¾ç‰‡ï¼Œjs ï¼Œæ•°æ®ç­‰ï¼‰å­˜åœ¨äº Web æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¹‹é—´çš„å‰¯æœ¬ã€‚ç¼“å­˜æ ¹æ®è¿›æ¥çš„è¯·æ±‚ä¿å­˜è¾“å‡ºå†…å®¹çš„å‰¯æœ¬ï¼Œå½“å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ç›¸åŒçš„URLï¼Œä¼šæ ¹æ®ç¼“å­˜æœºåˆ¶å†³å®šæ˜¯ç›´æ¥ä½¿ç”¨å‰¯æœ¬å“åº”è®¿é—®è¯·æ±‚ï¼Œè¿˜æ˜¯å‘æºæœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚<br>Web ç¼“å­˜æœºåˆ¶çš„æœ‰å¤šç§ï¼Œåœ¨è¿™é‡Œä¸»è¦æ¢è®¨ä»¥æµè§ˆå™¨ä¸ºè½½ä½“çš„ HTTP ç¼“å­˜æœºåˆ¶ï¼Œå¸Œæœ›å¯¹è‡ªå·±å’Œå¤§å®¶éƒ½æœ‰æ‰€å¸®åŠ©ã€‚</p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æµè§ˆå™¨ç¼“å­˜ï¼ˆ Brower Caching ï¼‰æ˜¯æµè§ˆå™¨åœ¨æœ¬åœ°ç£ç›˜å¯¹ç”¨æˆ·æœ€è¿‘è¯·æ±‚è¿‡çš„æ–‡æ¡£è¿›è¡Œå­˜å‚¨ï¼Œå½“è®¿é—®è€…å†æ¬¡è®¿é—®åŒä¸€é¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥ç›´æ¥ä»æœ¬åœ°ç£ç›˜åŠ è½½æ–‡æ¡£ï¼Œæµè§ˆå™¨ç¼“å­˜çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å‡å°‘äº†å†—ä½™çš„æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœäº†ç½‘è´¹</li>
<li>å‡å°‘äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ï¼Œå¤§å¤§æå‡äº†ç½‘ç«™çš„æ€§èƒ½</li>
<li>åŠ å¿«äº†å®¢æˆ·ç«¯åŠ è½½ç½‘é¡µçš„é€Ÿåº¦</li>
</ul>
<h2 id="ç¼“å­˜è¿‡ç¨‹åˆ†æ"><a href="#ç¼“å­˜è¿‡ç¨‹åˆ†æ" class="headerlink" title="ç¼“å­˜è¿‡ç¨‹åˆ†æ"></a>ç¼“å­˜è¿‡ç¨‹åˆ†æ</h2><p>æµè§ˆå™¨ä¸æœåŠ¡å™¨é€šä¿¡çš„æ–¹å¼ä¸ºåº”ç­”æ¨¡å¼ï¼Œå³ï¼šæµè§ˆå™¨å‘èµ· HTTP è¯·æ±‚â€“æœåŠ¡å™¨å“åº”è¯¥è¯·æ±‚ã€‚é‚£ä¹ˆæµè§ˆå™¨ç¬¬ä¸€æ¬¡å‘æœåŠ¡å™¨å‘èµ·è¯¥è¯·æ±‚åæ‹¿åˆ°è¯·æ±‚ç»“æœï¼Œä¼šæ ¹æ®å“åº”æŠ¥æ–‡ä¸­ HTTP å¤´çš„ç¼“å­˜æ ‡è¯†ï¼Œå†³å®šæ˜¯å¦ç¼“å­˜ç»“æœï¼Œæ˜¯åˆ™å°†è¯·æ±‚ç»“æœå’Œç¼“å­˜æ ‡è¯†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ä¸­ï¼Œç®€å•çš„è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/fbbc80627083b6bbe7ecb9525a36189434504.webp" alt=""></p>
<p>ç”±ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p>
<ul>
<li>æµè§ˆå™¨æ¯æ¬¡å‘èµ·è¯·æ±‚ï¼Œéƒ½ä¼šå…ˆåœ¨æµè§ˆå™¨ç¼“å­˜ä¸­æŸ¥æ‰¾è¯¥è¯·æ±‚çš„ç»“æœä»¥åŠç¼“å­˜æ ‡è¯†</li>
<li>æµè§ˆå™¨æ¯æ¬¡æ‹¿åˆ°è¿”å›çš„è¯·æ±‚ç»“æœéƒ½ä¼šå°†è¯¥ç»“æœå’Œç¼“å­˜æ ‡è¯†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ä¸­</li>
</ul>
<p>ä»¥ä¸Šä¸¤ç‚¹ç»“è®ºå°±æ˜¯æµè§ˆå™¨ç¼“å­˜æœºåˆ¶çš„å…³é”®ï¼Œå®ƒç¡®ä¿äº†æ¯ä¸ªè¯·æ±‚çš„ç¼“å­˜å­˜å…¥ä¸è¯»å–ã€‚</p>
<h2 id="æµè§ˆå™¨ç¼“å­˜ç±»å‹"><a href="#æµè§ˆå™¨ç¼“å­˜ç±»å‹" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜ç±»å‹"></a>æµè§ˆå™¨ç¼“å­˜ç±»å‹</h2><p>æˆ‘ä»¬æ ¹æ®æ˜¯å¦éœ€è¦å‘æœåŠ¡å™¨é‡æ–°å‘èµ· HTTP è¯·æ±‚å°†ç¼“å­˜è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>å¼ºåˆ¶ç¼“å­˜</strong>å’Œ<strong>åå•†ç¼“å­˜</strong>ã€‚</p>
<h3 id="å¼ºåˆ¶ç¼“å­˜"><a href="#å¼ºåˆ¶ç¼“å­˜" class="headerlink" title="å¼ºåˆ¶ç¼“å­˜"></a>å¼ºåˆ¶ç¼“å­˜</h3><p>å½“æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†ç¼“å­˜è§„åˆ™æ”¾å…¥ HTTP å“åº”æŠ¥æ–‡çš„ HTTP å¤´ä¸­å’Œè¯·æ±‚ç»“æœä¸€èµ·è¿”å›ç»™æµè§ˆå™¨ï¼Œæ§åˆ¶å¼ºåˆ¶ç¼“å­˜çš„å­—æ®µåˆ†åˆ«æ˜¯ Expires å’Œ Cache-Control ï¼Œ<strong>å…¶ä¸­ Cache-Control ä¼˜å…ˆçº§æ¯” Expires é«˜</strong>ã€‚</p>
<h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h4><p>Expires æ˜¯ HTTP / 1.0 æ§åˆ¶ç½‘é¡µç¼“å­˜çš„å­—æ®µï¼Œå…¶å€¼ä¸ºæœåŠ¡å™¨è¿”å›è¯¥è¯·æ±‚ç»“æœç¼“å­˜çš„åˆ°æœŸæ—¶é—´ï¼Œå³å†æ¬¡å‘èµ·è¯¥è¯·æ±‚æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„æ—¶é—´å°äº Expires çš„å€¼æ—¶ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ç»“æœã€‚</p>
<p>1ã€æµè§ˆå™¨ç¬¬ä¸€æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨åœ¨è¿”å›è¿™ä¸ªèµ„æºçš„åŒæ—¶ï¼Œåœ¨ respone çš„ header åŠ ä¸Š Expires çš„ header ï¼Œå¦‚ï¼š</p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/417893a96e4205a4c13acbc58941d25850878.png"></p>
<p>2ã€æµè§ˆå™¨åœ¨æ¥æ”¶åˆ°è¿™ä¸ªèµ„æºåï¼Œä¼šæŠŠè¿™ä¸ªèµ„æºè¿åŒæ‰€æœ‰ response header ä¸€èµ·ç¼“å­˜ä¸‹æ¥ï¼ˆæ‰€ä»¥ç¼“å­˜å‘½ä¸­çš„è¯·æ±‚è¿”å›çš„ header å¹¶ä¸æ˜¯æ¥è‡ªæœåŠ¡å™¨ï¼Œè€Œæ˜¯æ¥è‡ªä¹‹å‰ç¼“å­˜çš„ header ï¼‰ï¼›<br>3ã€æµè§ˆå™¨å†è¯·æ±‚è¿™ä¸ªèµ„æºæ—¶ï¼Œå…ˆä»ç¼“å­˜ä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°è¿™ä¸ªèµ„æºåï¼Œæ‹¿å‡ºå®ƒçš„ Expires è·Ÿå½“å‰çš„è¯·æ±‚æ—¶é—´æ¯”è¾ƒï¼Œå¦‚æœè¯·æ±‚æ—¶é—´åœ¨ Expires æŒ‡å®šçš„æ—¶é—´ä¹‹å‰ï¼Œå°±èƒ½å‘½ä¸­ç¼“å­˜ï¼Œå¦åˆ™å°±ä¸è¡Œã€‚<br>4ã€å¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæµè§ˆå™¨ç›´æ¥å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒExpires Header åœ¨é‡æ–°åŠ è½½çš„æ—¶å€™ä¼šè¢«æ›´æ–°ã€‚<br>åˆ°äº† HTTP / 1.1 ï¼ŒExpire å·²ç»è¢« Cache-Control æ›¿ä»£ï¼ŒåŸå› åœ¨äº Expires æ§åˆ¶ç¼“å­˜çš„åŸç†æ˜¯ä½¿ç”¨å®¢æˆ·ç«¯çš„æ—¶é—´ä¸æœåŠ¡ç«¯è¿”å›çš„æ—¶é—´åšå¯¹æ¯”ï¼Œé‚£ä¹ˆå¦‚æœå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„æ—¶é—´å› ä¸ºæŸäº›åŸå› ï¼ˆä¾‹å¦‚æ—¶åŒºä¸åŒï¼›å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æœ‰ä¸€æ–¹çš„æ—¶é—´ä¸å‡†ç¡®ï¼‰å‘ç”Ÿè¯¯å·®ï¼Œé‚£ä¹ˆå¼ºåˆ¶ç¼“å­˜åˆ™ä¼šç›´æ¥å¤±æ•ˆï¼Œè¿™æ ·çš„è¯å¼ºåˆ¶ç¼“å­˜çš„å­˜åœ¨åˆ™æ¯«æ— æ„ä¹‰ï¼Œé‚£ä¹ˆ Cache-Control åˆæ˜¯å¦‚ä½•æ§åˆ¶çš„å‘¢ï¼Ÿ</p>
<h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p>åœ¨ HTTP / 1.1 ä¸­ï¼ŒCache-Control æ˜¯æœ€é‡è¦çš„è§„åˆ™ï¼Œä¸»è¦ç”¨äºæ§åˆ¶ç½‘é¡µç¼“å­˜ï¼Œä¸»è¦å–å€¼ä¸ºï¼š</p>
<ul>
<li>publicï¼šå¯ä»¥è¢«æ‰€æœ‰çš„ç”¨æˆ·ç¼“å­˜ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯å’Œ CDN ç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨ï¼Œé»˜è®¤å€¼</li>
<li>privateï¼šåªèƒ½è¢«å®¢æˆ·ç«¯ç¼“å­˜ï¼Œä¸å…è®¸ CDN ç­‰ä¸­é—´ä»£ç†æœåŠ¡å™¨å¯¹å…¶ç¼“å­˜ï¼ŒCache-Control çš„é»˜è®¤å–å€¼</li>
<li>no-cacheï¼šå®¢æˆ·ç«¯ç¼“å­˜å†…å®¹ï¼Œä½†æ˜¯æ˜¯å¦ä½¿ç”¨ç¼“å­˜åˆ™éœ€è¦ç»è¿‡åå•†ç¼“å­˜æ¥éªŒè¯å†³å®š</li>
<li>no-storeï¼šæ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šè¢«ç¼“å­˜ï¼Œå³ä¸ä½¿ç”¨å¼ºåˆ¶ç¼“å­˜ï¼Œä¹Ÿä¸ä½¿ç”¨åå•†ç¼“å­˜ï¼Œæ¯æ¬¡è¯·æ±‚è¯¥èµ„æºç›´æ¥å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæ¯æ¬¡éƒ½ä¼šä¸‹è½½å®Œæ•´çš„èµ„æº</li>
<li>max-age=xxxï¼šï¼ˆå•ä½ä¸º s ï¼‰ï¼šç¼“å­˜å†…å®¹å°†åœ¨ xxx ç§’åå¤±æ•ˆï¼Œå½“æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚åï¼Œåœ¨ max-age è¿™æ®µæ—¶é—´é‡Œæµè§ˆå™¨å°±ä¸ä¼šå†å‘æœåŠ¡å™¨å‘é€è¯·æ±‚äº†</li>
<li>s-maxage=xxxï¼šï¼ˆå•ä½ä¸º s ï¼‰ï¼šåŒ max-age ï¼Œåªç”¨äºå…±äº«ç¼“å­˜ï¼ˆæ¯”å¦‚ CDN ç¼“å­˜ï¼‰ï¼Œè¦†ç›–æ‰ max-age å’Œ Expires</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹ï¼š</p>
<p>1ã€æµè§ˆå™¨ç¬¬ä¸€æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨åœ¨è¿”å›è¿™ä¸ªèµ„æºçš„åŒæ—¶ï¼Œåœ¨ respone çš„ header åŠ ä¸Š Cache-Control çš„ header ï¼›<br>2ã€æµè§ˆå™¨åœ¨æ¥æ”¶åˆ°è¿™ä¸ªèµ„æºåï¼Œä¼šæŠŠè¿™ä¸ªèµ„æºè¿åŒæ‰€æœ‰ response header ä¸€èµ·ç¼“å­˜ä¸‹æ¥ï¼›<br>3ã€æµè§ˆå™¨å†è¯·æ±‚è¿™ä¸ªèµ„æºæ—¶ï¼Œå…ˆä»ç¼“å­˜ä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°è¿™ä¸ªèµ„æºåï¼Œæ ¹æ®å®ƒç¬¬ä¸€æ¬¡çš„è¯·æ±‚æ—¶é—´å’Œ Cache-Control è®¾å®šçš„æœ‰æ•ˆæœŸï¼Œè®¡ç®—å‡ºä¸€ä¸ªèµ„æºè¿‡æœŸæ—¶é—´ï¼Œå†æ‹¿è¿™ä¸ªè¿‡æœŸæ—¶é—´è·Ÿå½“å‰çš„è¯·æ±‚æ—¶é—´æ¯”è¾ƒï¼Œå¦‚æœè¯·æ±‚æ—¶é—´åœ¨è¿‡æœŸæ—¶é—´ä¹‹å‰ï¼Œå°±èƒ½å‘½ä¸­ç¼“å­˜ï¼Œå¦åˆ™å°±ä¸è¡Œã€‚</p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/2f10fb6c2edd15f829d36330bee33b6b57447.png" alt=""></p>
<p>4ã€å¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæµè§ˆå™¨ç›´æ¥ä»æœåŠ¡å™¨åŠ è½½èµ„æºæ—¶ï¼ŒCache-Control Header åœ¨é‡æ–°åŠ è½½çš„æ—¶å€™ä¼šè¢«æ›´æ–°ã€‚</p>
<p>ç”±ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p>
<ul>
<li>HTTP å“åº”æŠ¥æ–‡ä¸­ expires çš„æ—¶é—´å€¼ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹æ—¶é—´çš„GMTæ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²</li>
<li>HTTP å“åº”æŠ¥æ–‡ä¸­ Cache-Control ä¸º max-age = 7200 ï¼Œæ˜¯ç›¸å¯¹å€¼ï¼Œä»£è¡¨ç€èµ„æºçš„æœ‰æ•ˆæœŸ</li>
</ul>
<p>ç”±äº Cache-Control çš„ä¼˜å…ˆçº§æ¯” expires ï¼Œé‚£ä¹ˆç›´æ¥æ ¹æ® Cache-Control çš„å€¼è¿›è¡Œç¼“å­˜ï¼Œæ„æ€å°±æ˜¯è¯´åœ¨ 7200 ç§’å†…å†æ¬¡å‘èµ·è¯¥è¯·æ±‚ï¼Œåˆ™ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜ç»“æœï¼Œå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆã€‚<br>æ³¨ï¼šåœ¨æ— æ³•ç¡®å®šå®¢æˆ·ç«¯çš„æ—¶é—´æ˜¯å¦ä¸æœåŠ¡ç«¯çš„æ—¶é—´åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œ Cache-Control ç›¸æ¯”äº expires æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œæ‰€ä»¥åŒæ—¶å­˜åœ¨æ—¶ï¼Œåªæœ‰ Cache-Control ç”Ÿæ•ˆã€‚</p>
<h3 id="åå•†ç¼“å­˜"><a href="#åå•†ç¼“å­˜" class="headerlink" title="åå•†ç¼“å­˜"></a>åå•†ç¼“å­˜</h3><p>å½“æµè§ˆå™¨å¯¹æŸä¸ªèµ„æºçš„è¯·æ±‚æ²¡æœ‰å‘½ä¸­å¼ºç¼“å­˜ï¼Œå°±ä¼šæºå¸¦ç¼“å­˜æ ‡è¯†å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒéªŒè¯åå•†ç¼“å­˜æ˜¯å¦å‘½ä¸­ï¼Œç”±æœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œå¦‚æœåå•†ç¼“å­˜å‘½ä¸­ï¼Œè¯·æ±‚å“åº”è¿”å›çš„ http çŠ¶æ€ä¸º 304 ã€‚</p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/165599b6e70d5fcc1258be192f6db41b36954.png" alt=""></p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/0416603a7ed8b6c6d8af6f548a6c570c26337.png" alt=""></p>
<p>æŸ¥çœ‹å•ä¸ªè¯·æ±‚çš„ ResponseHeaderï¼Œä¹Ÿèƒ½çœ‹åˆ° 304 çš„çŠ¶æ€ç å’Œ Not Modified çš„å­—ç¬¦ä¸²ï¼Œåªè¦çœ‹åˆ°è¿™ä¸ªå°±å¯è¯´æ˜è¿™ä¸ªèµ„æºæ˜¯å‘½ä¸­äº†åå•†ç¼“å­˜ï¼Œç„¶åä»å®¢æˆ·ç«¯ç¼“å­˜ä¸­åŠ è½½çš„ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨æœ€æ–°çš„èµ„æºã€‚</p>
<h4 id="ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š"><a href="#ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š" class="headerlink" title="ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š"></a>ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</h4><p>åå•†ç¼“å­˜ç”Ÿæ•ˆï¼Œè¿”å› 304 ï¼Œå¦‚ä¸‹:</p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/cac3ffaa672010fee74692465e9c17f021484.webp" alt=""></p>
<blockquote>
<p>304</p>
</blockquote>
<p>åå•†ç¼“å­˜å¤±æ•ˆï¼Œè¿”å› 200 å’Œè¯·æ±‚ç»“æœç»“æœï¼Œå¦‚ä¸‹:</p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/76908dc6fb49340ad92d97ff2ed759ba22094.riff" alt=""></p>
<blockquote>
<p>200</p>
</blockquote>
<p>åŒæ ·ï¼Œåå•†ç¼“å­˜çš„æ ‡è¯†ä¹Ÿæ˜¯åœ¨å“åº”æŠ¥æ–‡çš„ HTTP å¤´ä¸­å’Œè¯·æ±‚ç»“æœä¸€èµ·è¿”å›ç»™æµè§ˆå™¨çš„ï¼Œæ§åˆ¶åå•†ç¼“å­˜çš„å­—æ®µåˆ†åˆ«æœ‰ï¼šLast-Modified / If-Modified-Since å’Œ Etag / If-None-Match ï¼Œå…¶ä¸­ Etag / If-None-Match çš„ä¼˜å…ˆçº§æ¯” Last-Modified / If-Modified-Since é«˜ã€‚</p>
<h5 id="ã€-Last-Modifiedï¼ŒIf-Modified-Since-ã€‘"><a href="#ã€-Last-Modifiedï¼ŒIf-Modified-Since-ã€‘" class="headerlink" title="ã€ Last-Modifiedï¼ŒIf-Modified-Since ã€‘:"></a>ã€ Last-Modifiedï¼ŒIf-Modified-Since ã€‘:</h5><p>Last-Modified æ˜¯è¯¥èµ„æºæ–‡ä»¶æœ€åä¸€æ¬¡æ›´æ”¹æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ response header é‡Œè¿”å›ï¼ŒåŒæ—¶æµè§ˆå™¨ä¼šå°†è¿™ä¸ªå€¼ä¿å­˜èµ·æ¥ï¼Œåœ¨ä¸‹ä¸€æ¬¡å‘é€è¯·æ±‚æ—¶ï¼Œæ”¾åˆ° request header é‡Œçš„ If-Modified-Since é‡Œï¼ŒæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°åä¹Ÿä¼šåšæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒåˆ™å‘½ä¸­åå•†ç¼“å­˜ï¼Œå…·ä½“æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p>1ã€æµè§ˆå™¨ç¬¬ä¸€æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨åœ¨è¿”å›è¿™ä¸ªèµ„æºçš„åŒæ—¶ï¼Œåœ¨ response çš„ header åŠ ä¸Š Last-Modified çš„ headerï¼Œè¿™ä¸ª header è¡¨ç¤ºè¿™ä¸ªèµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„æœ€åä¿®æ”¹æ—¶é—´ï¼š</p>
<p><img src="http://vfile.meituan.net/xgfe/d5788526358fd1f02278de827d0cc8f481865.png" alt=""></p>
<p>2ã€æµè§ˆå™¨å†æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚è¿™ä¸ªèµ„æºæ—¶ï¼Œåœ¨ request çš„ header ä¸ŠåŠ ä¸Š If-Modified-Since çš„ headerï¼Œè¿™ä¸ª header çš„å€¼å°±æ˜¯ä¸Šä¸€æ¬¡è¯·æ±‚æ—¶è¿”å›çš„ Last-Modified çš„å€¼ï¼š</p>
<p><img src="http://vfile.meituan.net/xgfe/b150d289f5ec7c2921d175d4aad1dd8a81884.png" alt=""></p>
<p>3ã€æœåŠ¡å™¨å†æ¬¡æ”¶åˆ°èµ„æºè¯·æ±‚æ—¶ï¼Œæ ¹æ®æµè§ˆå™¨ä¼ è¿‡æ¥ If-Modified-Since å’Œèµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„æœ€åä¿®æ”¹æ—¶é—´åˆ¤æ–­èµ„æºæ˜¯å¦æœ‰å˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–åˆ™è¿”å› 304 NotModifiedï¼Œä½†æ˜¯ä¸ä¼šè¿”å›èµ„æºå†…å®¹ï¼›å¦‚æœæœ‰å˜åŒ–ï¼Œå°±æ­£å¸¸è¿”å›èµ„æºå†…å®¹ï¼ŒçŠ¶æ€ç ä¸º 200ã€‚å½“æœåŠ¡å™¨è¿”å› 304 Not Modified çš„å“åº”æ—¶ï¼Œresponse header ä¸­ä¸ä¼šå†æ·»åŠ  Last-Modified çš„ headerï¼Œå› ä¸ºæ—¢ç„¶èµ„æºæ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆ Last-Modified ä¹Ÿå°±ä¸ä¼šæ”¹å˜ï¼Œè¿™æ˜¯æœåŠ¡å™¨è¿”å› 304 æ—¶çš„ response header ã€‚<br>4ã€æµè§ˆå™¨æ”¶åˆ° 304 çš„å“åº”åï¼Œå°±ä¼šä»ç¼“å­˜ä¸­åŠ è½½èµ„æºã€‚<br>5ã€å¦‚æœåå•†ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œæµè§ˆå™¨ç›´æ¥ä»æœåŠ¡å™¨åŠ è½½èµ„æºæ—¶ï¼ŒLast-Modified Header åœ¨é‡æ–°åŠ è½½çš„æ—¶å€™ä¼šè¢«æ›´æ–°ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ï¼ŒIf-Modified-Since ä¼šå¯ç”¨ä¸Šæ¬¡è¿”å›çš„ Last-Modified å€¼ã€‚</p>
<h5 id="ã€-ETag-ã€If-None-Match-ã€‘"><a href="#ã€-ETag-ã€If-None-Match-ã€‘" class="headerlink" title="ã€ ETag ã€If-None-Match ã€‘:"></a>ã€ ETag ã€If-None-Match ã€‘:</h5><p>1ã€æµè§ˆå™¨ç¬¬ä¸€æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªèµ„æºï¼ŒæœåŠ¡å™¨åœ¨è¿”å›è¿™ä¸ªèµ„æºçš„åŒæ—¶ï¼Œåœ¨ respone çš„ header åŠ ä¸Š ETag çš„ header ï¼Œè¿™ä¸ª header æ˜¯æœåŠ¡å™¨æ ¹æ®å½“å‰è¯·æ±‚çš„èµ„æºç”Ÿæˆçš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªå”¯ä¸€æ ‡è¯†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåªè¦èµ„æºæœ‰å˜åŒ–è¿™ä¸ªä¸²å°±ä¸åŒï¼Œè·Ÿæœ€åä¿®æ”¹æ—¶é—´æ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥èƒ½å¾ˆå¥½çš„è¡¥å…… Last-Modified çš„é—®é¢˜ï¼š</p>
<p><img src="http://vfile.meituan.net/xgfe/f8e13201a0acfa1c34a07f978ab8eb1560458.png" alt=""></p>
<p>2ã€æµè§ˆå™¨å†æ¬¡è·ŸæœåŠ¡å™¨è¯·æ±‚è¿™ä¸ªèµ„æºæ—¶ï¼Œåœ¨ request çš„ header ä¸ŠåŠ ä¸Š If-None-Match çš„ header ï¼Œè¿™ä¸ª header çš„å€¼å°±æ˜¯ä¸Šä¸€æ¬¡è¯·æ±‚æ—¶è¿”å›çš„ ETag çš„å€¼ï¼š</p>
<p><img src="http://vfile.meituan.net/xgfe/b3ee027ffc12d12ee34cfdeaebff931f103431.png" alt=""></p>
<p>3ã€æœåŠ¡å™¨å†æ¬¡æ”¶åˆ°èµ„æºè¯·æ±‚æ—¶ï¼Œæ ¹æ®æµè§ˆå™¨ä¼ è¿‡æ¥ If-None-Match å’Œç„¶åå†æ ¹æ®èµ„æºç”Ÿæˆä¸€ä¸ªæ–°çš„ ETag ï¼Œå¦‚æœè¿™ä¸¤ä¸ªå€¼ç›¸åŒå°±è¯´æ˜èµ„æºæ²¡æœ‰å˜åŒ–ï¼Œå¦åˆ™å°±æ˜¯æœ‰å˜åŒ–ï¼›å¦‚æœæ²¡æœ‰å˜åŒ–åˆ™è¿”å› 304 Not Modified ï¼Œä½†æ˜¯ä¸ä¼šè¿”å›èµ„æºå†…å®¹ï¼›å¦‚æœæœ‰å˜åŒ–ï¼Œå°±æ­£å¸¸è¿”å›èµ„æºå†…å®¹ã€‚ä¸ Last-Modified ä¸ä¸€æ ·çš„æ˜¯ï¼Œå½“æœåŠ¡å™¨è¿”å› 304 Not Modified çš„å“åº”æ—¶ï¼Œç”±äº ETag é‡æ–°ç”Ÿæˆè¿‡ï¼Œresponse header ä¸­è¿˜ä¼šæŠŠè¿™ä¸ª ETag è¿”å›ï¼Œå³ä½¿è¿™ä¸ª ETag è·Ÿä¹‹å‰çš„æ²¡æœ‰å˜åŒ–ï¼š<br>4ã€æµè§ˆå™¨æ”¶åˆ° 304 çš„å“åº”åï¼Œå°±ä¼šä»ç¼“å­˜ä¸­åŠ è½½èµ„æºã€‚</p>
<h5 id="ä¸ºä»€ä¹ˆè¦æœ‰-Etag"><a href="#ä¸ºä»€ä¹ˆè¦æœ‰-Etag" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æœ‰ Etag"></a>ä¸ºä»€ä¹ˆè¦æœ‰ Etag</h5><p>ä½ å¯èƒ½ä¼šè§‰å¾—ä½¿ç”¨ Last-Modified å·²ç»è¶³ä»¥è®©æµè§ˆå™¨çŸ¥é“æœ¬åœ°çš„ç¼“å­˜å‰¯æœ¬æ˜¯å¦è¶³å¤Ÿæ–°ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ Etag å‘¢ï¼Ÿ HTTP 1.1 ä¸­ Etag çš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å‡ ä¸ª Last-Modified æ¯”è¾ƒéš¾è§£å†³çš„é—®é¢˜ï¼š<br>    â€¢ ä¸€äº›æ–‡ä»¶ä¹Ÿè®¸ä¼šå‘¨æœŸæ€§çš„æ›´æ”¹ï¼Œä½†æ˜¯ä»–çš„å†…å®¹å¹¶ä¸æ”¹å˜ï¼ˆä»…ä»…æ”¹å˜çš„ä¿®æ”¹æ—¶é—´ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®¢æˆ·ç«¯è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œè€Œé‡æ–° GET ï¼›<br>    â€¢ æŸäº›æ–‡ä»¶ä¿®æ”¹éå¸¸é¢‘ç¹ï¼Œæ¯”å¦‚åœ¨ç§’ä»¥ä¸‹çš„æ—¶é—´å†…è¿›è¡Œä¿®æ”¹ï¼Œï¼ˆæ¯”æ–¹è¯´ 1 s å†…ä¿®æ”¹äº† N æ¬¡ï¼‰ï¼ŒIf-Modified-Since èƒ½æ£€æŸ¥åˆ°çš„ç²’åº¦æ˜¯ s çº§çš„ï¼Œè¿™ç§ä¿®æ”¹æ— æ³•åˆ¤æ–­ï¼ˆæˆ–è€…è¯´ UNIX è®°å½• MTIME åªèƒ½ç²¾ç¡®åˆ°ç§’ï¼‰ï¼›<br>    â€¢ æŸäº›æœåŠ¡å™¨ä¸èƒ½ç²¾ç¡®çš„å¾—åˆ°æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ã€‚<br>Last-Modified ä¸ ETag æ˜¯å¯ä»¥ä¸€èµ·ä½¿ç”¨çš„ï¼ŒæœåŠ¡å™¨ä¼šä¼˜å…ˆéªŒè¯ ETag ï¼Œä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šç»§ç»­æ¯”å¯¹ Last-Modified ï¼Œæœ€åæ‰å†³å®šæ˜¯å¦è¿”å› 304 ã€‚</p>
<h3 id="å¼ºç¼“å­˜ä¸åå•†ç¼“å­˜çš„åŒºåˆ«"><a href="#å¼ºç¼“å­˜ä¸åå•†ç¼“å­˜çš„åŒºåˆ«" class="headerlink" title="å¼ºç¼“å­˜ä¸åå•†ç¼“å­˜çš„åŒºåˆ«"></a>å¼ºç¼“å­˜ä¸åå•†ç¼“å­˜çš„åŒºåˆ«</h3><p>å¼ºç¼“å­˜ä¸åå•†ç¼“å­˜çš„åŒºåˆ«å¯ä»¥ç”¨ä¸‹è¡¨æ¥è¡¨ç¤ºï¼š</p>
<p><img src="http://vfile.meituan.net/xgfe/f0eb26fac54900ef2272f4c3e3e233ef20064.png" alt=""></p>
<p>å¼ºåˆ¶ç¼“å­˜ä¼˜å…ˆäºåå•†ç¼“å­˜è¿›è¡Œï¼Œè‹¥å¼ºåˆ¶ç¼“å­˜ï¼ˆ Expires å’Œ Cache-Control ï¼‰ç”Ÿæ•ˆåˆ™ç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œè‹¥ä¸ç”Ÿæ•ˆåˆ™è¿›è¡Œåå•†ç¼“å­˜ï¼ˆ Last-Modified / If-Modified-Since å’Œ Etag / If-None-Match ï¼‰ï¼Œåå•†ç¼“å­˜ç”±æœåŠ¡å™¨å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œè‹¥åå•†ç¼“å­˜å¤±æ•ˆï¼Œé‚£ä¹ˆä»£è¡¨è¯¥è¯·æ±‚çš„ç¼“å­˜å¤±æ•ˆï¼Œé‡æ–°è·å–è¯·æ±‚ç»“æœï¼Œå†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ä¸­ï¼›ç”Ÿæ•ˆåˆ™è¿”å› 304 ï¼Œç»§ç»­ä½¿ç”¨ç¼“å­˜ã€‚</p>
<h3 id="æµè§ˆå™¨ç¼“å­˜è¿‡ç¨‹"><a href="#æµè§ˆå™¨ç¼“å­˜è¿‡ç¨‹" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜è¿‡ç¨‹"></a>æµè§ˆå™¨ç¼“å­˜è¿‡ç¨‹</h3><p>1ã€æµè§ˆå™¨ç¬¬ä¸€æ¬¡åŠ è½½èµ„æºï¼ŒæœåŠ¡å™¨è¿”å› 200ï¼Œæµè§ˆå™¨å°†èµ„æºæ–‡ä»¶ä»æœåŠ¡å™¨ä¸Šè¯·æ±‚ä¸‹è½½ä¸‹æ¥ï¼Œå¹¶æŠŠ response header åŠè¯¥è¯·æ±‚çš„è¿”å›æ—¶é—´ä¸€å¹¶ç¼“å­˜ï¼›<br>2ã€ä¸‹ä¸€æ¬¡åŠ è½½èµ„æºæ—¶ï¼Œå…ˆæ¯”è¾ƒå½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡è¿”å› 200 æ—¶çš„æ—¶é—´å·®ï¼Œå¦‚æœæ²¡æœ‰è¶…è¿‡ cache-control è®¾ç½®çš„ max-age ï¼Œåˆ™æ²¡æœ‰è¿‡æœŸï¼Œå‘½ä¸­å¼ºç¼“å­˜ï¼Œä¸å‘è¯·æ±‚ç›´æ¥ä»æœ¬åœ°ç¼“å­˜è¯»å–è¯¥æ–‡ä»¶ï¼ˆå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ HTTP 1.1 ï¼Œåˆ™ç”¨ expires åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼‰ï¼›å¦‚æœæ—¶é—´è¿‡æœŸï¼Œåˆ™å‘æœåŠ¡å™¨å‘é€ header å¸¦æœ‰ If-None-Match å’Œ If-Modified-Since çš„è¯·æ±‚ï¼›<br>3ã€æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼˜å…ˆæ ¹æ® Etag çš„å€¼åˆ¤æ–­è¢«è¯·æ±‚çš„æ–‡ä»¶æœ‰æ²¡æœ‰åšä¿®æ”¹ï¼ŒEtag å€¼ä¸€è‡´åˆ™æ²¡æœ‰ä¿®æ”¹ï¼Œå‘½ä¸­åå•†ç¼“å­˜ï¼Œè¿”å› 304 ï¼›å¦‚æœä¸ä¸€è‡´åˆ™æœ‰æ”¹åŠ¨ï¼Œç›´æ¥è¿”å›æ–°çš„èµ„æºæ–‡ä»¶å¸¦ä¸Šæ–°çš„ Etag å€¼å¹¶è¿”å› 200 ï¼›<br>4ã€å¦‚æœæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚æ²¡æœ‰ Etag å€¼ï¼Œåˆ™å°† If-Modified-Since å’Œè¢«è¯·æ±‚æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´åšæ¯”å¯¹ï¼Œä¸€è‡´åˆ™å‘½ä¸­åå•†ç¼“å­˜ï¼Œè¿”å› 304 ï¼›ä¸ä¸€è‡´åˆ™è¿”å›æ–°çš„ last-modified å’Œæ–‡ä»¶å¹¶è¿”å› 200 ï¼›</p>
<p><img width="600px" height="300px" src="http://vfile.meituan.net/xgfe/735836ddebf6bf03fb577902c88afd6925020.webp" alt=""></p>
<h3 id="ç”¨æˆ·è¡Œä¸ºå¯¹ç¼“å­˜çš„å½±å“"><a href="#ç”¨æˆ·è¡Œä¸ºå¯¹ç¼“å­˜çš„å½±å“" class="headerlink" title="ç”¨æˆ·è¡Œä¸ºå¯¹ç¼“å­˜çš„å½±å“"></a>ç”¨æˆ·è¡Œä¸ºå¯¹ç¼“å­˜çš„å½±å“</h3><p>åœ°å€æ è®¿é—®ï¼Œç‚¹å‡»é“¾æ¥è·³è½¬æ˜¯æ­£å¸¸ç”¨æˆ·è¡Œä¸ºï¼Œå°†ä¼šè§¦å‘æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ï¼Œæµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼ŒæŒ‰ç…§æ­£å¸¸æµç¨‹ï¼Œæœ¬åœ°æ£€æŸ¥æ˜¯å¦è¿‡æœŸï¼Œç„¶åæœåŠ¡å™¨æ£€æŸ¥æ–°é²œåº¦ï¼Œæœ€åè¿”å›å†…å®¹ï¼›<br>F5 åˆ·æ–°ï¼Œæµè§ˆå™¨ä¼šè®¾ç½® max-age = 0ï¼Œè·³è¿‡å¼ºç¼“å­˜åˆ¤æ–­ï¼Œä¼šè¿›è¡Œåå•†ç¼“å­˜åˆ¤æ–­ï¼›<br>ctrl + F5 åˆ·æ–°ï¼Œè·³è¿‡å¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œç›´æ¥ä»æœåŠ¡å™¨æ‹‰å–èµ„æºã€‚</p>
<p><img src="http://vfile.meituan.net/xgfe/72ef16289230d836b2027eb7f6a6845c27545.png" alt=""></p>
<h3 id="å·²ç»ç¼“å­˜çš„å“åº”ï¼Œå¦‚ä½•æ›´æ–°æˆ–åºŸå¼ƒï¼Ÿ"><a href="#å·²ç»ç¼“å­˜çš„å“åº”ï¼Œå¦‚ä½•æ›´æ–°æˆ–åºŸå¼ƒï¼Ÿ" class="headerlink" title="å·²ç»ç¼“å­˜çš„å“åº”ï¼Œå¦‚ä½•æ›´æ–°æˆ–åºŸå¼ƒï¼Ÿ"></a>å·²ç»ç¼“å­˜çš„å“åº”ï¼Œå¦‚ä½•æ›´æ–°æˆ–åºŸå¼ƒï¼Ÿ</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å‘å‡ºçš„æ‰€æœ‰ HTTP è¯·æ±‚ä¼šé¦–å…ˆè¢«è·¯ç”±åˆ°æµè§ˆå™¨çš„ç¼“å­˜ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦ç¼“å­˜äº†å¯ä»¥ç”¨äºå®ç°è¯·æ±‚çš„æœ‰æ•ˆå“åº”ã€‚å¦‚æœæœ‰åŒ¹é…çš„å“åº”ï¼Œä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–å“åº”ï¼Œè¿™æ ·å°±é¿å…äº†ç½‘ç»œå»¶è¿Ÿä»¥åŠä¼ è¾“äº§ç”Ÿçš„æ•°æ®æˆæœ¬ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ›´æ–°æˆ–åºŸå¼ƒå·²ç¼“å­˜çš„å“åº”ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ<br>å‡è®¾æˆ‘ä»¬å·²ç»å‘Šè¯‰è®¿é—®è€…æŸä¸ª CSS æ ·å¼è¡¨ç¼“å­˜é•¿è¾¾ 24 å°æ—¶ï¼ˆ max-age = 86400 ï¼‰ï¼Œä½†æ˜¯è®¾è®¡äººå‘˜åˆšåˆšæäº¤äº†ä¸€ä¸ªæ›´æ–°ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½ä½¿ç”¨ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•é€šçŸ¥æ‰€æœ‰è®¿é—®è€…ç¼“å­˜çš„ CSS å‰¯æœ¬å·²è¿‡æ—¶ï¼Œéœ€è¦æ›´æ–°ç¼“å­˜ï¼Ÿ<br>å®é™…ä¸Šä»¥å‰æ²¡æœ‰è¯·æ±‚è¿‡è¯¥èµ„æºçš„æ–°çš„ç”¨æˆ·ä¼šå¾—åˆ°æ›´æ–°çš„èµ„æºï¼Œä½†æ˜¯è¯·æ±‚è¿‡èµ„æºçš„ç”¨æˆ·å°†åœ¨è¿‡æœŸæ—¶é—´è¾¾åˆ°ä¹‹å‰ä¸€ç›´å¾—åˆ°æ—§çš„è¢«ç¼“å­˜çš„èµ„æºï¼Œç›´åˆ°ä»–æ‰‹åŠ¨çš„å»æ¸…ç†äº†æµè§ˆå™¨çš„ç¼“å­˜ã€‚æ‰‹åŠ¨æ¸…ç†æµè§ˆå™¨ç¼“å­˜è¿™ç§äº‹å¯èƒ½åªæœ‰ç¨‹åºå‘˜æ‰ä¼šåšï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆåšæ‰èƒ½è®©ç”¨æˆ·å¾—åˆ°æ›´æ–°åçš„èµ„æºå‘¢ï¼Ÿ<br>å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨èµ„æºçš„å†…å®¹æ›´æ”¹åï¼Œæ›´æ”¹èµ„æºçš„ç½‘å€ï¼Œå¼ºåˆ¶ç”¨æˆ·ä¸‹è½½æ–°å“åº”ã€‚æ¯”å¦‚åœ¨èµ„æºé“¾æ¥åæ·»åŠ å‚æ•°ï¼š</p>
<p><img src="http://vfile.meituan.net/xgfe/29b12a26033d0eccff1a6d503ae8f9f674695.png" alt=""></p>
<p>ï¼ˆæœ‰å…´è¶£çš„å¯ä»¥é˜…è¯»ï¼š<a href="https://www.zhihu.com/question/20790576ï¼‰" target="_blank" rel="external">https://www.zhihu.com/question/20790576ï¼‰</a></p>
<h2 id="web-ç¼“å­˜ä½œç”¨"><a href="#web-ç¼“å­˜ä½œç”¨" class="headerlink" title="web ç¼“å­˜ä½œç”¨"></a>web ç¼“å­˜ä½œç”¨</h2><p>1ã€å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—<br>æ— è®ºå¯¹äºç½‘ç«™è¿è¥è€…æˆ–è€…ç”¨æˆ·ï¼Œå¸¦å®½éƒ½ä»£è¡¨ç€é‡‘é’±ï¼Œè¿‡å¤šçš„å¸¦å®½æ¶ˆè€—ï¼Œåªä¼šä¾¿å®œäº†ç½‘ç»œè¿è¥å•†ã€‚å½“ Web ç¼“å­˜å‰¯æœ¬è¢«ä½¿ç”¨æ—¶ï¼Œåªä¼šäº§ç”Ÿæå°çš„ç½‘ç»œæµé‡ï¼Œå¯ä»¥æœ‰æ•ˆçš„é™ä½è¿è¥æˆæœ¬ã€‚</p>
<p>2ã€é™ä½æœåŠ¡å™¨å‹åŠ›<br>ç»™ç½‘ç»œèµ„æºè®¾å®šæœ‰æ•ˆæœŸä¹‹åï¼Œç”¨æˆ·å¯ä»¥é‡å¤ä½¿ç”¨æœ¬åœ°çš„ç¼“å­˜ï¼Œå‡å°‘å¯¹æºæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œé—´æ¥é™ä½æœåŠ¡å™¨çš„å‹åŠ›ã€‚åŒæ—¶ï¼Œæœç´¢å¼•æ“çš„çˆ¬è™«æœºå™¨äººä¹Ÿèƒ½æ ¹æ®è¿‡æœŸæœºåˆ¶é™ä½çˆ¬å–çš„é¢‘ç‡ï¼Œä¹Ÿèƒ½æœ‰æ•ˆé™ä½æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p>
<p>3ã€å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼ŒåŠ å¿«é¡µé¢æ‰“å¼€é€Ÿåº¦<br>ç¼“å­˜çš„ä½¿ç”¨èƒ½å¤Ÿæ˜æ˜¾åŠ å¿«é¡µé¢æ‰“å¼€é€Ÿåº¦ï¼Œæé«˜ç½‘é¡µæ€§èƒ½ï¼Œè¾¾åˆ°æ›´å¥½çš„ä½“éªŒã€‚</p>
<h2 id="å…¶å®ƒ-web-ç¼“å­˜æœºåˆ¶"><a href="#å…¶å®ƒ-web-ç¼“å­˜æœºåˆ¶" class="headerlink" title="å…¶å®ƒ web ç¼“å­˜æœºåˆ¶"></a>å…¶å®ƒ web ç¼“å­˜æœºåˆ¶</h2><p>1ã€æ•°æ®åº“ç¼“å­˜<br>æˆ‘ä»¬å¯èƒ½å¬è¯´è¿‡ memcached ï¼Œå®ƒå°±æ˜¯ä¸€ç§æ•°æ®åº“å±‚é¢çš„ç¼“å­˜æ–¹æ¡ˆã€‚æ•°æ®åº“ç¼“å­˜æ˜¯æŒ‡ï¼Œå½“ web åº”ç”¨çš„å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œæ•°æ®åº“ä¸­çš„è¡¨å¾ˆå¤šçš„æ—¶å€™ï¼Œå¦‚æœé¢‘ç¹è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ•°æ®åº“ä¸å ªé‡è·ã€‚ä¸ºäº†æä¾›æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå°†æŸ¥è¯¢åçš„æ•°æ®æ”¾åˆ°å†…å­˜ä¸­è¿›è¡Œç¼“å­˜ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ï¼Œç›´æ¥ä»å†…å­˜ç¼“å­˜ç›´æ¥è¿”å›ï¼Œæä¾›å“åº”æ•ˆç‡ã€‚</p>
<p>2ã€CDN ç¼“å­˜<br>CDNç¼“å­˜ä¸€èˆ¬æ˜¯ç”±ç½‘ç«™ç®¡ç†å‘˜è‡ªå·±éƒ¨ç½²ï¼Œä¸ºäº†è®©ä»–ä»¬çš„ç½‘ç«™æ›´å®¹æ˜“æ‰©å±•å¹¶è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å…ˆå‘ CDN ç½‘å…³å‘èµ· Web è¯·æ±‚ï¼Œç½‘å…³æœåŠ¡å™¨åé¢å¯¹åº”ç€ä¸€å°æˆ–å¤šå°è´Ÿè½½å‡è¡¡æºæœåŠ¡å™¨ï¼Œä¼šæ ¹æ®å®ƒä»¬çš„è´Ÿè½½è¯·æ±‚ï¼ŒåŠ¨æ€å°†è¯·æ±‚è½¬å‘åˆ°åˆé€‚çš„æºæœåŠ¡å™¨ä¸Šã€‚ä»æµè§ˆå™¨è§’åº¦æ¥çœ‹ï¼Œæ•´ä¸ª CDN å°±æ˜¯ä¸€ä¸ªæºæœåŠ¡å™¨ï¼Œä»è¿™ä¸ªå±‚é¢æ¥è¯´ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç¼“å­˜æœºåˆ¶ï¼Œåœ¨è¿™ç§æ¶æ„ä¸‹åŒæ ·é€‚ç”¨ã€‚</p>
<p>3ã€ä»£ç†æœåŠ¡å™¨ç¼“å­˜<br>ä»£ç†æœåŠ¡å™¨æ˜¯æµè§ˆå™¨å’ŒæºæœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´æœåŠ¡å™¨ï¼Œæµè§ˆå™¨å…ˆå‘è¿™ä¸ªä¸­é—´æœåŠ¡å™¨å‘èµ· Web è¯·æ±‚ï¼Œç»è¿‡å¤„ç†åï¼ˆæ¯”å¦‚æƒé™éªŒè¯ï¼Œç¼“å­˜åŒ¹é…ç­‰ï¼‰ï¼Œå†å°†è¯·æ±‚è½¬å‘åˆ°æºæœåŠ¡å™¨ã€‚ä»£ç†æœåŠ¡å™¨ç¼“å­˜çš„è¿ä½œåŸç†è·Ÿæµè§ˆå™¨çš„è¿ä½œåŸç†å·®ä¸å¤šï¼Œåªæ˜¯è§„æ¨¡æ›´å¤§ã€‚</p>
<p>4ã€åº”ç”¨å±‚ç¼“å­˜<br>åº”ç”¨å±‚ç¼“å­˜æ˜¯æŒ‡æˆ‘ä»¬åœ¨ä»£ç å±‚é¢ä¸Šåšçš„ç¼“å­˜ã€‚é€šè¿‡ä»£ç é€»è¾‘ï¼ŒæŠŠæ›¾ç»è¯·æ±‚è¿‡çš„æ•°æ®æˆ–èµ„æºç­‰ï¼Œç¼“å­˜èµ·æ¥ï¼Œå†æ¬¡éœ€è¦æ•°æ®æ—¶é€šè¿‡é€»è¾‘ä¸Šçš„å¤„ç†é€‰æ‹©å¯ç”¨çš„ç¼“å­˜çš„æ•°æ®ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæµè§ˆå™¨ç¼“å­˜æ˜¯ web æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ–¹é¢ï¼Œæ˜¯æå‡ web æ€§èƒ½çš„ä¸€å¤§åˆ©å™¨ï¼Œä½†æ˜¯æµè§ˆå™¨ç¼“å­˜å¦‚æœä½¿ç”¨ä¸å½“ï¼Œä¹Ÿä¼šäº§ç”Ÿå¾ˆå¤šé—®é¢˜ã€‚æ‰€ä»¥å¯¹äºç¼“å­˜çš„åº”ç”¨éœ€è¦ç»¼åˆè€ƒè™‘ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨ web å‰ç«¯å¼€å‘ä¸­ï¼Œç½‘é¡µååº”é€Ÿåº¦æ˜¯åˆ¤æ–­ä¸€ä¸ªç½‘ç«™çš„æ€§èƒ½æœ€é‡è¦çš„æŒ‡æ ‡ä¹‹ä¸€ã€‚ä¸€ä¸ªä¼˜ç§€çš„ç¼“å­˜ç­–ç•¥å¯ä»¥æé«˜ç½‘é¡µè®¿é—®é€Ÿåº¦ï¼Œå‡å°‘å»¶è¿Ÿï¼Œå‡å°‘å¸¦å®½ï¼Œé™ä½ç½‘ç»œè´Ÿè·ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥æ¢³ç†ä¸€ä¸‹ Web ç¼“å­˜çš„å·¥ä½œæ–¹å¼ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="zhangjihu" scheme="http://xgfe.github.io/categories/zhangjihu/"/>
    
    
      <category term="ç¼“å­˜" scheme="http://xgfe.github.io/tags/%E7%BC%93%E5%AD%98/"/>
    
      <category term="web ç¼“å­˜" scheme="http://xgfe.github.io/tags/web-%E7%BC%93%E5%AD%98/"/>
    
      <category term="æµè§ˆå™¨ç¼“å­˜" scheme="http://xgfe.github.io/tags/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>redux,react-reduxç®€å•å®ç°</title>
    <link href="http://xgfe.github.io/2018/05/01/wangpan/redux,react-redux%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/"/>
    <id>http://xgfe.github.io/2018/05/01/wangpan/redux,react-reduxç®€å•å®ç°/</id>
    <published>2018-04-30T16:00:00.000Z</published>
    <updated>2018-06-19T07:07:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>reduxè§£å†³äº†reactåªä¸“æ³¨viewå±‚å´æ²¡æœ‰æ¶‰åŠåˆ°çš„ ä»£ç ç»“æ„ å’Œç»„ä»¶é€šä¿¡çš„å…³é”®é—®é¢˜ï¼Œæœ¬æ–‡ä¸»è¦ç›®çš„æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„reduxå’Œreact-reduxå¹¶ä¸”å®ç°å…¶middlewareä¸­é—´ä»¶æœºåˆ¶ã€‚</p>
<a id="more"></a>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨reacté¡¹ç›®ä¸­ï¼Œå¦‚æœä½ çš„UIå±‚éå¸¸ç®€å•ï¼Œæ²¡æœ‰å¾ˆå¤šçš„äº’åŠ¨ï¼Œé‚£ä¹ˆreduxæ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚<br>reduxæ˜¯ä¸€ä¸ªæœ‰ç”¨çŠ¶æ€æ¶æ„ï¼Œæ‰€æœ‰çš„çŠ¶æ€ä¿å­˜åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œå¯¹äºå¤§å‹çš„å¤æ‚åº”ç”¨ï¼Œ ä»£ç ç»“æ„å’Œç»„ä»¶é€šä¿¡æ˜¯æä¸ºå…³é”®çš„ï¼Œè€Œreduxå°±æ˜¯è§£å†³è¿™ä¸¤æ–¹é¢çš„é—®é¢˜ã€‚</p>
<h3 id="ä¸€ã€reduxä½¿ç”¨åœºæ™¯"><a href="#ä¸€ã€reduxä½¿ç”¨åœºæ™¯" class="headerlink" title="ä¸€ã€reduxä½¿ç”¨åœºæ™¯"></a>ä¸€ã€reduxä½¿ç”¨åœºæ™¯</h3><p><strong>é€‚ç”¨reduxçš„åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·çš„ä½¿ç”¨æ–¹å¼å¤æ‚</li>
<li>ä¸åŒèº«ä»½çš„ç”¨æˆ·æœ‰ä¸åŒçš„ä½¿ç”¨æ–¹å¼ï¼ˆæ¯”å¦‚æ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼‰</li>
<li>å¤šä¸ªç”¨æˆ·ä¹‹é—´å¯ä»¥åä½œ</li>
<li>ä¸æœåŠ¡å™¨å¤§é‡äº¤äº’ï¼Œæˆ–è€…ä½¿ç”¨äº†WebSocket</li>
<li>Viewè¦ä»å¤šä¸ªæ¥æºè·å–æ•°æ®</li>
</ul>
<p><strong>ä»ç»„ä»¶è§’åº¦çœ‹</strong>:</p>
<ul>
<li>æŸä¸ªç»„ä»¶çš„çŠ¶æ€ï¼Œéœ€è¦å…±äº«</li>
<li>æŸä¸ªçŠ¶æ€éœ€è¦åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥æ‹¿åˆ°</li>
<li>ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å…¨å±€çŠ¶æ€</li>
<li>ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å¦ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€</li>
</ul>
<h3 id="äºŒã€reduxå¸¸ç”¨API"><a href="#äºŒã€reduxå¸¸ç”¨API" class="headerlink" title="äºŒã€reduxå¸¸ç”¨API"></a>äºŒã€reduxå¸¸ç”¨API</h3><ul>
<li>createStore<store>()    åˆ›å»ºstroe è¿”å›storeå¯¹è±¡</store></li>
<li>store.getState<state>() è¿”å›state</state></li>
<li>store.subscribe()       è®¢é˜…store</li>
<li>store.dispatch()        æäº¤çŠ¶æ€å˜æ›´çš„ç”³è¯·</li>
</ul>
<h3 id="ä¸‰ã€reduxç®€å•å®ç°"><a href="#ä¸‰ã€reduxç®€å•å®ç°" class="headerlink" title="ä¸‰ã€reduxç®€å•å®ç°"></a>ä¸‰ã€reduxç®€å•å®ç°</h3><p>æ•´ä½“æ¶æ„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> currentState = &#123;&#125;</div><div class="line">    <span class="keyword">let</span> currentListeners = []</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> currentState</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">subscirbe</span>(<span class="params">listener</span>) </span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span> (<span class="params">action</span>) </span>&#123;&#125;</div><div class="line">    <span class="comment">// åˆå§‹æ‰§è¡Œä¸€æ¬¡ï¼Œè·å¾—åˆå§‹åŒ–çŠ¶æ€</span></div><div class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="string">'@first_init@wangpan'</span> &#125;)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        getState, subscribe, dispatch</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span> (<span class="params">creator, dispatch</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(creator(...args))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> bindAcitonCreators(creators, dispatch) &#123;</div><div class="line">    <span class="keyword">let</span> bound = &#123;&#125;</div><div class="line">    <span class="built_in">Object</span>.keys(creators).forEach(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">let</span> creator = creators[v]</div><div class="line">        bound[v] = bindActionCreator(creator, dispatch)</div><div class="line">    &#125;)</div><div class="line">    <span class="keyword">return</span> bound</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>subcribeå‡½æ•°ï¼Œä¼ å…¥ç›‘å¬å‡½æ•°ï¼Œæ³¨æ„å¯¹å‚æ•°æ ¡éªŒï¼Œå› ä¸ºåªæ˜¯ç®€å•å®ç°ï¼Œæˆ‘è¿™å°±ä¸å†™å•¦<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// subscribeè®¢é˜…å‡½æ•° ä¼ å…¥listenerå‡½æ•°</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span> (<span class="params">listenr</span>) </span>&#123;</div><div class="line">    currentListeners.push(listener)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>dispatchå‡½æ•°ï¼Œä¼ å…¥action,åŒæ ·å¯ä»¥å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒ<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span> (<span class="params">action</span>) </span>&#123;</div><div class="line">    currentState = reducer(currentState, aciton)</div><div class="line">    <span class="comment">// stateæ”¹å˜ï¼Œæ‰§è¡Œè®¢é˜…å‡½æ•°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„å‘å¸ƒè€…è®¢é˜…è€…æ¨¡å¼</span></div><div class="line">    currentListeners.forEach(<span class="function"><span class="params">v</span> =&gt;</span> v())</div><div class="line">    <span class="keyword">return</span> aciton</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šä¸€ä¸ªæœ€ç®€å•çš„reduxå°±æ˜¯å®ç°äº†ï¼Œç°åœ¨æš‚ä¸”ä¸å®ç°reduxä¸­é—´ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹react-reduxå®ç°</p>
<h3 id="å››ã€react-reduxç®€å•å®ç°"><a href="#å››ã€react-reduxç®€å•å®ç°" class="headerlink" title="å››ã€react-reduxç®€å•å®ç°"></a>å››ã€react-reduxç®€å•å®ç°</h3><p>åœ¨å®ç°react-reduxä¹‹å‰ï¼Œå…ˆæ¥çœ‹çœ‹reactçš„context,è¿™æ˜¯å®ç°react-reduxçš„å…³é”®<br>åœ¨reactçˆ¶å­ç»„ä»¶é€šä¿¡æ˜¯éå¸¸ç®€å•çš„ï¼Œé€šè¿‡propså°±å¯ä»¥å®ç°ï¼Œä½†æ˜¯åœ¨å¤šå±‚çº§çš„åœºæ™¯ä¸‹é€šä¿¡é€šè¿‡propsä¸€å±‚ä¸€å±‚ä¼ é€’æ˜¯éå¸¸éº»çƒ¦è€Œä¸”ä¸å‹å¥½çš„,æ‰€ä»¥reactæä¾›contextå®ç°ç»„ä»¶çš„è·¨å¤šå±‚çº§é€šä¿¡ã€‚</p>
<p>react-reduxåŸºæœ¬æ¶æ„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Children &#125; <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> Proptypes <span class="keyword">from</span> <span class="string">'prop-types'</span></div><div class="line"><span class="keyword">import</span> &#123; bindAcitonCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"><span class="comment">// è´Ÿè´£é“¾æ¥ç»„ä»¶ï¼Œå°†reduxä¸­çš„æ•°æ®æ”¾å…¥ç»„ä»¶</span></div><div class="line"><span class="comment">// é«˜é˜¶ç»„ä»¶</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> connect(mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> state, mapDispatchToProps = &#123;&#125;) =&gt;<span class="function">(<span class="params">WrapComponent</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">        <span class="keyword">static</span> contextTypes = &#123;</div><div class="line">            <span class="attr">store</span>: PropTpes.object</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">constructor</span> (props, context) &#123;</div><div class="line">            <span class="keyword">super</span>(props)</div><div class="line">            <span class="keyword">this</span>.state = &#123;</div><div class="line">                <span class="attr">props</span>: &#123;&#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        componentDidMount() &#123;</div><div class="line">            <span class="keyword">this</span>.update()</div><div class="line">            <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</div><div class="line">            store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.update())</div><div class="line">            <span class="keyword">this</span>.update()</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        update () &#123;</div><div class="line">            <span class="keyword">const</span> &#123; store &#125; = <span class="keyword">this</span>.context</div><div class="line">            <span class="keyword">const</span> stateProps = mapStateToProps(store.getState())</div><div class="line">            <span class="keyword">const</span> dispatchProps = bindAcitonCreators(mapDispatchToProps, store.dispatch)</div><div class="line">            <span class="keyword">this</span>.setState(&#123;</div><div class="line">                <span class="attr">props</span>: &#123;</div><div class="line">                    ...this.state.props</div><div class="line">                    ...stateProps</div><div class="line">                    ...dispatchProps</div><div class="line">                    ...this.props</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        render() &#123;</div><div class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrapComponent</span> &#123;<span class="attr">...this.state.props</span>&#125; /&gt;</span></span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">// Providerç»„ä»¶ï¼ŒæŠŠstroreæ”¾å…¥contextä¸­ï¼Œæ‰€æœ‰å­å…ƒç´ å¯ä»¥ç›´æ¥å»åˆ°store</div><div class="line">export class Provider extends React.Component &#123;</div><div class="line">    static childContextTypes = &#123;</div><div class="line">        store: Proptypes.object</div><div class="line">    &#125;</div><div class="line">    getchildContext () &#123;</div><div class="line">        return &#123;</div><div class="line">            store: this.store</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    constructor (props, context) &#123;</div><div class="line">        super(props, context)</div><div class="line">        this.store = props.store</div><div class="line">    &#125;</div><div class="line">    render () &#123;</div><div class="line">        return Children.only(this.props.children)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="äº”ã€ä¸­é—´ä»¶æœºåˆ¶"><a href="#äº”ã€ä¸­é—´ä»¶æœºåˆ¶" class="headerlink" title="äº”ã€ä¸­é—´ä»¶æœºåˆ¶"></a>äº”ã€ä¸­é—´ä»¶æœºåˆ¶</h3><p>åœ¨ä¹‹å‰çš„reduxåŸºç¡€ä¸Šæ·»åŠ applyMiddlewareå‡½æ•°ï¼Œå¹¶ä¸”æ‰©å±•crateStoreå‡½æ•°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span> (<span class="params">reducer, enhancer</span>) </span>&#123;</div><div class="line">    <span class="comment">// å¦‚æœä¸­é—´ä»¶å­˜åœ¨</span></div><div class="line">    <span class="keyword">if</span> (enhancer) &#123;</div><div class="line">        <span class="keyword">return</span> enhancer(createStore)(reducer)</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">middleware</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="params">createStore</span> =&gt;</span> (...args) =&gt; &#123;</div><div class="line">        <span class="keyword">const</span> store = createStore(...args)</div><div class="line">        <span class="keyword">const</span> dispatch = store.dispatch</div><div class="line"></div><div class="line">        <span class="keyword">const</span> midApi = &#123;</div><div class="line">            <span class="attr">getState</span>: store.getState,</div><div class="line">            <span class="attr">dispatch</span>: <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(...args)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        dispatch = middleware(midApi)(store, dispatch)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            ...store,</div><div class="line">            dispatch</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="å…­ã€redux-thunkç®€å•å®ç°"><a href="#å…­ã€redux-thunkç®€å•å®ç°" class="headerlink" title="å…­ã€redux-thunkç®€å•å®ç°"></a>å…­ã€redux-thunkç®€å•å®ç°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> thunk = <span class="function">(<span class="params">&#123;dispatch, getState&#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="function"><span class="keyword">function</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> action(dispatch, getState)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> next(action)</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> thunk</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±åŸºæœ¬å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„reduxå’Œreact-redux</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;&lt;p&gt;reduxè§£å†³äº†reactåªä¸“æ³¨viewå±‚å´æ²¡æœ‰æ¶‰åŠåˆ°çš„ ä»£ç ç»“æ„ å’Œç»„ä»¶é€šä¿¡çš„å…³é”®é—®é¢˜ï¼Œæœ¬æ–‡ä¸»è¦ç›®çš„æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„reduxå’Œreact-reduxå¹¶ä¸”å®ç°å…¶middlewareä¸­é—´ä»¶æœºåˆ¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="wangpan" scheme="http://xgfe.github.io/categories/wangpan/"/>
    
    
      <category term="react" scheme="http://xgfe.github.io/tags/react/"/>
    
      <category term="redux" scheme="http://xgfe.github.io/tags/redux/"/>
    
  </entry>
  
  <entry>
    <title>åŠ¨ç”»åº“ Lottie çš„ä½¿ç”¨</title>
    <link href="http://xgfe.github.io/2018/04/26/wangpeng/lottie_android/"/>
    <id>http://xgfe.github.io/2018/04/26/wangpeng/lottie_android/</id>
    <published>2018-04-26T08:26:00.000Z</published>
    <updated>2018-05-29T04:35:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»åŠ¨ç”»å¼€æºåº“ Lottie åœ¨ Android ä¸­çš„ä½¿ç”¨ã€‚</p>
<a id="more"></a>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨æ—¥å¸¸APPå¼€å‘ä¸­ï¼Œä¸ºäº†æå‡ç”¨æˆ·æ„Ÿå®˜èˆ’é€‚åº¦ç­‰åŸå› ï¼Œæˆ‘ä»¬ä¼šåœ¨APPä¸­åŠ å…¥é€‚é‡åŠ¨ç”»ã€‚<br>è€Œä¼ ç»Ÿæ‰‹å†™åŠ¨ç”»æ–¹å¼å¾€å¾€å­˜åœ¨è¯¸å¤šé—®é¢˜:</p>
<ul>
<li><p><strong>åŠ¨ç”»å¤æ‚è€Œå®ç°å›°éš¾</strong></p>
</li>
<li><p><strong>å›¾ç‰‡ç´ æå ç”¨ä½“ç§¯è¿‡å¤§</strong></p>
</li>
<li><p><strong>ä¸åŒNativeå¹³å°éƒ½éœ€å„è‡ªå®ç°ï¼Œå¼€å‘æˆæœ¬é«˜</strong></p>
</li>
<li><p><strong>ä¸åŒNativeå¹³å°å®ç°çš„æœ€ç»ˆæ•ˆæœä¸ä¸€è‡´</strong></p>
</li>
<li><p><strong>åæœŸè§†è§‰è”è°ƒå·®å¼‚åŒ–å¤§</strong></p>
</li>
</ul>
<p><img src="http://p0.meituan.com/tuanpic/lottie_android_headache.jpeg" alt="">  </p>
<p><em>éš¾é“å°±æ²¡æœ‰ä¸€ç§ç®€ä¾¿ä¸”é«˜æ•ˆçš„æ–¹æ¡ˆæ¥å‡ç¼“æˆ–è§£å†³ä¸Šè¿°é—®é¢˜å—ï¼Ÿ</em></p>
<p>ç­”: æœ‰çš„ï¼Œé‚£å°±æ˜¯æœ¬æ–‡è¦ä»‹ç»çš„ä¸»è§’ <strong>Lottie</strong>ã€‚</p>
<h2 id="ä¸€ã€Lottie-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Lottie-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Lottie æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Lottie æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote>
<p>Lottieæ˜¯Airbnbå¼€æºçš„ä¸€ä¸ªé¢å‘IOSã€Androidã€React Nativeçš„åŠ¨ç”»åº“ï¼Œå¯ä»¥è§£æç”¨ Adobe After Effects åˆ¶ä½œåŠ¨ç”»åé€šè¿‡ Bodymovin æ’ä»¶å¯¼å‡ºçš„ Json æ•°æ®æ–‡ä»¶å¹¶åœ¨ç§»åŠ¨ç«¯åŸç”Ÿæ¸²æŸ“ã€‚</p>
</blockquote>
<p>é€šä¿—ç‚¹è¯´ï¼Œå®ƒæ˜¯ä¸€æ¬¾åŠ¨ç”»å¼€æºåº“ï¼Œé€šè¿‡è§£æç‰¹å®šçš„Jsonæ–‡ä»¶æˆ–Jsonæ–‡æœ¬ï¼Œå¯ç›´æ¥åœ¨ç§»åŠ¨ç«¯ä¸Šæ¸²æŸ“å‡ºå¤æ‚çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<p><img src="http://p0.meituan.com/tuanpic/lottie_android_flow.png" alt="å‚è€ƒå›¾é‡Š"></p>
<h2 id="äºŒã€Lottie-èƒ½å¹²ä»€ä¹ˆ"><a href="#äºŒã€Lottie-èƒ½å¹²ä»€ä¹ˆ" class="headerlink" title="äºŒã€Lottie èƒ½å¹²ä»€ä¹ˆ?"></a>äºŒã€Lottie èƒ½å¹²ä»€ä¹ˆ?</h2><p><strong>å®ƒå¯ä»¥ç®€ä¾¿é«˜æ•ˆçš„å®ç°å¤æ‚åŠ¨ç”»ï¼Œæ›¿ä»£ä¼ ç»Ÿä½æ•ˆçš„æ‰‹å†™åŠ¨ç”»æ–¹å¼ã€‚</strong> </p>
<p>åŠ¨ç”»å±•ç¤º:</p>
<p><img src="http://p0.meituan.com/tuanpic/lottie_android_example_4.gif" alt=""></p>
<p>ä¸Šæ–¹çš„åŠ¨ç”»æ˜¯é€šè¿‡Lottieç›´æ¥å®ç°çš„ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ‰‹å†™ä»£ç æ–¹å¼å®ç°ï¼Œå¯ä»¥è¯´æ˜¯å¾ˆéš¾ï¼  </p>
<p>è€Œé€šè¿‡ Lottie å®ç°æ—¶ï¼Œéœ€è¦çš„ä»…æ˜¯ä¸€ä¸ªJsonæ–‡ä»¶æˆ–ä¸€æ®µJsonæ–‡æœ¬ï¼Œå¹¶é€šè¿‡ç®€æ´çš„ä»£ç é›†æˆå³å¯ã€‚</p>
<p>é›†æˆä»£ç å¯èƒ½ç²¾ç®€åˆ°å¦‚ä¸‹æ¨¡æ ·:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.airbnb.lottie.LottieAnimationView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/animation_view"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">    <span class="attr">app:lottie_rawRes</span>=<span class="string">"@raw/anim_lottie"</span></div><div class="line">    <span class="attr">app:lottie_loop</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">app:lottie_autoPlay</span>=<span class="string">"true"</span> /&gt;</div></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€ä¸ºä»€ä¹ˆä½¿ç”¨-Lottie"><a href="#ä¸‰ã€ä¸ºä»€ä¹ˆä½¿ç”¨-Lottie" class="headerlink" title="ä¸‰ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Lottie?"></a>ä¸‰ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Lottie?</h2><ul>
<li><p><strong>ç®€ä¾¿ï¼Œå¼€å‘æˆæœ¬ä½</strong><br>ç›¸å¯¹äºä¼ ç»Ÿæ–¹å¼ï¼ŒåŠ¨ç”»ä¸å†æ˜¯å…¨éƒ¨æ‰‹å†™ï¼Œæ‰€éœ€åšå¾—åªæ˜¯åµŒå…¥XMLå¹¶é…ç½®åŠ¨ç”»å±æ€§ï¼Œé›†æˆå¿«ï¼Œå¼€å‘æ—¶é—´å°‘ï¼Œå¼€å‘æˆæœ¬ä½ã€‚    </p>
</li>
<li><p><strong>ä¸åŒ Native å¹³å°æ•ˆæœåŸºæœ¬ä¸€è‡´</strong><br>æ¸²æŸ“äº¤ç”±Lottieå¼•æ“å†…éƒ¨å®ç°ï¼Œæ— éœ€å¼€å‘è€…å¤„ç†å¹³å°å·®å¼‚ï¼Œå¤šå¹³å°å…±ç”¨åŒä¸€ä¸ªåŠ¨ç”»é…ç½®æ–‡ä»¶ï¼Œæ•ˆæœä¸€è‡´æ€§é«˜ã€‚    </p>
</li>
<li><p><strong>å ç”¨åŒ…ä½“ç§¯å°</strong><br>Lottieé…ç½®æ–‡ä»¶ç”±Jsonæ–‡æœ¬ä¸²æ„æˆï¼Œç›¸å¯¹äºå›¾ç‰‡ï¼Œå ç”¨ä½“ç§¯æ›´å°ã€‚</p>
</li>
<li><p><strong>åŠ¨ç”»æ•ˆæœä¸å¤±çœŸ</strong><br>ä¼ ç»Ÿå›¾ç‰‡æ‹‰ä¼¸æˆ–å‹ç¼©å¯¼è‡´å¤±çœŸï¼Œè€ŒLottieä¸ºçŸ¢é‡å›¾å±•ç¤ºï¼Œä¸ä¼šå‡ºç°å¤±çœŸæƒ…å†µã€‚</p>
</li>
<li><p><strong>åŠ¨ç”»æ•ˆæœå¯ä»¥äº‘ç«¯æ§åˆ¶</strong><br>ç”±äºLottieåŠ¨ç”»åŸºäºJsonæ–‡ä»¶æˆ–æ–‡æœ¬è§£æï¼Œå› æ­¤å¯ä»¥å®ç°äº‘ç«¯ä¸‹å‘ï¼Œå®ç°åŠ¨æ€åŠ è½½ï¼ŒåŠ¨æ€æ§åˆ¶åŠ¨ç”»æ ·å¼ã€‚</p>
</li>
</ul>
<h2 id="å››ã€å¦‚ä½•ä½¿ç”¨-Lottieï¼Ÿ"><a href="#å››ã€å¦‚ä½•ä½¿ç”¨-Lottieï¼Ÿ" class="headerlink" title="å››ã€å¦‚ä½•ä½¿ç”¨ Lottieï¼Ÿ"></a>å››ã€å¦‚ä½•ä½¿ç”¨ Lottieï¼Ÿ</h2><p>Lottie ä»…æ”¯æŒç”¨ Gradle æ„å»ºé…ç½®ï¼Œæœ€ä½æ”¯æŒå®‰å“ç‰ˆæœ¬ 16ã€‚     </p>
<h3 id="1-æ·»åŠ ä¾èµ–åˆ°-build-gradle"><a href="#1-æ·»åŠ ä¾èµ–åˆ°-build-gradle" class="headerlink" title="1. æ·»åŠ ä¾èµ–åˆ° build.gradle"></a>1. æ·»åŠ ä¾èµ–åˆ° build.gradle</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    implementation <span class="string">'com.airbnb.android:lottie:2.5.4'</span></div><div class="line">&#125;</div><div class="line">æˆ–</div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    implementation <span class="string">"com.airbnb.android:lottie:$&#123;å…¨å±€ç‰ˆæœ¬å˜é‡&#125;"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-æ·»åŠ -Adobe-After-Effects-å¯¼å‡ºçš„åŠ¨ç”»-Json-æ–‡ä»¶"><a href="#2-æ·»åŠ -Adobe-After-Effects-å¯¼å‡ºçš„åŠ¨ç”»-Json-æ–‡ä»¶" class="headerlink" title="2. æ·»åŠ  Adobe After Effects å¯¼å‡ºçš„åŠ¨ç”» Json æ–‡ä»¶"></a>2. æ·»åŠ  Adobe After Effects å¯¼å‡ºçš„åŠ¨ç”» Json æ–‡ä»¶</h3><p>é€šå¸¸ç”±è§†è§‰å·¥ç¨‹å¸ˆç¡®è®¤åŠ¨æ•ˆåé€šè¿‡AEå¯¼å‡º, æˆ‘ä»¬åªéœ€å°†è¯¥Jsonæ–‡ä»¶ä¿å­˜è‡³ /raw æˆ– /assetsæ–‡ä»¶å¤¹ä¸‹ã€‚  </p>
<h3 id="3-XMLä¸­åµŒå…¥åŸºæœ¬å¸ƒå±€"><a href="#3-XMLä¸­åµŒå…¥åŸºæœ¬å¸ƒå±€" class="headerlink" title="3. XMLä¸­åµŒå…¥åŸºæœ¬å¸ƒå±€"></a>3. XMLä¸­åµŒå…¥åŸºæœ¬å¸ƒå±€</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.airbnb.lottie.LottieAnimationView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/animation_view"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div></pre></td></tr></table></figure>
<h3 id="4-åŠ è½½æ’­æ”¾åŠ¨ç”»ï¼Œä¸¤ç±»æ–¹å¼å¯é€‰"><a href="#4-åŠ è½½æ’­æ”¾åŠ¨ç”»ï¼Œä¸¤ç±»æ–¹å¼å¯é€‰" class="headerlink" title="4. åŠ è½½æ’­æ”¾åŠ¨ç”»ï¼Œä¸¤ç±»æ–¹å¼å¯é€‰"></a>4. åŠ è½½æ’­æ”¾åŠ¨ç”»ï¼Œä¸¤ç±»æ–¹å¼å¯é€‰</h3><h4 id="â‘ -XMLä¸­é™æ€é…ç½®-ä¸¾ä¾‹"><a href="#â‘ -XMLä¸­é™æ€é…ç½®-ä¸¾ä¾‹" class="headerlink" title="â‘  XMLä¸­é™æ€é…ç½®, ä¸¾ä¾‹:"></a>â‘  XMLä¸­é™æ€é…ç½®, ä¸¾ä¾‹:</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.airbnb.lottie.LottieAnimationView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/animation_view"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">       </div><div class="line">    //åŠ è½½æ–¹å¼å¦‚ä¸‹<span class="attr">2</span>ç§ä»»é€‰å…¶ä¸€</div><div class="line">    <span class="attr">app:lottie_rawRes</span>=<span class="string">"@raw/hello_world"</span></div><div class="line">    <span class="attr">app:lottie_fileName</span>=<span class="string">"hello_world.json"</span></div><div class="line">	</div><div class="line">    //å¾ªç¯æ’­æ”¾</div><div class="line">    <span class="attr">app:lottie_loop</span>=<span class="string">"true"</span></div><div class="line">    //åŠ è½½å®Œæ¯•åè‡ªåŠ¨æ’­æ”¾</div><div class="line">    <span class="attr">app:lottie_autoPlay</span>=<span class="string">"true"</span> /&gt;</div></pre></td></tr></table></figure>
<h4 id="â‘¡-ä»£ç åŠ¨æ€é…ç½®-ä¸¾ä¾‹"><a href="#â‘¡-ä»£ç åŠ¨æ€é…ç½®-ä¸¾ä¾‹" class="headerlink" title="â‘¡ ä»£ç åŠ¨æ€é…ç½®, ä¸¾ä¾‹:"></a>â‘¡ ä»£ç åŠ¨æ€é…ç½®, ä¸¾ä¾‹:</h4><p><em>å¦‚ä¸‹ä»£ç ä¼šåœ¨åå°å¼‚æ­¥åŠ è½½åŠ¨ç”»æ–‡ä»¶ï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåå¼€å§‹æ¸²æŸ“åŠ¨ç”»ã€‚</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">LottieAnimationView animationView = ...;</div><div class="line">animationView.setAnimation(R.raw.hello_world);</div><div class="line">animationView.loop(<span class="keyword">true</span>);</div><div class="line">animationView.playAnimation();</div></pre></td></tr></table></figure>
<h2 id="äº”ã€å…¶ä»–æ‹“å±•ä½¿ç”¨"><a href="#äº”ã€å…¶ä»–æ‹“å±•ä½¿ç”¨" class="headerlink" title="äº”ã€å…¶ä»–æ‹“å±•ä½¿ç”¨"></a>äº”ã€å…¶ä»–æ‹“å±•ä½¿ç”¨</h2><h3 id="1-ç›´æ¥è§£æJsonæ–‡æœ¬ä¸²åŠ è½½åŠ¨ç”»"><a href="#1-ç›´æ¥è§£æJsonæ–‡æœ¬ä¸²åŠ è½½åŠ¨ç”»" class="headerlink" title="1. ç›´æ¥è§£æJsonæ–‡æœ¬ä¸²åŠ è½½åŠ¨ç”»"></a>1. ç›´æ¥è§£æJsonæ–‡æœ¬ä¸²åŠ è½½åŠ¨ç”»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">JsonReader jsonReader = <span class="keyword">new</span> JsonReader(<span class="keyword">new</span> StringReader(jsonStr));</div><div class="line">lottieView.setAnimation(jsonReader);</div><div class="line">lottieView.playAnimation();</div><div class="line">æˆ–</div><div class="line">Cancellable cancellable = LottieComposition.Factory.fromJsonString(jsonStr, composition -&gt; &#123;</div><div class="line">            lottieView.setComposition(composition);</div><div class="line">            lottieView.playAnimation();</div><div class="line">        &#125;);</div><div class="line"><span class="comment">//å¿…è¦æ—¶å–æ¶ˆè¿›è¡Œä¸­çš„å¼‚æ­¥æ“ä½œ</span></div><div class="line">cancellable.cancel();</div></pre></td></tr></table></figure>
<h3 id="2-é…åˆç½‘ç»œä¸‹è½½ï¼Œå®ç°ä¸‹è½½Jsoné…ç½®å¹¶åŠ¨æ€åŠ è½½"><a href="#2-é…åˆç½‘ç»œä¸‹è½½ï¼Œå®ç°ä¸‹è½½Jsoné…ç½®å¹¶åŠ¨æ€åŠ è½½" class="headerlink" title="2. é…åˆç½‘ç»œä¸‹è½½ï¼Œå®ç°ä¸‹è½½Jsoné…ç½®å¹¶åŠ¨æ€åŠ è½½"></a>2. é…åˆç½‘ç»œä¸‹è½½ï¼Œå®ç°ä¸‹è½½Jsoné…ç½®å¹¶åŠ¨æ€åŠ è½½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Call&lt;ResponseBody&gt; call = RetrofitComponent.fetchLottieConfig();<span class="comment">//ä¼ªä»£ç </span></div><div class="line">call.enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</div><div class="line">                <span class="comment">//String json = response.body().string();</span></div><div class="line">                <span class="comment">//äº¤ç”±Lottieå¤„ç†...</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</div><div class="line">                <span class="comment">//do something.</span></div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<h3 id="3-åŠ¨ç”»åŠ è½½ç›‘å¬å™¨"><a href="#3-åŠ¨ç”»åŠ è½½ç›‘å¬å™¨" class="headerlink" title="3. åŠ¨ç”»åŠ è½½ç›‘å¬å™¨"></a>3. åŠ¨ç”»åŠ è½½ç›‘å¬å™¨</h3><p>æ ¹æ®ä¸šåŠ¡éœ€è¦è¿›è¡ŒåŠ¨ç”»è¿‡ç¨‹ç›‘å¬:    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">animationView.addAnimatorUpdateListener((animation) -&gt; &#123;</div><div class="line">    	<span class="comment">// do something.</span></div><div class="line">&#125;);</div><div class="line">animationView.playAnimation();</div><div class="line">...</div><div class="line"><span class="keyword">if</span> (animationView.isAnimating()) &#123;</div><div class="line">	<span class="comment">// do something.</span></div><div class="line">&#125;</div><div class="line">...</div><div class="line">animationView.setProgress(<span class="number">0.5f</span>);</div><div class="line">...</div></pre></td></tr></table></figure>
<h3 id="4-LottieDrawable-çš„ä½¿ç”¨"><a href="#4-LottieDrawable-çš„ä½¿ç”¨" class="headerlink" title="4. LottieDrawable çš„ä½¿ç”¨"></a>4. LottieDrawable çš„ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">LottieDrawable drawable = <span class="keyword">new</span> LottieDrawable();</div><div class="line">LottieComposition.Factory.fromAssetFileName(getApplicationContext(), <span class="string">"lottie_pin_jump.json"</span>, composition -&gt; &#123;</div><div class="line">            drawable.setComposition(composition);</div><div class="line">            <span class="comment">//ç›®å‰æ˜¾ç¤ºä¸ºé™æ€å›¾</span></div><div class="line">            ivLottie.setImageDrawable(drawable);</div><div class="line">            <span class="comment">//è°ƒç”¨start()å¼€å§‹æ’­æ”¾åŠ¨ç”»</span></div><div class="line">            drawable.start();</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<h3 id="5-æ›´å¤šä½¿ç”¨å¯å‚è€ƒæ–‡æœ«å®˜æ–¹é“¾æ¥"><a href="#5-æ›´å¤šä½¿ç”¨å¯å‚è€ƒæ–‡æœ«å®˜æ–¹é“¾æ¥" class="headerlink" title="5. æ›´å¤šä½¿ç”¨å¯å‚è€ƒæ–‡æœ«å®˜æ–¹é“¾æ¥"></a>5. æ›´å¤šä½¿ç”¨å¯å‚è€ƒæ–‡æœ«å®˜æ–¹é“¾æ¥</h3><h2 id="å…­ã€éœ€è¦è€ƒè™‘çš„é—®é¢˜"><a href="#å…­ã€éœ€è¦è€ƒè™‘çš„é—®é¢˜" class="headerlink" title="å…­ã€éœ€è¦è€ƒè™‘çš„é—®é¢˜"></a>å…­ã€éœ€è¦è€ƒè™‘çš„é—®é¢˜</h2><ol>
<li>ç”±äºæ˜¯ä¾èµ–äºAEåšçš„åŠ¨ç”»ï¼Œä¼°è®¡ä»¥åä¸åªæ˜¯è¦æ±‚è§†è§‰è®¾è®¡å¸ˆç²¾é€šAEï¼Œè¿å‰ç«¯å¼€å‘éƒ½éœ€è¦äº†è§£AE  </li>
<li>Lottie å¯¹ Json æ–‡ä»¶çš„æ”¯æŒå¾…å®Œå–„ï¼Œç›®å‰å­˜åœ¨éƒ¨åˆ†AEå¯¼å‡ºæˆ Json æ–‡ä»¶æ— æ³•æ¸²æŸ“æˆ–æ¸²æŸ“ä¸ä½³</li>
<li>æ”¯æŒçš„åŠŸèƒ½å­˜åœ¨é™åˆ¶ï¼Œå¯å‚è€ƒ <a href="http://airbnb.io/lottie/supported-features.html" target="_blank" rel="external">åŠŸèƒ½æ”¯æŒåˆ—è¡¨</a>ã€‚</li>
</ol>
<h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>å°½ç®¡Lottieè¿˜å­˜åœ¨è¯¸å¤šå°é—®é¢˜ï¼Œä½†å®ƒæ‰€å¸¦æ¥çš„æ•ˆç‡æå‡ç»å¯¹æ˜¯ä¼ ç»Ÿå¼€å‘æ–¹å¼æ— æ³•æ¯”æ‹Ÿçš„ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯æ­£ç¡®å–„ç”¨å®ƒã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="http://airbnb.io/lottie/android/android.html" target="_blank" rel="external">å®˜ç½‘ç½‘å€</a><br><a href="https://github.com/airbnb/lottie-android" target="_blank" rel="external">Githubåœ°å€</a><br><a href="https://github.com/airbnb/lottie-android/tree/master/LottieSample/src/main/assets" target="_blank" rel="external">æµ‹è¯•ç”¨Jsonæ–‡ä»¶</a><br><a href="https://github.com/bigxixi/lottie-android" target="_blank" rel="external">é¡¹ç›®ä¸­æ–‡ç¿»è¯‘ç‰ˆ (ç•¥æœ‰å·®å¼‚)</a>  </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦ä»‹ç»åŠ¨ç”»å¼€æºåº“ Lottie åœ¨ Android ä¸­çš„ä½¿ç”¨ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="w.p" scheme="http://xgfe.github.io/categories/w-p/"/>
    
    
      <category term="Android" scheme="http://xgfe.github.io/tags/Android/"/>
    
      <category term="animation" scheme="http://xgfe.github.io/tags/animation/"/>
    
      <category term="lottie" scheme="http://xgfe.github.io/tags/lottie/"/>
    
  </entry>
  
  <entry>
    <title>å®ç°Reactå›½é™…åŒ–</title>
    <link href="http://xgfe.github.io/2018/04/26/jiangxiang/internationalize-your-react-project/"/>
    <id>http://xgfe.github.io/2018/04/26/jiangxiang/internationalize-your-react-project/</id>
    <published>2018-04-26T07:00:00.000Z</published>
    <updated>2018-05-29T03:15:12.000Z</updated>
    
    <content type="html"><![CDATA[<p> React æœ€æ—©ç”± Facebook çš„è½¯ä»¶å·¥ç¨‹å¸ˆ Jordan Walke åˆ›å»ºï¼Œå®ƒåœ¨ 2011 å¹´é¦–æ¬¡éƒ¨ç½²åœ¨ Facebook çš„æ–°é—»æºä¸­ï¼Œç”±äºå…¶æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ï¼Œå¾ˆå¿«è·å¾—äº†å¹¿æ³›å…³æ³¨å’Œå¤§è§„æ¨¡çš„ä½¿ç”¨ï¼Œå¦‚ä»Šå‘å±•å·²ç»éå¸¸æˆç†Ÿã€‚<br>åŸºäº React çš„æ¸²æŸ“åŸç†å¯ä»¥å®ç°å¾ˆå¤šæœ‰æ„æ€çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å®ç°ä¸€ä¸ª React çš„å›½é™…åŒ–å·¥å…·ã€‚(React v16.3)</p>
<a id="more"></a>
<h2 id="ä¸€ã€ç°çŠ¶"><a href="#ä¸€ã€ç°çŠ¶" class="headerlink" title="ä¸€ã€ç°çŠ¶"></a>ä¸€ã€ç°çŠ¶</h2><h3 id="1-1-ç›®å‰-React-å›½é™…åŒ–å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼š"><a href="#1-1-ç›®å‰-React-å›½é™…åŒ–å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="1.1 ç›®å‰ React å›½é™…åŒ–å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼š"></a>1.1 ç›®å‰ React å›½é™…åŒ–å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆï¼š</h3><ol>
<li>æ‰“åŒ…æ—¶ç¿»è¯‘</li>
<li>åŠ¨æ€ç¿»è¯‘</li>
<li>ç”Ÿæˆå¤šä¸ªç‰ˆæœ¬</li>
</ol>
<p>æ¯”è¾ƒæµè¡Œçš„ä¸º webpack å›¢é˜ŸåŸºäºæ‰“åŒ…æ—¶ç¿»è¯‘çš„ webpack-i18n-plugin å’Œ yahoo å›¢é˜ŸåŸºäºåŠ¨æ€ç¿»è¯‘çš„ React-intl</p>
<h3 id="1-2-å¯¹æ¯”"><a href="#1-2-å¯¹æ¯”" class="headerlink" title="1.2 å¯¹æ¯”"></a>1.2 å¯¹æ¯”</h3><ol>
<li>æ‰“åŒ…æ—¶ç¿»è¯‘<br>ä¼˜ç‚¹ï¼šæ–¹æ¡ˆæ¯”è¾ƒæˆç†Ÿï¼Œå·²æœ‰æˆåŠŸæ¡ˆä¾‹ï¼ˆå¦‚å¾ˆå¤šèµ„è®¯ç½‘ç«™ã€åšå®¢ï¼Œå¦‚ mdn ï¼‰<br>ç¼ºç‚¹ï¼šç¿»è¯‘è¡¨ä¸€æ—¦æ›´æ–°ï¼Œéœ€è¦é‡æ–°æ‰“åŒ…å‘å¸ƒï¼Œæœ¬åœ°è¦ç»´æŠ¤å¤§é‡çš„ç¿»è¯‘è¡¨æ–‡ä»¶ï¼Œè¿‡äºç¹ç</li>
<li>åŠ¨æ€ç¿»è¯‘<br>ä¼˜ç‚¹ï¼šçµæ´»ï¼Œç¿»è¯‘è¡¨æ”¾è¿› cdn ä¸€å¥ sql å¯ä»¥æ›´æ–°ï¼Œå¯æ“ä½œæ€§å¼º<br>ç¼ºç‚¹ï¼šå…¼å®¹æ€§æœ‰å¾…è€ƒå¯Ÿï¼Œå¯¹äºä¸åŒçš„é¡¹ç›®ç»“æ„è¦è®¾ç½®ç‰¹æœ‰çš„é…ç½®</li>
<li>å¤šç‰ˆæœ¬<br>ä¼˜ç‚¹ï¼šäº§ç”Ÿçš„æ‰“åŒ…æ–‡ä»¶æœ€å°ï¼Œæ— éœ€é…ç½®<br>ç¼ºç‚¹ï¼šä¿®æ”¹è¿‡ç¨‹å¤æ‚ï¼Œåº”ç”¨åœºæ™¯ä¸å¹¿æ³›</li>
</ol>
<h2 id="äºŒã€å¤§æ¦‚çš„è®¾æƒ³"><a href="#äºŒã€å¤§æ¦‚çš„è®¾æƒ³" class="headerlink" title="äºŒã€å¤§æ¦‚çš„è®¾æƒ³"></a>äºŒã€å¤§æ¦‚çš„è®¾æƒ³</h2><h3 id="3-1-ç¿»è¯‘è¯­æ³•"><a href="#3-1-ç¿»è¯‘è¯­æ³•" class="headerlink" title="3.1 ç¿»è¯‘è¯­æ³•"></a>3.1 ç¿»è¯‘è¯­æ³•</h3><p>è¯­æ³•åˆ†ä¸ºæ‰¹é‡ç¿»è¯‘æˆ–æŒ‡å®šå•å¥ä¸ç¿»è¯‘<br>å…·ä½“é€šè¿‡<code>&lt;Provider/&gt;</code>ç±»ä»¥åŠå±æ€§ no-translate å®ç°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// æ‰¹é‡ç¿»è¯‘</div><div class="line">&lt;Provider value=&#123;&#123;</div><div class="line">    languageMap, // è¯­è¨€åŒ…</div><div class="line">    language, // è¯­è¨€ç±»å‹</div><div class="line">&#125;&#125;&gt;</div><div class="line">    ... (è¦ç¿»è¯‘çš„ä»£ç å—)</div><div class="line">&lt;/Provider&gt;</div><div class="line">// æŒ‡å®šä¸ç¿»è¯‘</div><div class="line">&lt;div no-translate&gt;...(ä¸ç¿»è¯‘çš„å­—ç¬¦ä¸²)&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<h3 id="3-2-æ–¹ä¾¿è·å–åœ¨çº¿çš„è¯­è¨€åŒ…"><a href="#3-2-æ–¹ä¾¿è·å–åœ¨çº¿çš„è¯­è¨€åŒ…" class="headerlink" title="3.2 æ–¹ä¾¿è·å–åœ¨çº¿çš„è¯­è¨€åŒ…"></a>3.2 æ–¹ä¾¿è·å–åœ¨çº¿çš„è¯­è¨€åŒ…</h3><p>å¯ä»¥é€šè¿‡è¯·æ±‚è·å¾—åœ¨çº¿è¯­è¨€åŒ…ï¼Œåœ¨ä¸‹è½½å®Œæˆåè¿›è¡Œæ›´æ–°</p>
<h2 id="ä¸‰ã€æ ¸å¿ƒæ€è·¯"><a href="#ä¸‰ã€æ ¸å¿ƒæ€è·¯" class="headerlink" title="ä¸‰ã€æ ¸å¿ƒæ€è·¯"></a>ä¸‰ã€æ ¸å¿ƒæ€è·¯</h2><p>å®ç°å¤šè¯­è¨€é€šä¿—æ¥è¯´å°±æ˜¯ï¼š</p>
<ol>
<li>å…ˆæ‰¾åˆ°è¦ç¿»è¯‘çš„æ–‡å­—</li>
<li>è¯·æ±‚åœ¨çº¿è¯­è¨€åŒ…</li>
<li>å†å¯¹è¦ç¿»è¯‘çš„æ–‡å­—è¿›è¡Œç¿»è¯‘</li>
</ol>
<p>åŸºäºä»¥ä¸ŠåŸºæœ¬æ€è·¯å†æ€è€ƒï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ JSX æ˜¯ react çš„è¯­æ³•ç³–ï¼Œè€Œä½¿ç”¨é«˜é˜¶å‡½æ•°<code>React.createElement</code>å¯ä»¥é‡æ–°å®šä¹‰ç»„ä»¶çš„æ¸²æŸ“ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¦ç¿»è¯‘çš„æ–‡å­—åœ¨è¯¥æ–¹æ³•ä¸­å¤„ç†å³å¯ã€‚</p>
<p>ä»¥ä¸‹ä¸¤ç§å†™æ³•ç» babel è½¬ä¹‰ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class Hello extends React.Component &#123;</div><div class="line">  render() &#123;</div><div class="line">    return React.createElement(&apos;div&apos;, null, `Hello $&#123;this.props.toWhat&#125;`);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  React.createElement(Hello, &#123;toWhat: &apos;World&apos;&#125;, null),</div><div class="line">  document.getElementById(&apos;root&apos;)</div><div class="line">);</div></pre></td></tr></table></figure>
<ul>
<li>åŸºäºè¿™ä¸ªæƒ³æ³•ï¼Œé€šè¿‡è®¾ç½® no-translate å±æ€§ï¼Œ<code>&lt;Provider/&gt;</code>ï¼Œå¹¶åœ¨<code>createElement</code>ä¸­åˆ¤æ–­ï¼Œå°±çŸ¥é“å“ªé‡Œçš„æ–‡å­—éœ€è¦ç¿»è¯‘ï¼Œä¹ŸçŸ¥é“è¦ç¿»è¯‘æˆå“ªç§è¯­è¨€äº†ï¼ˆç¬¬ä¸€æ­¥ï¼‰ï¼</li>
<li>(ç¬¬äºŒæ­¥æ¯”è¾ƒç®€å•ï¼Œæš‚æ—¶å¿½ç•¥â€¦)</li>
<li>å†å®šä¹‰ä¸€ä¸ª<code>translate</code>å‡½æ•°ï¼Œæ¥å—æ–‡å­—ï¼Œè¯­è¨€åŒ…å’Œç¿»è¯‘è¡¨ï¼Œè¿”å›ç¿»è¯‘åçš„æ–‡å­—ï¼ˆç¬¬ä¸‰æ­¥ï¼‰</li>
</ul>
<p>ä¸‹é¢çš„æµç¨‹å›¾å±•ç¤ºäº†æ•´ä½“çš„æ€è·¯ï¼š</p>
<p><img src="http://vfile.meituan.net/xgfe/2f1f2dac01553645441f63da880b712937156.png" alt=""></p>
<h2 id="å››ã€å®ç°"><a href="#å››ã€å®ç°" class="headerlink" title="å››ã€å®ç°"></a>å››ã€å®ç°</h2><p>æ¯•ç«Ÿæ˜¯è¦åšä¸€ä¸ªå·¥å…·åº“ï¼Œé¦–å…ˆæ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œåœ¨ core æ–‡ä»¶ç›®å½•ä¸‹åˆ›å»ºå…·ä½“æ–‡ä»¶</p>
<h3 id="4-1-å®šä¹‰ä¸€ä¸ª-languageMap"><a href="#4-1-å®šä¹‰ä¸€ä¸ª-languageMap" class="headerlink" title="4.1 å®šä¹‰ä¸€ä¸ª languageMap"></a>4.1 å®šä¹‰ä¸€ä¸ª languageMap</h3><p> languageMap ä¸€å®šå¾—æ˜¯å•ä¾‹æ¨¡å¼ï¼Œæ–¹ä¾¿å…¨å±€è°ƒç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// file: ./core/languageMap.js</div><div class="line">const translateMap = &#123;&#125;;</div><div class="line">export default translateMap;</div></pre></td></tr></table></figure></p>
<h3 id="4-2-å†å†™ä¸€ä¸ªtranslateå‡½æ•°"><a href="#4-2-å†å†™ä¸€ä¸ªtranslateå‡½æ•°" class="headerlink" title="4.2 å†å†™ä¸€ä¸ªtranslateå‡½æ•°"></a>4.2 å†å†™ä¸€ä¸ªtranslateå‡½æ•°</h3><p>ä»»ä½•éœ€è¦ç¿»è¯‘çš„åœ°æ–¹ï¼Œéƒ½å°†ä¼šä½¿ç”¨è¿™ä¸ª<code>translate</code>å‡½æ•°ï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>contentï¼šè¦ç¿»è¯‘çš„æ–‡å­—</li>
<li>languageMapï¼šè¯­è¨€åŒ…</li>
<li>languageï¼šè¯­è¨€ç±»å‹</li>
</ul>
<p>è®¾ç½® middleware ä½œä¸ºä¸­é—´ä»¶ï¼Œå¯ä»¥æ“ä½œç¿»è¯‘å‰åçš„å­—æ®µï¼Œå¯ä»¥è§£å†³ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼Œæˆ–è€…å®ç°ä¸€äº›å½©è›‹çš„æ•ˆæœâ€¦</p>
<p>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// file: ./core/translate.js</div><div class="line">const middleware = &#123;</div><div class="line">  merge: function(obj) &#123;</div><div class="line">    Object.keys(obj).forEach(function(key) &#123;</div><div class="line">      if (key !== &quot;merge&quot;) &#123;</div><div class="line">        middleware[key] = obj[key];</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">const translate = (content, languageMap, language) =&gt; &#123;</div><div class="line">  if (!content) &#123;</div><div class="line">    return &quot;&quot;;</div><div class="line">  &#125;</div><div class="line">  if (!language) &#123;</div><div class="line">    throw new Error(&quot;you should define specific language type!&quot;);</div><div class="line">  &#125;</div><div class="line">  // beforeRender middleware</div><div class="line">  if (middleware.beforeRender) content = middleware.beforeRender(content);</div><div class="line">  // translate words</div><div class="line">  if (language &amp;&amp; languageMap &amp;&amp; languageMap[language]) &#123;</div><div class="line">    languageMap[language][content] &amp;&amp;</div><div class="line">      (content = languageMap[language][content]);</div><div class="line">  &#125;</div><div class="line">  // afterRender middleware</div><div class="line">  if (middleware.afterRender) content = middleware.afterRender(content);</div><div class="line">  return content;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="4-3-å†åˆ›å»º-translateClass"><a href="#4-3-å†åˆ›å»º-translateClass" class="headerlink" title="4.3 å†åˆ›å»º translateClass"></a>4.3 å†åˆ›å»º translateClass</h3><p>ä¸ºäº†ä½¿ç”¨Context APIï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©ç±»æ¥æ¥å—<code>&lt;Provider/&gt;</code>ä¼ è¿‡æ¥çš„ languageMap å’Œ language ç­‰å­—æ®µ</p>
<p>å…ˆåˆ›å»ºä¸€ä¸ª./core/context.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export const &#123; Provider, Consumer &#125; = React.createContext();</div></pre></td></tr></table></figure></p>
<p>åœ¨åˆ›å»ºä¸€ä¸ª./core/translateClass<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// file: ./core/translateClass.jsx</div><div class="line">import React from &quot;react&quot;;</div><div class="line">import &#123; translate &#125; from &quot;./translate&quot;;</div><div class="line">import &#123; Consumer &#125; from &quot;./context&quot;;</div><div class="line"></div><div class="line">class Translate extends React.Component &#123;</div><div class="line">  render() &#123;</div><div class="line">    const noTranslate = this.props[&quot;no-translate&quot;];</div><div class="line">    return (</div><div class="line">      &lt;Consumer&gt;</div><div class="line">        &#123;context =&gt;</div><div class="line">          noTranslate</div><div class="line">            ? this.props.children</div><div class="line">            : translate(</div><div class="line">                this.props.children,</div><div class="line">                context.languageMap,</div><div class="line">                context.language</div><div class="line">              )</div><div class="line">        &#125;</div><div class="line">      &lt;/Consumer&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default Translate;</div></pre></td></tr></table></figure></p>
<h3 id="4-4-æ”¹å†™-createElement"><a href="#4-4-æ”¹å†™-createElement" class="headerlink" title="4.4 æ”¹å†™ createElement"></a>4.4 æ”¹å†™ createElement</h3><p>æœ‰äº†ä¹‹å‰çš„é“ºå«ï¼Œå¯ä»¥å¾ˆå¿«çš„å®ç°æˆ‘ä»¬è‡ªå·±çš„<code>createElement</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// file: ./core/translateTag.jsx</div><div class="line">import React, &#123; Component &#125; from &quot;react&quot;;</div><div class="line">import Translate from &quot;./translateClass&quot;;</div><div class="line"></div><div class="line">const createElement = React.createElement;</div><div class="line"></div><div class="line">React.createElement = (...args) =&gt; &#123;</div><div class="line">  let children = args.slice(2);</div><div class="line"></div><div class="line">  // â‘  console.log(args)</div><div class="line">  children = children.map(child =&gt; &#123;</div><div class="line">    if (typeof args[0] === &quot;string&quot; &amp;&amp; typeof child === &quot;string&quot;) &#123;</div><div class="line">      if (args[1] &amp;&amp; args[1][&quot;no-translate&quot;]) &#123;</div><div class="line">        return &lt;Translate no-translate&gt;&#123;child&#125;&lt;/Translate&gt;;</div><div class="line">      &#125; else &#123;</div><div class="line">        return &lt;Translate&gt;&#123;child&#125;&lt;/Translate&gt;;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    return child;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  return createElement(args[0], args[1], ...children);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>åœ¨æ ‡å¿—â‘ å¤„æ‰“å° args å¯ä»¥çœ‹åˆ° ReactDom çš„ç»“æ„ï¼Œå®ƒåŒ…å«äº†$$typeof,props,ref,childrenç­‰å±æ€§ï¼Œ $$typeof ä»£è¡¨ç»„ä»¶ç±»å‹ï¼Œ props æ˜¯å±æ€§ï¼Œ children æ˜¯å­èŠ‚ç‚¹çš„è‹¥å¹²å…ƒç´ ï¼Œå°†å…¶ children è·å–åˆ°ï¼Œè¿›è¡Œå¦‚ä¸‹åˆ¤æ–­ï¼š</p>
<ol>
<li>å¦‚æœç±»å‹æ˜¯ Object å°±ä¸åšä»»ä½•æ“ä½œ</li>
<li>å¦‚æœ child ç±»å‹æ˜¯å­—ç¬¦ä¸²å°±è¿›è¡Œç¿»è¯‘</li>
<li>å¦‚å¸¦æœ‰ no-translate å±æ€§å°†ä¸å¯¹å…¶è¿›è¡Œç¿»è¯‘</li>
</ol>
<p>é€šè¿‡æ”¹å˜<code>&lt;Provider/&gt;</code>çš„ä½ç½®ï¼Œå¯ä»¥è®¾ç½®ä¸åŒåŒºå—çš„ context ï¼Œè¿™æ ·å¯ä»¥æ”¹å˜ä¸åŒåŒºå—çš„ç¿»è¯‘è¡¨å’Œè¯­è¨€ç±»å‹</p>
<p>åˆ°è¿™é‡Œï¼Œ translate å·¥å…·ç±»åŸºæœ¬å®Œæˆ</p>
<h2 id="äº”ã€è¿›è¡Œæµ‹è¯•"><a href="#äº”ã€è¿›è¡Œæµ‹è¯•" class="headerlink" title="äº”ã€è¿›è¡Œæµ‹è¯•"></a>äº”ã€è¿›è¡Œæµ‹è¯•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from &quot;react&quot;;</div><div class="line">import ReactDom from &quot;react-dom&quot;;</div><div class="line">import languageMap from &quot;./core/languageMap&quot;;</div><div class="line">import &#123; translate, middleware &#125; from &quot;./core/translate&quot;;</div><div class="line">import &#123; Provider &#125; from &quot;./core/context&quot;;</div><div class="line">// å…¨å±€æ›´æ–°createElement</div><div class="line">import &quot;./core/translateTag.jsx&quot;;</div><div class="line"></div><div class="line">const styles = &#123;</div><div class="line">  fontFamily: &quot;sans-serif&quot;,</div><div class="line">  textAlign: &quot;center&quot;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">class App extends Component &#123;</div><div class="line">  constructor(...args) &#123;</div><div class="line">    super(...args);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  componentWillMount() &#123;</div><div class="line">    this.fetchTranslateList();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  fetchTranslateList() &#123;</div><div class="line">    languageMap[&quot;en&quot;] = &#123;</div><div class="line">      ä½ å¥½: &quot;Hello&quot;,</div><div class="line">      å›½é™…åŒ–: &quot;intl&quot;</div><div class="line">    &#125;;</div><div class="line">    languageMap[&quot;france&quot;] = &#123;</div><div class="line">      ä½ å¥½: &quot;Bonjour&quot;,</div><div class="line">      å›½é™…åŒ–: &quot;intl&quot;</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    const enConfig = &#123; language: &quot;en&quot;, languageMap &#125;;</div><div class="line">    const franceConfig = &#123; language: &quot;france&quot;, languageMap &#125;;</div><div class="line">    return (</div><div class="line">      &lt;div style=&#123;styles&#125;&gt;</div><div class="line">        &lt;Provider value=&#123;enConfig&#125;&gt;</div><div class="line">          &lt;div&gt;</div><div class="line">            &lt;h1&gt;ä½ å¥½&lt;/h1&gt;</div><div class="line">            &lt;span&gt;</div><div class="line">              ä½ å¥½</div><div class="line">              &lt;Provider value=&#123;franceConfig&#125;&gt;</div><div class="line">                &lt;h1 no-translate&gt;</div><div class="line">                  ä½ å¥½</div><div class="line">                  &lt;div&gt;å›½é™…åŒ–&lt;/div&gt;</div><div class="line">                &lt;/h1&gt;</div><div class="line">                &lt;span&gt;å›½é™…åŒ–&lt;/span&gt;</div><div class="line">              &lt;/Provider&gt;</div><div class="line">            &lt;/span&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">        &lt;/Provider&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ReactDom.render(</div><div class="line">  &lt;App /&gt;,</div><div class="line">  document.body.appendChild(document.createElement(&quot;div&quot;))</div><div class="line">);</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œåˆ†åˆ«å°†ä¸­æ–‡ç¿»è¯‘æˆäº†è‹±æ–‡å’Œæ³•æ–‡ï¼Œæœ€ç»ˆè¿è¡Œæ­£å¸¸ï¼</p>
<h2 id="å…­ã€å…¼å®¹æ€§"><a href="#å…­ã€å…¼å®¹æ€§" class="headerlink" title="å…­ã€å…¼å®¹æ€§"></a>å…­ã€å…¼å®¹æ€§</h2><p>å†™è¿™ä¸ªå·¥å…·çš„åˆè¡·å½“ç„¶æ˜¯æ— ç¼å…¼å®¹å„ç§ react é¡¹ç›®ï¼Œä½†äº‹å®ä¸Šå¹¶ä¸ç®€å•<br>ä¸¾ä¾‹æ¥è¯´ï¼Œç›®å‰å‡ºç°çš„å¾ˆå¤šçš„å‰ç«¯ç»„ä»¶åº“ä¸è¿™ä¸ªå·¥å…·æœ‰å¾ˆå¤šå…¼å®¹æ€§å†²çªï¼Œè¿™äº›åº“ä¸»è¦æœ‰ï¼š</p>
<ol>
<li>ant-design/ant-mobileï¼ˆèš‚èšé‡‘æœå›¢é˜Ÿçš„å‰ç«¯UIç»„ä»¶åº“ï¼Œé“¾æ¥ï¼š<a href="https://ant.design/index-cnï¼‰" target="_blank" rel="external">https://ant.design/index-cnï¼‰</a></li>
<li>element-reactï¼ˆé¥¿äº†ä¹ˆå›¢é˜Ÿçš„å‰ç«¯UIç»„ä»¶åº“reactç‰ˆæœ¬ï¼Œé“¾æ¥ï¼š<a href="https://eleme.github.io/element-react/ï¼‰" target="_blank" rel="external">https://eleme.github.io/element-react/ï¼‰</a></li>
</ol>
<p>å®é™…æ“ä½œä¸­å‘ç°äº†ä¸å…¼å®¹çš„é—®é¢˜å¾ˆå¤šï¼Œæƒ³å¿…è¦åšåˆ°å¼€ç®±å³ç”¨æ˜¯ä¸å¯èƒ½äº†~~~<br>å¯„å¸Œæœ›äºæ— ç¼å…¼å®¹ï¼Œä¸å¦‚æä¾›ä¸­é—´ä»¶æ¥å£æ¥è®©ä½¿ç”¨è€…è‡ªè¡Œé…ç½® o(â•¥ï¹â•¥)o</p>
<h3 id="6-1-ant-design"><a href="#6-1-ant-design" class="headerlink" title="6.1 ant-design"></a>6.1 ant-design</h3><p>ä¾‹å¦‚ï¼Œåœ¨ ant-design ç»„ä»¶åº“ä¸­ï¼Œ<code>&lt;input/&gt;</code>çš„ placeholder å±æ€§ï¼Œå¦‚ä¸è¿›è¡Œæ£€æµ‹ï¼Œå°†ä¸ä¼šè¢«ç¿»è¯‘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">import &#123;filter&#125; from &apos;./core/translate.js&apos;;</div><div class="line"></div><div class="line">filter.forAntDesign = (props,language) =&gt; &#123;</div><div class="line">    let props = Object.assign(&#123;&#125;, props);</div><div class="line">            if (language &amp;&amp; props.placeholder) &#123;</div><div class="line">                if (languageMap[language]) &#123;</div><div class="line">                    if (/[^\u4e00-\u9fa5]/g.test(props.placeholder)) &#123;</div><div class="line">                        props.placeholder = props.placeholder.replace(/([\u4e00-\u9fa5]+)/g, (match) =&gt; &#123;</div><div class="line">                            return languageMap[language][match] ? languageMap[language][match] : match</div><div class="line">                        &#125;)</div><div class="line">                    &#125; else &#123;</div><div class="line">                        languageMap[language][props.placeholder] &amp;&amp; (props.placeholder = languageMap[language][props.placeholder]);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            return &lt;input</div><div class="line">                &#123;...props&#125;</div><div class="line">                ref=&quot;input&quot;</div><div class="line">                onInput=&#123;e =&gt; &#123;this.value = e.target.value; this.props.onInput &amp;&amp; this.props.onInput(e);&#125;&#125;&gt;</div><div class="line">                &#123;this.props.children&#125;</div><div class="line">            &lt;/input&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é€šè¿‡å¦‚ä¸Šå¯¹ placeholder çš„è¿‡æ»¤æ“ä½œï¼Œå¯ä»¥å®ç° ant-design è¾“å…¥æ¡†çš„å¤šè¯­è¨€ç¿»è¯‘ã€‚<br>å†å¦‚ï¼Œ<code>&lt;Select/&gt;</code>ç»„ä»¶ï¼Œå®ƒçº¦å®šå…ƒç´  option çš„å±æ€§ value å¼ºç­‰äºå†…å®¹ children æ—¶æ‰è®¤ä¸ºå½“å‰é€‰é¡¹æ˜¯è¢«é€‰ä¸­ï¼Œè§£å†³åŠæ³•è¿™é‡Œä¸å†èµ˜è¿°ï¼Œå®ƒä»¬éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸­é—´ä»¶ï¼Œä¿®æ”¹<code>props.children</code>çš„è¿‡æ»¤æœºåˆ¶è¿›è€Œè§£å†³ï¼</p>
<h3 id="6-2-å…¶ä»–reactç»„ä»¶åº“"><a href="#6-2-å…¶ä»–reactç»„ä»¶åº“" class="headerlink" title="6.2 å…¶ä»–reactç»„ä»¶åº“"></a>6.2 å…¶ä»–reactç»„ä»¶åº“</h3><p>ä¹Ÿæœ‰ä¸€äº›æ¡†æ¶æˆ–è€…è‡ªè¡Œç¼–å†™çš„ç»„ä»¶ï¼Œå¦‚ element-react ï¼Œä¸€äº› dom æ–‡å­—å¹¶ä¸ä¼šæ”¾åœ¨ text ä¸­ï¼Œæ›´ç¡®åˆ‡åœ°è¯´å…¶ç»„ä»¶å†…éƒ¨è¿›è¡Œäº†é‡æ„ï¼Œå¹¶ä¸ä¼šå°†æ–‡å­—ç®€å•çš„å‘å¤–å±•ç¤ºï¼Œè¿™å°±éœ€è¦é¢å¤–çš„ç¼–å†™ç‰¹æ®Šçš„ filter äº†</p>
<h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ React å›½é™…åŒ–å·¥å…·å·²ç»å®ç°äº†ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„åœ¨çº¿ demo</p>
<iframe src="https://codesandbox.io/embed/64zx97v9qr" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

<ul>
<li>å®Œæ•´ä»£ç å‚è€ƒ github: <a href="https://github.com/ranrantu/react-i18" target="_blank" rel="external">https://github.com/ranrantu/react-i18</a></li>
</ul>
<p>æ€»ä¹‹ï¼Œè¿™å¯ä»¥è¯´æ˜¯ React åŠ¨æ€ç¿»è¯‘çš„ä¸€ç§æ€è·¯ï¼Œè¿™ç§å®ç°è‡³ä»Šè¿˜æ˜¯æœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œè¿˜è¯·å„ä½æ‹ç –æŒ‡æ­£ï¼Œæ„Ÿè°¢ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt; React æœ€æ—©ç”± Facebook çš„è½¯ä»¶å·¥ç¨‹å¸ˆ Jordan Walke åˆ›å»ºï¼Œå®ƒåœ¨ 2011 å¹´é¦–æ¬¡éƒ¨ç½²åœ¨ Facebook çš„æ–°é—»æºä¸­ï¼Œç”±äºå…¶æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ï¼Œå¾ˆå¿«è·å¾—äº†å¹¿æ³›å…³æ³¨å’Œå¤§è§„æ¨¡çš„ä½¿ç”¨ï¼Œå¦‚ä»Šå‘å±•å·²ç»éå¸¸æˆç†Ÿã€‚&lt;br&gt;åŸºäº React çš„æ¸²æŸ“åŸç†å¯ä»¥å®ç°å¾ˆå¤šæœ‰æ„æ€çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å®ç°ä¸€ä¸ª React çš„å›½é™…åŒ–å·¥å…·ã€‚(React v16.3)&lt;/p&gt;
    
    </summary>
    
      <category term="jiangxiang" scheme="http://xgfe.github.io/categories/jiangxiang/"/>
    
    
      <category term="React" scheme="http://xgfe.github.io/tags/React/"/>
    
      <category term="å›½é™…åŒ–" scheme="http://xgfe.github.io/tags/%E5%9B%BD%E9%99%85%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>webå‰ç«¯æ€§èƒ½ä¼˜åŒ–</title>
    <link href="http://xgfe.github.io/2018/04/15/zhangjianfeng/web%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    <id>http://xgfe.github.io/2018/04/15/zhangjianfeng/webå‰ç«¯æ€§èƒ½ä¼˜åŒ–/</id>
    <published>2018-04-15T07:00:00.000Z</published>
    <updated>2018-04-25T07:45:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æ„å»ºwebç«™ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç»†èŠ‚éƒ½æœ‰å¯èƒ½å½±å“ç½‘ç«™çš„è®¿é—®é€Ÿåº¦ï¼Œå¦‚æœä¸äº†è§£æ€§èƒ½ä¼˜åŒ–çŸ¥è¯†ï¼Œå¾ˆå¤šä¸åˆ©ç½‘ç«™è®¿é—®é€Ÿåº¦çš„å› ç´ ä¼šå½¢æˆç´¯åŠ ï¼Œä»è€Œä¸¥é‡å½±å“ç½‘ç«™çš„æ€§èƒ½ï¼Œå¯¼è‡´ç½‘ç«™è®¿é—®é€Ÿåº¦å˜æ…¢ï¼Œç”¨æˆ·ä½“éªŒä½ä¸‹ï¼Œæœ€ç»ˆå¯¼è‡´ç”¨æˆ·æµå¤±ã€‚æœ¬æ–‡ä¸»è¦å›´ç»•ä»¥ä¸‹å‡ ç‚¹è®²è§£ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯è¯·æ±‚</li>
<li>å®¢æˆ·ç«¯æ¸²æŸ“</li>
<li>æœåŠ¡ç«¯å“åº”</li>
<li>ç½‘ç»œ<a id="more"></a>
</li>
</ol>
<h2 id="å®¢æˆ·ç«¯è¯·æ±‚"><a href="#å®¢æˆ·ç«¯è¯·æ±‚" class="headerlink" title="å®¢æˆ·ç«¯è¯·æ±‚"></a>å®¢æˆ·ç«¯è¯·æ±‚</h2><p>æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯æœ‰æˆæœ¬çš„ï¼Œæ—¢åŒ…å«æ—¶é—´æˆæœ¬ä¹ŸåŒ…å«èµ„æºæˆæœ¬ã€‚ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚éƒ½éœ€è¦ç»è¿‡ DNSå¯»å€ã€ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€å‘é€æ•°æ®ã€ç­‰å¾…æœåŠ¡å™¨å“åº”ã€æ¥æ”¶æ•°æ®è¿™æ ·ä¸€ä¸ª â€œæ¼«é•¿â€ è€Œå¤æ‚çš„è¿‡ç¨‹ã€‚æ—¶é—´æˆæœ¬å°±æ˜¯ç”¨æˆ·éœ€è¦çœ‹åˆ°æˆ–è€… â€œæ„Ÿå—â€ åˆ°è¿™ä¸ªèµ„æºæ˜¯å¿…é¡»è¦ç­‰å¾…è¿™ä¸ªè¿‡ç¨‹ç»“æŸçš„ï¼Œèµ„æºä¸Šç”±äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦æºå¸¦æ•°æ®ï¼Œå› æ­¤æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦å ç”¨å¸¦å®½ã€‚å¦å¤–ï¼Œç”±äºæµè§ˆå™¨è¿›è¡Œå¹¶å‘è¯·æ±‚çš„è¯·æ±‚æ•°æ˜¯æœ‰ä¸Šé™çš„ï¼Œå› æ­¤è¯·æ±‚æ•°å¤šäº†ä»¥åï¼Œæµè§ˆå™¨éœ€è¦åˆ†æ‰¹è¿›è¡Œè¯·æ±‚ï¼Œå› æ­¤ä¼šå¢åŠ ç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ï¼Œä¼šç»™ç”¨æˆ·é€ æˆç«™ç‚¹é€Ÿåº¦æ…¢è¿™æ ·ä¸€ä¸ªå°è±¡ã€‚</p>
<h3 id="èµ„æºå‹ç¼©ä¸åˆå¹¶"><a href="#èµ„æºå‹ç¼©ä¸åˆå¹¶" class="headerlink" title="èµ„æºå‹ç¼©ä¸åˆå¹¶"></a>èµ„æºå‹ç¼©ä¸åˆå¹¶</h3><p>å‹ç¼©å¯ä»¥å‡å°‘èµ„æºçš„ä½“ç§¯ï¼Œä»è€Œå¢åŠ åŠ è½½é€Ÿåº¦ã€‚å°†èµ„æºæ–‡ä»¶åˆå¹¶ï¼Œå‡å°‘èµ„æºçš„è¯·æ±‚æ•°ã€‚ä½†å¹¶ä¸æ„å‘³ç€ï¼Œä¸€ä¸ªèµ„æºè¶Šå¤§è¶Šå¥½ï¼Œèµ„æºå¤ªå¤§ï¼Œä¼šå½±å“èµ„æºåŠ è½½é€Ÿåº¦ã€‚é’ˆå¯¹è¿™ä¸€é—®é¢˜ï¼Œåˆ©ç”¨webpackæ¨¡å—åŒ–æ‰“åŒ…å·¥å…·åˆ†å—æ‰“åŒ…ã€æŒ‰éœ€åŠ è½½ä»¥åŠæå–å…¬å…±éƒ¨åˆ†ä»£ç ï¼Œåˆ©ç”¨ç¼“å­˜å¯ä»¥å¾—åˆ°è§£å†³ã€‚å…·ä½“å¯å‚è€ƒ<a href="http://mp.weixin.qq.com/s/BVYgLeOEIJp5xY55Rcrszg" target="_blank" rel="external">webpackçš„ä½¿ç”¨</a>ã€‚</p>
<h3 id="DNSé¢„è§£æ"><a href="#DNSé¢„è§£æ" class="headerlink" title="DNSé¢„è§£æ"></a>DNSé¢„è§£æ</h3><p>ä»ç”¨æˆ·è¾“å…¥ä¸€ä¸ªç½‘å€åˆ°ç½‘é¡µæœ€ç»ˆå±•ç°åˆ°ç”¨æˆ·é¢å‰ï¼Œä¸­é—´çš„å¤§è‡´å‘ç”Ÿä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼š</p>
<ol>
<li>å‘é€åˆ°DNSï¼ˆåŸŸåæœåŠ¡å™¨ï¼‰è·å¾—åŸŸåå¯¹åº”çš„WEBæœåŠ¡å™¨çš„IPåœ°å€ã€‚</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨ä¸WEBæœåŠ¡å™¨å»ºç«‹TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰è¿æ¥ã€‚</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨å‘å¯¹åº”IPåœ°å€çš„WEBæœåŠ¡å™¨å‘é€ç›¸åº”çš„HTTPæˆ–HTTPSè¯·æ±‚ã€‚</li>
<li>WEBæœåŠ¡å™¨å“åº”è¯·æ±‚ï¼Œè¿”å›æŒ‡å®šçš„URLæ•°æ®æˆ–é”™è¯¯ä¿¡æ¯ï¼›å¦‚æœè®¾å®šé‡å®šå‘ï¼Œåˆ™é‡å®šå‘åˆ°æ–°çš„URLåœ°å€ã€‚</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨ä¸‹è½½æ•°æ®ï¼Œè§£æHTMLæºæ–‡ä»¶ï¼Œè§£æçš„è¿‡ç¨‹ä¸­å®ç°å¯¹é¡µé¢çš„æ’ç‰ˆï¼Œè§£æå®Œæˆåï¼Œåœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºåŸºç¡€çš„é¡µé¢ã€‚</li>
<li>åˆ†æé¡µé¢ä¸­çš„è¶…é“¾æ¥ï¼Œæ˜¾ç¤ºåœ¨å½“å‰é¡µé¢ï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ç›´è‡³æ²¡æœ‰è¶…é“¾æ¥éœ€è¦å‘é€ï¼Œå®Œæˆé¡µé¢çš„å…¨éƒ¨æ˜¾ç¤ºã€‚<br>DNSè§£ææ—¶é—´å¯èƒ½å¯¼è‡´å¤§é‡ç”¨æˆ·æ„ŸçŸ¥å»¶è¿Ÿï¼ŒDNSè§£ææ‰€éœ€çš„æ—¶é—´å·®å¼‚éå¸¸å¤§ï¼Œå»¶è¿ŸèŒƒå›´å¯ä»¥ä»1msï¼ˆæœ¬åœ°ç¼“å­˜ç»“æœï¼‰åˆ°æ™®éçš„å‡ ç§’é’Ÿæ—¶é—´ã€‚æ‰€ä»¥åˆ©ç”¨DNSé¢„è§£ææ˜¯æœ‰æ„ä¹‰çš„ã€‚<br>å…·ä½“å®ç°æ–¹å¼ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;link rel=<span class="string">"dns-prefetch"</span> href=<span class="string">"hostname"</span> /&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="é¢„åŠ è½½"><a href="#é¢„åŠ è½½" class="headerlink" title="é¢„åŠ è½½"></a>é¢„åŠ è½½</h3><p>é¢„åŠ è½½æ˜¯ä¸€ç§æµè§ˆå™¨æœºåˆ¶ï¼Œä½¿ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´æ¥é¢„å…ˆä¸‹è½½/åŠ è½½ç”¨æˆ·æ¥ä¸‹æ¥å¾ˆå¯èƒ½ä¼šæµè§ˆçš„é¡µé¢/èµ„æºã€‚é¡µé¢æä¾›ç»™æµè§ˆå™¨éœ€è¦é¢„åŠ è½½çš„é›†åˆã€‚æµè§ˆå™¨è½½å…¥å½“å‰é¡µé¢å®Œæˆåï¼Œå°†ä¼šåœ¨åå°ä¸‹è½½éœ€è¦é¢„åŠ è½½çš„é¡µé¢å¹¶æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚å½“ç”¨æˆ·è®¿é—®æŸä¸ªé¢„åŠ è½½çš„é“¾æ¥æ—¶ï¼Œå¦‚æœä»ç¼“å­˜å‘½ä¸­ï¼Œé¡µé¢å°±å¾—ä»¥å¿«é€Ÿå‘ˆç°ã€‚ å®ç°æ–¹å¼ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// é¡µé¢ï¼Œå¯ä»¥ä½¿ç”¨ç»å¯¹æˆ–è€…ç›¸å¯¹è·¯å¾„</span></div><div class="line">&lt;link rel=<span class="string">"prefetch"</span> href=<span class="string">"page2.html"</span> /&gt; </div><div class="line"><span class="comment">// å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„æ–‡ä»¶</span></div><div class="line">&lt;link rel=<span class="string">"prefetch"</span> href=<span class="string">"sprite.png"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>ä»ä¸Šé¢çš„HTMLä»£ç å¯ä»¥çœ‹å‡ºï¼Œé¢„åŠ è½½ä½¿ç”¨ <link> æ ‡ç­¾ï¼Œå¹¶æŒ‡å®š rel=â€prefetchâ€ å±æ€§ï¼Œè€Œhrefå±æ€§å°±æ˜¯éœ€è¦é¢„åŠ è½½çš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<h3 id="æ‡’åŠ è½½"><a href="#æ‡’åŠ è½½" class="headerlink" title="æ‡’åŠ è½½"></a>æ‡’åŠ è½½</h3><p>ä¸€ä¸ªé¡µé¢æœ‰å¾ˆå¤šå›¾ç‰‡ï¼Œè€Œé¦–å±å‡ºç°çš„å›¾ç‰‡å¤§æ¦‚å°±ä¸€ä¸¤å¼ ï¼Œå¦‚æœä¸€æ¬¡æ€§æŠŠæ‰€æœ‰å›¾ç‰‡éƒ½åŠ è½½å‡ºæ¥ï¼Œä¸ä»…å½±å“é¡µé¢æ¸²æŸ“é€Ÿåº¦ï¼Œè¿˜æµªè´¹å¸¦å®½ã€‚è¿™ä¹Ÿå°±æ˜¯ä»¬é€šå¸¸æ‰€è¯´çš„é¦–å±åŠ è½½ï¼Œå…¶ä¸­è¦ç”¨çš„æŠ€æœ¯å°±æ˜¯å›¾ç‰‡æ‡’åŠ è½½â€“åˆ°å¯è§†åŒºåŸŸå†åŠ è½½ã€‚ç®€å•å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">lazyload</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// è·å–æ‰€æœ‰è¦è¿›è¡Œæ‡’åŠ è½½çš„å›¾ç‰‡</span></div><div class="line">    <span class="keyword">var</span> eles = <span class="built_in">document</span>.querySelectorAll(<span class="string">'img[data-original][lazyload]'</span>);</div><div class="line">    <span class="keyword">var</span> viewHeight = <span class="built_in">window</span>.innerHeight;</div><div class="line">    eles.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item, index</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> rect;</div><div class="line">        <span class="keyword">if</span> (item.dataset.original === <span class="string">''</span>) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        rect = item.getBoundingClientRect();</div><div class="line">        <span class="comment">// å›¾ç‰‡ä¸€è¿›å…¥å¯è§†åŒºï¼ŒåŠ¨æ€åŠ è½½</span></div><div class="line">        <span class="keyword">if</span> (rect.bottom &gt;= <span class="number">0</span> &amp;&amp; rect.top &lt; viewHeight) &#123;</div><div class="line">            item.src = item.dataset.original;</div><div class="line">            item.removeAttribute(<span class="string">'data-original'</span>);</div><div class="line">            item.removeAttribute(<span class="string">'lazyload'</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="CSS-Sprites"><a href="#CSS-Sprites" class="headerlink" title="CSS Sprites"></a>CSS Sprites</h3><p>åˆå¹¶ CSSå›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å°†å¤šä¸ªå›¾ç‰‡æˆ–è€…iconæ”¾åœ¨ä¸€å¼ å›¾ç‰‡ä¸­ï¼Œåˆ©ç”¨cssçš„background-positionå±æ€§æ§åˆ¶æ¯ä¸ªå›¾ç‰‡æˆ–iconçš„ä½ç½®ã€‚</p>
<h2 id="å®¢æˆ·ç«¯æ¸²æŸ“"><a href="#å®¢æˆ·ç«¯æ¸²æŸ“" class="headerlink" title="å®¢æˆ·ç«¯æ¸²æŸ“"></a>å®¢æˆ·ç«¯æ¸²æŸ“</h2><p>å®¢æˆ·ç«¯ä¼˜åŒ– domã€css å’Œ js çš„ä»£ç å’ŒåŠ è½½é¡ºåº</p>
<h3 id="ä»€ä¹ˆæ˜¯DOM"><a href="#ä»€ä¹ˆæ˜¯DOM" class="headerlink" title="ä»€ä¹ˆæ˜¯DOM"></a>ä»€ä¹ˆæ˜¯DOM</h3><blockquote>
<p>Document Object Model æ–‡æ¡£å¯¹è±¡æ¨¡å‹</p>
</blockquote>
<p>DOMæ˜¯Modelï¼Œæ˜¯Object Modelï¼Œå¯¹è±¡æ¨¡å‹ï¼Œæ˜¯ä¸ºHTMLï¼ˆand XMLï¼‰æä¾›çš„APIã€‚HTMLï¼ˆHyper Text Markup Languageï¼‰æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼ŒHTMLåœ¨DOMçš„æ¨¡å‹æ ‡å‡†ä¸­è¢«è§†ä¸ºå¯¹è±¡ï¼ŒDOMåªæä¾›ç¼–ç¨‹æ¥å£ï¼Œå´æ— æ³•å®é™…æ“ä½œHTMLé‡Œé¢çš„å†…å®¹ã€‚ä½†åœ¨æµè§ˆå™¨ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è„šæœ¬è¯­è¨€ï¼ˆJavaScriptï¼‰é€šè¿‡DOMå»æ“ä½œHTMLå†…å®¹ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆDOMå¾ˆæ…¢"><a href="#ä¸ºä»€ä¹ˆDOMå¾ˆæ…¢" class="headerlink" title="ä¸ºä»€ä¹ˆDOMå¾ˆæ…¢"></a>ä¸ºä»€ä¹ˆDOMå¾ˆæ…¢</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ç½‘é¡µçš„ç”Ÿæˆè¿‡ç¨‹ã€‚æµè§ˆå™¨åœ¨æ”¶åˆ° HTML æ–‡æ¡£ä¹‹åä¼šå¯¹æ–‡æ¡£è¿›è¡Œè§£æå¼€å§‹æ„å»º DOM ï¼ˆDocument Object Modelï¼‰ æ ‘ï¼Œè¿›è€Œåœ¨æ–‡æ¡£ä¸­å‘ç°æ ·å¼è¡¨ï¼Œå¼€å§‹è§£æ CSS æ¥æ„å»º CSSOMï¼ˆCSS Object Modelï¼‰æ ‘ï¼Œè¿™ä¸¤è€…éƒ½æ„å»ºå®Œæˆåï¼Œå¼€å§‹æ„å»ºæ¸²æŸ“æ ‘ã€‚å¤§è‡´å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼š</p>
<ol>
<li>æ„å»ºDOMæ ‘</li>
<li>æ„å»ºCSSOMæ ‘</li>
<li>ç”Ÿæˆrenderæ ‘</li>
<li>Layout å¸ƒå±€</li>
<li>Paint ç»˜åˆ¶</li>
</ol>
<p>åœ¨æ¯æ¬¡ä¿®æ”¹äº† DOM æˆ–è€…å…¶æ ·å¼ä¹‹åéƒ½è¦è¿›è¡Œ DOMæ ‘çš„æ„å»ºï¼ŒCSSOM çš„é‡æ–°è®¡ç®—ï¼Œè¿›è€Œå¾—åˆ°æ–°çš„æ¸²æŸ“æ ‘ã€‚æµè§ˆå™¨ä¼šåˆ©ç”¨æ–°çš„æ¸²æŸ“æ ‘å¯¹é¡µé¢è¿›è¡Œé‡æ’å’Œé‡ç»˜ï¼Œä»¥åŠå›¾å±‚çš„åˆå¹¶ã€‚é€šå¸¸æµè§ˆå™¨ä¼šæ‰¹é‡è¿›è¡Œé‡æ’å’Œé‡ç»˜ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ä½†å½“æˆ‘ä»¬è¯•å›¾é€šè¿‡ JavaScript è·å–æŸä¸ªèŠ‚ç‚¹çš„å°ºå¯¸ä¿¡æ¯çš„æ—¶å€™ï¼Œä¸ºäº†è·å¾—å½“å‰çœŸå®çš„ä¿¡æ¯ï¼Œæµè§ˆå™¨ä¼šç«‹åˆ»è¿›è¡Œä¸€æ¬¡é‡æ’ã€‚</p>
<p>é€šè¿‡jsæ“ä½œDOMï¼Œå½±å“é¡µé¢æ€§èƒ½çš„ä¸»è¦åŸå› æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>è®¿é—®å’Œä¿®æ”¹DOMå…ƒç´ </li>
<li>ä¿®æ”¹DOMå…ƒç´ çš„æ ·å¼ï¼Œå¯¼è‡´é‡ç»˜å’Œé‡æ’</li>
<li>é€šè¿‡å¯¹DOMå…ƒç´ çš„äº‹ä»¶å¤„ç†ï¼Œå®Œæˆä¸ç”¨æˆ·çš„äº¤äº’åŠŸèƒ½</li>
</ul>
<h3 id="é‡ç»˜ï¼ˆä¹Ÿç§°ä¸ºå›æµreflowï¼‰å’Œé‡æ’"><a href="#é‡ç»˜ï¼ˆä¹Ÿç§°ä¸ºå›æµreflowï¼‰å’Œé‡æ’" class="headerlink" title="é‡ç»˜ï¼ˆä¹Ÿç§°ä¸ºå›æµreflowï¼‰å’Œé‡æ’"></a>é‡ç»˜ï¼ˆä¹Ÿç§°ä¸ºå›æµreflowï¼‰å’Œé‡æ’</h3><p>é‡æ’å’Œé‡ç»˜æ˜¯DOMç¼–ç¨‹ä¸­è€—èƒ½çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚</p>
<blockquote>
<p>é‡ç»˜</p>
</blockquote>
<p>é‡ç»˜æ„å‘³ç€å…ƒç´ å‘ç”Ÿçš„æ”¹å˜åªå½±å“äº†èŠ‚ç‚¹çš„ä¸€äº›æ ·å¼ï¼ˆèƒŒæ™¯è‰²ï¼Œè¾¹æ¡†é¢œè‰²ï¼Œæ–‡å­—é¢œè‰²ç­‰ï¼‰ï¼Œåªéœ€è¦åº”ç”¨æ–°æ ·å¼ç»˜åˆ¶è¿™ä¸ªå…ƒç´ å°±å¯ä»¥äº†ã€‚</p>
<blockquote>
<p>å¼•èµ·é‡ç»˜çš„æ“ä½œ</p>
</blockquote>
<ul>
<li>é‡æ’å¿…å®šå¼•èµ·repainté‡ç»˜ï¼Œé‡ç»˜å¯ä»¥å•ç‹¬è§¦å‘</li>
<li>èƒŒæ™¯è‰²ã€é¢œè‰²ã€å­—ä½“æ”¹å˜ï¼ˆæ³¨æ„ï¼šå­—ä½“å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘å›æµï¼‰</li>
</ul>
<blockquote>
<p>é‡æ’</p>
</blockquote>
<p>æ ¹æ®Render Treeå¸ƒå±€ï¼ˆå‡ ä½•å±æ€§ï¼‰ï¼Œæ„å‘³ç€å…ƒç´ çš„å†…å®¹ã€ç»“æ„ã€ä½ç½®æˆ–å°ºå¯¸å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦é‡æ–°è®¡ç®—æ ·å¼å’Œæ¸²æŸ“æ ‘ã€‚</p>
<blockquote>
<p>å¼•èµ·é‡æ’çš„æ“ä½œ</p>
</blockquote>
<ul>
<li>å†…å®¹æ”¹å˜<br>  æ–‡æœ¬æ”¹å˜æˆ–å›¾ç‰‡å°ºå¯¸æ”¹å˜</li>
<li>DOMå…ƒç´ çš„å‡ ä½•å±æ€§çš„å˜åŒ–<br>  ä¾‹å¦‚æ”¹å˜DOMå…ƒç´ çš„å®½é«˜å€¼æ—¶ï¼ŒåŸæ¸²æŸ“æ ‘ä¸­çš„ç›¸å…³èŠ‚ç‚¹ä¼šå¤±æ•ˆï¼Œæµè§ˆå™¨ä¼šæ ¹æ®å˜åŒ–åçš„DOMé‡æ–°æ’å»ºæ¸²æŸ“æ ‘ä¸­çš„ç›¸å…³èŠ‚ç‚¹ã€‚å¦‚æœçˆ¶èŠ‚ç‚¹çš„å‡ ä½•å±æ€§å˜åŒ–æ—¶ï¼Œè¿˜ä¼šä½¿å…¶å­èŠ‚ç‚¹åŠåç»­å…„å¼ŸèŠ‚ç‚¹é‡æ–°è®¡ç®—ä½ç½®ç­‰ï¼Œé€ æˆä¸€ç³»åˆ—çš„é‡æ’ã€‚</li>
<li>DOMæ ‘çš„ç»“æ„å˜åŒ–<br>  æ·»åŠ DOMèŠ‚ç‚¹ã€ä¿®æ”¹DOMèŠ‚ç‚¹ä½ç½®åŠåˆ é™¤æŸä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯¹DOMæ ‘çš„æ›´æ”¹ï¼Œä¼šé€ æˆé¡µé¢çš„é‡æ’ã€‚æµè§ˆå™¨å¸ƒå±€æ˜¯ä»ä¸Šåˆ°ä¸‹çš„è¿‡ç¨‹ï¼Œä¿®æ”¹å½“å‰å…ƒç´ ä¸ä¼šå¯¹å…¶å‰è¾¹å·²ç»éå†è¿‡çš„å…ƒç´ é€ æˆå½±å“ï¼Œä½†æ˜¯å¦‚æœåœ¨æ‰€æœ‰çš„èŠ‚ç‚¹å‰æ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œåˆ™åç»­çš„æ‰€æœ‰å…ƒç´ éƒ½è¦è¿›è¡Œé‡æ’ã€‚</li>
<li>æµè§ˆå™¨çª—å£å°ºå¯¸æ”¹å˜<br>  çª—å£å°ºå¯¸çš„æ”¹å˜ä¼šå½±å“æ•´ä¸ªç½‘é¡µå†…å…ƒç´ çš„å°ºå¯¸çš„æ”¹å˜ï¼Œå³DOMå…ƒç´ çš„é›†åˆå±æ€§å˜åŒ–ï¼Œå› æ­¤ä¼šé€ æˆé‡æ’ã€‚</li>
<li>è·å–æŸäº›å±æ€§<br>  é™¤äº†æ¸²æŸ“æ ‘çš„ç›´æ¥å˜åŒ–ï¼Œå½“è·å–ä¸€äº›å±æ€§å€¼æ—¶ï¼Œæµè§ˆå™¨ä¸ºå–å¾—æ­£ç¡®çš„å€¼ä¹Ÿä¼šå‘ç”Ÿé‡æ’ï¼Œè¿™äº›å±æ€§åŒ…æ‹¬ï¼šoffsetTopã€offsetLeftã€ offsetWidthã€offsetHeightã€scrollTopã€scrollLeftã€scrollWidthã€scrollHeightã€ clientTopã€clientLeftã€clientWidthã€clientHeightã€getComputedStyle()ã€‚</li>
</ul>
<h3 id="å¯¹æ€§èƒ½çš„å½±å“"><a href="#å¯¹æ€§èƒ½çš„å½±å“" class="headerlink" title="å¯¹æ€§èƒ½çš„å½±å“"></a>å¯¹æ€§èƒ½çš„å½±å“</h3><p>é‡æ’å’Œé‡ç»˜ä¼šä¸æ–­è§¦å‘ï¼Œè¿™æ˜¯ä¸å¯é¿å…çš„ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬éå¸¸è€—è´¹èµ„æºï¼Œæ˜¯å¯¼è‡´ç½‘é¡µæ€§èƒ½ä½ä¸‹çš„æ ¹æœ¬åŸå› ã€‚<br>æé«˜ç½‘é¡µæ€§èƒ½ï¼Œå°±æ˜¯è¦é™ä½â€œé‡æ’â€å’Œâ€œé‡ç»˜â€çš„é¢‘ç‡å’Œæˆæœ¬ï¼Œå°½é‡å°‘è§¦å‘é‡æ–°æ¸²æŸ“ã€‚<br>å‰é¢æåˆ°ï¼ŒDOMå˜åŠ¨å’Œæ ·å¼å˜åŠ¨ï¼Œéƒ½ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚ä½†æ˜¯ï¼Œæµè§ˆå™¨å·²ç»å¾ˆæ™ºèƒ½äº†ï¼Œä¼šå°½é‡æŠŠæ‰€æœ‰çš„å˜åŠ¨é›†ä¸­åœ¨ä¸€èµ·ï¼Œæ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œç„¶åä¸€æ¬¡æ€§æ‰§è¡Œï¼Œå°½é‡é¿å…å¤šæ¬¡é‡æ–°æ¸²æŸ“ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">div.style.color = <span class="string">'blue'</span>;</div><div class="line">div.style.marginTop = <span class="string">'30px'</span>;</div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œdivå…ƒç´ æœ‰ä¸¤ä¸ªæ ·å¼å˜åŠ¨ï¼Œä½†æ˜¯æµè§ˆå™¨åªä¼šè§¦å‘ä¸€æ¬¡é‡æ’å’Œé‡ç»˜ã€‚</p>
<p>å¦‚æœå†™å¾—ä¸å¥½ï¼Œå°±ä¼šè§¦å‘ä¸¤æ¬¡é‡æ’å’Œé‡ç»˜ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">div.style.color = <span class="string">'blue'</span>;</div><div class="line"><span class="keyword">var</span> margin = <span class="built_in">parseInt</span>(div.style.marginTop);</div><div class="line">div.style.marginTop = (margin + <span class="number">10</span>) + <span class="string">'px'</span>;</div></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ä»£ç å¯¹divå…ƒç´ è®¾ç½®é¢œè‰²ä»¥åï¼Œç¬¬äºŒè¡Œè¦æ±‚æµè§ˆå™¨ç»™å‡ºè¯¥å…ƒç´ çš„ä½ç½®ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¸å¾—ä¸ç«‹å³é‡æ’ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ ·å¼çš„å†™æ“ä½œä¹‹åï¼Œå¦‚æœæœ‰ä¸‹é¢è¿™äº›å±æ€§çš„è¯»æ“ä½œï¼Œéƒ½ä¼šå¼•å‘æµè§ˆå™¨ç«‹å³é‡æ–°æ¸²æŸ“ã€‚</p>
<pre><code>* offsetTop/offsetLeft/offsetWidth/offsetHeight
* scrollTop/scrollLeft/scrollWidth/scrollHeight
* clientTop/clientLeft/clientWidth/clientHeight
* getComputedStyle()
</code></pre><p>æ‰€ä»¥ï¼Œä»æ€§èƒ½è§’åº¦è€ƒè™‘ï¼Œå°½é‡ä¸è¦æŠŠè¯»æ“ä½œå’Œå†™æ“ä½œï¼Œæ”¾åœ¨ä¸€ä¸ªè¯­å¥é‡Œé¢ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//bad</span></div><div class="line">div.style.left = div.offsetLeft + <span class="number">10</span> + <span class="string">"px"</span>;</div><div class="line">div.style.top = div.offsetTop + <span class="number">10</span> + <span class="string">"px"</span>;</div><div class="line"><span class="comment">//good</span></div><div class="line"><span class="keyword">var</span> left = div.offsetLeft;</div><div class="line"><span class="keyword">var</span> top  = div.offsetTop;</div><div class="line">div.style.left = left + <span class="number">10</span> + <span class="string">"px"</span>;</div><div class="line">div.style.top = top + <span class="number">10</span> + <span class="string">"px"</span>;</div></pre></td></tr></table></figure></p>
<h3 id="å…³äºDOMæ“ä½œçš„å‡ ä¸ªæŠ€å·§"><a href="#å…³äºDOMæ“ä½œçš„å‡ ä¸ªæŠ€å·§" class="headerlink" title="å…³äºDOMæ“ä½œçš„å‡ ä¸ªæŠ€å·§"></a>å…³äºDOMæ“ä½œçš„å‡ ä¸ªæŠ€å·§</h3><ul>
<li>DOM çš„å¤šä¸ªè¯»æ“ä½œï¼ˆæˆ–å¤šä¸ªå†™æ“ä½œï¼‰ï¼Œåº”è¯¥æ”¾åœ¨ä¸€èµ·ã€‚ä¸è¦ä¸¤ä¸ªè¯»æ“ä½œä¹‹é—´ï¼ŒåŠ å…¥ä¸€ä¸ªå†™æ“ä½œã€‚</li>
<li>å¦‚æœæŸä¸ªæ ·å¼æ˜¯é€šè¿‡é‡æ’å¾—åˆ°çš„ï¼Œé‚£ä¹ˆæœ€å¥½ç¼“å­˜ç»“æœã€‚é¿å…ä¸‹ä¸€æ¬¡ç”¨åˆ°çš„æ—¶å€™ï¼Œæµè§ˆå™¨åˆè¦é‡æ’ã€‚</li>
<li><p>ä¸è¦ä¸€æ¡æ¡åœ°æ”¹å˜æ ·å¼ï¼Œè€Œè¦é€šè¿‡æ”¹å˜classï¼Œæˆ–è€…csstextå±æ€§ï¼Œä¸€æ¬¡æ€§åœ°æ”¹å˜æ ·å¼ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// bad</span></div><div class="line"><span class="keyword">var</span> left = <span class="number">10</span>;</div><div class="line"><span class="keyword">var</span> top = <span class="number">10</span>;</div><div class="line">el.style.left = left + <span class="string">"px"</span>;</div><div class="line">el.style.top  = top  + <span class="string">"px"</span>;</div><div class="line"><span class="comment">// good</span></div><div class="line">el.className += <span class="string">" theclassname"</span>;</div><div class="line"><span class="comment">// good</span></div><div class="line">el.style.cssText += <span class="string">"; left: "</span> + left + <span class="string">"px; top: "</span> + top + <span class="string">"px;"</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>å…ˆå°†å…ƒç´ è®¾ä¸ºdisplay: noneï¼ˆéœ€è¦1æ¬¡é‡æ’å’Œé‡ç»˜ï¼‰ï¼Œç„¶åå¯¹è¿™ä¸ªèŠ‚ç‚¹è¿›è¡Œ100æ¬¡æ“ä½œï¼Œæœ€åå†æ¢å¤æ˜¾ç¤ºï¼ˆéœ€è¦1æ¬¡é‡æ’å’Œé‡ç»˜ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ å°±ç”¨ä¸¤æ¬¡é‡æ–°æ¸²æŸ“ï¼Œå–ä»£äº†å¯èƒ½é«˜è¾¾100æ¬¡çš„é‡æ–°æ¸²æŸ“ã€‚</p>
</li>
<li>positionå±æ€§ä¸ºabsoluteæˆ–fixedçš„å…ƒç´ ï¼Œé‡æ’çš„å¼€é”€ä¼šæ¯”è¾ƒå°ï¼Œå› ä¸ºä¸ç”¨è€ƒè™‘å®ƒå¯¹å…¶ä»–å…ƒç´ çš„å½±å“ã€‚</li>
<li>åªåœ¨å¿…è¦çš„æ—¶å€™ï¼Œæ‰å°†å…ƒç´ çš„displayå±æ€§ä¸ºå¯è§ï¼Œå› ä¸ºä¸å¯è§çš„å…ƒç´ ä¸å½±å“é‡æ’å’Œé‡ç»˜ã€‚å¦å¤–ï¼Œvisibility : hiddençš„å…ƒç´ åªå¯¹é‡ç»˜æœ‰å½±å“ï¼Œä¸å½±å“é‡æ’ã€‚</li>
<li><p>åœ¨æ¶‰åŠåˆ°å¸é¡¶ç›¸å…³åŠscrollæ»šåŠ¨ä¼˜åŒ–</p>
<ol>
<li>å°½é‡æ§åˆ¶DOMçš„æ˜¾ç¤ºæˆ–éšè—ï¼Œè€Œä¸æ˜¯åˆ é™¤æˆ–æ·»åŠ </li>
<li>ä¸€æ¬¡æ€§æ“ä½œDOM</li>
<li>å¤šåšç¼“å­˜</li>
<li><p>æ³¨æ„èŠ‚æµï¼Œé¿å…é¢‘ç¹è§¦å‘æ»šåŠ¨äº‹ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> throttle = <span class="function"><span class="keyword">function</span> (<span class="params">fn, threshhold = <span class="number">200</span></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> last;</div><div class="line">    <span class="keyword">var</span> timer;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> context = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</div><div class="line">        <span class="keyword">var</span> now = +<span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        <span class="keyword">if</span> (last &amp;&amp; now &lt; last + threshhold) &#123;</div><div class="line">            clearTimeout(timer);</div><div class="line">            timer = setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                last = now;</div><div class="line">                fn.apply(context, args);</div><div class="line">            &#125;, threshhold);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            last = now;</div><div class="line">            fn.apply(context, args);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h3 id="ä»£ç ä¼˜åŒ–å’ŒåŠ è½½é¡ºåº"><a href="#ä»£ç ä¼˜åŒ–å’ŒåŠ è½½é¡ºåº" class="headerlink" title="ä»£ç ä¼˜åŒ–å’ŒåŠ è½½é¡ºåº"></a>ä»£ç ä¼˜åŒ–å’ŒåŠ è½½é¡ºåº</h3><p>å°½é‡è¾ƒå°‘ä¸å¿…è¦çš„ä»£ç ï¼Œæ¯”å¦‚htmlå’Œcssçš„å¤šå±‚åµŒå¥—ï¼Œä»£ç ç»“æ„å°½é‡ç²¾ç®€ã€‚äº†è§£jså†…å­˜æ³„æ¼ï¼Œé¿å…å¯¼è‡´å†…å­˜æ³„æ¼çš„å†™æ³•ã€‚HTMLå’ŒCSSéƒ½ä¼šé˜»å¡æ¸²æŸ“ã€‚æ‰€ä»¥éœ€è¦è®©CSSå°½æ—©åŠ è½½ï¼ˆå¦‚ï¼šæ”¾åœ¨å¤´éƒ¨ï¼‰ï¼Œä»¥ç¼©çŸ­é¦–æ¬¡æ¸²æŸ“çš„æ—¶é—´ã€‚jsè„šæœ¬ä¼šé˜»å¡æµè§ˆå™¨è§£æï¼Œå°†è„šæœ¬æ”¾åœ¨é¡µé¢åº•éƒ¨åŠ è½½ã€‚</p>
<h2 id="æœåŠ¡ç«¯å“åº”"><a href="#æœåŠ¡ç«¯å“åº”" class="headerlink" title="æœåŠ¡ç«¯å“åº”"></a>æœåŠ¡ç«¯å“åº”</h2><p>å°½é‡å‡å°‘å“åº”çš„ä½“ç§¯ï¼Œæ¯”å¦‚ç”¨ gzip å‹ç¼©ï¼Œä¼˜åŒ–å›¾ç‰‡å­—èŠ‚æ•°ï¼ŒåŠ å¿«æ–‡ä»¶è¯»å–é€Ÿåº¦ï¼Œä¼˜åŒ–æœåŠ¡ç«¯çš„ç¼“å­˜ç­–ç•¥ã€‚</p>
<h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><p>ä¼˜åŒ–ç½‘ç»œè·¯ç”±ï¼Œæ¯”å¦‚å¢åŠ  CDN ç¼“å­˜ï¼›æˆ–å¢åŠ å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œæ¯”å¦‚æœåŠ¡ç«¯è®¾ç½®å¤šä¸ªåŸŸåï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å¤šä¸ªåŸŸååŒæ—¶è¯·æ±‚èµ„æºï¼Œå¢åŠ å¹¶å‘é‡ã€‚</p>
<h3 id="æµè§ˆå™¨å¹¶å‘è¯·æ±‚é™åˆ¶"><a href="#æµè§ˆå™¨å¹¶å‘è¯·æ±‚é™åˆ¶" class="headerlink" title="æµè§ˆå™¨å¹¶å‘è¯·æ±‚é™åˆ¶"></a>æµè§ˆå™¨å¹¶å‘è¯·æ±‚é™åˆ¶</h3><p>åŸºäºç«¯å£æ•°é‡å’Œçº¿ç¨‹åˆ‡æ¢å¼€é”€çš„è€ƒè™‘ï¼Œæµè§ˆå™¨ä¸å¯èƒ½æ— é™é‡çš„å¹¶å‘è¯·æ±‚ï¼Œå› æ­¤è¡ç”Ÿå‡ºæ¥äº†å¹¶å‘é™åˆ¶ã€‚æµè§ˆå™¨çš„å¹¶å‘è¯·æ±‚æ•°ç›®é™åˆ¶æ˜¯é’ˆå¯¹åŒä¸€åŸŸåçš„ã€‚å› æ­¤é™æ€èµ„æºå¯ä»¥å¼•ç”¨ä¸åŒåŸŸåä¸‹çš„èµ„æºæ–‡ä»¶ï¼Œé—´æ¥å¢åŠ æµè§ˆå™¨è¯·æ±‚èµ„æºçš„å¹¶å‘æ•°ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥ä¸Šä»‹ç»äº†æ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ–¹é¢ï¼Œå› ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œæœ‰æ€»ç»“ä¸åˆ°æˆ–è€…é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·å„ä½å¤§ç¥ä¸åæŒ‡æ•™ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨æ„å»ºwebç«™ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç»†èŠ‚éƒ½æœ‰å¯èƒ½å½±å“ç½‘ç«™çš„è®¿é—®é€Ÿåº¦ï¼Œå¦‚æœä¸äº†è§£æ€§èƒ½ä¼˜åŒ–çŸ¥è¯†ï¼Œå¾ˆå¤šä¸åˆ©ç½‘ç«™è®¿é—®é€Ÿåº¦çš„å› ç´ ä¼šå½¢æˆç´¯åŠ ï¼Œä»è€Œä¸¥é‡å½±å“ç½‘ç«™çš„æ€§èƒ½ï¼Œå¯¼è‡´ç½‘ç«™è®¿é—®é€Ÿåº¦å˜æ…¢ï¼Œç”¨æˆ·ä½“éªŒä½ä¸‹ï¼Œæœ€ç»ˆå¯¼è‡´ç”¨æˆ·æµå¤±ã€‚æœ¬æ–‡ä¸»è¦å›´ç»•ä»¥ä¸‹å‡ ç‚¹è®²è§£ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯è¯·æ±‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯æ¸²æŸ“&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯å“åº”&lt;/li&gt;
&lt;li&gt;ç½‘ç»œ
    
    </summary>
    
      <category term="zhangjianfeng" scheme="http://xgfe.github.io/categories/zhangjianfeng/"/>
    
    
      <category term="æ€§èƒ½ä¼˜åŒ–" scheme="http://xgfe.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    
      <category term="webæ€§èƒ½" scheme="http://xgfe.github.io/tags/web%E6%80%A7%E8%83%BD/"/>
    
      <category term="å‰ç«¯ä¼˜åŒ–å®è·µ" scheme="http://xgfe.github.io/tags/%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/"/>
    
  </entry>
  
  <entry>
    <title>routable-ios æºç è§£æ</title>
    <link href="http://xgfe.github.io/2018/04/07/chenyu/routable-ios_sourceAnalysis/"/>
    <id>http://xgfe.github.io/2018/04/07/chenyu/routable-ios_sourceAnalysis/</id>
    <published>2018-04-07T05:12:00.000Z</published>
    <updated>2018-04-12T12:51:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦åˆ†æ <a href="https://github.com/clayallsopp/routable-ios" target="_blank" rel="external">routable-ios</a> æºç ï¼Œé€šè¿‡æœ¬æ–‡å¯ä»¥äº†è§£è·¯ç”±çš„åŸç†åŠä½¿ç”¨ã€‚æœ¬æ–‡åˆ†ä¸ºå…­ä¸ªéƒ¨åˆ†ï¼Œä»ä»£ç ç»“æ„åˆ°å…·ä½“çš„ç±»ä¾æ¬¡ä»‹ç»ï¼Œæ–‡ç« æœ€åä¼šç»™å‡ºåœ¨é¡¹ç›®ä¸­æ³¨å†Œè·¯ç”±å¸¸ç”¨çš„æ–¹å¼ã€‚</p>
<a id="more"></a>
<h2 id="ä¸€ã€routable-ios-æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿä¸ä¹‹ç±»ä¼¼çš„æ¡†æ¶è¿˜æœ‰å“ªäº›ï¼Ÿ"><a href="#ä¸€ã€routable-ios-æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿä¸ä¹‹ç±»ä¼¼çš„æ¡†æ¶è¿˜æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="ä¸€ã€routable-ios æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿä¸ä¹‹ç±»ä¼¼çš„æ¡†æ¶è¿˜æœ‰å“ªäº›ï¼Ÿ"></a>ä¸€ã€routable-ios æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿä¸ä¹‹ç±»ä¼¼çš„æ¡†æ¶è¿˜æœ‰å“ªäº›ï¼Ÿ</h2><ul>
<li>routable-ios æ˜¯ä¸€ä¸ªè·¯ç”±æ¡†æ¶ï¼Œç”±ä¸¤ä¸ªæ–‡ä»¶å››ä¸ªç±»ç»„æˆï¼Œå…¶ä¸­æ ¸å¿ƒçš„ç±»å°±ä¸€ä¸ªã€‚</li>
<li>å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç° iOS ä¸­<code>UIViewController</code>ä¹‹é—´çš„è·³è½¬ã€‚è·³è½¬æ–¹å¼ä¹Ÿå¯ä»¥çµæ´»çš„è®¾ç½®ï¼Œåé¢å…·ä½“ä¼šè®²åˆ°ã€‚</li>
<li>ç±»ä¼¼çš„æ¡†æ¶è¿˜æœ‰ <a href="https://github.com/aaronbrethorst/ABRouter" target="_blank" rel="external">ABRouter</a> &amp; <a href="https://github.com/lightory/HHRouter" target="_blank" rel="external">HHRouter</a>ã€‚åæœŸçš„æ–‡ç« ä¹Ÿä¼šå¯¹ HHRouter åšä»‹ç»ã€‚</li>
</ul>
<h2 id="äºŒã€routable-ios-ä¸­ç±»çš„å…³ç³»"><a href="#äºŒã€routable-ios-ä¸­ç±»çš„å…³ç³»" class="headerlink" title="äºŒã€routable-ios ä¸­ç±»çš„å…³ç³»"></a>äºŒã€routable-ios ä¸­ç±»çš„å…³ç³»</h2><p>&nbsp;&nbsp;äº†è§£ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»ï¼Œæœ‰åŠ©äºç†è§£æ•´ä¸ªæ¡†æ¶ã€‚<code>Routable</code>ç»§æ‰¿è‡ª<code>UPRouter</code>ï¼Œä¸»è¦çš„åŠŸèƒ½éƒ½åœ¨<code>UPRouter</code>ç±»ä¸­ï¼Œè·¯ç”±ä¸»è¦çš„åŠŸèƒ½å…¶å®å°±ä¸¤ä¸ªï¼š</p>
<ul>
<li>æ³¨å†Œå¸Œæœ›è·¯ç”±è·³è½¬çš„ç±»åŠ<code>URL</code></li>
<li>è¿›è¡Œè·³è½¬</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/142772-7f18a54a0a327233.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="routable-ios ç±»ç»„ç»‡ç»“æ„.png"></p>
<h2 id="ä¸‰ã€routable-ios-å¦‚ä½•ä½¿ç”¨"><a href="#ä¸‰ã€routable-ios-å¦‚ä½•ä½¿ç”¨" class="headerlink" title="ä¸‰ã€routable-ios å¦‚ä½•ä½¿ç”¨"></a>ä¸‰ã€routable-ios å¦‚ä½•ä½¿ç”¨</h2><ul>
<li>å°†<code>routable-ios</code>å¯¼å…¥é¡¹ç›®</li>
<li><p>æ³¨å†Œè·¯ç”±ï¼š</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[Routable sharedRouter] map:@&quot;user/:name/:age&quot; toController:[UserController class]];</div></pre></td></tr></table></figure>
</li>
<li><p>è°ƒç”¨è·¯ç”±è¿›è¡Œè·³è½¬ï¼š</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[Routable sharedRouter] open:@&quot;user/chenyu/28&quot;];</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨ VC ä¸­è·å–ä¼ é€’çš„å‚æ•°</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@implementation UserController</div><div class="line"></div><div class="line">- (id)initWithRouterParams:(NSDictionary *)params &#123;</div><div class="line">  if ((self = [self initWithNibName:nil bundle:nil])) &#123;</div><div class="line">    self.title = @&quot;User&quot;;</div><div class="line">      NSLog(@&quot;name: %@&quot;,[params objectForKey:@&quot;name&quot;]); //chenyu</div><div class="line">      NSLog(@&quot;age: %@&quot;,[params objectForKey:@&quot;age&quot;]);   //28</div><div class="line">  &#125;</div><div class="line">  return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å››ã€routable-ios-ä¸­çš„æ ¸å¿ƒç±»"><a href="#å››ã€routable-ios-ä¸­çš„æ ¸å¿ƒç±»" class="headerlink" title="å››ã€routable-ios ä¸­çš„æ ¸å¿ƒç±»"></a>å››ã€routable-ios ä¸­çš„æ ¸å¿ƒç±»</h2><p>&nbsp;&nbsp;æ ¸å¿ƒç±»åˆ†åˆ«æœ‰ï¼š<code>Routable</code>ï¼Œ<code>UPRouterOptions</code>ï¼Œ<code>RouterParams</code>ï¼Œ<code>UPRouter</code></p>
<h3 id="1-Routable"><a href="#1-Routable" class="headerlink" title="1.Routable"></a>1.<code>Routable</code></h3><p>&nbsp;&nbsp;<code>Routable</code>ç»§æ‰¿è‡ª<code>UPRouter</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)sharedRouter; //æä¾›å•ä¾‹æ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºè·¯ç”±ç±»</div><div class="line">+ (instancetype)newRouter;     //å¦ä¸€ç§åˆ›å»ºè·¯ç”±çš„æ–¹å¼ï¼Œä¸€èˆ¬ä¸æ¨èï¼Œä¸æ˜¯å•ä¾‹ã€‚</div></pre></td></tr></table></figure>
<h3 id="2-UPRouterOptions"><a href="#2-UPRouterOptions" class="headerlink" title="2.UPRouterOptions"></a>2.<code>UPRouterOptions</code></h3><p>&nbsp;&nbsp;<code>UPRouterOptions</code>ç»§æ‰¿è‡ª<code>NSObject</code>ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªç±»æä¾›çš„ä¸€äº›å±æ€§ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªç±»æ˜¯åšä»€ä¹ˆçš„äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@property (readwrite, nonatomic, getter=isModal) BOOL modal;  //æ˜¯å¦æ˜¯æ¨¡æ€è§†å›¾</div><div class="line">@property (readwrite, nonatomic) UIModalPresentationStyle presentationStyle;  //VC æ˜¾ç¤ºçš„æ ·å¼</div><div class="line">@property (readwrite, nonatomic) UIModalTransitionStyle transitionStyle;  //VC å‡ºç°æ—¶çš„åŠ¨ç”»</div><div class="line">@property (readwrite, nonatomic, strong) NSDictionary *defaultParams;  //é»˜è®¤çš„æ•°æ®</div><div class="line">@property (readwrite, nonatomic, assign) BOOL shouldOpenAsRootViewController; //æ˜¯å¦æ˜¯æ ¹è§†å›¾</div><div class="line"></div><div class="line">//.m æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªå±æ€§</div><div class="line">@property (readwrite, nonatomic, strong) Class openClass;  //æ³¨å†Œçš„ç±»</div><div class="line">@property (readwrite, nonatomic, copy) RouterOpenCallback callback;  //block å›è°ƒ</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°<code>UPRouterOptions</code>å…¶å®å°±æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œé‡Œé¢å­˜å‚¨è·¯ç”±è·³è½¬æ—¶éœ€è¦çš„ä¸€äº›æ•°æ®ï¼Œå¯ä»¥ç†è§£æˆä¸€ä¸ªè¾…åŠ©çš„ç±»ã€‚è¿™ä¸ªç±»ä¸­æä¾›äº†ä¸€ç³»åˆ—çš„å·¥å‚æ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚ï¼ˆåªåˆ—ä¸¾éƒ¨åˆ†å‡½æ•°ï¼Œå…¶ä»–åŒç±»å‹çš„å‡½æ•°è¿˜æœ‰å¾ˆå¤šï¼ŒåŠŸèƒ½å¤§ä½“ä¸€è‡´ï¼Œåªæ˜¯æŸä¸ªé…ç½®é¡¹ä¸åŒè€Œå·²ã€‚ï¼‰ï¼š</p>
<ul>
<li><p>å…¨éƒ¨ä½¿ç”¨é»˜è®¤é…ç½®</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//Default construction; like [NSArray array]</div><div class="line">+ (instancetype)routerOptions &#123;</div><div class="line">  return [self routerOptionsWithPresentationStyle:UIModalPresentationNone</div><div class="line">                                  transitionStyle:UIModalTransitionStyleCoverVertical</div><div class="line">                                    defaultParams:nil</div><div class="line">                                           isRoot:NO</div><div class="line">                                          isModal:NO];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>ä¼ å…¥æ‰€æœ‰å‚æ•°åˆ›å»ºå¯¹è±¡</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//Explicit construction</div><div class="line">+ (instancetype)routerOptionsWithPresentationStyle: (UIModalPresentationStyle)presentationStyle</div><div class="line">                                   transitionStyle: (UIModalTransitionStyle)transitionStyle</div><div class="line">                                     defaultParams: (NSDictionary *)defaultParams</div><div class="line">                                            isRoot: (BOOL)isRoot</div><div class="line">                                           isModal: (BOOL)isModal &#123;</div><div class="line">  UPRouterOptions *options = [[UPRouterOptions alloc] init];</div><div class="line">  options.presentationStyle = presentationStyle;</div><div class="line">  options.transitionStyle = transitionStyle;</div><div class="line">  options.defaultParams = defaultParams;</div><div class="line">  options.shouldOpenAsRootViewController = isRoot;</div><div class="line">  options.modal = isModal;</div><div class="line">  return options;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>è‡ªå®šä¹‰éƒ¨åˆ†å‚æ•°åˆ›å»ºå¯¹è±¡</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//Custom class constructors, with heavier Objective-C accent</div><div class="line">+ (instancetype)routerOptionsAsModal &#123;</div><div class="line">  return [self routerOptionsWithPresentationStyle:UIModalPresentationNone</div><div class="line">                                  transitionStyle:UIModalTransitionStyleCoverVertical</div><div class="line">                                    defaultParams:nil</div><div class="line">                                           isRoot:NO</div><div class="line">                                          isModal:YES];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>å‰©ä½™çš„åŸºæœ¬å°±æ˜¯ä¸€äº›å¿«æ·çš„æ–¹æ³•åŠä¸€äº›<code>setters</code>æ–¹æ³•ï¼Œå¯ä»¥æŸ¥çœ‹æºç ã€‚</p>
</li>
</ul>
<h3 id="3-RouterParams"><a href="#3-RouterParams" class="headerlink" title="3.RouterParams"></a>3.<code>RouterParams</code></h3><p>&nbsp;&nbsp;<code>RouterParams</code>ç»§æ‰¿è‡ª<code>NSObject</code>ã€‚<code>RouterParams</code>å¹¶æ²¡æœ‰åœ¨.h æ–‡ä»¶ä¸­åšå£°æ˜ï¼Œè¿™ä¸ªç±»åªåœ¨<code>Routable</code>å’Œ<code>UPRouter</code>ä¸­çš„å®ç°ä¸­æ‰ç”¨åˆ°ï¼Œè€Œè¿™ä¸‰ä¸ªç±»éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰å¿…è¦å‡ºç°åœ¨ .h æ–‡ä»¶ä¸­ã€‚<br>é¦–å…ˆçœ‹ä¸€ä¸‹<code>RouterParams</code>çš„å£°æ˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@interface RouterParams : NSObject</div><div class="line"></div><div class="line">@property (readwrite, nonatomic, strong) UPRouterOptions *routerOptions;</div><div class="line">@property (readwrite, nonatomic, strong) NSDictionary *openParams; </div><div class="line">@property (readwrite, nonatomic, strong) NSDictionary *extraParams;</div><div class="line">@property (readwrite, nonatomic, strong) NSDictionary *controllerParams;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;è¿™ä¸ªç±»çš„å‡ºç°ï¼Œä¸»è¦ä½œç”¨æ˜¯å°†è·³è½¬æ—¶åŒ¹é…å¥½çš„æ‰€æœ‰å†…å®¹å­˜èµ·æ¥ï¼Œç¼“å­˜åˆ°å¦ä¸€ä¸ªå­—å…¸ä¸­ï¼Œæœªæ¥å†æ¬¡è·³è½¬çš„æ—¶å€™ï¼Œç›´æ¥å¯ä»¥æ‹¿å‡ºæ¥ç”¨ï¼Œä½ ä¹Ÿè®¸ä¼šé—®ï¼Œæˆ‘ä»¬çš„è·¯ç”±ä¸æ˜¯åœ¨ä¸€ä¸ªå­—å…¸é‡Œå—ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‹¿å‡ºæ¥ç”¨ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç¼“å­˜ï¼Œåç»­åˆ°æºä»£ç çš„åœ°æ–¹ä¼šç»†è¯´ï¼Œä¸ºä»€ä¹ˆè¦ç¼“å­˜ï¼Œä¸ºä»€ä¹ˆè·³è½¬çš„æ—¶å€™ä¸æ˜¯ç›´æ¥å» map ä¸­å¯»æ‰¾ã€‚</p>
<h3 id="4-UPRouter"><a href="#4-UPRouter" class="headerlink" title="4.UPRouter"></a>4.<code>UPRouter</code></h3><p>&nbsp;&nbsp;<code>UPRouter</code>ç»§æ‰¿è‡ª<code>NSObject</code>ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹ç±»çš„å£°æ˜ï¼Œåˆ é™¤äº†å¾ˆå¤šæ³¨é‡Šã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">@interface UPRouter : NSObject</div><div class="line"></div><div class="line">/**</div><div class="line"> The UINavigationController instance which mapped UIViewControllers will be pushed onto.</div><div class="line"> */</div><div class="line">@property (readwrite, nonatomic, strong) UINavigationController *navigationController;</div><div class="line"></div><div class="line">- (void)pop;</div><div class="line">- (void)popViewControllerFromRouterAnimated:(BOOL)animated;</div><div class="line">- (void)pop:(BOOL)animated;</div><div class="line"></div><div class="line">@property (readwrite, nonatomic, assign) BOOL ignoresExceptions;</div><div class="line"></div><div class="line">- (void)map:(NSString *)format toCallback:(RouterOpenCallback)callback;</div><div class="line">- (void)map:(NSString *)format toCallback:(RouterOpenCallback)callback withOptions:(UPRouterOptions *)options;</div><div class="line">- (void)map:(NSString *)format toController:(Class)controllerClass;</div><div class="line">//æ³¨å†Œè·¯ç”±ï¼Œæœ¬ç¯‡ä¸»è¦åˆ†æçš„æ–¹æ³•ã€‚ä¸Šé¢çš„æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œoptions ä¼ å…¥çš„æ˜¯ nil</div><div class="line">- (void)map:(NSString *)format toController:(Class)controllerClass withOptions:(UPRouterOptions *)options;</div><div class="line"></div><div class="line"></div><div class="line">- (void)openExternal:(NSString *)url;</div><div class="line">- (void)open:(NSString *)url;</div><div class="line">- (void)open:(NSString *)url animated:(BOOL)animated;</div><div class="line">//è·¯ç”±è·³è½¬ï¼Œæœ¬ç¯‡ä¸»è¦åˆ†æçš„æ–¹æ³•ã€‚ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</div><div class="line">- (void)open:(NSString *)url animated:(BOOL)animated extraParams:(NSDictionary *)extraParams;</div><div class="line"></div><div class="line">- (NSDictionary*)paramsOfUrl:(NSString*)url;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@interface UPRouter ()</div><div class="line"></div><div class="line">// å­˜å‚¨æ³¨å†Œçš„è·¯ç”±</div><div class="line">@property (readwrite, nonatomic, strong) NSMutableDictionary *routes;</div><div class="line">// ç¼“å­˜å·²è·³è½¬è¿‡çš„è·¯ç”±</div><div class="line">@property (readwrite, nonatomic, strong) NSMutableDictionary *cachedRoutes;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;æ³¨å†Œè·¯ç”±æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†ä¼ å…¥çš„<code>URL</code>ä½œä¸º keyï¼Œå°†<code>Class</code>ä½œä¸ºå€¼å­˜å…¥å·²åˆå§‹åŒ–çš„<code>routes</code>ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (void)map:(NSString *)format toController:(Class)controllerClass &#123;</div><div class="line">  [self map:format toController:controllerClass withOptions:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)map:(NSString *)format toController:(Class)controllerClass withOptions:(UPRouterOptions *)options &#123;</div><div class="line">  if (!format) &#123;</div><div class="line">    @throw [NSException exceptionWithName:@&quot;RouteNotProvided&quot;</div><div class="line">                                   reason:@&quot;Route #format is not initialized&quot;</div><div class="line">                                 userInfo:nil];</div><div class="line">    return;</div><div class="line">  &#125;</div><div class="line">  //å¦‚æœæ²¡æœ‰ä¼ å…¥ optionsï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„é…ç½®å¯¹è±¡</div><div class="line">  if (!options) &#123;</div><div class="line">    options = [UPRouterOptions routerOptions];</div><div class="line">  &#125;</div><div class="line">  options.openClass = controllerClass;</div><div class="line">  [self.routes setObject:options forKey:format];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;è·¯ç”±è·³è½¬ä¸€å…±æœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼Œé¦–å…ˆçœ‹<code>open:animated:extraParams:</code>æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">- (void)open:(NSString *)url</div><div class="line">    animated:(BOOL)animated</div><div class="line"> extraParams:(NSDictionary *)extraParams</div><div class="line">&#123;</div><div class="line">  //è·å–è·¯ç”±è·³è½¬ç›¸å…³çš„å‚æ•°ï¼Œå¾€ä¸‹æ»‘åŠ¨ï¼Œå…ˆçœ‹æ€ä¹ˆè·å–çš„æ•°æ®ï¼Œçœ‹å®Œä¸‹é¢çš„æ–¹æ³•å†å›æ¥çœ‹è¿™ä¸ªæ–¹æ³•</div><div class="line">  RouterParams *params = [self routerParamsForUrl:url extraParams: extraParams];</div><div class="line">  UPRouterOptions *options = params.routerOptions;</div><div class="line">  </div><div class="line">  //å¥½äº†ï¼Œæ‹¿åˆ°æ•°æ®äº†ï¼Œå¼€å§‹è·³è½¬ã€‚å…ˆåˆ¤æ–­æ˜¯å¦æœ‰å›è°ƒï¼Œå¦‚æœæœ‰çš„è¯ï¼Œåˆ™å»æ‰§è¡Œ block</div><div class="line">  if (options.callback) &#123;</div><div class="line">    RouterOpenCallback callback = options.callback;</div><div class="line">    callback([params controllerParams]);</div><div class="line">    return;</div><div class="line">  &#125;</div><div class="line">  //æ­¤å¤„åˆ é™¤äº†åˆ¤æ–­ self.navigationController æ˜¯å¦å­˜åœ¨çš„å®¹é”™ä»£ç ï¼Œæ— å…³ç´§è¦ã€‚</div><div class="line">  </div><div class="line">  //è·å–å°†è¦è·³è½¬çš„ VCï¼Œå¹¶ä¸”å°†æˆ‘ä»¬ä¼ é€’çš„æ•°æ®ä»¥å­—å…¸çš„å½¢å¼ï¼Œä¼ é€’ç»™è¿™ä¸ª VC</div><div class="line">  //controllerForRouterParams è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæ‰“æ–­ç‚¹è¿›å»çœ‹çœ‹å°± OK äº†ã€‚</div><div class="line">  UIViewController *controller = [self controllerForRouterParams:params];</div><div class="line">  </div><div class="line">  //åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰ presented çš„ UIViewControllerï¼Œæœ‰çš„è¯è¦ dismissï¼Œå› ä¸ºæ¥ä¸‹æ¥è¦è·³è½¬æˆ–è€… presentViewController</div><div class="line">  if (self.navigationController.presentedViewController) &#123;</div><div class="line">    [self.navigationController dismissViewControllerAnimated:animated completion:nil];</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  //æ˜¯å¦æ˜¯ä»¥æ¨¡æ€çš„æ–¹å¼å¼¹å‡º UIViewController</div><div class="line">  if ([options isModal]) &#123;</div><div class="line">    if ([controller.class isSubclassOfClass:UINavigationController.class]) &#123;</div><div class="line">      [self.navigationController presentViewController:controller</div><div class="line">                                              animated:animated</div><div class="line">                                            completion:nil];</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">      UINavigationController *navigationController = [[UINavigationController alloc] initWithRootViewController:controller];</div><div class="line">      navigationController.modalPresentationStyle = controller.modalPresentationStyle;</div><div class="line">      navigationController.modalTransitionStyle = controller.modalTransitionStyle;</div><div class="line">      [self.navigationController presentViewController:navigationController</div><div class="line">                                              animated:animated</div><div class="line">                                            completion:nil];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  else if (options.shouldOpenAsRootViewController) &#123;</div><div class="line">    //è®¾ç½®æ ¹è§†å›¾</div><div class="line">    [self.navigationController setViewControllers:@[controller] animated:animated];</div><div class="line">  &#125;</div><div class="line">  else &#123;</div><div class="line">    //ç›´æ¥ push ä¸€ä¸ª UIViewController</div><div class="line">    [self.navigationController pushViewController:controller animated:animated];</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;è·å–è·¯ç”±è·³è½¬ç›¸å…³çš„å‚æ•°æ–¹æ³•ï¼ˆåˆ é™¤äº†ä¸€äº›å®¹é”™å¤„ç†çš„ä»£ç ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">- (RouterParams *)routerParamsForUrl:(NSString *)url extraParams: (NSDictionary *)extraParams &#123;</div><div class="line">  //å¦‚æœç¼“å­˜ä¸­å·²ç»æœ‰äº†ï¼ˆè¯æ˜ä¹‹å‰å·²ç»è·³è½¬è¿‡è¿™ä¸ª VCï¼‰ï¼Œå¹¶ä¸”ä¼ é€’çš„å‚æ•°æ²¡æœ‰å˜åŒ–ã€‚</div><div class="line">  //è¿™é‡Œéœ€è¦æ³¨æ„äº†ï¼Œå¦‚æœä¼ é€’çš„å‚æ•°ä½ ä¹Ÿä¸ç¡®å®šæ˜¯ä¸æ˜¯æ²¡å˜åŒ–ï¼Œæœ€å¥½ç»™ extraParams ç»™ä¸ªå€¼ï¼Œè¿™æ ·å°±ä¸ä¼šèµ°ç¼“å­˜äº†</div><div class="line">  //å¦åˆ™å¯èƒ½ä¼ é€’çš„æ•°æ®å˜äº†ï¼Œä½†æ˜¯èµ°çš„è¿˜æ˜¯ä¹‹å‰çš„ç¼“å­˜ã€‚</div><div class="line">  //å¦‚æœ VC ä¹‹é—´ä¸è¦ä¼ é€’æ•°æ®ï¼Œä¸ç”¨è€ƒè™‘è¿™ä¸ªé—®é¢˜</div><div class="line">  if ([self.cachedRoutes objectForKey:url] &amp;&amp; !extraParams) &#123;</div><div class="line">    return [self.cachedRoutes objectForKey:url];</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  NSArray *givenParts = url.pathComponents;</div><div class="line">  NSArray *legacyParts = [url componentsSeparatedByString:@&quot;/&quot;];</div><div class="line">  //è¿™é‡Œåˆ¤æ–­ä¼ å…¥çš„è·¯ç”±è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¼ å…¥è¿™æ ·çš„ &quot;iOS/app//first&quot; è·¯å¾„ï¼Œåˆ™ä¼šè­¦å‘Šã€‚</div><div class="line">  //ä¹Ÿè®¸ä½ çš„è·¯ç”±è·¯å¾„æ˜¯&quot;iOS/app&quot;ï¼Œè¿™æ ·å†™ä½ å°±å°‘ä¼ äº†ä¸€ä¸ªå®å‚</div><div class="line">  if ([legacyParts count] != [givenParts count]) &#123;</div><div class="line">    NSLog(@&quot;Routable Warning - your URL %@ has empty path components - this will throw an error in an upcoming release&quot;, url);</div><div class="line">    givenParts = legacyParts;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  //ä½¿ç”¨æšä¸¾çš„æ–¹å¼å»åŒ¹é…ï¼Œè¿™é‡Œä¸èƒ½ä» self.routes ä¸­é€šè¿‡ [self.routes objectForKey:@&quot;key&quot;] çš„æ–¹å¼è·å–ï¼Œ</div><div class="line">  //å› ä¸ºæ³¨å†Œçš„æ—¶å€™ï¼Œä½ åé¢æ·»åŠ çš„æ˜¯å‚æ•°ï¼ˆå½¢å‚ï¼‰ï¼Œåœ¨è·³è½¬çš„æ—¶å€™ä¼ é€’çš„æ˜¯æ•°æ®ï¼ˆå®å‚ï¼‰ã€‚</div><div class="line">  //è¿™é‡Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜çš„åŸå› äº†ï¼Œæ¯æ¬¡è·³è½¬éƒ½è¦æšä¸¾è¿™ä¸ªå­—å…¸ï¼Œç¼“å­˜äº†ä»¥åæ—¶é—´å¤æ‚åº¦ç›´æ¥é™åˆ°äº† O(1)ã€‚</div><div class="line">  __block RouterParams *openParams = nil;</div><div class="line">  [self.routes enumerateKeysAndObjectsUsingBlock:</div><div class="line">   ^(NSString *routerUrl, UPRouterOptions *routerOptions, BOOL *stop) &#123;</div><div class="line">     //routerUrl æ˜¯æšä¸¾åˆ°çš„ keyï¼Œä¹Ÿæ˜¯å½“æ—¶æ³¨å†Œè·¯ç”±æ—¶æ·»åŠ è¿›å»çš„ urlï¼ŒrouterOptions æ˜¯æšä¸¾åˆ°çš„ value</div><div class="line"></div><div class="line">     NSArray *routerParts = [routerUrl pathComponents];</div><div class="line">     //åˆ¤æ–­æ³¨å†Œçš„è·¯ç”±åœ°å€å’Œè·³è½¬çš„å¸¦å‚æ•°çš„åœ°å€æ˜¯å¦ä¸€è‡´ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯åˆ¤æ–­ä»–ä»¬åŒ…å«çš„å…ƒç´ ä¸ªæ•°æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œå†åšæ›´è¯¦ç»†çš„åˆ¤æ–­</div><div class="line">     if ([routerParts count] == [givenParts count]) &#123;</div><div class="line">       //å¦‚æœä¸ªæ•°ä¸€è‡´ï¼Œå†åˆ¤æ–­æ˜¯å¦åŒ¹é…</div><div class="line">       NSDictionary *givenParams = [self paramsForUrlComponents:givenParts routerUrlComponents:routerParts];</div><div class="line">       if (givenParams) &#123;</div><div class="line">         //givenParams å­˜å‚¨çš„æ˜¯è·¯ç”±åœ°å€ä¸­ç»™çš„æ•°æ®ï¼Œå†å°† extraParams ä¸€èµ·ä¼ å…¥ RouterParamsï¼Œåˆ›å»º RouterParams çš„å¯¹è±¡ã€‚</div><div class="line">         openParams = [[RouterParams alloc] initWithRouterOptions:routerOptions openParams:givenParams extraParams: extraParams];</div><div class="line">         *stop = YES;//ç»“æŸéå†</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;];</div><div class="line">  </div><div class="line">  //å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°è·¯ç”±</div><div class="line">  if (!openParams) &#123;</div><div class="line">    //ç”¨æˆ·è®¾ç½®äº†å¿½ç•¥å¼‚å¸¸ï¼Œç›´æ¥è¿”å› nilï¼Œå¦åˆ™ä¼šèµ° @throw</div><div class="line">    if (_ignoresExceptions) &#123;</div><div class="line">      return nil;</div><div class="line">    &#125;</div><div class="line">    @throw [NSException exceptionWithName:@&quot;RouteNotFoundException&quot;</div><div class="line">                                   reason:[NSString stringWithFormat:ROUTE_NOT_FOUND_FORMAT, url]</div><div class="line">                                 userInfo:nil];</div><div class="line">  &#125;</div><div class="line">  //å°†æˆ‘ä»¬è¾›è¾›è‹¦è‹¦å°è£…å¥½çš„è·¯ç”±ç›¸å…³çš„æ‰€æœ‰æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡åœ¨èµ°è¿™ä¸ª url çš„æ—¶å€™ï¼Œç›´æ¥å–ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ç¼“å­˜äº†ã€‚</div><div class="line">  //é™¤éä½ ä¼ é€’çš„å‚æ•°å˜äº†ï¼Œé‚£ä¹ˆä¸€å®šä¼ ç»™ extraParamsï¼Œç›¸å…³æ–¹æ³•æ£€æµ‹åˆ° extraParams ä¸ä¸ºç©ºï¼Œä¼šé‡æ–°ç»„è£…æ•°æ®ã€‚</div><div class="line">  [self.cachedRoutes setObject:openParams forKey:url];</div><div class="line">  return openParams;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">//åˆ¤æ–­æ³¨å†Œçš„è·¯ç”±å’Œè·³è½¬çš„è·¯ç”±æ˜¯å¦ä¸€è‡´</div><div class="line">- (NSDictionary *)paramsForUrlComponents:(NSArray *)givenUrlComponents</div><div class="line">                     routerUrlComponents:(NSArray *)routerUrlComponents &#123;</div><div class="line">  </div><div class="line">  __block NSMutableDictionary *params = [NSMutableDictionary dictionary];</div><div class="line">  [routerUrlComponents enumerateObjectsUsingBlock:</div><div class="line">   ^(NSString *routerComponent, NSUInteger idx, BOOL *stop) &#123;</div><div class="line">     </div><div class="line">     NSString *givenComponent = givenUrlComponents[idx];</div><div class="line">     //åˆ¤æ–­æ˜¯å¦æ˜¯å½¢å‚ï¼Œæ‰€ä»¥åœ¨æ³¨å†Œè·¯ç”±æ—¶ï¼Œä¸€å®šè¦æ³¨æ„ï¼Œå‚æ•°ä»¥:å¼€å§‹ï¼Œå¦åˆ™ä¼šå½“æˆè·¯å¾„å­—ç¬¦ä¸²</div><div class="line">     if ([routerComponent hasPrefix:@&quot;:&quot;]) &#123;</div><div class="line">       //å»é™¤å‚æ•°çš„:ï¼Œç„¶åå°†å‚æ•°åä½œä¸º keyï¼Œå°†å¯¹åº”çš„ givenComponent ä½œä¸ºå€¼å­˜å…¥å­—å…¸ä¸­ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨è·¯ç”±çš„æ—¶å€™ï¼Œä¼ é€’å‚æ•°ï¼ˆå®å‚ï¼‰é¡ºåºè¦ä¸€è‡´ï¼Œå¦åˆ™å‚æ•°å°±é”™ä¹±äº†</div><div class="line">       NSString *key = [routerComponent substringFromIndex:1];</div><div class="line">       [params setObject:givenComponent forKey:key];</div><div class="line">     &#125;</div><div class="line">     else if (![routerComponent isEqualToString:givenComponent]) &#123;</div><div class="line">       //åœ¨éä¼ å‚æ•°çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè·¯å¾„ä¸ä¸€è‡´ï¼Œåˆ™ç»“æŸã€‚ç»“æŸåä¼šå»è·¯ç”±è¡¨ä¸­æ‹¿ä¸‹ä¸€ä¸ªè·¯ç”±æ¥åˆ¤æ–­ã€‚</div><div class="line">       params = nil;</div><div class="line">       *stop = YES;</div><div class="line">     &#125;</div><div class="line">   &#125;];</div><div class="line">  return params;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;å°†è·¯ç”±è·³è½¬æœ€é‡è¦çš„ä¸‰ä¸ªæ–¹æ³•åˆ†æäº†ä¸€ä¸‹ï¼Œåœ¨é‡è¦çš„ä»£ç å‰éƒ½åŠ ä¸Šäº†æ³¨é‡Šã€‚æ¥ä¸‹æ¥æ€»ç»“ä¸€ä¸‹æ•´ä½“çš„æ€è·¯ã€‚</p>
<h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>&nbsp;&nbsp;æ³¨å†Œçš„æ—¶å€™ï¼Œæ¯”è¾ƒç®€å•ï¼Œå°†æˆ‘ä»¬çš„è·¯å¾„å’Œ VC ä¼ é€’è¿›å»ï¼Œä¿å­˜åœ¨å­—å…¸ä¸­å°±å¯ä»¥äº†ã€‚è·³è½¬çš„æ—¶å€™ï¼Œåšçš„åˆ¤æ–­å°±æ¯”è¾ƒå¤šã€‚é¦–å…ˆåˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰è¿™ä¸ªè·¯å¾„ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œç›´æ¥è·³è½¬ï¼Œåœ¨æ³¨é‡Šä¸­ä¹Ÿè¯¦ç»†è¯´æ˜äº†ä¸ºä»€ä¹ˆè¦ç¼“å­˜ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œåˆ™å»æšä¸¾è¿™ä¸ªè·¯ç”±å­—å…¸ï¼Œå¹¶ç»„è£…æ•°æ®ï¼Œå­˜å…¥ç¼“å­˜ä¸­ã€‚</p>
<p>&nbsp;&nbsp;ä»»ä½•æ¡†æ¶ï¼Œéƒ½ä¼šæœ‰ä¸å®Œç¾çš„åœ°æ–¹ï¼Œæ²¡é”™ï¼Œè¿™é‡Œè¦è¯´è¯´äº†ã€‚å¦‚æœéœ€è¦ç»™ä½ è·³è½¬çš„ VC ä¼ é€’æ•°æ®ï¼Œé‚£ä¹ˆéœ€è¦ä½ çš„ VC å®ç°è¿™ä¸ªæ–¹æ³•ï¼š<code>initWithRouterParams:params</code>ï¼Œé€šè¿‡<code>params</code>å»è·å–ä½ çš„å€¼ã€‚å…¶å®åœ¨è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡è·å–è¿™ä¸ª VC çš„æ‰€æœ‰å±æ€§ï¼Œåœ¨åˆ›å»ºè¿™ä¸ª VC çš„æ—¶å€™ï¼Œé€šè¿‡ KVC çš„æ–¹å¼æŠŠå€¼èµ‹ç»™è¿™ä¸ª VC çš„å±æ€§ã€‚</p>
<p>&nbsp;&nbsp;å¦ä¸€ç§å®ç°åŠæ³•æ˜¯æ‰©å±•<code>UIViewController</code>ï¼Œåœ¨è¿™é‡Œå¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@interface UIViewController (Routable)</div><div class="line"></div><div class="line">@property (nonatomic, strong) NSDictionary *params;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@implementation UIViewController (Routable)</div><div class="line"></div><div class="line">static char kAssociatedParamsObjectKey;</div><div class="line"></div><div class="line">- (void)setParams:(NSDictionary *)params&#123;</div><div class="line">    objc_setAssociatedObject(self, &amp;kAssociatedParamsObjectKey, params, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSDictionary *)params</div><div class="line">&#123;</div><div class="line">    return objc_getAssociatedObject(self, &amp;kAssociatedParamsObjectKey);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>&nbsp;&nbsp;è¿™æ ·æ¯ä¸ª<code>UIViewController</code>ä¸­å°±ä¸ç”¨å®ç°å›ºå®šçš„æ–¹æ³•äº†ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥è°ƒç”¨<code>self.params</code>å°±å¯ä»¥æ‹¿åˆ°è¿™ä¸ªå­—å…¸äº†ã€‚</p>
<h2 id="å…­ã€å»ºè®®"><a href="#å…­ã€å»ºè®®" class="headerlink" title="å…­ã€å»ºè®®"></a>å…­ã€å»ºè®®</h2><p>&nbsp;&nbsp;åœ¨<code>routable-ios</code>ä¸­ç»™å‡ºçš„æ³¨å†Œè·¯ç”±çš„æ–¹å¼æ˜¯ï¼Œä¸€ä¸ª VC ä¸€ä¸ª VC çš„æ³¨å†Œã€‚å¯ä»¥å°†éœ€è¦è·¯ç”±è·³è½¬çš„ VC é…ç½®åˆ° plist æ–‡ä»¶ä¸­ï¼Œå†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¯»å– plist æ–‡ä»¶ï¼Œå¾ªç¯æ³¨å†Œå³å¯ï¼Œåœ¨<code>application:didFinishLaunchingWithOptions:</code>æ–¹æ³•ä¸­ï¼Œè°ƒç”¨æ³¨å†Œè·¯ç”±çš„æ–¹æ³•å³å¯ã€‚</p>
<p>&nbsp;&nbsp;æˆ‘ fork äº†ä¸€ä»½ä»£ç ï¼Œå¹¶åœ¨é‡Œé¢æ·»åŠ äº†æ³¨é‡Šï¼Œæƒ³é€šè¿‡ Xcode çœ‹çš„ï¼Œå¯ä»¥ä¸‹è½½ä¸‹æ¥çœ‹ã€‚ <a href="https://github.com/chenyu1520/routable-ios" target="_blank" rel="external">ä¼ é€é—¨</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦åˆ†æ &lt;a href=&quot;https://github.com/clayallsopp/routable-ios&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;routable-ios&lt;/a&gt; æºç ï¼Œé€šè¿‡æœ¬æ–‡å¯ä»¥äº†è§£è·¯ç”±çš„åŸç†åŠä½¿ç”¨ã€‚æœ¬æ–‡åˆ†ä¸ºå…­ä¸ªéƒ¨åˆ†ï¼Œä»ä»£ç ç»“æ„åˆ°å…·ä½“çš„ç±»ä¾æ¬¡ä»‹ç»ï¼Œæ–‡ç« æœ€åä¼šç»™å‡ºåœ¨é¡¹ç›®ä¸­æ³¨å†Œè·¯ç”±å¸¸ç”¨çš„æ–¹å¼ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="chenyu" scheme="http://xgfe.github.io/categories/chenyu/"/>
    
    
      <category term="æºç " scheme="http://xgfe.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="iOS" scheme="http://xgfe.github.io/tags/iOS/"/>
    
      <category term="è·¯ç”±" scheme="http://xgfe.github.io/tags/%E8%B7%AF%E7%94%B1/"/>
    
  </entry>
  
  <entry>
    <title>iOSæºç è§£è¯»-å¯¹è±¡å…³è”å®ç°åˆ†æ</title>
    <link href="http://xgfe.github.io/2018/03/24/lixiaoqiang/ios%E4%B8%AD%E5%AF%B9%E8%B1%A1%E5%85%B3%E8%81%94%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/"/>
    <id>http://xgfe.github.io/2018/03/24/lixiaoqiang/iosä¸­å¯¹è±¡å…³è”çš„åº•å±‚å®ç°/</id>
    <published>2018-03-24T12:31:49.000Z</published>
    <updated>2018-04-04T09:05:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦åˆ†æiOSå¯¹è±¡å…³è”çš„å®ç°ã€‚<br><a id="more"></a></p>
<h3 id="ç–‘é—®"><a href="#ç–‘é—®" class="headerlink" title="ç–‘é—®"></a>ç–‘é—®</h3><p>åœ¨iOSå¼€å‘ä¸­ï¼Œç»å¸¸ä¸ºäº†å°†ä»£ç è§£è€¦æˆ–è€…åœ¨åŸæœ‰çš„ç±»çš„åŸºç¡€ä¸Šæ‰©å±•åŠŸèƒ½ï¼Œç»å¸¸ä¼šä½¿ç”¨ç±»ç›®(Catogery)ã€‚ä½†æ˜¯å¤§å®¶éƒ½çŸ¥é“åˆ†ç±»æ·»åŠ çš„å±æ€§Xcodeä¸ä¼šè‡ªåŠ¨çš„ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªä¸‹åˆ’çº¿å¼€å¤´çš„æˆå‘˜å˜é‡åŠsetå’Œgetæ–¹æ³•ï¼Œå¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç›´æ¥åœ¨å¤–é¢é€šè¿‡ç‚¹è¯­æ³•è°ƒç”¨è¿™ä¸ªå±æ€§ï¼Œè‚¯å®šå°±æŒ‚äº†ï¼Œä¼šæŠ¥â€œunrecognized selector sent to instanceâ€çš„é”™è¯¯ã€‚å‡è®¾æˆ‘ä»¬åœ¨ç±»ç›®.hä¸­æ”¾ç½®ä¸€ä¸ªå±æ€§ï¼ˆä½†æ˜¯å¹¶ä¸å£°æ˜setæ–¹æ³•å’Œgetæ–¹æ³•ï¼‰ï¼Œæˆ‘ä»¬åœ¨ç±»ç›®ä¸­.mä¸­å°è¯•æ·»åŠ è‡ªå®šä¹‰setæ–¹æ³•å’Œgetæ–¹æ³•ï¼Œæˆ‘ä»¬å‘ç°å·²ç»å¯ä»¥åƒæ­£å¸¸ç±»ä¸€æ ·è°ƒç”¨è¿™ä¸ªç±»ç›®çš„å±æ€§ï¼Œè¿™é‡Œå°±è¯´æ˜äº†@propertyå·²ç»å¸®æˆ‘ä»¬ç”³æ˜äº†setå’Œgetæ–¹æ³•ï¼Œåªæ˜¯å¹¶æ²¡æœ‰å®ç°ã€‚è¿™æ ·æˆ‘ä»¬è‡ªå·±å®ç°äº†setå’Œgetæ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰æˆå‘˜å˜é‡æ¥å­˜æ”¾æˆ‘ä»¬setçš„å€¼ï¼Œè¿™æ ·getçš„æ—¶å€™ä¹Ÿå°±æ— æ³•å–åˆ°setçš„å€¼ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚é‚£æˆ‘ä»¬çŒœæƒ³ä¸€ä¸‹è‹¹æœä¼šæ€ä¹ˆè®¾è®¡è¿™ä¸ªsetçš„å€¼å­˜å‚¨çš„æ–¹å¼ã€‚</p>
<h3 id="çŒœæƒ³"><a href="#çŒœæƒ³" class="headerlink" title="çŒœæƒ³"></a>çŒœæƒ³</h3><p>åœ¨æ²¡æœ‰çœ‹åˆ°è‹¹æœçš„å®ç°ä¹‹å‰ï¼Œæˆ‘æƒ³çš„æ˜¯å°†setçš„å€¼å­˜æ”¾åœ¨ä¸€ä¸ªå•ä¾‹ä¸‹çš„å˜é‡ä¸­ï¼Œè¿™æ ·åœ¨getçš„æ—¶å€™å»å–è¿™ä¸ªå•ä¾‹ä¸­è¢«setçš„å˜é‡ã€‚ä½†æ˜¯è¿™ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­åˆ›å»ºäº†å¾ˆå¤šç±»ç›®ï¼Œäº‹å®ä¸Šï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ç±»ç›®æ–‡ä»¶å¾ˆå¤šä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ›å»ºå•ä¾‹æ¥ä¿å­˜è¿™äº›ç±»ç›®ä¸‹çš„å±æ€§ï¼Œä¹Ÿè®¸ä¼šç”¨ä¸€ä¸ªå…¨å±€çš„å•ä¾‹ï¼Œæˆ–è€…æ˜¯æ¯ä¸ªç±»ç›®åˆ›å»ºä¸€ä¸ªå•ä¾‹æ¥å­˜å‚¨ã€‚è¿™æ˜¯æˆ‘çš„æƒ³æ³•ï¼Œé‚£æˆ‘ä»¬çœ‹çœ‹è‹¹æœçš„åšæ³•ç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚</p>
<h3 id="è‹¹æœçš„åšæ³•"><a href="#è‹¹æœçš„åšæ³•" class="headerlink" title="è‹¹æœçš„åšæ³•"></a>è‹¹æœçš„åšæ³•</h3><p>é€šè¿‡æŸ¥é˜…èµ„æ–™ï¼Œæˆ‘ä»¬çœ‹åˆ°ç»™categoryçš„åšæ³•æ˜¯åˆ©ç”¨äº†â€œ_object_set_associative_reference(id object, void *key, id value, uintptr_t policy)â€è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å°†è¦æ·»åŠ çš„å±æ€§å’Œç±»ç›®æ‰©å±•çš„å¯¹è±¡å…³è”èµ·æ¥ï¼Œæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°Objectæ˜¯éœ€è¦å…³è”çš„å¯¹è±¡ï¼Œkeyæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œvalueæ˜¯éœ€è¦æ·»åŠ çš„å±æ€§ã€‚<br>policyå¯¹åº”çš„æ˜¯æšä¸¾è¡¨ç¤ºå…³è”å¼•ç”¨çš„å­˜å‚¨ç­–ç•¥ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> OBJC_ENUM(uintptr_t, objc_AssociationPolicy) &#123;</div><div class="line">    OBJC_ASSOCIATION_ASSIGN = <span class="number">0</span>,           <span class="comment">/**&lt; Specifies a weak reference to the associated object. */</span></div><div class="line">    OBJC_ASSOCIATION_RETAIN_NONATOMIC = <span class="number">1</span>, <span class="comment">/**&lt; Specifies a strong reference to the associated object. </span></div><div class="line">                                            *   The association is not made atomically. */</div><div class="line">    OBJC_ASSOCIATION_COPY_NONATOMIC = <span class="number">3</span>,   <span class="comment">/**&lt; Specifies that the associated object is copied. </span></div><div class="line">                                            *   The association is not made atomically. */</div><div class="line">    OBJC_ASSOCIATION_RETAIN = <span class="number">01401</span>,       <span class="comment">/**&lt; Specifies a strong reference to the associated object.</span></div><div class="line">                                            *   The association is made atomically. */</div><div class="line">    OBJC_ASSOCIATION_COPY = <span class="number">01403</span>          <span class="comment">/**&lt; Specifies that the associated object is copied.</span></div><div class="line">                                            *   The association is made atomically. */</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªâ€œ_object_set_associative_referenceâ€çš„æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œè™½ç„¶æ˜¯c++çš„ä»£ç ï¼Œæˆ‘ä»¬åªè¦è®¤çœŸçš„æ²‰ä¸‹å¿ƒæ¥åˆ†æï¼Œè¿˜æ˜¯èƒ½åˆ†æå‡ºè‹¹æœè¿™ä¸ªæ–¹æ³•çš„å®ç°æ€è·¯ã€‚æ–¹æ³•æ‰€åšçš„äº‹æƒ…æˆ‘åœ¨ä»£ç ä¸­ç”¨ä¸­æ–‡æ³¨é‡Šå‡ºæ¥ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> _object_set_associative_reference(<span class="keyword">id</span> object, <span class="keyword">void</span> *key, <span class="keyword">id</span> value, uintptr_t policy) &#123;</div><div class="line">    <span class="comment">// retain the new value (if any) outside the lock.</span></div><div class="line">    ObjcAssociation old_association(<span class="number">0</span>, <span class="literal">nil</span>); <span class="comment">//æ„é€ äº†ä¸€ä¸ªè¡¨ç¤ºæ—§å€¼çš„å¯¹è±¡</span></div><div class="line">    <span class="keyword">id</span> new_value = value ? acquireValue(value, policy) : <span class="literal">nil</span>;<span class="comment">//æ ¹æ®ä¼ è¿›æ¥çš„å€¼å’Œç­–ç•¥äº§ç”Ÿä¸€ä¸ªæ–°å€¼</span></div><div class="line">    &#123;</div><div class="line">        AssociationsManager manager;<span class="comment">//è¿™æ˜¯ç®¡ç†å…³è”çš„å•ä¾‹</span></div><div class="line">        AssociationsHashMap &amp;associations(manager.associations());<span class="comment">//è¿™ä¸ªå•ä¾‹é‡Œé¢æœ‰ä¸€ä¸ªhashmap</span></div><div class="line">        disguised_ptr_t disguised_object = DISGUISE(object);<span class="comment">//DISGUISEæ˜¯ä¸€ä¸ªå°†å¯¹è±¡æŒ‡é’ˆè½¬å˜çš„å®ï¼Œè¿™é‡Œæš‚ä¸”å°†disguised_objectçœ‹åšæ˜¯ä¼ è¿›æ¥çš„å¯¹è±¡ç»è¿‡è½¬æ¢äº§ç”Ÿçš„ä¸€ä¸ªæ–°å¯¹è±¡</span></div><div class="line">        <span class="keyword">if</span> (new_value) &#123;<span class="comment">//å¦‚æœè¿™ä¸ªä¼ è¿›æ¥çš„å€¼å­˜åœ¨</span></div><div class="line">            <span class="comment">// break any existing association.</span></div><div class="line">            AssociationsHashMap::iterator i = associations.find(disguised_object);<span class="comment">//éå†å•ä¾‹ä¸­hashmapæ ¹æ®disguised_object å»æ‰¾AssociationsHashMapç±»å‹çš„hashmapã€‚ç”±æ­¤å¯è§ï¼Œassociationsä¸­å­˜å‚¨ç€ä»¥disguised_objectä¸ºkeyçš„å¤šä¸ªhashmap</span></div><div class="line">            <span class="keyword">if</span> (i != associations.end()) &#123;<span class="comment">//è¡¨ç¤ºæ‰¾åˆ°äº†ä»¥ä¼ è¿›æ¥çš„ä»¥disguised_objectä¸ºkeyçš„hashmapï¼Œä¸‹é¢å°±æ˜¯åœ¨æ‰¾åˆ°çš„hashmapä¸­æ‰¾ä»¥ä¼ è¿›æ¥çš„keyä¸ºkeyçš„é”®å€¼å¯¹.</span></div><div class="line">                <span class="comment">// secondary table exists</span></div><div class="line">                ObjectAssociationMap *refs = i-&gt;second;</div><div class="line">                ObjectAssociationMap::iterator j = refs-&gt;find(key);</div><div class="line">                <span class="keyword">if</span> (j != refs-&gt;end()) &#123;<span class="comment">//æ‰¾åˆ°äº†è·Ÿä¼ è¿›æ¥çš„keyç›¸åŒçš„é”®å€¼å¯¹ï¼Œå°†åŸæ¥çš„é”®å€¼å¾—å€¼èµ‹å€¼ç»™åˆšå¼€å§‹åˆå§‹åŒ–çš„old_associationï¼Œç„¶åå°†æ–°å€¼èµ‹å€¼ç»™åŸæ¥çš„é”®å€¼å¯¹ã€‚</span></div><div class="line">                    old_association = j-&gt;second;</div><div class="line">                    j-&gt;second = ObjcAssociation(policy, new_value);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;<span class="comment">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒçš„keyï¼Œåˆ™ç›´æ¥å…³è”åˆ°éå†å¾—åˆ°çš„hashmapä¸Š</span></div><div class="line">                    (*refs)[key] = ObjcAssociation(policy, new_value);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;<span class="comment">//å¦‚æœæ‰¾ä¸åˆ°ä»¥disguised_objectä¸ºkeyçš„hashmapï¼Œåˆ™åˆ›å»ºæ–°çš„hashmapç»™å¤§çš„associations</span></div><div class="line">                <span class="comment">// create the new association (first time).</span></div><div class="line">                ObjectAssociationMap *refs = new ObjectAssociationMap;</div><div class="line">                associations[disguised_object] = refs;</div><div class="line">                (*refs)[key] = ObjcAssociation(policy, new_value);</div><div class="line">                object-&gt;setHasAssociatedObjects();</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//å¦‚æœæ–°å€¼ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ ¹æ®ä¼ è¿›æ¥çš„keyæŠ¹å»åŸæ¥çš„åœ¨hashmapä¸­çš„ä»¥keyå¯¹åº”çš„é”®å€¼å¯¹</span></div><div class="line">            <span class="comment">// setting the association to nil breaks the association.</span></div><div class="line">            AssociationsHashMap::iterator i = associations.find(disguised_object);</div><div class="line">            <span class="keyword">if</span> (i !=  associations.end()) &#123;</div><div class="line">                ObjectAssociationMap *refs = i-&gt;second;</div><div class="line">                ObjectAssociationMap::iterator j = refs-&gt;find(key);</div><div class="line">                <span class="keyword">if</span> (j != refs-&gt;end()) &#123;</div><div class="line">                    old_association = j-&gt;second;</div><div class="line">                    refs-&gt;erase(j);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// release the old value (outside of the lock).</span></div><div class="line">    <span class="keyword">if</span> (old_association.hasValue()) ReleaseValue()(old_association)<span class="comment">//æ ¹æ®å…¶åŸæœ¬ç»‘å®šçš„ç­–ç•¥ï¼Œå¯¹åˆ æ‰çš„å€¼åšä¸€äº›å–„åå¤„ç†</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»è¿‡æºç åˆ†ææˆ‘ä»¬çŸ¥é“äº†è‹¹æœæ˜¯æ€ä¹ˆå…³è”çš„å±æ€§çš„åº•å±‚çš„å®ç°ï¼Œé‚£ä¹ˆè¦å–å‡ºæ¥å­˜è¿›å»çš„å±æ€§é‚£å°±ç®€å•äº†ï¼Œå°±æ˜¯æ ¹æ®keyå’Œobjectå¯¹è±¡è¿›è¡Œéå†ï¼Œæˆ‘ä»¬çœ‹çœ‹objc_getAssociatedObject(id _Nonnull object, const void * _Nonnull key)çš„åº•å±‚å®ç°:  </p>
<pre><code class="objc"><span class="keyword">id</span> _object_get_associative_reference(<span class="keyword">id</span> object, <span class="keyword">void</span> *key) {
    <span class="keyword">id</span> value = <span class="literal">nil</span>;
    uintptr_t policy = OBJC_ASSOCIATION_ASSIGN;
    {
        AssociationsManager manager;
        AssociationsHashMap &amp;associations(manager.associations());
        disguised_ptr_t disguised_object = DISGUISE(object);
        AssociationsHashMap::iterator i = associations.find(disguised_object);
        <span class="keyword">if</span> (i != associations.end()) {
            ObjectAssociationMap *refs = i-&gt;second;
            ObjectAssociationMap::iterator j = refs-&gt;find(key);
            <span class="keyword">if</span> (j != refs-&gt;end()) {
                ObjcAssociation &amp;entry = j-&gt;second;
                value = entry.value();
                policy = entry.policy();
                <span class="keyword">if</span> (policy &amp; OBJC_ASSOCIATION_GETTER_RETAIN) {
                    objc_retain(value);
                }
            }
        }
    }
    <span class="keyword">if</span> (value &amp;&amp; (policy &amp; OBJC_ASSOCIATION_GETTER_AUTORELEASE)) {
        objc_autorelease(value);
    }
    <span class="keyword">return</span> value;
}
</code></pre>
<p>æœä¸å…¶ç„¶ï¼Œè‹¹æœä¹Ÿæ˜¯æŒ‰ç…§æˆ‘ä»¬çš„çŒœæƒ³å»åšçš„è¿™ä»¶äº‹ã€‚  </p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ ¹æ®æˆ‘ä»¬çš„çŒœæƒ³ç„¶åå»åˆ†æè‹¹æœçš„æºç ï¼Œå‘ç°è‹¹æœä¸ºåˆ†ç±»çš„å±æ€§å»ºé€ äº†ä¸€ä¸ªå¤§çš„hashmapï¼Œè¿™ä¸ªå¤§çš„hashmapçš„é‡Œé¢åˆæ ¹æ®å¯¹è±¡åˆ’åˆ†äº†å¤šä¸ªå­hashmapï¼Œåˆ’åˆ†çš„ä¾ç…§objectæ¥åˆ’åˆ†ã€‚æ¯ä¸ªå­hashmapä¸­å­˜æ”¾äº†å„ä¸ªåˆ†ç±»æ·»åŠ çš„å±æ€§ã€‚æ³¨æ„ï¼šæ¯ä¸ªåˆ†ç±»çš„å±æ€§ä½¿ç”¨å¯¹è±¡å…³è”å»å…³è”å±æ€§çš„æ—¶å€™åƒä¸‡è¦ä¿è¯keyå€¼å¾—å”¯ä¸€æ€§ï¼Œå¦åˆ™ä¼šå‡ºç°åé¢çš„å­˜å‚¨è¦†ç›–æ‰å‰é¢çš„å­˜å‚¨çš„æƒ…å†µã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦åˆ†æiOSå¯¹è±¡å…³è”çš„å®ç°ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="lixiaoqiang" scheme="http://xgfe.github.io/categories/lixiaoqiang/"/>
    
    
      <category term="iOS" scheme="http://xgfe.github.io/tags/iOS/"/>
    
      <category term="Catogery" scheme="http://xgfe.github.io/tags/Catogery/"/>
    
  </entry>
  
  <entry>
    <title>Android Zxing æ‰«ç å°è£…</title>
    <link href="http://xgfe.github.io/2018/03/20/Catherine/AndroidZxing%E6%89%AB%E7%A0%81%E5%B0%81%E8%A3%85/"/>
    <id>http://xgfe.github.io/2018/03/20/Catherine/AndroidZxingæ‰«ç å°è£…/</id>
    <published>2018-03-20T02:49:30.000Z</published>
    <updated>2018-03-27T13:51:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>Zxing æ˜¯ä¸€ä¸ªå¼€æ”¾æºç çš„ï¼Œç”¨ Java å®ç°çš„å¤šç§æ ¼å¼çš„ 1D/2D æ¡ç å›¾åƒå¤„ç†åº“ï¼Œå®ƒåŒ…å«äº†è”ç³»åˆ°å…¶ä»–è¯­è¨€çš„ç«¯å£ã€‚Zxing å¯ä»¥å®ç°ä½¿ç”¨æ‰‹æœºçš„å†…ç½®çš„æ‘„åƒå¤´å®Œæˆæ¡å½¢ç çš„æ‰«æåŠè§£ç ã€‚</p>
<a id="more"></a>
<h2 id="ä¸€ã€æ¡ç ç å‹"><a href="#ä¸€ã€æ¡ç ç å‹" class="headerlink" title="ä¸€ã€æ¡ç ç å‹"></a>ä¸€ã€æ¡ç ç å‹</h2><p>Zxing ç›®å‰æ”¯æŒæ‰«æå’Œè§£æä»¥ä¸‹ç å‹ï¼š</p>
<table>
<thead>
<tr>
<th>ç å‹</th>
<th>ä¸­æ–‡å</th>
<th>ç»´åº¦</th>
<th>å­—ç¬¦ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>AZTEC</td>
<td>é˜¿å…¹ç‰¹å…‹ç </td>
<td>2D</td>
<td>ASCII</td>
</tr>
<tr>
<td>CODABAR</td>
<td>åº“å¾·å·´ç </td>
<td>1D</td>
<td>æ•°å­—ã€å­—æ¯</td>
</tr>
<tr>
<td>CODE_39</td>
<td>39ç </td>
<td>1D</td>
<td>(0-9)10ä¸ªæ•°å­—ã€â€œABCDâ€å››ä¸ªå­—æ¯å’Œâ€œ$-:/.+â€å…­ä¸ªç‰¹æ®Šå­—ç¬¦</td>
</tr>
<tr>
<td>CODE_93</td>
<td>93ç </td>
<td>1D</td>
<td>(0-9)10ä¸ªæ•°å­—ã€â€œABCDâ€å››ä¸ªå­—æ¯å’Œâ€œ$-:/.+â€å…­ä¸ªç‰¹æ®Šå­—ç¬¦</td>
</tr>
<tr>
<td>CODE_128</td>
<td>128ç </td>
<td>1D</td>
<td>ASCII</td>
</tr>
<tr>
<td>DATA_MATRIX</td>
<td>Matrix 25ç </td>
<td>2D</td>
<td>ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td>EAN_8</td>
<td>EANå•†å“ç </td>
<td>1D</td>
<td>æ•°å­—</td>
</tr>
<tr>
<td>EAN_13</td>
<td>EANå•†å“ç </td>
<td>1D</td>
<td>æ•°å­—</td>
</tr>
<tr>
<td>ITF</td>
<td>äº¤æ’25ç </td>
<td>1D</td>
<td>æ•°å­—</td>
</tr>
<tr>
<td>MAXICODE</td>
<td>UPCå¿«é€’ç </td>
<td>2D</td>
<td>ASCII</td>
</tr>
<tr>
<td>PDF_417</td>
<td>PDF417</td>
<td>2D</td>
<td>æ‰©å±•çš„å­—æ¯æ•°å­—å‹ç¼©æ ¼å¼ã€äºŒè¿›åˆ¶ ã€ASCIIã€æ•°å­—å‹ç¼©æ ¼å¼</td>
</tr>
<tr>
<td>QR_CODE</td>
<td>äºŒç»´æ¡ç </td>
<td>2D</td>
<td>ä»»æ„å­—ç¬¦</td>
</tr>
<tr>
<td>RSS_14</td>
<td>RSSç </td>
<td>1D+2D</td>
<td>æ•°å­—</td>
</tr>
<tr>
<td>RSS_EXPANDED</td>
<td>RSSç </td>
<td>1D+2D</td>
<td>æ•°å­—</td>
</tr>
<tr>
<td>UPC_A</td>
<td>UPCç¾å›½ç </td>
<td>1D</td>
<td>æ•°å­—</td>
</tr>
<tr>
<td>UPC_E</td>
<td>UPCç¾å›½ç </td>
<td>1D</td>
<td>æ•°å­—</td>
</tr>
<tr>
<td>UPC_EAN_EXTENSION</td>
<td>EAN/UPCæ··åˆç </td>
<td>1D</td>
<td>æ•°å­—</td>
</tr>
</tbody>
</table>
<p>åœ¨ <code>build.gradle</code> ä¸­å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">implementation &quot;com.google.zxing:core:$&#123;zxingCoreVer&#125;&quot;</div><div class="line">implementation &quot;com.google.zxing:android-core:$&#123;zxingAndroidVer&#125;&quot;</div><div class="line">implementation &quot;com.google.zxing:android-integration:$&#123;zxingAndroidVer&#125;&quot;</div></pre></td></tr></table></figure>
<p>å¼•å…¥ä¾èµ–åå³å¯ä½¿ç”¨ Zxing çš„è§£ç åº“ï¼Œå¯¹æ¡å½¢ç æˆ–äºŒç»´ç è¿›è¡Œè§£æï¼Œä½†æ˜¯éœ€è¦å°è£…æ‰«ç ç•Œé¢ã€å–å›¾æµç¨‹å’Œè§£æåçš„æ•°æ®è¿”å›ï¼Œæ‰èƒ½æ–¹ä¾¿ Android åº”ç”¨ä¸­ä½¿ç”¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°è£…äº†æ•´ä¸ªæ‰«ç å’Œè§£æçš„ç»„ä»¶åº“ï¼Œä½¿å¾— Android åº”ç”¨ä¸­ä»…éœ€å…³æ³¨å¸ƒå±€çš„æ„å»ºã€‚</p>
<h2 id="äºŒã€CaptureActivity-ç•Œé¢éƒ¨åˆ†å°è£…"><a href="#äºŒã€CaptureActivity-ç•Œé¢éƒ¨åˆ†å°è£…" class="headerlink" title="äºŒã€CaptureActivity ç•Œé¢éƒ¨åˆ†å°è£…"></a>äºŒã€CaptureActivity ç•Œé¢éƒ¨åˆ†å°è£…</h2><p><code>CaptureActivity</code> æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç»§æ‰¿äº <code>AppCompatActivity</code> ï¼Œè¿™ä¸ªActivityä¸åŒ…å«ç•Œé¢ï¼Œæ‰€ä»¥å…¶å­ç±»éœ€è¦åœ¨ <code>onCreate()</code> ä¸­è®¾ç½®å¸ƒå±€ã€‚</p>
<p><code>CaptureActivity</code> ä¸­æœ‰å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼š</p>
<ul>
<li>boolean getResult(Result, byte[]) : æ¯æ¬¡æ‰«ç ç»“æŸåä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå®ç°ç±»å¯ä»¥ä»å‚æ•°ä¸­è·å–æ‰«ç ç»“æœï¼›</li>
<li>SurfaceView getScanPreview() : å­ç±» Activity éœ€è¦è‡ªå®šä¹‰å¸ƒå±€ï¼Œå¯å®ç°æ­¤æ–¹æ³•ï¼Œè¿”å›è‡ªå®šä¹‰å¸ƒå±€ä¸­çš„ <code>SurfaceView</code> å¯¹è±¡ï¼›</li>
<li>View getCropView() : è¿”å›å­ç±»è‡ªå®šä¹‰å¸ƒå±€ä¸­çš„æ‰«ç æ¡† Viewï¼Œç”¨äºè£å‰ªå–å›¾å›¾ç‰‡ã€‚</li>
</ul>
<p><code>CaptureActivity</code> ä¸­å°è£…äº†æ‰«ç çš„æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>æ‘„åƒå¤´é¢„è§ˆï¼šé€šè¿‡ <code>SurfaceView</code> å’Œ <code>Camera</code> çš„åˆå§‹åŒ–ï¼Œåœ¨ç•Œé¢ä¸­æ˜¾ç¤ºæ‘„åƒå¤´çš„é¢„è§ˆç”»é¢ï¼›</li>
<li>è‡ªåŠ¨å–å›¾ï¼šé€šè¿‡å®šæ—¶è·å– <code>SurfaceView</code> é¢„è§ˆå›¾ç‰‡çš„æ–¹å¼ï¼Œå¾—åˆ°é¢„è§ˆå›¾çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç„¶åè£å‰ªå‡ºæ‰«ç æ¡†ä¸­éƒ¨åˆ†ï¼›</li>
<li>è§£æï¼šé€šè¿‡ Zxing Core è§£æå›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œè·å–è§£æç»“æœï¼›</li>
<li>å°è£…è§£æç»“æœï¼šç»“æœåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªå›¾ç‰‡äºŒè¿›åˆ¶æ•°ç»„ã€æ¡ç ä½ç½®æ•°ç»„ï¼Œå°è£…ä¸º <code>Result</code> å¯¹è±¡ï¼›</li>
<li>ç•Œé¢æ¥æ”¶ç»“æœï¼šé€šè¿‡æŠ½è±¡æ–¹æ³• <code>boolean getResult(Result, byte[])</code> ï¼Œå°†ç»“æœè¿”å›ç»™å­ç±» Activity ã€‚</li>
</ol>
<p>å¦å¤–ï¼Œæ­¤æŠ½è±¡ç±»ä¸­è¿˜å°è£…äº†æ‰«ç ç•Œé¢ä¸­å¸¸ç”¨é—ªå…‰ç¯å¼€å…³æ–¹æ³•ï¼Œå¹¶ä¸”å°è£…äº†é€‚é… Android 6.0 çš„åŠ¨æ€æƒé™ç”³è¯·ã€‚</p>
<h3 id="2-1-æ‘„åƒå¤´é¢„è§ˆ"><a href="#2-1-æ‘„åƒå¤´é¢„è§ˆ" class="headerlink" title="2.1 æ‘„åƒå¤´é¢„è§ˆ"></a>2.1 æ‘„åƒå¤´é¢„è§ˆ</h3><p>ä¸ºäº†åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆç”»é¢ï¼Œéœ€è¦å­ç±» Activity æä¾›å¸ƒå±€ä¸­çš„ <code>SurfaceView</code> å¯¹è±¡ï¼Œå³å¯åœ¨ Activity ç”Ÿå‘½å‘¨æœŸä¸­å¤„ç†å…¶åˆå§‹åŒ–å’Œé”€æ¯ï¼š</p>
<ul>
<li>å®Œæˆ <code>SurfaceView</code> çš„åˆå§‹åŒ–åï¼Œæ‰“å¼€ <code>Camera</code> è·å–æ‘„åƒå¤´æ•°æ®æ˜¾ç¤ºé¢„è§ˆç”»é¢ï¼›</li>
<li>åœ¨ Activity æš‚åœæ—¶ï¼Œåœæ­¢é¢„è§ˆï¼Œé‡Šæ”¾ <code>Camera</code> èµ„æºï¼›</li>
<li>åœ¨ Activity é‡æ–°æ˜¾ç¤ºæ—¶ï¼Œé‡æ–°åˆå§‹åŒ–ã€‚</li>
</ul>
<h3 id="2-2-è‡ªåŠ¨å–å›¾"><a href="#2-2-è‡ªåŠ¨å–å›¾" class="headerlink" title="2.2 è‡ªåŠ¨å–å›¾"></a>2.2 è‡ªåŠ¨å–å›¾</h3><p>å–å›¾ï¼Œå³è·å– <code>SurfaceView</code> é¢„è§ˆç”»é¢çš„ä¸€å¸§å›¾ç‰‡ã€‚ä¸º <code>SurfaceView</code> è®¾ç½®å–å›¾å›è°ƒï¼Œå³å¯åœ¨è¯·æ±‚å–å›¾åï¼Œè·å–åˆ°æ­¤åˆ»ä¸€å¸§å›¾åƒçš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
<p>è‡ªåŠ¨å–å›¾çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼š</p>
<ol>
<li>è‡ªåŠ¨å¯¹ç„¦æ–¹å¼ï¼Œå¯åŠ¨æ‘„åƒå¤´çš„è‡ªåŠ¨å¯¹ç„¦åŠŸèƒ½ï¼Œåœ¨æ¯æ¬¡å¯¹ç„¦æˆåŠŸçš„å›è°ƒä¸­æ‰§è¡Œå–å›¾ã€‚è¿™ç§å–å›¾æ–¹å¼ä¾èµ–è‡ªåŠ¨å¯¹ç„¦ï¼Œåœ¨æç«¯æƒ…å†µä¸‹å¯èƒ½æ— æ³•å¯¹ç„¦ï¼Œæˆ–è€…å¯¹ç„¦æ—¶é—´è¾ƒé•¿ï¼Œé€ æˆæ‰«ç é€Ÿåº¦é™ä½ã€‚</li>
<li>å®šæ—¶å–å›¾æ–¹å¼ï¼Œéœ€è¦å¼€å¯å®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€å®šæ—¶é—´è¯·æ±‚å–å›¾æ–¹æ³•ã€‚è¿™ç§å–å›¾æ–¹æ³•çš„å–å›¾é—´éš”æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥æé«˜å–å›¾é€Ÿåº¦ï¼Œä½†æ˜¯åœ¨è§£æé€Ÿåº¦è¾ƒæ…¢çš„æ‰‹æœºä¸Šå¯èƒ½å‡ºç°è§£ææœªå®Œæˆè€Œå†æ¬¡å–å›¾çš„æƒ…å†µï¼Œé€ æˆæ··ä¹±ã€‚</li>
<li>çº¿æ€§å–å›¾æ–¹å¼ï¼Œå³å®Œæˆâ€œå–å›¾â€”â€”è§£æâ€”â€”å–å›¾â€çš„çº¿æ€§æ“ä½œï¼Œå–å›¾å’Œè§£æéƒ½æ˜¯ç”±æˆ‘ä»¬è‡ªå·±çš„ä»£ç è¯·æ±‚çš„ï¼Œè¿™æ ·å¯ä»¥å®Œå…¨æ§åˆ¶æ•´ä¸ªæ“ä½œæµç¨‹ï¼Œé¿å…äº†å®šæ—¶å–å›¾çš„å¼Šç«¯ï¼›å› ä¸ºä¸éœ€è¦åœ¨å®Œæˆå¯¹ç„¦åå†å–å›¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶å»¶è¿Ÿæ—¶é—´æ§åˆ¶å–å›¾é€Ÿåº¦ã€‚</li>
</ol>
<p>å»ºè®®ä½¿ç”¨çº¿æ€§å–å›¾æ–¹å¼ï¼Œä»¥å®Œå…¨æ§åˆ¶å–å›¾é€Ÿåº¦å’Œå–å›¾è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥åœ¨å­ç±» Activity è·å–åˆ°ç»“æœåï¼Œè‡ªç”±æ§åˆ¶ç»§ç»­å–å›¾æˆ–æš‚åœå–å›¾ã€‚</p>
<h3 id="2-3-è§£æå›¾ç‰‡"><a href="#2-3-è§£æå›¾ç‰‡" class="headerlink" title="2.3 è§£æå›¾ç‰‡"></a>2.3 è§£æå›¾ç‰‡</h3><p>è§£æå–å›¾æ•°æ®çš„è¿‡ç¨‹ç”± zxing:core åº“å®Œæˆã€‚</p>
<p>å…·ä½“è§£æåŸç†ä»£ç è¾ƒå¤šï¼Œæ­¤å¤„ä¸è¯¦è¿°ï¼Œä»£ç åœ¨ <code>com.google.zxing.MultiFormatReader</code> ä¸­ã€‚</p>
<h3 id="2-4-ç»“æœå°è£…"><a href="#2-4-ç»“æœå°è£…" class="headerlink" title="2.4 ç»“æœå°è£…"></a>2.4 ç»“æœå°è£…</h3><p><code>com.google.zxing.Result</code> ç±»ä¸­å®šä¹‰äº†æ‰«ç ç»“æœã€‚</p>
<ul>
<li>String text: å³ä¸Šä¸€æ­¥è§£æå‡ºæ¥çš„å­—ç¬¦ä¸²ï¼›</li>
<li>byte[] rawBytes: å›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ®ï¼›</li>
<li>ResultPoint[] resultPoints: ä¸€ä¸ªæˆ–å¤šä¸ªå…³é”®ç‚¹ï¼Œå¯ä»¥ç”¨äºåœ¨ç•Œé¢ä¸­æ ‡å‡ºæ¡ç ä½ç½®ï¼›</li>
<li>BarcodeFormat format: æ¡ç çš„ç å‹ï¼›</li>
<li>long timestamp: æ—¶é—´æˆ³ã€‚</li>
</ul>
<p>ä»¥ä¸Šæ•°æ®ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è·å–æ‰«ç ç»“æœå’Œå±•ç¤ºå‹å¥½çš„ç•Œé¢ã€‚</p>
<h2 id="ä¸‰ã€é¢„è§ˆå’Œæ‘„åƒå¤´"><a href="#ä¸‰ã€é¢„è§ˆå’Œæ‘„åƒå¤´" class="headerlink" title="ä¸‰ã€é¢„è§ˆå’Œæ‘„åƒå¤´"></a>ä¸‰ã€é¢„è§ˆå’Œæ‘„åƒå¤´</h2><p>æˆ‘ä»¬å°†æ‘„åƒå¤´é¢„è§ˆç›¸å…³çš„æ“ä½œï¼Œå°è£…åœ¨ <code>camera</code> åŒ…ä¸­ï¼Œå…³é”®ç±»æœ‰ï¼š</p>
<ul>
<li>CameraManagerï¼šæ§åˆ¶æ‘„åƒå¤´çš„å¼€å¯å’Œå…³é—­ï¼›</li>
<li>CameraConfigurationManagerï¼šè®¾ç½®æ‘„åƒå¤´å’Œé¢„è§ˆçš„å‚æ•°ï¼›</li>
<li>AutoFocusManagerï¼šæ§åˆ¶æ‘„åƒå¤´çš„è‡ªåŠ¨å¯¹ç„¦ã€‚</li>
</ul>
<h2 id="å››ã€å›¾ç‰‡è§£æ"><a href="#å››ã€å›¾ç‰‡è§£æ" class="headerlink" title="å››ã€å›¾ç‰‡è§£æ"></a>å››ã€å›¾ç‰‡è§£æ</h2><p>æˆ‘ä»¬å°†å›¾ç‰‡è§£æç›¸å…³çš„æ“ä½œï¼Œå°è£…åœ¨ <code>decode</code> åŒ…ä¸­ï¼Œå…³é”®ç±»æœ‰ï¼š</p>
<ul>
<li>DecodeHandler: ä»æ‘„åƒå¤´è·å–çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®æ˜¯ YUV æ ¼å¼ï¼Œæˆ‘ä»¬åœ¨æ­¤ç±»ä¸­å°†å…¶è½¬æ¢ä¸º <code>Bitmap</code> ï¼Œç„¶åå‘é€åˆ° zxing:core åº“è§£æï¼›</li>
<li>DecodeThread: è§£æå›¾ç‰‡æ˜¯è€—æ—¶æ“ä½œï¼Œæ‰€ä»¥éœ€è¦åœ¨é UI çº¿ç¨‹ä¸­è¿›è¡Œã€‚</li>
</ul>
<p>åœ¨ <code>DecodeThread</code> ç±»ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¤šç§ç å‹ç»„åˆï¼Œä¾‹å¦‚æ‰€æœ‰æ¡å½¢ç ã€æ¡å½¢ç ä¸äºŒç»´ç ã€CODE128ä¸äºŒç»´ç ç­‰ï¼Œä»¥æ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯ã€‚åœ¨ <code>CaptureActivity</code> ä¸­å®šä¹‰äº†æ–¹æ³• <code>int getBarcodeMode()</code>ï¼Œå¯ä»¥åœ¨å­ç±»ä¸­é‡å†™ï¼Œå³å¯å®šä¹‰åº”ç”¨éœ€è¦çš„ç å‹ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ”¯æŒçš„ç å‹æ•°é‡è¶Šå¤šï¼Œè§£æé€Ÿåº¦è¶Šæ…¢ï¼›äºŒç»´ç çš„è§£æé€Ÿåº¦å¤§å¤§æ…¢äºä¸€ç»´ç çš„è§£æé€Ÿåº¦ã€‚</p>
</blockquote>
<h2 id="äº”ã€App-ä¸­å®ç°æ‰«ç ç•Œé¢"><a href="#äº”ã€App-ä¸­å®ç°æ‰«ç ç•Œé¢" class="headerlink" title="äº”ã€App ä¸­å®ç°æ‰«ç ç•Œé¢"></a>äº”ã€App ä¸­å®ç°æ‰«ç ç•Œé¢</h2><p>åœ¨ä¾èµ–ä»¥ä¸Šç»„ä»¶åº“åï¼Œå³å¯å¿«é€Ÿå®ç°æ‰«ç åŠŸèƒ½ï¼Œåœ¨ App å¼€å‘ä¸­ä»…éœ€è‡ªå®šä¹‰ç•Œé¢å³å¯ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆç»§æ‰¿ <code>CaptureActivity</code> ï¼Œåˆ›å»º <code>MyScanActivity</code> å’Œå¸ƒå±€æ–‡ä»¶ <code>activity_my_scan.xml</code></p>
<p>MyScanActivity.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyScanActivity</span> <span class="keyword">extends</span> <span class="title">CaptureActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> SurfaceView mPreviewSv;</div><div class="line">    <span class="keyword">private</span> View mCropView;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_my_scan);</div><div class="line">        mPreviewSv = findViewById(R.id.scan_preview);</div><div class="line">        mCropView = findViewById(R.id.scan_crop);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * è·å–æ‰«ç ç»“æœ</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> result æ‰«ç ç»“æœ</div><div class="line">     * <span class="doctag">@param</span> bytes  å›¾ç‰‡äºŒè¿›åˆ¶æ•°ç»„</div><div class="line">     * <span class="doctag">@return</span> true - ç»§ç»­æ‰«æï¼›false - æš‚åœæ‰«æ</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">getResult</span><span class="params">(Result result, <span class="keyword">byte</span>[] bytes)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (result == <span class="keyword">null</span> || TextUtils.isEmpty(result.getText()))</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> SurfaceView <span class="title">getScanPreview</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mPreviewSv;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@NonNull</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> View <span class="title">getCropView</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mCropView;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>activity_my_scan.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">SurfaceView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/scan_preview"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">View</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/scan_crop"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"#33ffffff"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>ä»¥ä¸Šä»…ä»…æ˜¯å®ç°æ‰«ç ç•Œé¢çš„æœ€ç®€å•ä»£ç ï¼Œå¦‚æœéœ€è¦æ›´å¥½çš„ç•Œé¢æ•ˆæœï¼Œè¿˜éœ€è¦ä¿®æ”¹å¸ƒå±€å’Œè·å–ç»“æœåçš„é€»è¾‘ã€‚</p>
</blockquote>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¿«é€Ÿå®ç°äº†æ‰«ç é¡µé¢çš„åŠŸèƒ½ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Zxing æ˜¯ä¸€ä¸ªå¼€æ”¾æºç çš„ï¼Œç”¨ Java å®ç°çš„å¤šç§æ ¼å¼çš„ 1D/2D æ¡ç å›¾åƒå¤„ç†åº“ï¼Œå®ƒåŒ…å«äº†è”ç³»åˆ°å…¶ä»–è¯­è¨€çš„ç«¯å£ã€‚Zxing å¯ä»¥å®ç°ä½¿ç”¨æ‰‹æœºçš„å†…ç½®çš„æ‘„åƒå¤´å®Œæˆæ¡å½¢ç çš„æ‰«æåŠè§£ç ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Catherine" scheme="http://xgfe.github.io/categories/Catherine/"/>
    
    
      <category term="Android" scheme="http://xgfe.github.io/tags/Android/"/>
    
      <category term="Zxing" scheme="http://xgfe.github.io/tags/Zxing/"/>
    
  </entry>
  
  <entry>
    <title>å®ç°ä¸€ä¸ªReact ç»„ä»¶</title>
    <link href="http://xgfe.github.io/2018/03/04/zhouyinian/React-component/"/>
    <id>http://xgfe.github.io/2018/03/04/zhouyinian/React-component/</id>
    <published>2018-03-04T06:00:00.000Z</published>
    <updated>2018-03-20T03:07:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç®€å•ä»‹ç»äº†å¦‚ä½•åœ¨Reactä¸­ç¼–å†™ç»„ä»¶ã€‚<br><a id="more"></a></p>
<h3 id="é¡¹ç›®çš„æ­å»º"><a href="#é¡¹ç›®çš„æ­å»º" class="headerlink" title="é¡¹ç›®çš„æ­å»º"></a>é¡¹ç›®çš„æ­å»º</h3><p>ä¸ºäº†åŠ å¿«æ¼”ç¤ºï¼Œç”¨react-create-appå¿«é€Ÿæ­å»ºé¡¹ç›®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g create-react-app</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create-react-app react-learn-component</div><div class="line">cd react-learn-component</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm run start</div></pre></td></tr></table></figure>
<p>æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€å¦‚ä¸‹é¡µé¢</p>
<p><img src="//ww1.sinaimg.cn/large/933205a1ly1fp01hatymlj20y60hg75l.jpg"></p>
<p>æ›´å¤šå…³äºreact-create-appä»‹ç»ï¼š<a href="//github.com/facebook/create-react-app">ä¼ é€é—¨</a></p>
<h3 id="ç»„ä»¶çš„ä»‹ç»"><a href="#ç»„ä»¶çš„ä»‹ç»" class="headerlink" title="ç»„ä»¶çš„ä»‹ç»"></a>ç»„ä»¶çš„ä»‹ç»</h3><blockquote>
<p>Components let you split the UI into independent, reusable pieces, and think about each piece in isolation.</p>
</blockquote>
<p>ç»„ä»¶å¯ä»¥è®©ä½ æŠŠUIåˆ‡åˆ†æˆç‹¬ç«‹çš„ã€å¯å¤ç”¨çš„å—å»å•ç‹¬çš„è€ƒè™‘å’Œå¼€å‘ã€‚</p>
<h3 id="Reactä¸­ç»„ä»¶çš„åˆ†ç±»"><a href="#Reactä¸­ç»„ä»¶çš„åˆ†ç±»" class="headerlink" title="Reactä¸­ç»„ä»¶çš„åˆ†ç±»"></a>Reactä¸­ç»„ä»¶çš„åˆ†ç±»</h3><h4 id="å±•ç¤ºå‹ç»„ä»¶ï¼ˆpresentationalï¼‰"><a href="#å±•ç¤ºå‹ç»„ä»¶ï¼ˆpresentationalï¼‰" class="headerlink" title="å±•ç¤ºå‹ç»„ä»¶ï¼ˆpresentationalï¼‰"></a>å±•ç¤ºå‹ç»„ä»¶ï¼ˆpresentationalï¼‰</h4><p>å±•ç¤ºå‹ç»„ä»¶æ˜¯ç”¨æ¥å±•ç¤ºæ ·å¼çš„ï¼Œä»–ä»¬å¯¹åº”ç”¨çš„å…¶ä½™éƒ¨åˆ†æ²¡æœ‰ä¾èµ–æ€§ï¼Œä¼šé€šè¿‡propsæ˜ç¡®åœ°æ¥æ”¶æ•°æ®ï¼Œå¯ä»¥å†™æˆå‡½æ•°çš„å½¢å¼ã€‚å¦‚ä¸‹çš„BlogListç»„ä»¶åªæ˜¯æ¥æ”¶ä¸€ä¸ª<code>bolglist</code>æ•°ç»„ï¼Œä¾¿èƒ½å±•ç¤ºåšå®¢åˆ—è¡¨ï¼Œç›¸åŒçš„è¾“å…¥ä¼šæœ‰ç›¸åŒçš„è¾“å‡ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">import React from &quot;react&quot;;</div><div class="line">export const BlogList = bloglist =&gt; (  </div><div class="line">    &lt;ul&gt;</div><div class="line">        &#123;</div><div class="line">            bloglist.map((&#123; body,author,id &#125;) =&gt;      </div><div class="line">                &lt;li key=&#123;id&#125;&gt;&#123;body&#125;-&#123;author&#125;&lt;/li&gt; </div><div class="line">            )</div><div class="line">        &#125;     </div><div class="line">    &lt;/ul&gt;</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="å®¹å™¨å‹ç»„ä»¶-container"><a href="#å®¹å™¨å‹ç»„ä»¶-container" class="headerlink" title="å®¹å™¨å‹ç»„ä»¶(container)"></a>å®¹å™¨å‹ç»„ä»¶(container)</h4><p>å®¹å™¨å‹ç»„ä»¶å…³å¿ƒç»„ä»¶å¦‚ä½•å·¥ä½œï¼Œå¯ä»¥ä¸ºå±•ç¤ºç»„ä»¶æˆ–å…¶ä»–å®¹å™¨ç»„ä»¶æä¾›æ•°æ®ï¼Œé€šå¸¸æ˜¯æœ‰çŠ¶æ€çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">import React,&#123;Component&#125; from &quot;react&quot;;</div><div class="line">import &#123;BlogList&#125; from &apos;../BlogList/BlogList&apos;</div><div class="line">class Blog extends Component &#123;</div><div class="line">    constructor(props)&#123;</div><div class="line">        super(props)</div><div class="line">        this.state = &#123;</div><div class="line">            blogList:[]</div><div class="line">        &#125;</div><div class="line">        this.showBlodList = this.showBlodList.bind(this)</div><div class="line">    &#125;</div><div class="line">    componentDidMount()&#123;</div><div class="line">        const blogList = [</div><div class="line">            &#123;</div><div class="line">                id:1,</div><div class="line">                author:&apos;zyn&apos;,</div><div class="line">                body:&apos;è¿™æ˜¯blogå†…å®¹111&apos;</div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                id:2,</div><div class="line">                author:&apos;zyn&apos;,</div><div class="line">                body:&apos;è¿™æ˜¯blogå†…å®¹222&apos;</div><div class="line">            &#125;</div><div class="line">        ]</div><div class="line">        this.setState(&#123;</div><div class="line">            blogList</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">    showBlodList()&#123;</div><div class="line">        console.log(this.state.blogList)</div><div class="line">    &#125;</div><div class="line">    render()&#123;</div><div class="line">        const &#123;blogList&#125; = this.state</div><div class="line">        return(</div><div class="line">            &lt;div&gt;</div><div class="line">                &#123;BlogList(blogList)&#125;</div><div class="line">                &lt;button type=&quot;button&quot; onClick=&#123;this.showBlodList&#125;&gt;ç‚¹å‡»æˆ‘&lt;/button&gt;</div><div class="line">            &lt;/div&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">export default Blog</div></pre></td></tr></table></figure>
<p>æ˜¾ç¤ºæ•ˆæœå¦‚å›¾</p>
<p><img src="//ww1.sinaimg.cn/large/933205a1ly1fp020d7trzj21vi0okdl3.jpg"></p>
<h3 id="ç¼–å†™ä¸€ä¸ªå¤é€‰æ¡†ç»„ä»¶"><a href="#ç¼–å†™ä¸€ä¸ªå¤é€‰æ¡†ç»„ä»¶" class="headerlink" title="ç¼–å†™ä¸€ä¸ªå¤é€‰æ¡†ç»„ä»¶"></a>ç¼–å†™ä¸€ä¸ªå¤é€‰æ¡†ç»„ä»¶</h3><p>æœ€è¿‘ç”¨äº†AngularJS å’Œ Vue, åœ¨å†™è¡¨å•çš„æ—¶å€™åŸºäºåŒå‘æ•°æ®ç»‘å®šï¼Œå†™èµ·æ¥æ˜¯ç›¸å½“çš„happyï¼Œå½“ç„¶Reactçš„å•å‘æ•°æ®æµä¹Ÿæœ‰ç€è‡ªå·±çš„ä¼˜ç‚¹ã€‚åŸºäºæ­¤æˆ‘ä»¬å¯ä»¥å¯¹é¡¹ç›®ä¸­å¸¸ç”¨çš„è¡¨å•æ§ä»¶è¿›è¡Œç»„ä»¶çš„å°è£…ï¼Œä¸‹é¢ä»¥å¤é€‰æ¡†ä¸ºä¾‹ã€‚</p>
<h4 id="ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶"><a href="#ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶"></a>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºæ–‡ä»¶</h4><p>é¦–å…ˆæˆ‘ä»¬åœ¨ components æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºCheckboxæ–‡ä»¶å¤¹ä»¥åŠCheckbox.js æ–‡ä»¶,å…ˆå†™ä¸€ä¸ªæ— çŠ¶æ€ç»„ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// CheckBox.js</div><div class="line"></div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">class CheckBox extends Component &#123;</div><div class="line">    render() &#123;</div><div class="line">        return (</div><div class="line">            &lt;label&gt;&lt;input type=&quot;checkbox&quot; /&gt;ç‚¹å‡»æˆ‘&lt;/label&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">export default CheckBox</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// App.js</div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import logo from &apos;./logo.svg&apos;;</div><div class="line">import &apos;./App.css&apos;;</div><div class="line">import Blog from &apos;./components/Blog/Blog&apos;</div><div class="line">import CheckBox from &apos;./components/CheckBox/CheckBox&apos;</div><div class="line">class App extends Component &#123;</div><div class="line">  render() &#123;</div><div class="line">    return (</div><div class="line">      &lt;div className=&quot;App&quot;&gt;</div><div class="line">        &lt;header className=&quot;App-header&quot;&gt;</div><div class="line">          &lt;img src=&#123;logo&#125; className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;</div><div class="line">          &lt;h1 className=&quot;App-title&quot;&gt;Welcome to React&lt;/h1&gt;</div><div class="line">        &lt;/header&gt;</div><div class="line">        &lt;p className=&quot;App-intro&quot;&gt;</div><div class="line">          To get started, edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;Blog/&gt;</div><div class="line">        &lt;CheckBox/&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default App;</div></pre></td></tr></table></figure>
<p>å¦‚å›¾ï¼Œä¼šå‡ºç°ä¸€ä¸ª<code>ç‚¹å‡»æˆ‘</code>çš„å¤é€‰æ¡†</p>
<p><img src="//ww1.sinaimg.cn/large/933205a1ly1fp02g9zniej21aq0pedi9.jpg"></p>
<h4 id="ç¬¬äºŒæ­¥ï¼Œå®ç°labelçš„å¯é…ç½®"><a href="#ç¬¬äºŒæ­¥ï¼Œå®ç°labelçš„å¯é…ç½®" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œå®ç°labelçš„å¯é…ç½®"></a>ç¬¬äºŒæ­¥ï¼Œå®ç°labelçš„å¯é…ç½®</h4><p>æˆ‘ä»¬ä¼šå‘ç°å¤é€‰æ¡†çš„ <code>label</code> çš„æ–‡å­— <code>ç‚¹å‡»æˆ‘</code> æ˜¯å†™æ­»çš„ï¼Œé‚£ä¹ˆæ€ä¹ˆè®© <code>label</code> çš„åŠ¨æ€ä¼ å…¥å‘¢ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//Checkbox.js</div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">class CheckBox extends Component &#123;</div><div class="line">    render() &#123;</div><div class="line">        return (</div><div class="line">            &lt;label&gt;</div><div class="line">                &lt;input type=&quot;checkbox&quot; /&gt;</div><div class="line"></div><div class="line">                //è¿™é‡Œç”±â€˜ç‚¹å‡»æˆ‘â€™æ¢æˆäº†å¦‚ä¸‹ä»£ç </div><div class="line">                &#123;this.props.children !== undefined ? this.props.children : null&#125;</div><div class="line">            &lt;/label&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">export default CheckBox</div></pre></td></tr></table></figure>
<p>è¿™é‡Œè¦æ³¨æ„<code>this.props.children</code> è¡¨ç¤ºå½“å‰ç»„ä»¶çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚<code>this.props.children</code> çš„å€¼æœ‰ä¸‰ç§å¯èƒ½ï¼šå¦‚æœå½“å‰ç»„ä»¶æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œå®ƒå°±æ˜¯ <code>undefined</code> ;å¦‚æœæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œæ•°æ®ç±»å‹æ˜¯ <code>object</code> ï¼›å¦‚æœæœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ•°æ®ç±»å‹å°±æ˜¯ <code>array</code> ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">//App.js</div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import logo from &apos;./logo.svg&apos;;</div><div class="line">import &apos;./App.css&apos;;</div><div class="line">import Blog from &apos;./components/Blog/Blog&apos;</div><div class="line">import CheckBox from &apos;./components/CheckBox/CheckBox&apos;</div><div class="line">class App extends Component &#123;</div><div class="line">  render() &#123;</div><div class="line">    return (</div><div class="line">      &lt;div className=&quot;App&quot;&gt;</div><div class="line">        &lt;header className=&quot;App-header&quot;&gt;</div><div class="line">          &lt;img src=&#123;logo&#125; className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;</div><div class="line">          &lt;h1 className=&quot;App-title&quot;&gt;Welcome to React&lt;/h1&gt;</div><div class="line">        &lt;/header&gt;</div><div class="line">        &lt;p className=&quot;App-intro&quot;&gt;</div><div class="line">          To get started, edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;Blog/&gt;</div><div class="line">        &lt;CheckBox&gt;æŒ‰é’®1&lt;/CheckBox&gt;</div><div class="line">        &lt;CheckBox&gt;æŒ‰é’®2&lt;/CheckBox&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default App;</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æµè§ˆå™¨ï¼Œå¯ä»¥çœ‹åˆ°æŒ‰é’®çš„labelå·²ç»å˜æˆå¯ä»¥é…ç½®çš„äº†ã€‚</p>
<p><img src="//ww1.sinaimg.cn/large/933205a1ly1fp02tjojipj21ai0mo0vb.jpg"></p>
<h4 id="ç¬¬ä¸‰æ­¥ï¼Œå®ç°å¯æ§ç»„ä»¶åŠè·å€¼"><a href="#ç¬¬ä¸‰æ­¥ï¼Œå®ç°å¯æ§ç»„ä»¶åŠè·å€¼" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œå®ç°å¯æ§ç»„ä»¶åŠè·å€¼"></a>ç¬¬ä¸‰æ­¥ï¼Œå®ç°å¯æ§ç»„ä»¶åŠè·å€¼</h4><p>ç°åœ¨çš„å¤é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€æ˜¯ç”±è‡ªèº«å»æ§åˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨è¿˜æ— æ³•å»åŠ¨æ€æ§åˆ¶å¤é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€ã€‚åŒæ—¶ï¼Œåœ¨ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªå¤é€‰æ¡†ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥è·å¾—é€‰ä¸­çš„å¤é€‰æ¡†çš„æ•°æ®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">// Checkbox.js</div><div class="line"></div><div class="line">import React from &quot;react&quot;;</div><div class="line">class CheckBox extends React.Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props)</div><div class="line">        this.checkCheckBox = this.checkCheckBox.bind(this);</div><div class="line">        this.state = &#123;</div><div class="line">            is_checked: props.checked || false,</div><div class="line">            value: props.value || &apos;&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    componentWillReceiveProps(nextProps)&#123;</div><div class="line">        if(&apos;checked&apos; in nextProps)&#123;</div><div class="line">            this.setState(&#123;</div><div class="line">                is_checked:nextProps.checked || false</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    checkCheckBox() &#123;</div><div class="line">        const onChange = this.props.onChange;</div><div class="line">        const value = this.props.value;</div><div class="line">        if (onChange) &#123;</div><div class="line">            onChange(value);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        let &#123; is_checked, value &#125; = this.state;</div><div class="line">        return (</div><div class="line">            &lt;label&gt;</div><div class="line">                &lt;input value=&#123;value&#125; type=&quot;checkbox&quot; onClick=&#123;this.checkCheckBox&#125; checked=&#123;is_checked&#125; /&gt;</div><div class="line">                &#123;this.props.children !== undefined ? this.props.children : null&#125;</div><div class="line">            &lt;/label&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">export default CheckBox;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">//App.js</div><div class="line"></div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import logo from &apos;./logo.svg&apos;;</div><div class="line">import &apos;./App.css&apos;;</div><div class="line">import Blog from &apos;./components/Blog/Blog&apos;</div><div class="line">import CheckBox from &apos;./components/CheckBox/CheckBox&apos;</div><div class="line">class App extends Component &#123;</div><div class="line">  state = &#123;</div><div class="line">    checkedList: []</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  changeCheckBox = (value) =&gt; &#123;</div><div class="line">    const valueIndex = this.state.checkedList.indexOf(value)</div><div class="line">    const checkedList = [...this.state.checkedList]</div><div class="line">    if (valueIndex === -1) &#123;</div><div class="line">      checkedList.push(value);</div><div class="line">    &#125; else &#123;</div><div class="line">      checkedList.splice(valueIndex, 1);</div><div class="line">    &#125;</div><div class="line">    this.setState(&#123;</div><div class="line">      checkedList</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  getChecked = (value) =&gt; &#123;</div><div class="line">    const valueIndex = this.state.checkedList.indexOf(value)</div><div class="line">    if (valueIndex === -1) &#123;</div><div class="line">      return false</div><div class="line">    &#125;</div><div class="line">    return true</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    console.log(&apos;å½“å‰ç‚¹å‡»&apos;, this.state.checkedList)</div><div class="line">    console.log(&apos;å½“å‰ç‚¹å‡»&apos;, this.getChecked(&apos;æŒ‰é’®1&apos;))</div><div class="line">    return (</div><div class="line">      &lt;div className=&quot;App&quot;&gt;</div><div class="line">        &lt;header className=&quot;App-header&quot;&gt;</div><div class="line">          &lt;img src=&#123;logo&#125; className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;</div><div class="line">          &lt;h1 className=&quot;App-title&quot;&gt;Welcome to React&lt;/h1&gt;</div><div class="line">        &lt;/header&gt;</div><div class="line">        &lt;p className=&quot;App-intro&quot;&gt;</div><div class="line">          To get started, edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;Blog /&gt;</div><div class="line">        &lt;CheckBox key=&quot;1&quot; value=&quot;æŒ‰é’®1&quot; checked=&#123;this.getChecked(&apos;æŒ‰é’®1&apos;)&#125; onChange=&#123;this.changeCheckBox&#125;&gt;æŒ‰é’®1&lt;/CheckBox&gt;</div><div class="line">        &lt;CheckBox key=&quot;2&quot; value=&quot;æŒ‰é’®2&quot; checked=&#123;this.getChecked(&apos;æŒ‰é’®2&apos;)&#125; onChange=&#123;this.changeCheckBox&#125;&gt;æŒ‰é’®2&lt;/CheckBox&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default App;</div></pre></td></tr></table></figure>
<p><img src="http://ww1.sinaimg.cn/large/933205a1ly1fp03zn79w8j21m60osaea.jpg"><br>ä¸Šè¿°ä»£ç ï¼Œå¤é€‰æ¡†å¢åŠ äº†è‡ªèº«çš„çŠ¶æ€ï¼Œåˆå§‹çš„<code>state</code>é»˜è®¤ä»<code>props</code>ä¸­è¯»å–ï¼Œå†åœ¨<code>onChange</code>çš„æ—¶å€™ï¼Œå†æŠŠç»„ä»¶çš„<code>value</code> å€¼ä¼ ä¸Šå»ï¼Œç„¶ååœ¨çˆ¶ç»„ä»¶ä¸­è·å–ï¼Œä»è€Œå®ç°å¤é€‰æ¡†çš„å¯æ§åˆ¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ§åˆ¶å°ä¸­è·å–åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„å€¼ã€‚</p>
<h4 id="ç¬¬å››æ­¥ï¼Œå°è£…CheckBoxGroupç»„ä»¶"><a href="#ç¬¬å››æ­¥ï¼Œå°è£…CheckBoxGroupç»„ä»¶" class="headerlink" title="ç¬¬å››æ­¥ï¼Œå°è£…CheckBoxGroupç»„ä»¶"></a>ç¬¬å››æ­¥ï¼Œå°è£…CheckBoxGroupç»„ä»¶</h4><p>é€šè¿‡ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬åŸºæœ¬å®ç°äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ˜¯App.js æ–‡ä»¶é‡Œé¢æ“æ§å¤é€‰æ¡†ç»„ä»¶çš„é€»è¾‘ä»£ç å¤ªå¤šäº†ï¼Œå½±å“äº†ç»„ä»¶çš„ç®€æ´å’Œä½¿ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬æ‰“ç®—å°è£…CheckBoxGroup æ¥åŒ…è£¹æˆ‘ä»¬çš„å¤é€‰æ¡†ç»„ä»¶ï¼ŒæŠŠApp.jsä¸­çš„é€»è¾‘æŠ½ç¦»åˆ°CheckBoxGroup ç»„ä»¶ä¸Šã€‚</p>
<p>é¦–å…ˆåˆ›å»ºCheckBoxGroup.js æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">// CheckBoxGroup.js</div><div class="line">import React from &quot;react&quot;</div><div class="line">import PropTypes from &apos;prop-types&apos;;</div><div class="line">class CheckBoxGroup extends React.Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props)</div><div class="line">        this.state = &#123;</div><div class="line">            value: props.value || props.defaultValue || [],</div><div class="line">        &#125;;</div><div class="line">        this.toggleOption = this.toggleOption.bind(this);</div><div class="line">    &#125;</div><div class="line">    componentWillReceiveProps(nextProps) &#123;</div><div class="line">        if (&apos;value&apos; in nextProps) &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">                value: nextProps.value || [],</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    getChildContext() &#123;</div><div class="line">        return &#123;</div><div class="line">            checkboxGroup: &#123;</div><div class="line">                toggleOption: this.toggleOption,</div><div class="line">                value: this.state.value,</div><div class="line">            &#125;,</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    toggleOption(option) &#123;</div><div class="line">        const optionIndex = this.state.value.indexOf(option.value);</div><div class="line">        const value = [...this.state.value];</div><div class="line">        if (optionIndex === -1) &#123;</div><div class="line">            value.push(option.value);</div><div class="line">        &#125; else &#123;</div><div class="line">            value.splice(optionIndex, 1);</div><div class="line">        &#125;</div><div class="line">        if (!(&apos;value&apos; in this.props)) &#123;</div><div class="line">            this.setState(&#123; value &#125;);</div><div class="line">        &#125;</div><div class="line">        const onChange = this.props.onChange;</div><div class="line">        if (onChange) &#123;</div><div class="line">            onChange(value);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        const &#123; children, className &#125; = this.props</div><div class="line">        return (</div><div class="line">            &lt;div className=&#123;className&#125;&gt;</div><div class="line">                &#123;children&#125;</div><div class="line">            &lt;/div&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">CheckBoxGroup.childContextTypes = &#123;</div><div class="line">    checkboxGroup: PropTypes.any,</div><div class="line">&#125;;</div><div class="line">export default CheckBoxGroup</div></pre></td></tr></table></figure>
<p>ä»£ç åˆ†æï¼šé¦–å…ˆä»<code>render</code> å¼€å§‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">render() &#123;</div><div class="line">        const &#123; children, className &#125; = this.props</div><div class="line">        return (</div><div class="line">            &lt;div className=&#123;className&#125;&gt;</div><div class="line">                &#123;children&#125;</div><div class="line">            &lt;/div&gt;</div><div class="line">        )</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™å—ä»£ç å’Œä¸Šé¢<code>BlodList</code>é‚£é‡Œä¸€æ ·ï¼Œä¹Ÿæ˜¯é€šè¿‡<code>this.props.children</code> åŠ è½½å­èŠ‚ç‚¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">getChildContext() &#123;</div><div class="line">       return &#123;</div><div class="line">           checkboxGroup: &#123;</div><div class="line">               toggleOption: this.toggleOption,</div><div class="line">               value: this.state.value,</div><div class="line">           &#125;,</div><div class="line">       &#125;;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>å­ç»„ä»¶å¯ä»¥é€šè¿‡è®¾ç½®<code>contextTypes</code>ç±»å‹ååœ¨<code>this.content</code>è®¿é—®åˆ°çˆ¶ç»„ä»¶çš„<code>getChildContext</code>å‡½æ•°è¿”å›çš„å¯¹è±¡å±æ€§ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒgetChildContext æŒ‡å®šçš„ä¼ é€’ç»™å­ç»„ä»¶çš„å±æ€§éœ€è¦å…ˆé€šè¿‡ childContextTypes æ¥æŒ‡å®šï¼Œä¸ç„¶ä¼šäº§ç”Ÿé”™è¯¯ã€‚</p>
<p>åŒæ—¶ï¼Œåœ¨å­ç»„ä»¶è¦æŠŠå—æ§çŠ¶æ€è½¬ç§»åˆ°<code>this.content</code>ç›‘å¬çš„å¯¹è±¡ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">//CheckBox.js</div><div class="line">import React from &quot;react&quot;</div><div class="line">import PropTypes from &apos;prop-types&apos;;</div><div class="line">import CheckBoxGroup from &apos;../CheckBoxGroup/CheckBoxGroup&apos;</div><div class="line">class CheckBox extends React.Component &#123;</div><div class="line">    constructor(props) &#123;</div><div class="line">        super(props)</div><div class="line">        this.checkCheckBox = this.checkCheckBox.bind(this);</div><div class="line">        this.state = &#123;</div><div class="line">            is_checked: props.checked || false,</div><div class="line">            value: props.value || &apos;&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    checkCheckBox() &#123;</div><div class="line">        const &#123; checkboxGroup &#125; = this.context;</div><div class="line">        if (checkboxGroup) &#123;</div><div class="line">            checkboxGroup.toggleOption(&#123; label: this.props.children, value: this.props.value &#125;)</div><div class="line">        &#125; else &#123;</div><div class="line">            const onChange = this.props.onChange;</div><div class="line">            const value = this.props.value;</div><div class="line">            if (onChange) &#123;</div><div class="line">                onChange(value);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    render() &#123;</div><div class="line">        let &#123; is_checked, value &#125; = this.state;</div><div class="line">        const &#123; checkboxGroup &#125; = this.context;</div><div class="line">        if (checkboxGroup) &#123;</div><div class="line">            is_checked = checkboxGroup.value.indexOf(this.props.value) !== -1;</div><div class="line">        &#125;</div><div class="line">        return (</div><div class="line">            &lt;label&gt;</div><div class="line">                &lt;input value=&#123;value&#125; type=&quot;checkbox&quot; checked=&#123;is_checked&#125;</div><div class="line">                    onClick=&#123;this.checkCheckBox&#125; /&gt;</div><div class="line">                &#123;this.props.children !== undefined ? this.props.children : null&#125;</div><div class="line">            &lt;/label&gt;</div><div class="line">        )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">CheckBox.Group = CheckBoxGroup;</div><div class="line">CheckBox.contextTypes = &#123;</div><div class="line">    checkboxGroup: PropTypes.any,</div><div class="line">&#125;</div><div class="line">export default CheckBox;</div></pre></td></tr></table></figure>
<p>å­ç»„ä»¶åœ¨ç‚¹å‡»çš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰åŒ…è£¹çš„<code>this.content.checkboxGroup</code> å±æ€§ã€‚å¦‚æœæœ‰ï¼Œå°±æŠŠçŠ¶æ€è½¬ç§»åˆ°åŒ…è£¹çš„ç»„ä»¶å»ç®¡ç†ã€‚<br><code>CheckBox.Group = CheckboxGroup</code> è¿™æ®µä»£ç æ–¹ä¾¿å¤–éƒ¨è°ƒç”¨ç»„ä»¶ï¼Œå³æƒ³å¼•ç”¨CheckBoxGroupç»„ä»¶å¯ä»¥å†™æˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import CheckBox from &apos;./components/CheckBox/CheckBox&apos;</div><div class="line">const CheckBoxGroup = CheckBox.Group;</div></pre></td></tr></table></figure>
<p>ç„¶ååœ¨App.js ä¸­å¼•å…¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">//App.js</div><div class="line">import React, &#123; Component &#125; from &apos;react&apos;;</div><div class="line">import logo from &apos;./logo.svg&apos;;</div><div class="line">import &apos;./App.css&apos;;</div><div class="line">import Blog from &apos;./components/Blog/Blog&apos;</div><div class="line">import CheckBox from &apos;./components/CheckBox/CheckBox&apos;</div><div class="line">const CheckBoxGroup = CheckBox.Group;</div><div class="line"></div><div class="line">class App extends Component &#123;</div><div class="line">  state=&#123;</div><div class="line">    checkList:[]</div><div class="line">  &#125;</div><div class="line">  selectCheckBtn=(values)=&gt;&#123;</div><div class="line">    console.log(values)</div><div class="line">    this.setState(&#123;</div><div class="line">      checkList:values</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">    render() &#123;</div><div class="line">    const &#123;checkList&#125; = this.state</div><div class="line">    return (</div><div class="line">      &lt;div className=&quot;App&quot;&gt;</div><div class="line">        &lt;header className=&quot;App-header&quot;&gt; </div><div class="line">         &lt;img src=&#123;logo&#125; className=&quot;App-logo&quot; alt=&quot;logo&quot; /&gt;  </div><div class="line">         &lt;h1 className=&quot;App-title&quot;&gt;Welcome to React&lt;/h1&gt;</div><div class="line">        &lt;/header&gt; </div><div class="line">        &lt;p className=&quot;App-intro&quot;&gt;</div><div class="line">          To get started, edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.</div><div class="line">        &lt;/p&gt;</div><div class="line">        &lt;Blog/&gt;</div><div class="line">        &lt;CheckBoxGroup value=&#123;checkList&#125; onChange=&#123;this.selectCheckBtn&#125;&gt; </div><div class="line">          &lt;CheckBox value=&#123;&apos;1&apos;&#125;&gt;æŒ‰é’®1&lt;/CheckBox&gt;</div><div class="line">          &lt;CheckBox value=&#123;&apos;2&apos;&#125;&gt;æŒ‰é’®2&lt;/CheckBox&gt;</div><div class="line">          &lt;CheckBox value=&#123;&apos;3&apos;&#125;&gt;æŒ‰é’®3&lt;/CheckBox&gt;</div><div class="line">          &lt;CheckBox value=&#123;&apos;4&apos;&#125;&gt;æŒ‰é’®4&lt;/CheckBox&gt;</div><div class="line">        &lt;/CheckBoxGroup&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    );</div><div class="line">  &#125;&#125;</div><div class="line">export default App;</div></pre></td></tr></table></figure></p>
<p>æœ€ååœ¨æµè§ˆå™¨ç‚¹å‡»å¤é€‰æ¡†</p>
<p><img src="//ww1.sinaimg.cn/large/933205a1ly1fp04zmphioj21py0pygpy.jpg"></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªå¤é€‰æ¡†ç»„ä»¶ï¼Œå¯ä»¥ç»™ç»„ä»¶åŠ ä¸Šä¸€äº›æ ·å¼ç¾åŒ–ä¸€ä¸‹ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™ç›´æ¥å¼•ç”¨å°±å¥½äº†ã€‚</p>
<h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>å†™ä¸€ä¸ªç»„ä»¶å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯å†™å¥½ä¸€ä¸ªç»„ä»¶å°±ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“çš„äº‹äº†ï¼ŒReactä¹Ÿæœ‰ä¸€äº›ç°åœ¨æ¯”è¾ƒæˆç†Ÿçš„UIç»„ä»¶åº“ï¼Œæ¯”å¦‚èš‚èšé‡‘æœçš„Antd Design <a href="//github.com/ant-design/ant-design/">ä¼ é€é—¨</a> ï¼Œå¯ä»¥æ‰“å¼€çœ‹çœ‹é‡Œé¢çš„æºç å­¦ä¹ ä¸€ä¸‹ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ç®€å•ä»‹ç»äº†å¦‚ä½•åœ¨Reactä¸­ç¼–å†™ç»„ä»¶ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="zhouyinian" scheme="http://xgfe.github.io/categories/zhouyinian/"/>
    
    
      <category term="React" scheme="http://xgfe.github.io/tags/React/"/>
    
      <category term="component" scheme="http://xgfe.github.io/tags/component/"/>
    
  </entry>
  
  <entry>
    <title>ListViewæºç åˆ†æ</title>
    <link href="http://xgfe.github.io/2018/02/09/caominkang/ListView%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://xgfe.github.io/2018/02/09/caominkang/ListViewæºç åˆ†æ/</id>
    <published>2018-02-09T05:12:00.000Z</published>
    <updated>2018-03-20T03:07:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ˜¯åˆ†æListViewæºç ï¼Œé‡ç‚¹å…³æ³¨å¤ç”¨æœºåˆ¶ã€‚</p>
<a id="more"></a>
<h1 id="ListViewæºç è§£æ"><a href="#ListViewæºç è§£æ" class="headerlink" title="ListViewæºç è§£æ"></a>ListViewæºç è§£æ</h1><p>&nbsp;&nbsp;æœ¬æ–‡åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†æå–å‡ºRecycleBinçš„ç›¸å…³ä»£ç ï¼Œå¯¹RecyleBinåšåŸºæœ¬è®²è§£ï¼›ç¬¬äºŒéƒ¨åˆ†è®²è§£ListViewåˆå§‹åŒ–æ—¶onLayoutè¿‡ç¨‹ï¼›ç¬¬ä¸‰éƒ¨åˆ†è®²è§£ListViewå¦‚ä½•åœ¨å±å¹•æ»‘åŠ¨ä¸­å®ç°å¤ç”¨ã€‚</p>
<h2 id="ä¸€ã€RecycleBin"><a href="#ä¸€ã€RecycleBin" class="headerlink" title="ä¸€ã€RecycleBin"></a>ä¸€ã€RecycleBin</h2><p>&nbsp;&nbsp;RecycleBinæ˜¯AbsListViewçš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ˜¯ç»§æ‰¿è‡ªAbsListViewçš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæœºåˆ¶ï¼Œä»£ç ç»“æ„å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<pre><code>class RecycleBin{
    private int mFirstPosition;
    private View[] mActiveViews = new View[0];
    private int mViewTypeCount;
    private ArrayList&lt;View&gt;[] mScrapViews;
    private ArrayList&lt;View&gt; mCurrentScrap;
    void fillActiveViews(int childCount,int firstActivePostion)
    void getActiveView(int position);
    void addScrapView(View scrap);
    View getSrapView(int position);
    public void setViewTypeCount(int viewTypeCount);
}
</code></pre><p>ä¸‹é¢ä»‹ç»å­—æ®µå’Œapiï¼š</p>
<ul>
<li>mFirstPositionæŒ‡çš„æ˜¯mActiveView[0]ä¸­å­˜å‚¨çš„Viewåœ¨æ•°æ®ä¸­çš„positionã€‚</li>
<li>mActiveViewsç¼“å­˜çš„æ˜¯ç¬¬ä¸€å±çš„æ•°æ®ï¼Œåé¢çš„è®²è§£ä¸­ä¼šè¯´æ˜ï¼Œä¸»è¦æ˜¯åœ¨ListViewåˆå§‹åŒ–ä¸­èµ·ä½œç”¨</li>
<li>mViewTypeCountä»£è¡¨æ•°æ®ç§ç±»ï¼Œå€¼ç”±setViewTypeCountæ–¹æ³•è®¾ç½®ã€‚ListViewå¯ä»¥å¤„ç†ä¸åŒç§ç±»çš„æ•°æ®</li>
<li>mScrapViewsç”¨æ¥ç¼“å­˜ç§»å‡ºåˆ°å±å¹•å¤–çš„viewï¼Œå› ä¸ºListViewæ”¯æŒä¸åŒç§ç±»æ•°æ®ï¼Œæ‰€ä»¥mScrapViewsæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå¯¹åº”ä¸åŒç§ç±»æ•°æ®ï¼Œä½¿ç”¨ä¸åŒçš„ArrayListå»ç¼“å­˜ã€‚</li>
<li>fillActiveViewsæ˜¯å°†å±å¹•ä¸Šå¯ä»¥çœ‹åˆ°çš„viewç¼“å­˜åˆ°mActiveViewsä¸­</li>
<li>getActiveViewså°†æŒ‡å®šçš„ä½ç½®çš„viewä»mActiveViewsä¸­å–å‡ºæ¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå–å‡ºåå†æ¬¡è·å–è¯¥ä½ç½®viewä¼šè¿”å›ç©ºã€‚</li>
<li>getScrapViewç”¨äºä»mScrapViewä¸­å–å‡ºviewï¼Œç”±äºåŒç§æ•°æ®ç±»å‹çš„viewéƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•åªæ˜¯è¿”å›è¯¥ç±»å‹æœ€åä¸€ä¸ªä½ç½®çš„viewã€‚</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´RecycleBinæœ‰ä¸¤ç§ç¼“å­˜viewçš„æ¨¡å¼ï¼šActiveViewå’ŒScrapView.ListViewåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨mActiveViewsæ¥ç¼“å­˜æ˜¾ç¤ºåœ¨å±å¹•ä¸­çš„viewï¼Œåœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­ä½¿ç”¨mScrapViewç¼“å­˜ç§»é™¤åˆ°å±å¹•å¤–çš„æ•°æ®ï¼Œå®ç°å¤ç”¨ã€‚ä¸‹é¢æˆ‘æ¥å…·ä½“çœ‹ListViewæ˜¯å¦‚ä½•é€šè¿‡è°ƒç”¨RecycleBinçš„æ–¹æ³•æ¥ç®¡ç†viewçš„å¤ç”¨ã€‚</p>
<h2 id="äºŒã€ListViewåˆå§‹åŒ–è¿‡ç¨‹"><a href="#äºŒã€ListViewåˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="äºŒã€ListViewåˆå§‹åŒ–è¿‡ç¨‹"></a>äºŒã€ListViewåˆå§‹åŒ–è¿‡ç¨‹</h2><p>&nbsp;&nbsp;é‡ç‚¹å…³æ³¨ListViewåˆå§‹åŒ–è¿‡ç¨‹ä¸­onLayoutè¿‡ç¨‹ï¼Œå› ä¸ºä¸RecycleBinäº¤äº’ä¸»è¦åœ¨è¿™ä¸ªè¿‡ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œandroidè§†å›¾æ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯FrameLayoutå­ç±»ï¼Œè€ŒFrameLayoutä¼šè®©å­viewæ‰§è¡Œä¸¤æ¬¡onLayoutè¿‡ç¨‹ï¼ŒListViewä¹Ÿä¸ä¾‹å¤–ï¼Œä¹Ÿä¼šæœ‰ä¸¤æ¬¡onLayoutè¿‡ç¨‹ã€‚</p>
<h3 id="1-ç¬¬ä¸€æ¬¡onLayout"><a href="#1-ç¬¬ä¸€æ¬¡onLayout" class="headerlink" title="1.ç¬¬ä¸€æ¬¡onLayout"></a>1.ç¬¬ä¸€æ¬¡onLayout</h3><p>&nbsp;&nbsp;ListViewä¸­æ²¡æœ‰å¤å†™çˆ¶ç±»AbsListViewçš„onLayoutæ–¹æ³•ï¼Œä¸è¿‡åœ¨çˆ¶ç±»onLayoutä¸­ï¼Œåšå®Œæ•°æ®åˆ¤æ–­åï¼Œç›´æ¥è°ƒç”¨äº†layoutChildrenï¼Œå¹¶ä¸”æ³¨é‡Šæœ‰è¯´æ˜ï¼Œå­ç±»ä¸åº”è¯¥å¤å†™onLayoutæ–¹æ³•ï¼Œè€Œè¯¥å¤å†™layoutChildrenã€‚ç”±äºlayoutChildrenéœ€è¦é’ˆå¯¹ä¸¤æ¬¡onLayoutå¤„ç†ï¼Œæ‰€ä»¥åˆ¤æ–­å’Œåˆ†æ”¯æµç¨‹ç‰¹åˆ«å¤æ‚ï¼ŒæŠ½å–å‡ºç¬¬ä¸€æ¬¡è°ƒç”¨çš„æµç¨‹ï¼Œå¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<pre><code> protected void layoutChildren(){
    int childCount = getChildCount();

    switch(mLayoutMode){

    }
    boolean dataChanged = mDataChanged;
    if(dataChanged){

    }else{
        recycleBin.fillActiveView(childCount,firstPosition);
    }
    detachAllViewsFromParent();
    switch (mLayoutMode){
        default:
            if(childCount==0)
                fillFromTop(childrenTop);
            else
                fillSpecific(0,childrenTop)

    }

}
</code></pre><p>&nbsp;&nbsp;ä»¥ä¸Šæ˜¯ä»£ç ç»“æ„ï¼Œçœå»äº†å¾ˆå¤šä¸åˆ†ææµç¨‹æ— å…³çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç”±äºæˆ‘ä»¬æ•°æ®æºæ²¡æœ‰å˜åŒ–ï¼ŒdataChangedç­‰äºfalseï¼Œè¿›å…¥fillActiveViewsï¼Œä½†æ˜¯æ­¤æ—¶ListViewæ²¡æœ‰ä»»ä½•å­viewï¼ŒchildCountä¸º0ï¼Œè¿™è¡Œä»£ç æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œè¿›å…¥switchè¯­å¥åï¼Œè¿›å…¥defaultåˆ†æ”¯ï¼Œè°ƒç”¨fillFromTopã€‚æˆ‘ä»¬è¿›å…¥è¯¥å‡½æ•°ï¼Œå‘ç°ä¸»è¦è°ƒç”¨äº†fillDownæ–¹æ³•ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹</p>
<pre><code>private View fillDown(int pos, int nextTop) {
    View selectedView = null;
    int end = (getBottom() - getTop()) - mListPadding.bottom;
    while (nextTop &lt; end &amp;&amp; pos &lt; mItemCount) {
        // is this the selected item?  
        boolean selected = pos == mSelectedPosition;
        View child = makeAndAddView(pos, nextTop, true, mListPadding.left, selected);
        nextTop = child.getBottom() + mDividerHeight;
        if (selected) {
            selectedView = child;
        }
        pos++;
    }
    return selectedView;
}
</code></pre><p>&nbsp;&nbsp;å¯ä»¥çœ‹åˆ°ï¼Œå¾ªç¯è°ƒç”¨makeAndAddViewï¼ˆï¼‰æ–¹æ³•ï¼Œç»ˆæ­¢æ¡ä»¶æ˜¯æ•°æ®é¡¹åŠ è½½å®Œæˆ–è€…æœ€åä¸€ä¸ªå­viewçš„topå°äºListViewçš„åº•éƒ¨ã€‚å®ç°ä»ListViewé¡¶éƒ¨ä¸€ç›´å¡«å……åˆ°ListViewåº•éƒ¨ï¼Œé‚£ä¹ˆmakeAndAddViewæ–¹æ³•è‚¯å®šæ˜¯æ„å»ºviewå¹¶ä¸”å¡«å……viewåˆ°ListViewä¸­ï¼Œä¸‹é¢æ˜¯ç›¸å…³ä»£ç ï¼š</p>
<pre><code> private View makeAndAddView(int position, int y, boolean flow, int childrenLeft,
                            boolean selected) {
    View child;
    if (!mDataChanged) {
        // Try to use an exsiting view for this position
        child = mRecycler.getActiveView(position);
        if (child != null) {
            // Found it -- we&apos;re using an existing child
            // This just needs to be positioned
            setupChild(child, position, y, flow, childrenLeft, selected, true);
            return child;
        }
    }
    // Make a new view for this position, or convert an unused view if possible
    child = obtainView(position, mIsScrap);
    // This needs to be positioned and measured
    setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[0]);
    return child;
}
</code></pre><p>&nbsp;&nbsp;é¦–å…ˆå°è¯•é€šè¿‡recyclerçš„getActiveViewè·å–viewï¼Œç”±äºæ²¡æœ‰ç¼“å­˜è¿‡ä»»ä½•viewï¼Œè¿™é‡Œæ˜¯è·å–ä¸åˆ°çš„ï¼Œå†ä½¿ç”¨obtainViewè·å–viewã€‚ä»£ç å¦‚ä¸‹</p>
<pre><code>View obtainView(int position, boolean[] isScrap) {
    isScrap[0] = false;
    View scrapView;
    scrapView = mRecycler.getScrapView(position);
    View child;
    if (scrapView != null) {
        child = mAdapter.getView(position, scrapView, this);
        if (child != scrapView) {
            mRecycler.addScrapView(scrapView);
            if (mCacheColorHint != 0) {
                child.setDrawingCacheBackgroundColor(mCacheColorHint);
            }
        } else {
            isScrap[0] = true;
            dispatchFinishTemporaryDetach(child);
        }
    } else {
        child = mAdapter.getView(position, null, this);
        if (mCacheColorHint != 0) {
            child.setDrawingCacheBackgroundColor(mCacheColorHint);
        }
    }
    return child;
}
</code></pre><p>&nbsp;&nbsp;é¦–å…ˆå°è¯•ä»recyclerBinä¸­è·å–scrapViewï¼Œè·å–æˆåŠŸåä½œä¸ºå‚æ•°ä¼ å…¥Adapter.getViewæ–¹æ³•ä¸­ï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™å°†nullä¼ å…¥Adapter.getViewæ–¹æ³•ä¸­ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä½¿ç”¨ListViewæ—¶éœ€è¦è‡ªå®šä¹‰Adapterï¼Œä¼šå¤å†™getViewæ–¹æ³•ï¼Œé€šå¸¸å¦‚ä¸‹ï¼š</p>
<pre><code> public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {
    Fruit fruit = getItem(position);
    View view;
    ViewHolder viewHolder;
    if (convertView == null) {
        view = LayoutInflater.from(getContext()).inflate(resourceId, parent, false);
        viewHolder = new ViewHolder();
        viewHolder.fruitImage = view.findViewById(R.id.fruit_image);
        viewHolder.fruitName = view.findViewById(R.id.fruit_name);
        view.setTag(viewHolder);

    } else {
        view = convertView;
        viewHolder = (ViewHolder) view.getTag();
    }
    viewHolder.fruitImage.setImageResource(fruit.getImageId());
    viewHolder.fruitName.setText(fruit.getName());
    if(position==0)
        view.setBackgroundColor(Color.RED);

    return view;

}
</code></pre><p>&nbsp;&nbsp;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒconvertViewä¸ºç©ºæ—¶ä¼šä½¿ç”¨LayoutInflateråŠ è½½å¸ƒå±€ï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œç›´æ¥å¤ç”¨convertViewã€‚åˆ°è¿™é‡ŒobtainViewé€»è¾‘å·²ç»æ¸…æ¥šäº†ï¼Œå›åˆ°makeAndAddViewä¸­ï¼Œä¼šå°†obtainViewå¾—åˆ°çš„viewä¼ å…¥åˆ°setUpChildæ–¹æ³•ä¸­ï¼Œç„¶åä¼šè°ƒç”¨addViewInLayoutå°†è¯¥viewæ·»åŠ åˆ°ListViewä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€æ¬¡onLayout æ–¹æ³•ä½¿ç”¨InflateråŠ è½½äº†åˆšå¥½ä¸€å±å¹•æ•°æ®ï¼Œå…¶ä»–æ•°æ®å¹¶æ²¡æœ‰åŠ è½½ã€‚</p>
<p>###2.ç¬¬äºŒæ¬¡onLayout<br>&nbsp;&nbsp;æˆ‘ä»¬ä¾ç„¶ä»layoutChildæ–¹æ³•å¼€å§‹ï¼Œä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>protected void layoutChildren(){
    int childCount = getChildCount();

    switch(mLayoutMode){

    }
    boolean dataChanged = mDataChanged;
    if(dataChanged){

    }else{
        recycleBin.fillActiveView(childCount,firstPosition);
    }
    detachAllViewsFromParent();
    switch (mLayoutMode){
        default:
            if(childCount==0)
                fillFromTop(childrenTop);
            else
                fillSpecific(0,childrenTop)

    }

}
</code></pre><p>&nbsp;&nbsp;è¿™æ¬¡æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”±äºchildCountå·²ç»ä¸æ˜¯0ï¼Œä»£ç æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>recycleBin.fillActiveView():å°†å±å¹•ä¸­çš„viewç¼“å­˜åˆ°ActiveView[]ä¸­</li>
<li>detachAllViewsFromParent():å°†ç¬¬ä¸€æ¬¡onLayoutåŠ å…¥åˆ°ListViewä¸­çš„æ‰€æœ‰viewä»ListViewä¸­detach</li>
<li>fillSpecificï¼ˆ0ï¼ŒchildrenTopï¼‰å°†viewåŠ è½½åˆ°ListViewä¸­</li>
</ul>
<p>&nbsp;&nbsp;fillSpecificæ˜¯ç¬¬ä¸€æ¬¡onLayoutè¿‡ç¨‹ä¸­æ²¡æœ‰ç”¨åˆ°çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é€»è¾‘å’ŒfillDownå¾ˆç›¸ä¼¼ï¼Œä¸è¿‡æ˜¯å…ˆåŠ è½½æŒ‡å®šä½ç½®viewå†åˆ†åˆ«åŠ è½½ä¸¤è¾¹viewï¼Œç”±äºä¼ å…¥çš„positionæ˜¯0ï¼Œæ•ˆæœä¸ŠåŸºæœ¬å’ŒfillDownä¸€æ ·ã€‚æ‰€æœ‰æˆ‘ä»¬è¿˜æ˜¯å…³æ³¨makeAndAddView:</p>
<pre><code> private View makeAndAddView(int position, int y, boolean flow, int childrenLeft,
                            boolean selected) {
    View child;
    if (!mDataChanged) {
        // Try to use an exsiting view for this position
        child = mRecycler.getActiveView(position);
        if (child != null) {
            // Found it -- we&apos;re using an existing child
            // This just needs to be positioned
            setupChild(child, position, y, flow, childrenLeft, selected, true);
            return child;
        }
    }
    // Make a new view for this position, or convert an unused view if possible
    child = obtainView(position, mIsScrap);
    // This needs to be positioned and measured
    setupChild(child, position, y, flow, childrenLeft, selected, mIsScrap[0]);
    return child;
}
</code></pre><p>&nbsp;&nbsp;è¿™æ¬¡ä»£ç é€»è¾‘å°±å¾ˆç®€å•äº†ï¼ŒmRecycler.getActiveViewä»ç¼“å­˜ä¸­è·å–viewåç›´æ¥å°†viewä¼ å…¥setUpChildä¸­ï¼Œä¸è¿‡ä¸ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯trueï¼Œæ ‡è®°è¯¥viewæ˜¯ä½¿ç”¨çš„ç¼“å­˜ï¼Œæ ¹æ®è¯¥æ ‡è®°ï¼ŒsetUpChildæ–¹æ³•å†…ä¼šèµ°åˆ°attachViewToParent,å°†è¯¥view attachåˆ°ListViewä¸­ã€‚ä¸¤æ¬¡onLayoutæ€»ä½“æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>ä½¿ç”¨inflateråŠ è½½ç¬¬ä¸€å±æ•°æ®</li>
<li>å°†ç¬¬ä¸€å±æ•°æ®åŠ å…¥åˆ°recycleBinçš„ActiveViewsä¸­ï¼Œå¹¶å°†è¿™äº›viewä»ListViewä¸­ç§»é™¤</li>
<li>å°†ActiveViewsä¸­çš„viewå–å‡ºï¼Œé‡æ–°attachåˆ°ListViewä¸­</li>
</ul>
<p>&nbsp;&nbsp;ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨onLayouté˜¶æ®µï¼ŒActiveViewä¸»è¦æ˜¯ç¼“å­˜ç¬¬ä¸€æ¬¡åŠ è½½çš„æ•°æ®ï¼Œä»¥é¿å…å› ä¸ºä¸¤æ¬¡onLayoutäº§ç”Ÿé‡å¤æ•°æ®</p>
<h2 id="ä¸‰ã€å±å¹•æ»‘åŠ¨"><a href="#ä¸‰ã€å±å¹•æ»‘åŠ¨" class="headerlink" title="ä¸‰ã€å±å¹•æ»‘åŠ¨"></a>ä¸‰ã€å±å¹•æ»‘åŠ¨</h2><p>&nbsp;&nbsp;å±å¹•æ»‘åŠ¨çš„å¤„ç†æ˜¯å†™åœ¨AbsListViewä¸­ï¼Œè§¦æ‘¸ç›‘å¬å‡½æ•°æ˜¯onTouchEventï¼ˆï¼‰ï¼Œè¯¥å‡½æ•°ä¼šé’ˆå¯¹ä¸åŒç±»å‹çš„è§¦æ‘¸äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œè€Œåœ¨å±å¹•ä¸Šæ»‘åŠ¨äº‹ä»¶å¯¹åº”çš„æ˜¯ACTION_MOVE,è€Œè¯¥caseåˆåµŒå¥—ä¸€ä¸ªswitchåˆ†æ”¯ï¼Œé’ˆå¯¹TOUCH_MODEå¤„ç†ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹TOUCH_MODE_SRCOLL,å¯¹åº”æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨ã€‚åœ¨è¯¥caseå†…ï¼Œè°ƒç”¨äº†trackMotionScrollæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨ï¼ŒtrackMotionScrollå°±ä¼šè¢«è°ƒç”¨ï¼ŒtrackMotionä¸­æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>final boolean down = incrementalDeltaY&lt;0;
 if(down)
{
    final int top = listPadding.top - incrementalDeltaY;
    for (int i = 0; i &lt; childCount; i++) {
        final View child = getChildAt(i);
        if (child.getBottom() &gt;= top) {
            break;
        } else {
            count++;
            int position = firstPosition + i;
            if (position &gt;= headerViewsCount &amp;&amp; position &lt; footerViewsStart) {
                mRecycler.addScrapView(child);
            }
        }
    }
} else
{
    final int bottom = getHeight() - listPadding.bottom - incrementalDeltaY;
    for (int i = childCount - 1; i &gt;= 0; i--) {
        final View child = getChildAt(i);
        if (child.getTop() &lt;= bottom) {
            break;
        } else {
            start = i;
            count++;
            int position = firstPosition + i;
            if (position &gt;= headerViewsCount &amp;&amp; position &lt; footerViewsStart) {
                mRecycler.addScrapView(child);
            }
        }
    }
}
</code></pre><p>&nbsp;&nbsp;incrementalDeltaYæ˜¯ä¸Šæ¬¡è§¦å‘eventäº‹ä»¶æ—¶æ‰‹æŒ‡åœ¨yæ–¹å‘çš„æ”¹å˜é‡ï¼Œå¦‚æœå°äº0è¯´æ˜åœ¨å±å¹•ä¸Šä¸‹æ»‘ï¼Œè¿›å…¥downä¸ºtrueæµç¨‹ã€‚ä»ListViewç¬¬ä¸€ä¸ªchildå¼€å§‹åˆ¤æ–­ï¼Œåªè¦è¯¥viewçš„bottomå°äºListViewçš„topï¼Œè¯´æ˜è¯¥viewå·²ç»åˆ’å‡ºäº†å±å¹•ï¼Œè°ƒç”¨mRecycler.addScrapViewå°†è¯¥viewç¼“å­˜åˆ°scrapViewsä¸­,ç”¨countè®°å½•ä¸‹ç¼“å­˜çš„æ•°é‡ã€‚è¿™æ ·æ»‘å‡ºå±å¹•çš„viewå·²ç»ç¼“å­˜ä¸‹æ¥äº†ï¼Œç»§ç»­çœ‹æ¥ä¸‹æ¥ä»£ç :</p>
<pre><code>if (count &gt; 0) {
    detachViewsFromParent(start, count);
}
offsetChildrenTopAndBottom(incrementalDeltaY);  
if (down) {
    mFirstPosition += count;
}
invalidate();
final int absIncrementalDeltaY = Math.abs(incrementalDeltaY);  
if (spaceAbove &lt; absIncrementalDeltaY || spaceBelow &lt; absIncrementalDeltaY) {
    fillGap(down);
}
</code></pre><p>ä»£ç æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>è°ƒç”¨detachViewFromParentï¼Œå°†æ»‘å‡ºå±å¹•çš„viewä»ListViewä¸­detachæ‰</li>
<li>è°ƒç”¨offsetChildrenTopAndBottomæŒ‰ç…§ä¾¿å®œé‡å¹³ç§»å‰©ä¸‹çš„å­viewï¼Œå®ç°æ»‘åŠ¨æ•ˆæœ</li>
<li>è°ƒç”¨fillGapå¤„ç†å°†è¦æ»‘åŠ¨åˆ°å±å¹•å†…çš„view</li>
</ul>
<p>é‚£æˆ‘ä»¬çœ‹fillGapå¦‚ä½•å¤„ç†å°†è¦ç§»å…¥å±å¹•çš„å­viewçš„ï¼š</p>
<pre><code>void fillGap(boolean down) {
    final int count = getChildCount();
    if (down) {
        final int startOffset = count &gt; 0 ? getChildAt(count - 1).getBottom() + mDividerHeight :
                getListPaddingTop();
        fillDown(mFirstPosition + count, startOffset);
        correctTooHigh(getChildCount());
    } else {
        final int startOffset = count &gt; 0 ? getChildAt(0).getTop() - mDividerHeight :
                getHeight() - getListPaddingBottom();
        fillUp(mFirstPosition - 1, startOffset);
        correctTooLow(getChildCount());
    }
}
</code></pre><p>&nbsp;&nbsp;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ–¹æ³•å†…éƒ¨ä¸»è¦æ˜¯è°ƒç”¨äº†fillDownæˆ–è€…fillUpï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸‹fillDownçš„é€»è¾‘</p>
<ul>
<li>ä»activeViewä¸­è·å–ç¼“å­˜çš„view</li>
<li>è‹¥ç¬¬ä¸€æ­¥è·å–ä¸æˆåŠŸï¼Œåˆ™è°ƒç”¨obtainViewè·å–view</li>
<li>obtainViewä¼šå…ˆå°è¯•å¤ç”¨scrapViewä¸­çš„view</li>
<li>è‹¥ä¸Šä¸€æ­¥å¤ç”¨å¤±è´¥ï¼Œåˆ™ä½¿ç”¨inflateråŠ è½½å¸ƒå±€æ¥ç”Ÿæˆview</li>
<li>å°†å¾—åˆ°çš„viewä¼ å…¥setUpChildä¸­ä»¥åŠ å…¥ListViewä¸­</li>
</ul>
<p>&nbsp;&nbsp;ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ»‘åŠ¨å±å¹•æ—¶ï¼Œæ¯å½“æœ‰viewä»å±å¹•ä¸­ç§»å‡ºï¼Œå°±å…ˆç¼“å­˜åˆ°scrapViewsä¸­ï¼Œå†ä»ListViewä¸­ç§»é™¤è¯¥viewï¼Œè€Œæ¯å½“æœ‰viewè¦æ»‘å…¥å±å¹•ä¸­æ—¶ï¼Œä¼šä»scrapViewsä¸­å–å‡ºç¼“å­˜çš„view,å°†å…¶ä¸­çš„æ•°æ®æ›´æ–°ä¸ºç›¸åº”ä½ç½®çš„æ•°æ®ï¼Œå†åŠ å…¥åˆ°ListViewä¸­ï¼Œè¿™æ ·çš„å¾ªç¯ä½¿å¾—ListViewæ— è®ºåŠ è½½å¤šå°‘æ•°æ®ï¼Œéƒ½æ˜¯å›ºå®šæ•°é‡çš„viewåœ¨å¾ªç¯åˆ©ç”¨ï¼Œå†…å­˜éƒ½ä¸ä¼šå¢åŠ ã€‚</p>
<h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>&nbsp;&nbsp;ListViewé€šè¿‡activeViewè§£å†³ä¸¤æ¬¡onLayoutè¿‡ç¨‹ä¸­æ•°æ®é‡å¤é—®é¢˜ï¼Œé€šè¿‡scrapViewè§£å†³æ»‘åŠ¨è¿‡ç¨‹ä¸­viewå¤ç”¨é—®é¢˜ã€‚æ— è®ºæ˜¯onLayoutè¿‡ç¨‹è¿˜æ˜¯æ»‘åŠ¨è¿‡ç¨‹ï¼Œéƒ½æ˜¯é‡‡ç”¨attach-detach-attachçš„æ“ä½œæ€è·¯ï¼Œå°†ä¸¤ä¸ªé˜¶æ®µç»Ÿä¸€ä¸ºä¸€ä¸ªæŠ½è±¡æ“ä½œï¼Œä»¥å®ç°ä»£ç çš„å¤ç”¨ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦æ˜¯åˆ†æListViewæºç ï¼Œé‡ç‚¹å…³æ³¨å¤ç”¨æœºåˆ¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="caominkang" scheme="http://xgfe.github.io/categories/caominkang/"/>
    
    
      <category term="android" scheme="http://xgfe.github.io/tags/android/"/>
    
      <category term="æºç " scheme="http://xgfe.github.io/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="listview" scheme="http://xgfe.github.io/tags/listview/"/>
    
  </entry>
  
  <entry>
    <title>Less Vs Sass</title>
    <link href="http://xgfe.github.io/2018/01/26/zhoushiqi/Less-VS-Sass/"/>
    <id>http://xgfe.github.io/2018/01/26/zhoushiqi/Less-VS-Sass/</id>
    <published>2018-01-25T16:00:00.000Z</published>
    <updated>2018-05-29T03:15:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>é€šè¿‡ä¸€äº›å¯¹Less å’Œ Sass çš„ç ”ç©¶å’Œå­¦ä¹ ï¼Œé€æ¸å‘ç°äº†å®ƒä»¬ä¸€äº›å…±åŒç‰¹å¾ï¼ˆæ··å…¥ã€å‚æ•°æ··å…¥ã€åµŒå¥—è§„åˆ™ã€è¿ç®—ã€é¢œè‰²åŠŸèƒ½ã€åå­—ç©ºé—´ã€ä½œç”¨åŸŸã€JavaScript èµ‹å€¼ï¼‰å’Œ ä¸åŒä¹‹å¤„ï¼Œè¿™é‡Œä¸»è¦æ€»ç»“ä¸€äº› Less å’Œ Sass <strong>ç”¨æ³•ä¸åŒä¹‹å¤„</strong>ã€‚</p>
<a id="more"></a>
<h2 id="CSS-é¢„å¤„ç†å™¨"><a href="#CSS-é¢„å¤„ç†å™¨" class="headerlink" title="CSS é¢„å¤„ç†å™¨"></a>CSS é¢„å¤„ç†å™¨</h2><p>CSS é¢„å¤„ç†å™¨ï¼šç”¨ä¸€ç§ä¸“é—¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸º CSS å¢åŠ äº†ä¸€äº›ç¼–ç¨‹çš„ç‰¹æ€§ï¼Œå°† CSS ä½œä¸ºç›®æ ‡ç”Ÿæˆæ–‡ä»¶ï¼Œå¼€å‘è€…åªéœ€ä½¿ç”¨è¿™ç§è¯­è¨€å°±å¯è¿›è¡Œç¼–ç å·¥ä½œã€‚</p>
<h2 id="ç®€è¿°-Less-amp-Sass"><a href="#ç®€è¿°-Less-amp-Sass" class="headerlink" title="ç®€è¿° Less &amp; Sass"></a>ç®€è¿° Less &amp; Sass</h2><table><tr><td>Less</td><td>Sass</td></tr><tr><td>Less æ˜¯ä¸€é—¨ CSS é¢„å¤„ç†è¯­è¨€ï¼Œå®ƒæ‰©å……äº† CSS è¯­è¨€ï¼Œå¢åŠ äº†è¯¸å¦‚å˜é‡ã€æ··åˆï¼ˆmixinï¼‰ã€å‡½æ•°ç­‰åŠŸèƒ½ï¼Œè®© CSS æ›´æ˜“ç»´æŠ¤ã€æ–¹ä¾¿åˆ¶ä½œä¸»é¢˜ã€æ‰©å……ã€‚</td><td> Sass æ˜¯ä¸€é—¨é«˜äº CSS çš„å…ƒè¯­è¨€ï¼Œä¹Ÿæ˜¯ä¸€é—¨ CSS é¢„å¤„ç†è¯­è¨€ï¼Œå®ƒèƒ½ç”¨æ¥æ¸…æ™°åœ°ã€ç»“æ„åŒ–åœ°æè¿°æ–‡ä»¶æ ·å¼ï¼Œæœ‰ç€æ¯”æ™®é€š CSS æ›´åŠ å¼ºå¤§çš„åŠŸèƒ½ã€‚Sass èƒ½å¤Ÿæä¾›æ›´ç®€æ´ã€æ›´ä¼˜é›…çš„è¯­æ³•ï¼ŒåŒæ—¶æä¾›å¤šç§åŠŸèƒ½æ¥åˆ›å»ºå¯ç»´æŠ¤å’Œç®¡ç†çš„æ ·å¼è¡¨ã€‚ </td></tr></table>

<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><blockquote>
<ul>
<li>Less ï¼š npm install -g less</li>
<li>Sass ï¼š gem install sass</li>
</ul>
</blockquote>
<h2 id="Sass-amp-Less"><a href="#Sass-amp-Less" class="headerlink" title="Sass &amp; Less"></a>Sass &amp; Less</h2><h3 id="ç¼–è¯‘ç¯å¢ƒ"><a href="#ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒ"></a>ç¼–è¯‘ç¯å¢ƒ</h3><ul>
<li>Sass çš„å®‰è£…éœ€è¦ Ruby ç¯å¢ƒï¼Œæ˜¯åœ¨æœåŠ¡ç«¯å¤„ç†çš„ã€‚</li>
<li>Less æ˜¯éœ€è¦å¼•å…¥ less.js æ¥å¤„ç† Less ä»£ç è¾“å‡º CSS åˆ°æµè§ˆå™¨ï¼Œä¹Ÿå¯ä»¥åœ¨å¼€å‘ç¯èŠ‚ä½¿ç”¨Lessï¼Œç„¶åç¼–è¯‘æˆ CSS æ–‡ä»¶ï¼Œç›´æ¥æ”¾åˆ°é¡¹ç›®ä¸­ï¼Œä¹Ÿæœ‰ Less.appã€SimpleLessã€CodeKit.appè¿™æ ·çš„å·¥å…·ï¼Œä¹Ÿæœ‰åœ¨çº¿ç¼–è¯‘çš„ã€‚</li>
</ul>
<h3 id="å¼•ç”¨-import"><a href="#å¼•ç”¨-import" class="headerlink" title="å¼•ç”¨ @import"></a>å¼•ç”¨ @import</h3><ul>
<li><p>Less å¯ä»¥æ ¹æ®æ–‡ä»¶æ‰©å±•åä¸åŒè€Œç”¨ä¸åŒçš„æ–¹å¼å¤„ç†</p>
<ul>
<li>å¦‚æœæ–‡ä»¶æ˜¯.cssçš„æ‰©å±•åï¼Œå°†å¤„ç†ä¸º CSS å’Œ @import è¯­å¥ä¿æŒåŸæ ·ã€‚</li>
<li>å¦‚æœä¸ºå…¶ä»–çš„æ‰©å±•åå°†å¤„ç†ä¸º less å¯¼å…¥ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è¾ƒå°‘çš„æ‰©å±•ï¼Œé‚£ä¹ˆå®ƒå°†è¢«é™„åŠ å¹¶åŒ…å«ä¸ºå¯¼å…¥çš„è¾ƒå°‘æ–‡ä»¶ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ‰©å±•åï¼Œå°†ä¼šä¸ºä»–æ·»åŠ  .less æ‰©å±•åï¼Œä½œä¸º less å¯¼å…¥ã€‚</li>
<li>å¤šä¸ªå…³é”®å­— @import æ˜¯å…è®¸çš„ï¼Œä½ å¿…é¡»ä½¿ç”¨é€—å·åˆ†éš”å…³é”®å­—ï¼šexampleï¼š@import (optionalï¼Œ reference) â€œfoo.lessâ€ã€‚</li>
</ul>
</li>
<li><p>Sass çš„@importè§„åˆ™åœ¨ç”Ÿæˆ CSS æ–‡ä»¶æ—¶å°±æŠŠç›¸å…³æ–‡ä»¶å¯¼å…¥è¿›æ¥ã€‚Sass å…è®¸ @import å‘½ä»¤å†™åœ¨CSSè§„åˆ™å†…ã€‚è¿™ç§å¯¼å…¥æ–¹å¼ä¸‹ï¼Œç”Ÿæˆå¯¹åº”çš„ CSS æ–‡ä»¶æ—¶ï¼Œå±€éƒ¨æ–‡ä»¶ä¼šè¢«ç›´æ¥æ’å…¥åˆ°CSSè§„åˆ™å†…å¯¼å…¥å®ƒçš„åœ°æ–¹ã€‚è¢«å¯¼å…¥çš„å±€éƒ¨æ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œæ··åˆå™¨ï¼Œä¹Ÿä¼šåœ¨è¿™ä¸ªè§„åˆ™èŒƒå›´å†…ç”Ÿæ•ˆã€‚è¿™äº›å˜é‡å’Œæ··åˆå™¨ä¸ä¼šå…¨å±€æœ‰æ•ˆã€‚å¦å¤–ï¼Œæ‰€æœ‰åœ¨è¢«å¯¼å…¥æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡å’Œæ··åˆå™¨å‡å¯åœ¨å¯¼å…¥æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œåœ¨å°‘æ•°å‡ ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šè¢«ç¼–è¯‘æˆ CSS çš„ @import è§„åˆ™ï¼š</p>
<ul>
<li>å¦‚æœæ–‡ä»¶çš„æ‰©å±•åæ˜¯ .cssã€‚</li>
<li>å¦‚æœæ–‡ä»¶åä»¥ http:// å¼€å¤´ã€‚</li>
<li>å¦‚æœæ–‡ä»¶åæ˜¯ url()ã€‚</li>
<li><p>å¦‚æœ@importåŒ…å«äº†ä»»ä½•åª’ä½“æŸ¥è¯¢ï¼ˆmedia queriesï¼‰ã€‚</p>
<p>Scss/Sass å¼•ç”¨çš„å¤–éƒ¨æ–‡ä»¶å‘½åå¿…é¡»ä»¥ä¸‹åˆ’çº¿ <em> å¼€å¤´ï¼Œæ–‡ä»¶åå¦‚æœä»¥ä¸‹åˆ’çº¿ </em> å¼€å¤´çš„è¯ï¼ŒSass ä¼šè®¤ä¸ºè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªå¼•ç”¨æ–‡ä»¶ï¼Œè¿™å°†å‘Šè¯‰ Sass ä¸è¦æŠŠå®ƒç¼–è¯‘æˆ CSS æ–‡ä»¶ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="åµŒå¥—"><a href="#åµŒå¥—" class="headerlink" title="åµŒå¥—"></a>åµŒå¥—</h3><ul>
<li>Less<ul>
<li>å†…å±‚é€‰æ‹©å™¨å‰é¢çš„ &amp; ç¬¦å·å°±è¡¨ç¤ºå¯¹çˆ¶é€‰æ‹©å™¨çš„å¼•ç”¨ã€‚åœ¨ä¸€ä¸ªå†…å±‚é€‰æ‹©å™¨çš„å‰é¢ï¼Œå¦‚æœæ²¡æœ‰ &amp; ç¬¦å·ï¼Œåˆ™å®ƒè¢«è§£æä¸ºçˆ¶é€‰æ‹©å™¨çš„åä»£ï¼›å¦‚æœæœ‰ &amp; ç¬¦å·ï¼Œå®ƒå°±è¢«è§£æä¸ºçˆ¶å…ƒç´ è‡ªèº«æˆ–çˆ¶å…ƒç´ çš„ä¼ªç±»ã€‚</li>
</ul>
</li>
<li>Sass<ul>
<li>1.é€‰æ‹©å™¨åµŒå¥—ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &amp; è¡¨ç¤ºçˆ¶å…ƒç´ é€‰æ‹©å™¨ </li>
<li>2.Sass ä¸­è¿˜æä¾›å±æ€§åµŒå¥—ï¼Œæ‰€è°“å±æ€§åµŒå¥—æŒ‡çš„æ˜¯æœ‰äº›å±æ€§æ‹¥æœ‰åŒä¸€ä¸ªå¼€å§‹å•è¯ï¼Œå¦‚border-widthï¼Œborder-color éƒ½æ˜¯ä»¥ border å¼€å¤´ã€‚CSS æœ‰ä¸€äº›å±æ€§å‰ç¼€ç›¸åŒï¼Œåªæ˜¯åç¼€ä¸ä¸€æ · </li>
<li>3.å…¶å®ä¼ªç±»åµŒå¥—å’Œå±æ€§åµŒå¥—éå¸¸ç±»ä¼¼ï¼Œåªä¸è¿‡ä»–éœ€è¦å€ŸåŠ©<code>&amp;</code>ç¬¦å·ä¸€èµ·é…åˆä½¿ç”¨</li>
</ul>
</li>
</ul>
<h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><ul>
<li>Lessçš„å˜é‡å£°æ˜å’Œè°ƒç”¨ ï¼šç”¨@ </li>
<li>Sassçš„å˜é‡å£°æ˜å’Œè°ƒç”¨ ï¼šç”¨$</li>
</ul>
<table><tr><td>Less</td><td>Sass</td></tr><tr><td><img width="300px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntwpg061yj30nw0cwq62.jpg"></td><td><img width="300px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntwo1ksgcj30p80cugo9.jpg"></td></tr></table>

<h3 id="å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡"><a href="#å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡" class="headerlink" title="å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡"></a>å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡</h3><p>Both ï¼š å®šä¹‰å…¨å±€å˜é‡ï¼ˆåœ¨é€‰æ‹©å™¨ã€å‡½æ•°ã€é€‰æ‹©å®â€¦çš„å¤–é¢å®šä¹‰çš„å˜é‡ä¸ºå…¨å±€å˜é‡ï¼‰</p>
<table><tr><td>Less</td><td>Sass</td></tr><tr><td><img width="300px" height="150px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntwzi2wicj30pm0f4whn.jpg"></td><td><img width="300px" height="150px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntwzh8h1zj30ps0fgq67.jpg"></td></tr></table>

<h3 id="å·¥å…·åº“"><a href="#å·¥å…·åº“" class="headerlink" title="å·¥å…·åº“"></a>å·¥å…·åº“</h3><ul>
<li>Sasså·¥å…·åº“<ul>
<li><strong>Compass</strong>ã€‚<ul>
<li>ç‰¹ç‚¹ <ul>
<li>1ã€å‡å°‘é‡å¤å·¥ä½œï¼ŒåŠ å¿«å¼€å‘è¿›åº¦ </li>
<li>2ã€ä½¿ç”¨å˜é‡ï¼Œä¾¿äºè®°å¿†ï¼Œå˜é‡ä½¿ç”¨$ç¬¦å·å¼€å¤´ </li>
<li>3ã€è‡ªåŠ¨è½¬æ¢ RGBA é¢œè‰²å€¼ </li>
<li>4ã€Compass å¸¦æœ‰å¤§é‡æ··åˆå®ï¼Œå¯ä»¥å¿˜è®°æµè§ˆå™¨å‰ç¼€ï¼ŒèŠ‚çœå¤§é‡æ—¶é—´</li>
<li>5ã€åµŒå¥—è§„åˆ™ï¼Œä½¿ç”¨åµŒå¥—ï¼Œå‡å°‘ä»£ç é‡ </li>
<li>6ã€è®¾å¤‡æŸ¥è¯¢ï¼Œmedia queriesï¼Œä¸€æ ·æ˜¯ä½¿ç”¨æ··åˆå®ï¼Œå‡å°‘ä»£ç é‡ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´ </li>
<li>7ã€è‡ªåŠ¨å‹ç¼© CSS ä»£ç ï¼Œå†æ¬¡èŠ‚çœå¼€å‘æ—¶é—´ï¼Œæé«˜æ•ˆç›Š</li>
</ul>
</li>
<li>åªè¦å…ˆimport â€œcompass/<em><strong>CSS3</strong></em>â€ï¼Œ ä¹‹å¾Œå°±å¯ä»¥ä½¿ç”¨æ‰€æœ‰ CSS3 çš„å…§å®¹ï¼Œå¦‚border-radiusã€box-shadowã€gradientâ€¦ç­‰ï¼Œä½¿ç”¨æ–¹å¼æ˜¯ @include ï¼Œå…¶å®æ˜¯ compass å¸®ä½ å†™å¥½äº† @mixin ï¼Œä½ åªè¦ä¼šç”¨å°±å¥½ï¼Œè€Œcompasså‰å®³çš„å°±æ˜¯ä¼šåŒæ—¶å¸®ä½ äº§ç”Ÿå„å€‹æµè§ˆå™¨ç›¸å¯¹åº”çš„CSSã€‚</li>
<li>åœ¨ compass æ–°å»ºçš„é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ–°å»º images æ–‡ä»¶å¤¹ã€‚ åœ¨ images æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨äºæ”¾ç½®è¦åˆæˆçš„å›¾ç‰‡ã€‚ åœ¨é¡¹ç›®çš„ Sass æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ã€‚å°±èƒ½çœ‹åˆ°åœ¨ images æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆäº†ä¸€ä¸ª<em><strong>é›ªç¢§å›¾</strong></em>ã€‚</li>
</ul>
</li>
<li><strong>SCUT</strong>ã€‚SCUT æ˜¯æä¾›ç»™å‰ç«¯å¼€å‘è€…çš„ Sass å·¥å…·é›†ï¼Œèƒ½å¸®åŠ©æé«˜å¯¹ä¸€èˆ¬æ ·å¼ä»£ç æ¨¡å¼çš„æ‰§è¡Œï¼ˆimplementations of common style-code patternsï¼‰ã€‚Scut å·¥å…·é›†å¯ä»¥å¸®åŠ©ç”¨æˆ·é¿å…é‡å¤å†™ä»£ç ï¼Œæ‰©å¤§ä»£ç çš„å¯é‡ç”¨æ€§ã€‚Scut å·¥å…·é›†å¯ä»¥å¤„ç†æ¨¡å¼ï¼ˆpatternsï¼‰é‡åˆ°çš„ä¸‹åˆ—é—®é¢˜ï¼špattern æ˜¯ä¸ç›´è§‚çš„ã€‚pattern éœ€è¦ç®€å†™ pattern æ¶‰åŠåˆ°ä¸€äº›é‡è¦çš„æœ€ä½³å®è·µ pattern æ˜¯æä¸ºå¸¸è§çš„ï¼Œï¼ˆè‡³å°‘ï¼‰æœ‰ç‚¹è®¨åŒã€‚Scut å·¥å…·é›†çš„ç›®æ ‡æ˜¯å®ç°å¯é‡ç”¨æ€§çš„æœ€å¤§åŒ–ï¼ˆmaximizies reusabilitï¼‰ã€‚</li>
<li><strong>Koala</strong>ã€‚Sass å’Œ Less ä¸ä¸€æ ·ï¼Œéœ€è¦åœ¨æœ¬åœ°ç¼–è¯‘æˆ CSS æ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå¾ˆå¼ºå¤§çš„<em><strong>ç¼–è¯‘å·¥å…·</strong></em>æ‰æ˜¯é‡ä¸­ä¹‹é‡ã€‚å¦‚æœä½ ä¸ä¼šå®‰è£… ruby ï¼Œæ›´æ˜¯æ²¡å¬è¿‡å®ƒ;å¦‚æœä½ å®‰è£…äº† Rubyï¼Œä½†æ˜¯ä¸ä¼šç”¨å®ƒï¼Œé‚£ä¹ˆå°±æœæ–­ç”¨ Koala å§ã€‚<ul>
<li>ç‰¹ç‚¹ï¼š<ul>
<li>1ã€å¤šè¯­è¨€æ”¯æŒ     </li>
<li>2ã€å®æ—¶ç¼–è¯‘ã€€</li>
<li>3ã€ç¼–è¯‘é€‰é¡¹ã€€</li>
<li>4ã€å¼ºå¤§çš„æ–‡ä»¶å³é”®åŠŸèƒ½ã€€</li>
<li>5ã€é”™è¯¯æç¤º </li>
<li>6ã€è·¨å¹³å°ã€€</li>
<li>7ã€å…è´¹ä¸”è´Ÿè´£</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Lesså·¥å…·åº“<ul>
<li>æœ‰UIç»„ä»¶åº“<strong>Bootstrap</strong>ï¼ŒBootstrap æ˜¯ webå‰ç«¯å¼€å‘ä¸­ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„å‰ç«¯UIç»„ä»¶åº“ï¼ŒBootstrapçš„æ ·å¼æ–‡ä»¶éƒ¨åˆ†æºç å°±æ˜¯é‡‡ç”¨ Less è¯­æ³•ç¼–å†™ã€‚</li>
<li>Lesså·¥å…·åº“<strong>EST</strong>ã€‚ ESTï¼ˆEFE Styling Toolkitï¼‰æ˜¯ä¸€ä¸ªåŸºäºLessçš„æ ·å¼å·¥å…·åº“ï¼Œå¸®åŠ©æ‚¨æ›´è½»æ¾åœ°ä¹¦å†™ Less ä»£ç ã€‚EST æä¾›äº†ä¸€ç³»åˆ—æ–¹ä¾¿å¿«æ·çš„ mixinï¼Œåªåœ¨è°ƒç”¨æ—¶æ‰è¾“å‡ºä»£ç ã€‚è¯¥é¡¹ç›®ç”± EFE å›¢é˜Ÿå¼€å‘è€Œæ¥ï¼Œé¡¹ç›®æ‰˜ç®¡åœ¨ <a href="httpsï¼š//github.com/ecomfe/est/">GitHub</a> ä¸Šã€‚ESTä¸å¸Œæœ›æä¾›ç›´æ¥ç»™HTMLè°ƒç”¨çš„ç±»åï¼Œç”¨ã€Œæ ·å¼ç±»ã€æ±¡æŸ“HTMLä»£ç çš„è¯­ä¹‰ã€‚å½“ç„¶æ‚¨ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„é¡¹ç›®éœ€æ±‚åŸºäº EST æ­å»ºæ ·å¼ç±»åº“ï¼Œæä¾›ç±»åæ¥å£æ¥è¿›è¡Œå¿«é€Ÿå¼€å‘ã€‚</li>
</ul>
</li>
</ul>
<h3 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h3><p>1.åœ¨ Less é‡Œä½ å¯ä»¥ç”¨é€’å½’å‡½æ•°é€šè¿‡æ•°å€¼æ¥å¾ªç¯ï¼š</p>
<pre><code>.looper (@i) when (@i &gt; 0) {
  .image-class-@{i} {
    backgroundï¼š url(â€œ../img/@{i}.pngâ€) no-repeat;
  }
  .looper(@i â€“ 1);
}
.looper(0);
.looper(3);
</code></pre><p>2.åœ¨ Sass é‡Œä½ å¯ä»¥é€šè¿‡ä»»ä½•æ•°æ®æ¥è¿­ä»£ï¼š</p>
<pre><code>@each $beer in stoutï¼Œ pilsnerï¼Œ lager {
  .#{$beer}-background {
    backgroundï¼š url(â€œ../img/beers/#{$beer}.pngâ€) no-repeat;
  }
}
</code></pre><h3 id="æ¡ä»¶è¯­å¥-Lessä¸­ç§°ä½œå¼•å¯¼"><a href="#æ¡ä»¶è¯­å¥-Lessä¸­ç§°ä½œå¼•å¯¼" class="headerlink" title="æ¡ä»¶è¯­å¥(Lessä¸­ç§°ä½œå¼•å¯¼)"></a>æ¡ä»¶è¯­å¥(Lessä¸­ç§°ä½œå¼•å¯¼)</h3><ul>
<li>Less ï¼š å¯ä»¥é€šè¿‡ when è¯­å¥åˆ¤æ–­æ¡ä»¶</li>
<li>Sass ï¼š é€šè¿‡ @if å’Œ @else çš„æ–¹å¼è¿›è¡Œæ¡ä»¶åˆ¤æ–­</li>
</ul>
<table><tr><td>Less</td><td>Sass</td></tr><tr><td rowspan="2"><img width="400px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fnty9d44q4j30pi0bcacy.jpg"></td><td><img width="300px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fnty9br31dj30p40iqdjj.jpg"></td></tr></table>

<h3 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h3><ul>
<li>Less çš„ä½œç”¨åŸŸæ˜¯æŒ‰ç…§ä»£ç çš„ä»ä¸Šè‡³ä¸‹çš„é¡ºåºè¿›è¡Œçš„</li>
<li>Sass çš„ä½œç”¨åŸŸæ˜¯æŒ‰ç…§æœ€åä¸€æ¬¡å®šä¹‰å½±å“å…¨å±€çš„</li>
</ul>
<table><tr><td>Less</td><td>Sass</td></tr><tr><td><img width="150px" height="300px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntwsyxnt0j30fi0qqacf.jpg"></td><td><img width="150px" height="300px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntwsw1rouj30fg0qodi7.jpg"></td></tr></table>

<h3 id="è¾“å‡ºæ ¼å¼"><a href="#è¾“å‡ºæ ¼å¼" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h3><ul>
<li>Less ï¼šå¹¶æ²¡æœ‰è¾“å‡ºè®¾ç½®</li>
<li>Sass ï¼šæä¾›4ç§è¾“å‡ºé€‰é¡¹ï¼šnestedï¼Œcompactï¼Œcompressed å’Œ expanded</li>
</ul>
<h3 id="Mixins-æ··åˆå®"><a href="#Mixins-æ··åˆå®" class="headerlink" title="Mixins (æ··åˆå®)"></a>Mixins (æ··åˆå®)</h3><ul>
<li>Less ï¼šæ”¯æŒå¸¦å‚æ•°çš„æ··åˆä»¥åŠæœ‰é»˜è®¤å‚æ•°å€¼çš„æ··åˆ</li>
<li>Sass ï¼šæœ‰æ˜ç¡®çš„å®šä¹‰ï¼š @Mixin + å® è°ƒç”¨ ï¼š @include + å®</li>
</ul>
<table><tr><td>Less</td><td>Sass</td></tr><tr><td><img width="300px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntxaheqwoj30n00kin0g.jpg"></td><td><img width="300px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntxak5ku1j30my0ketcd.jpg"></td></tr></table>

<h3 id="Parametric-Mixins-å‚æ•°æ··å…¥"><a href="#Parametric-Mixins-å‚æ•°æ··å…¥" class="headerlink" title="Parametric-Mixins (å‚æ•°æ··å…¥)"></a>Parametric-Mixins (å‚æ•°æ··å…¥)</h3><p>æ··åˆå®ä½¿ç”¨ä¸­å‚æ•°ä½¿ç”¨ï¼š</p>
<ul>
<li>Less ï¼š @</li>
<li>Sass ï¼š $ + @mixin + @include</li>
</ul>
<table><tr><td>Less</td><td>Sass</td></tr><tr><td><img width="300px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntxcz0u3aj30ng0dwq55.jpg"></td><td><img width="300px" height="100px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntxcz7mboj30nm0e0wgz.jpg"></td></tr></table>

<h3 id="Placeholder-å ä½ç¬¦"><a href="#Placeholder-å ä½ç¬¦" class="headerlink" title="Placeholder (å ä½ç¬¦)"></a>Placeholder (å ä½ç¬¦)</h3><ul>
<li>Less ï¼š Null</li>
<li>Sass ï¼š å¯ä»¥ä½¿ç”¨ <strong>%</strong> ä½œä¸ºå ä½ç¬¦</li>
</ul>
<h3 id="è¿ç®—"><a href="#è¿ç®—" class="headerlink" title="è¿ç®—"></a>è¿ç®—</h3><p>Sass åœ¨æ•°å­—ä¸Šæ¯” Less æ›´ä¸“ä¸šã€‚å®ƒå·²ç»å¯ä»¥æ¢ç®—å•ä½äº†ã€‚Sass å¯ä»¥å¤„ç†æ— æ³•è¯†åˆ«çš„åº¦é‡å•ä½å¹¶å°†å…¶è¾“å‡ºã€‚è¿™ä¸ªç‰¹æ€§å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªå¯¹æœªæ¥çš„å°è¯•â€”â€”è¯æ˜W3Cä½œå‡ºçš„ä¸€äº›æ”¹å˜ã€‚</p>
<ul>
<li>Sass ï¼š 2in + 3cm + 2pc = 3.514in </li>
<li>Less ï¼š 2in + 3cm + 2pc = Error</li>
</ul>
<h3 id="é€‰æ‹©å™¨ç»§æ‰¿"><a href="#é€‰æ‹©å™¨ç»§æ‰¿" class="headerlink" title="é€‰æ‹©å™¨ç»§æ‰¿"></a>é€‰æ‹©å™¨ç»§æ‰¿</h3><ul>
<li>Sass å®šä¹‰çš„é€‰æ‹©å™¨å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ä½¿ç”¨</li>
<li>Less æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½</li>
</ul>
<table><tr><td>Less</td><td>Sass</td></tr><tr><td>Null</td><td><img width="300px" height="150px" src="https://ws1.sinaimg.cn/large/0073X7Nbly1fntxsqoiopj30p60kmn0e.jpg"></td></tr></table>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="å¼€å‘ä¸­å¦‚ä½•é€‰æ‹©ä½¿ç”¨Lessè¿˜æ˜¯Sass"><a href="#å¼€å‘ä¸­å¦‚ä½•é€‰æ‹©ä½¿ç”¨Lessè¿˜æ˜¯Sass" class="headerlink" title="å¼€å‘ä¸­å¦‚ä½•é€‰æ‹©ä½¿ç”¨Lessè¿˜æ˜¯Sass?"></a>å¼€å‘ä¸­å¦‚ä½•é€‰æ‹©ä½¿ç”¨Lessè¿˜æ˜¯Sass?</h3><ul>
<li><strong>ç›¸åŒç‚¹</strong>ï¼šä¸¤è€…éƒ½æ˜¯ CSS é¢„å¤„ç†å™¨ï¼Œéƒ½å…·æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç¼–è¯‘ä»£ç ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„ç»´æŠ¤æˆ‘ä»¬çš„æ ·å¼ä»£ç æˆ–è€…è¯´ç»´æŠ¤é¡¹ç›®å§ã€‚</li>
<li><strong>ä¸åŒç‚¹</strong>ï¼šLess ç›¸å¯¹æ¸…æ™°æ˜äº†ï¼Œæ˜“äºä¸Šæ‰‹ï¼Œå¯¹ç¼–è¯‘ç¯å¢ƒè¦æ±‚æ¯”è¾ƒå®½æ¾ã€‚Sass çš„åŠŸèƒ½æ¯” Less å¼ºå¤§ï¼Œæ˜¯ä¸‹ä¸€ä¸ªå±‚æ¬¡çš„é€‰æ‹©ï¼Œé€‚åˆç¨å¾®æœ‰ç»éªŒçš„å‰ç«¯å¼€å‘è€…ã€‚</li>
<li>æ ¹æ®ä¸šåŠ¡çº¿éœ€æ±‚ã€ç»„å†…æˆå‘˜æƒ…å†µï¼Œè¿›è¡Œçº¦å®šã€‚</li>
<li>æŒ‰éœ€ä½¿ç”¨ï¼Œéšä¹ æƒ¯æ‰€ä¸ºï¼</li>
</ul>
<h3 id="ç›¸å…³å‚è€ƒ"><a href="#ç›¸å…³å‚è€ƒ" class="headerlink" title="ç›¸å…³å‚è€ƒ"></a>ç›¸å…³å‚è€ƒ</h3><blockquote>
<p><a href="http://lessCSS.cn/" target="_blank" rel="external">http://lessCSS.cn/</a> </p>
<p><a href="https://www.sass.hk/" target="_blank" rel="external">https://www.sass.hk/</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é€šè¿‡ä¸€äº›å¯¹Less å’Œ Sass çš„ç ”ç©¶å’Œå­¦ä¹ ï¼Œé€æ¸å‘ç°äº†å®ƒä»¬ä¸€äº›å…±åŒç‰¹å¾ï¼ˆæ··å…¥ã€å‚æ•°æ··å…¥ã€åµŒå¥—è§„åˆ™ã€è¿ç®—ã€é¢œè‰²åŠŸèƒ½ã€åå­—ç©ºé—´ã€ä½œç”¨åŸŸã€JavaScript èµ‹å€¼ï¼‰å’Œ ä¸åŒä¹‹å¤„ï¼Œè¿™é‡Œä¸»è¦æ€»ç»“ä¸€äº› Less å’Œ Sass &lt;strong&gt;ç”¨æ³•ä¸åŒä¹‹å¤„&lt;/strong&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="zhoushiqi" scheme="http://xgfe.github.io/categories/zhoushiqi/"/>
    
    
      <category term="CSS" scheme="http://xgfe.github.io/tags/CSS/"/>
    
      <category term="Less" scheme="http://xgfe.github.io/tags/Less/"/>
    
      <category term="Sass" scheme="http://xgfe.github.io/tags/Sass/"/>
    
  </entry>
  
  <entry>
    <title>Web ç«¯å±å¹•é€‚é…æ–¹æ¡ˆ</title>
    <link href="http://xgfe.github.io/2018/01/26/zhoushiqi/Web%E7%AB%AF%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D%E6%96%B9%E6%A1%88/"/>
    <id>http://xgfe.github.io/2018/01/26/zhoushiqi/Webç«¯å±å¹•é€‚é…æ–¹æ¡ˆ/</id>
    <published>2018-01-25T16:00:00.000Z</published>
    <updated>2018-05-29T03:15:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>é€šè¿‡å¯¹ç°æœ‰ Web ç«¯å±å¹•é€‚é…æ–¹æ¡ˆçš„æ€»ç»“ï¼Œå¼•èµ·å¯¹æ›´å¥½çš„ Web ç«¯å±å¹•é€‚é…æ–¹æ¡ˆçš„è°ƒç ”ã€‚åœ¨è°ƒç ”ä¸­å‘ç°äº†ç°å®ä¸­å‡ºç°çš„ Web ç«¯ç§»åŠ¨ç«¯é€‚é…ç›¸å…³é—®é¢˜ï¼Œå¹¶æ¨èç›¸åº”è§£å†³æ–¹æ¡ˆï¼Œå’Œå±å¹•é€‚é…æ–¹æ¡ˆã€‚</p>
<a id="more"></a>
<h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="åƒç´ ç›¸å…³"><a href="#åƒç´ ç›¸å…³" class="headerlink" title="åƒç´ ç›¸å…³"></a>åƒç´ ç›¸å…³</h3><ol>
<li><strong>åƒç´ </strong> ï¼šåƒç´ æ˜¯å±å¹•æ˜¾ç¤ºæœ€å°çš„å•ä½ã€‚</li>
<li><strong>è®¾å¤‡åƒç´ </strong> ï¼šè®¾å¤‡åƒç´ åˆç§°ç‰©ç†åƒç´ ï¼ˆphysical pixelï¼‰ï¼Œè®¾å¤‡èƒ½æ§åˆ¶æ˜¾ç¤ºçš„æœ€å°å•ä½ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›åƒç´ çœ‹ä½œæˆæ˜¾ç¤ºå™¨ä¸Šä¸€ä¸ªä¸ªçš„ç‚¹ã€‚ iPhone5 çš„ç‰©ç†åƒç´ æ˜¯ 640 X 1136 ã€‚</li>
<li><strong>é€»è¾‘åƒç´ </strong>ï¼ˆlogical pixelï¼‰ï¼šç‹¬ç«‹äºè®¾å¤‡çš„ç”¨äºé€»è¾‘ä¸Šè¡¡é‡åƒç´ çš„å•ä½ã€‚CSS åƒç´ å°±æ˜¯é€»è¾‘åƒç´ ï¼ŒCSS åƒç´ æ˜¯ Web ç¼–ç¨‹çš„æ¦‚å¿µã€‚</li>
<li><strong>è®¾å¤‡ç‹¬ç«‹åƒç´ </strong>ï¼ˆdensity-independent pixelï¼‰ï¼šç®€ç§° dip ï¼Œå•ä½ dp ï¼Œç‹¬ç«‹äºè®¾å¤‡çš„ç”¨äºé€»è¾‘ä¸Šè¡¡é‡åƒç´ çš„å•ä½ ã€‚ä¸”é€»è¾‘åƒç´  â‰ˆ è®¾å¤‡ç‹¬ç«‹åƒç´ ã€‚</li>
<li><strong>è®¾ç½®åƒç´ æ¯”</strong>ï¼ˆdevice pixel ratiodprï¼‰ï¼šdpr = ç‰©ç†åƒç´  / è®¾å¤‡ç‹¬ç«‹åƒç´ ã€‚å¯é€šè¿‡ window.devicePixelRatio è·å–ã€‚æ‰€è°“çš„ä¸€å€å±ã€äºŒå€å±(Retina)ã€ä¸‰å€å±ï¼ŒæŒ‡çš„æ˜¯è®¾å¤‡ä»¥å¤šå°‘ç‰©ç†åƒç´ æ¥æ˜¾ç¤ºä¸€ä¸ª CSS åƒç´ å³ï¼šå‡  dprã€‚<br>æ™®é€š Android æ˜¯ä¸€å€å±ï¼Œåœ¨ Retina å±çš„ iPhone ä¸Šï¼ŒdevicePixelRatio çš„å€¼ä¸º 2ï¼Œä¹Ÿå°±æ˜¯è¯´ 1 ä¸ª CSS åƒç´ ç›¸å½“äº 2 ä¸ªç‰©ç†åƒç´ ã€‚é€šå¸¸æ‰€è¯´çš„äºŒå€å±ï¼ˆRetinaï¼‰çš„ dpr æ˜¯ 2ï¼Œ ä¸‰å€å±ï¼ˆIPhoneX ç­‰ï¼‰æ˜¯ 3 ã€‚</li>
</ol>
<h3 id="viewport-ç›¸å…³"><a href="#viewport-ç›¸å…³" class="headerlink" title="viewport ç›¸å…³"></a>viewport ç›¸å…³</h3><p><code>&lt;meta name=&quot;viewport&quot;   content=&quot;width=device-width, initial-scale=1,
 maximum-scale=1, user-scalable=no&quot;&gt;</code></p>
<ol>
<li><strong>visual viewport å¯è§è§†å£</strong> ï¼šå±å¹•å®½åº¦window.innerWidth/Height</li>
<li><strong>layout viewport å¸ƒå±€è§†å£</strong> ï¼šDOMå®½document.documentElement.clientWidth/Height</li>
<li><strong>ideal viewport ç†æƒ³è§†å£</strong> ï¼šä½¿å¸ƒå±€è§†å£å°±æ˜¯å¯è§è§†å£</li>
<li><strong>width=device-width</strong> ï¼šè¡¨ç¤ºå®½åº¦æ˜¯è®¾å¤‡å±å¹•çš„å®½åº¦</li>
<li><strong>initial-scale</strong> ï¼šè¡¨ç¤ºåˆå§‹çš„ç¼©æ”¾æ¯”ä¾‹</li>
<li><strong>minimum-scale</strong> ï¼šè¡¨ç¤ºæœ€å°çš„ç¼©æ”¾æ¯”ä¾‹</li>
<li><strong>maximum-scale</strong> ï¼šè¡¨ç¤ºæœ€å¤§çš„ç¼©æ”¾æ¯”ä¾‹</li>
<li><strong>user-scalable</strong> ï¼šè¡¨ç¤ºç”¨æˆ·æ˜¯å¦å¯ä»¥è°ƒæ•´ç¼©æ”¾æ¯”ä¾‹</li>
</ol>
<h2 id="æ€»ç»“ç°æœ‰æ–¹æ¡ˆä¼˜åŠ£"><a href="#æ€»ç»“ç°æœ‰æ–¹æ¡ˆä¼˜åŠ£" class="headerlink" title="æ€»ç»“ç°æœ‰æ–¹æ¡ˆä¼˜åŠ£"></a>æ€»ç»“ç°æœ‰æ–¹æ¡ˆä¼˜åŠ£</h2><p><strong>ç°æœ‰å±å¹•é€‚é…æ–¹æ¡ˆ ï¼š</strong> </p>
<ul>
<li>è®¾ç½® viewport çš„ scale å€¼ä¸º 1</li>
</ul>
<p><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0&quot;&gt;</code></p>
<ul>
<li>æ ¹æ®å±å¹•çš„åˆ†è¾¨ç‡åŠ¨æ€è®¾ç½® html çš„æ–‡å­—å¤§å°ï¼Œè¾¾åˆ°ç­‰æ¯”ç¼©æ”¾çš„åŠŸèƒ½</li>
</ul>
<p><code>375 å±å¹•ä¸º 20pxï¼Œä»¥æ­¤ä¸ºåŸºç¡€è®¡ç®—å‡ºæ¯ä¸€ç§å®½åº¦çš„å­—ä½“å¤§å°</code></p>
<ul>
<li><p>Rem.less ä¸­è®¾ç½®å…¶ä»–åŸºç¡€å°ºå¯¸ @bps ï¼š320pxï¼Œ 360pxï¼Œ 375pxï¼Œ 400pxï¼Œ 414pxï¼Œ 480pxï¼Œ 768pxï¼Œ 1024px<br>å¹¶è®¡ç®—ç›¸åº”çš„æ¯”ä¾‹ç¼©æ”¾ï¼š</p>
<pre><code>.loop(@i: 1) when (@i &lt;= length(@bps)) {  //æ³¨æ„lessæ•°ç»„æ˜¯ä»1å¼€å§‹çš„
  @bp: extract(@bps, @i);
  @font: round(@bp/@baseWidth*@baseFont, 1);
  @media only screen and (min-width: @bp){
    html {
      font-size: @font !important;
    }
  }
  .loop((@i + 1));
};
</code></pre></li>
<li><p>ç„¶ååœ¨ variables.less ä¸­è®¾ç½®æ¯”ä¾‹å’Œè¡Œé«˜ï¼š </p>
</li>
</ul>
<p><code>@2ptr : 1/2/20rem @ptr : 1/20rem</code></p>
<ul>
<li>æœ€åæ‰€æœ‰ CSS ä½¿ç”¨ @2ptr å’Œ @ptr åˆ©ç”¨ rem ç¼©æ”¾ dom ã€å­—ä½“</li>
</ul>
<h2 id="å…¶ä»–ä¸»æµé€‚é…æ–¹æ¡ˆä¼˜åŠ£"><a href="#å…¶ä»–ä¸»æµé€‚é…æ–¹æ¡ˆä¼˜åŠ£" class="headerlink" title="å…¶ä»–ä¸»æµé€‚é…æ–¹æ¡ˆä¼˜åŠ£"></a>å…¶ä»–ä¸»æµé€‚é…æ–¹æ¡ˆä¼˜åŠ£</h2><h3 id="æ–¹æ¡ˆï¼š"><a href="#æ–¹æ¡ˆï¼š" class="headerlink" title="æ–¹æ¡ˆï¼š"></a>æ–¹æ¡ˆï¼š</h3><h4 id="1-åª’ä½“æŸ¥è¯¢-Media-Queries"><a href="#1-åª’ä½“æŸ¥è¯¢-Media-Queries" class="headerlink" title="1. åª’ä½“æŸ¥è¯¢ Media Queries"></a>1. åª’ä½“æŸ¥è¯¢ Media Queries</h4><p><code>@media screen and (max-width: 300px){}</code></p>
<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>Media Queries å¯ä»¥åšåˆ°è®¾å¤‡åƒç´ æ¯”çš„åˆ¤æ–­ï¼Œæ–¹æ³•ç®€å•ï¼Œæˆæœ¬ä½ï¼Œç‰¹åˆ«æ˜¯å¯¹ç§»åŠ¨å’Œ PC ç»´æŠ¤åŒä¸€å¥—ä»£ç çš„æ—¶å€™ã€‚ç›®å‰åƒ Bootstrap ç­‰æ¡†æ¶ä½¿ç”¨è¿™ç§æ–¹å¼å¸ƒå±€</li>
<li>å›¾ç‰‡ä¾¿äºä¿®æ”¹ï¼Œåªéœ€ä¿®æ”¹ CSS æ–‡ä»¶</li>
<li>è°ƒæ•´å±å¹•å®½åº¦çš„æ—¶å€™ä¸ç”¨åˆ·æ–°é¡µé¢å³å¯å“åº”å¼å±•ç¤º</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>ä»£ç é‡æ¯”è¾ƒå¤§ï¼Œç»´æŠ¤ä¸æ–¹ä¾¿</li>
<li>ä¸ºäº†å…¼é¡¾å¤§å±å¹•æˆ–é«˜æ¸…è®¾å¤‡ï¼Œä¼šé€ æˆå…¶ä»–è®¾å¤‡èµ„æºæµªè´¹ï¼Œç‰¹åˆ«æ˜¯åŠ è½½å›¾ç‰‡èµ„æº</li>
<li>ä¸ºäº†å…¼é¡¾ç§»åŠ¨ç«¯å’ŒPCç«¯å„è‡ªå“åº”å¼çš„å±•ç¤ºæ•ˆæœï¼Œéš¾å…ä¼šæŸå¤±å„è‡ªç‰¹æœ‰çš„äº¤äº’æ–¹å¼</li>
</ul>
</li>
</ul>
<h5 id="æµè§ˆå™¨å…¼å®¹"><a href="#æµè§ˆå™¨å…¼å®¹" class="headerlink" title="æµè§ˆå™¨å…¼å®¹"></a>æµè§ˆå™¨å…¼å®¹</h5><ul>
<li>ä¸æ”¯æŒ IE 8.0 åŠä»¥ä¸‹ã€Safari 3.2 åŠä»¥ä¸‹ã€FireFox 3.0 åŠä»¥ä¸‹</li>
<li><img width="600px" height="300px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnv6ygswjj21ic0v0428.jpg"></li>
</ul>
<h4 id="2-Flex-å¼¹æ€§å¸ƒå±€"><a href="#2-Flex-å¼¹æ€§å¸ƒå±€" class="headerlink" title="2. Flex å¼¹æ€§å¸ƒå±€"></a>2. Flex å¼¹æ€§å¸ƒå±€</h4><ul>
<li>å›ºå®š viewport çš„é«˜åº¦ç­‰äºè®¾å¤‡é«˜åº¦ï¼Œå®½åº¦è‡ªé€‚åº”ï¼Œå…ƒç´ éƒ½é‡‡ç”¨ px åšå•ä½</li>
</ul>
<p><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</code></p>
<ul>
<li>éšç€å±å¹•å®½åº¦å˜åŒ–ï¼Œé¡µé¢ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œæ•ˆæœå°±å’ŒPCé¡µé¢çš„æµä½“å¸ƒå±€å·®ä¸å¤šï¼Œåœ¨å“ªä¸ªå®½åº¦éœ€è¦è°ƒæ•´çš„æ—¶å€™ä½¿ç”¨å“åº”å¼å¸ƒå±€è°ƒè°ƒå°±è¡Œï¼ˆæ¯”å¦‚ç½‘æ˜“æ–°é—»ï¼‰</li>
</ul>
<p><img width="600px" height="300px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqj1u1yzs5j20oa0e6taz.jpg"></p>
<ul>
<li>ä¼˜ç‚¹ï¼šå¸ƒå±€æ›´åŠ ç²¾ç®€ï¼Œç›´æ¥ç”¨ CSS çš„æ–¹å¼ï¼Œä½ ä¸ç”¨å†å¼•å…¥ Bootstrap ï¼Œä½¿ç”¨æ …æ ¼ç³»ç»Ÿ</li>
<li>ç¼ºç‚¹ï¼šIE10 åŠ IE10 ä»¥ä¸Šæ‰æ”¯æŒï¼Œæ‰€ä»¥ç›®å‰ä¸»è¦åº”ç”¨åœ¨ç§»åŠ¨ç«¯ä¸Š</li>
</ul>
<h5 id="æµè§ˆå™¨æ”¯æŒ"><a href="#æµè§ˆå™¨æ”¯æŒ" class="headerlink" title="æµè§ˆå™¨æ”¯æŒ"></a>æµè§ˆå™¨æ”¯æŒ</h5><ul>
<li>ä¸æ”¯æŒ IE 9.0 åŠä»¥ä¸‹ã€Opera 11.5 åŠä»¥ä¸‹ã€Opera Mobile 12åŠä»¥ä¸‹</li>
<li><img width="800px" height="200px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnvqmc091j21hi0f2q4y.jpg"></li>
</ul>
<h4 id="3-rem-viewport"><a href="#3-rem-viewport" class="headerlink" title="3. rem + viewport"></a>3. rem + viewport</h4><ul>
<li>æ ¹æ®å±å¹•å®½åº¦è®¾å®š rem å€¼ï¼Œéœ€è¦é€‚é…çš„å…ƒç´ éƒ½ä½¿ç”¨ rem ä¸ºå•ä½ï¼Œä¸éœ€è¦é€‚é…çš„å…ƒç´ è¿˜æ˜¯ä½¿ç”¨ px ä¸ºå•ä½</li>
<li><p>æ ¹æ® rem å°†é¡µé¢æ”¾å¤§ dpr å€ï¼Œ ç„¶å viewport è®¾ç½®ä¸º 1 / dpr</p>
<p>   <em>å¦‚ iPhone6 plus çš„ dpr ä¸º 3ï¼Œ åˆ™é¡µé¢æ•´ä½“æ”¾å¤§ 3 å€ï¼Œ 1px (csså•ä½)åœ¨plusä¸‹é»˜è®¤ä¸º 3px (ç‰©ç†åƒç´ )</em></p>
</li>
<li><p>ç„¶å viewport è®¾ç½®ä¸º 1/3ï¼Œ è¿™æ ·é¡µé¢æ•´ä½“ç¼©å›åŸå§‹å¤§å°ï¼Œä»è€Œå®ç°é«˜æ¸…ã€‚è¿™æ ·æ•´ä¸ªç½‘é¡µåœ¨è®¾å¤‡å†…æ˜¾ç¤ºæ—¶çš„é¡µé¢å®½åº¦å°±ä¼šç­‰äºè®¾å¤‡é€»è¾‘åƒç´ å¤§å°ï¼Œä¹Ÿå°±æ˜¯ device-width ã€‚è¿™ä¸ª device-width çš„è®¡ç®—å…¬å¼ä¸ºï¼š<br>è®¾å¤‡çš„ç‰©ç†åˆ†è¾¨ç‡ / (devicePixelRatio * scale)ï¼Œåœ¨ scale ä¸º 1 çš„æƒ…å†µä¸‹ï¼Œdevice-width = è®¾å¤‡çš„ç‰©ç†åˆ†è¾¨ç‡ / devicePixelRatio </p>
</li>
</ul>
<h5 id="remå¼Šç«¯"><a href="#remå¼Šç«¯" class="headerlink" title="remå¼Šç«¯"></a>remå¼Šç«¯</h5><p>&nbsp;&nbsp;&nbsp;&nbsp;iOS ä¸ Android å¹³å°çš„é€‚é…æ–¹å¼èƒŒåéšè—çš„è®¾è®¡å“²å­¦æ˜¯è¿™æ ·çš„ï¼šé˜…è¯»æ–‡å­—æ—¶ï¼Œå¯è¯»æ€§è¾ƒå¥½çš„æ–‡å­—å­—å·è¡Œè·ç­‰ç»å¯¹å°ºå¯¸æ•°å€¼ç»„åˆä¸æ–‡å­—æ‰€åœ¨åª’ä»‹çš„ç»å¯¹å°ºå¯¸å…³ç³»ä¸å¤§ã€‚ï¼ˆå¯ä»¥è¿™æ ·ç®€å•ç†è§£ï¼šA4 å¤§å°çš„æŠ¥çº¸å’Œ A3 å¤§å°ç”šè‡³æ›´å¤§çš„æŠ¥çº¸ï¼Œèˆ’é€‚çš„é˜…è¯»å­—å·ç»å¯¹å°ºå¯¸æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºä»–ä»¬éƒ½éœ€è¦æ‹¿åœ¨æ‰‹é‡Œé˜…è¯»ï¼Œåœ¨æ‰‹æœºä¹Ÿæ˜¯ä¸ŠåŒç†ï¼‰ã€‚åœ¨çœ‹å›¾ç‰‡è§†é¢‘æ—¶ï¼Œå›¾ç‰‡ã€è§†é¢‘çš„æ¯”ä¾‹åº”è¯¥æ˜¯å›ºå®šçš„ï¼Œä¸åº”è¯¥å‡ºç°æ‹‰ä¼¸å˜å½¢çš„æƒ…å†µã€‚è€Œ rem ç”¨åœ¨å­—å·æ—¶ï¼Œä½¿å­—å·åœ¨ä¸åŒå±å¹•ä¸Šçš„ç»å¯¹å°ºå¯¸ä¸ä¸€è‡´ï¼Œè¿èƒŒäº†è®¾è®¡å“²å­¦ã€‚</p>
<h5 id="æµè§ˆå™¨å…¼å®¹-1"><a href="#æµè§ˆå™¨å…¼å®¹-1" class="headerlink" title="æµè§ˆå™¨å…¼å®¹"></a>æµè§ˆå™¨å…¼å®¹</h5><ul>
<li>ä¸æ”¯æŒ IE 8.0 ä»¥ä¸‹ ã€Safari 4.0 ä»¥ä¸‹ã€FireFox 3.5ä»¥ä¸‹</li>
<li><img width="800px" height="200px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnvyg6do9j21he0f4ac2.jpg"></li>
</ul>
<h4 id="4-VWé€‚é…"><a href="#4-VWé€‚é…" class="headerlink" title="4. VWé€‚é…"></a>4. VWé€‚é…</h4><p><a href="https://juejin.im/entry/5aa09c3351882555602077ca" target="_blank" rel="external">å¦‚ä½•åœ¨Vueé¡¹ç›®ä¸­ä½¿ç”¨vwå®ç°ç§»åŠ¨ç«¯é€‚é…</a></p>
<pre><code>1vw ï¼ 1/100th viewport width
1vh ï¼ 1/100th viewport height
vmin ï¼šé€‰å– vw å’Œ vh ä¸­æœ€å°çš„é‚£ä¸ª
vmax ï¼šé€‰å– vw å’Œ vh ä¸­æœ€å¤§çš„é‚£ä¸ª 
</code></pre><p><strong>vw å¯ä»¥è½»æ¾æå®šå¼¹æ€§å¸ƒå±€ï¼Œæµä½“å¸ƒå±€ã€‚vw é€»è¾‘éå¸¸æ¸…æ™°</strong>å…¶å® vw çš„æ–¹æ¡ˆçš„å†™æ³•å’Œ flexible æ–¹æ¡ˆçš„å†™æ³•ä¸€è‡´<br>ï½ï½å› ä¸º flexible å…¶å®å°±æ˜¯ç”¨ hack çš„æ‰‹æ®µæ¨¡æ‹Ÿäº† vw çš„å®ç°è€Œå·²ã€‚<br>å…·ä½“å†™æ³•ï¼šé’ˆå¯¹ 750px çš„è®¾è®¡ç¨¿ï¼Œå°†ç›¸åº”çš„ px å€¼é™¤ä»¥ 75 å°±æ˜¯ vw çš„å€¼ã€‚</p>
<p>ä½¿ç”¨ vw æ¥å®ç°é¡µé¢çš„é€‚é…ï¼Œå¹¶ä¸”é€šè¿‡ PostCSS çš„æ’ä»¶ <a href="https://github.com/evrone/postcss-px-to-viewport" target="_blank" rel="external">postcss-px-to-viewport</a> æŠŠ px è½¬æ¢æˆ vw ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ’¸ç çš„æ—¶å€™ï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•çš„è®¡ç®—ï¼Œä½ åªéœ€è¦æ ¹æ®è®¾è®¡å›¾å†™ px å•ä½ã€‚<a href="https://github.com/evrone/postcss-px-to-viewport" target="_blank" rel="external">postcss-px-to-viewport</a> æ’ä»¶ä¸»è¦ç”¨æ¥æŠŠ px å•ä½è½¬æ¢ä¸º vw ã€vh ã€vmin æˆ–è€… vmax è¿™æ ·çš„è§†çª—å•ä½ï¼Œä¹Ÿæ˜¯ vw é€‚é…æ–¹æ¡ˆçš„æ ¸å¿ƒæ’ä»¶ä¹‹ä¸€ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„å®ç°é•¿å®½æ¯”ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹äº imgã€video å’Œ iframe å…ƒç´ ï¼Œé€šè¿‡ PostCSS æ’ä»¶<a href="https://github.com/yisibl/postcss-aspect-ratio-mini" target="_blank" rel="external">postcss-aspect-ratio-mini</a> æ¥å®ç°ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåªéœ€è¦æŠŠå¯¹åº”çš„å®½å’Œé«˜å†™è¿›å»å³å¯ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šrem ï¼Œä½¿ç”¨ vw å’Œ wh æ˜¯éå¸¸ç›´è§‚çš„ï¼Œè®©å…¶ä»–äººçœ‹åˆ°å°±èƒ½çŸ¥é“ï¼Œè¯¥ç•Œé¢æ˜¯ä»¥æ€ä¹ˆæ ·çš„ç»“æ„è¿›è¡Œå¸ƒå±€ï¼Œåˆ©äºç»´æŠ¤</li>
<li>ç¼ºç‚¹ï¼švw åœ¨ä¸€äº›ä¸‰æ˜Ÿçš„æœºå­ä¼šæœ‰å…¼å®¹é—®é¢˜ï¼Œå¯¼è‡´å¤±æ•ˆï¼Œä»¥åŠä¸åŒæµè§ˆå™¨å…¼å®¹é—®é¢˜</li>
</ul>
<h5 id="å…¼å®¹æ€§å¯¹æ¯”"><a href="#å…¼å®¹æ€§å¯¹æ¯”" class="headerlink" title="å…¼å®¹æ€§å¯¹æ¯”"></a>å…¼å®¹æ€§å¯¹æ¯”</h5><p> Remï¼š<br><img src="https://ws1.sinaimg.cn/large/d0ba619egy1fqi26dyf14j20sa052tcg.jpg" alt=""><br> VWï¼š<br><img src="https://ws1.sinaimg.cn/large/d0ba619egy1fqi26prtssj20su0560xa.jpg" alt=""></p>
<h2 id="æ‰‹æ·˜é€‚é…æ–¹æ¡ˆ-Flexible-js"><a href="#æ‰‹æ·˜é€‚é…æ–¹æ¡ˆ-Flexible-js" class="headerlink" title="æ‰‹æ·˜é€‚é…æ–¹æ¡ˆ Flexible.js"></a>æ‰‹æ·˜é€‚é…æ–¹æ¡ˆ Flexible.js</h2><p><img width="600px" height="300px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqi3ik1ullj20n20eujud.jpg"></p>
<p><a href="https://github.com/amfe/lib-flexible" target="_blank" rel="external">Github(lib-flexible)</a></p>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å°†æ–‡ä»¶ä¸‹è½½åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œç„¶åé€šè¿‡ç›¸å¯¹è·¯å¾„æ·»åŠ ï¼š</p>
<pre><code>&lt;script src=&quot;build/flexible_css.debug.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;build/flexible.debug.js&quot;&gt;&lt;/script&gt;
</code></pre><p>æˆ–è€…ç›´æ¥åŠ è½½é˜¿é‡ŒCDNçš„æ–‡ä»¶ï¼š</p>
<pre><code>&lt;script src=&quot;http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js&quot;&gt;&lt;/script&gt;
</code></pre><h3 id="æ‰‹æœºæ·˜å®ç”¨-JS-æ¥åŠ¨æ€å†™-meta-æ ‡ç­¾"><a href="#æ‰‹æœºæ·˜å®ç”¨-JS-æ¥åŠ¨æ€å†™-meta-æ ‡ç­¾" class="headerlink" title="æ‰‹æœºæ·˜å®ç”¨ JS æ¥åŠ¨æ€å†™ meta æ ‡ç­¾"></a>æ‰‹æœºæ·˜å®ç”¨ JS æ¥åŠ¨æ€å†™ meta æ ‡ç­¾</h3><p>æ‰‹æœºæ·˜å®çš„ flexible æ–¹æ¡ˆæ˜¯ç»¼åˆè¿ç”¨ rem å’Œ px ä¸¤ç§å•ä½ +js è®¾ç½® scale å’Œ html å­—ä½“ã€‚</p>
<pre><code>var metaEl = doc.createElement(&apos;meta&apos;);
var scale = isRetina ? 0.5:1;
metaEl.setAttribute(&apos;name&apos;, &apos;viewport&apos;);
metaEl.setAttribute(&apos;content&apos;, &apos;initial-scale=&apos; + scale + &apos;, maximum-scale=&apos; + scale + &apos;, minimum-scale=&apos; + scale + &apos;, user-scalable=no&apos;);
if (docEl.firstElementChild) {
    document.documentElement.firstElementChild.appendChild(metaEl);
} else {
    var wrap = doc.createElement(&apos;div&apos;);
    wrap.appendChild(metaEl);
    documen.write(wrap.innerHTML);
}
</code></pre><h3 id="å®è´¨"><a href="#å®è´¨" class="headerlink" title="å®è´¨"></a>å®è´¨</h3><ul>
<li>åŠ¨æ€æ”¹å†™<meta>æ ‡ç­¾</li>
<li>ç»™<html>å…ƒç´ æ·»åŠ  data-dpr å±æ€§ï¼Œå¹¶ä¸”åŠ¨æ€æ”¹å†™ data-dpr çš„å€¼</html></li>
<li>ç»™<html>å…ƒç´ æ·»åŠ  font-size å±æ€§ï¼Œå¹¶ä¸”åŠ¨æ€æ”¹å†™ font-size çš„å€¼</html></li>
</ul>
<h3 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h3><ul>
<li>ä¸èƒ½ä¸å“åº”å¼å¸ƒå±€å…¼å®¹</li>
<li>å¯¹ Android æ²¡æœ‰åšå¤„ç†ï¼Œå¯¼è‡´ 1px å’Œ backgroudImage è¿˜è¦é¢å¤–åšå¤„ç†çš„é—®é¢˜</li>
</ul>
<p>ps.é€šè¿‡ä¸€æ®µ JS ä»£ç æ ¹æ®è®¾å¤‡çš„å±å¹•å®½åº¦ã€dpr è®¾ç½®æ ¹å…ƒç´ çš„ data-dpr å’Œ font-size ï¼Œè¿™æ®µJSä»£ç è¦åœ¨æ‰€æœ‰èµ„æºåŠ è½½ä¹‹å‰æ‰§è¡Œï¼Œå»ºè®®åšå†…è”å¤„ç†ã€‚</p>
<h2 id="å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2><h3 id="ä¸€ã€è§£å†³-1px-æ–¹æ¡ˆ"><a href="#ä¸€ã€è§£å†³-1px-æ–¹æ¡ˆ" class="headerlink" title="ä¸€ã€è§£å†³ 1px æ–¹æ¡ˆ"></a>ä¸€ã€è§£å†³ 1px æ–¹æ¡ˆ</h3><p><strong>åŸå› ï¼š</strong>css ä¸­çš„ 1px å¹¶ä¸ç­‰äºç§»åŠ¨è®¾å¤‡çš„ 1px ï¼Œè¿™äº›ç”±äºä¸åŒçš„æ‰‹æœºæœ‰ä¸åŒçš„åƒç´ å¯†åº¦ã€‚åœ¨ window å¯¹è±¡ä¸­æœ‰ä¸€ä¸ª devicePixelRatio å±æ€§ï¼Œä»–å¯ä»¥ååº” css ä¸­çš„åƒç´ ä¸è®¾å¤‡çš„åƒç´ æ¯”ã€‚viewport çš„è®¾ç½®å’Œå±å¹•ç‰©ç†åˆ†è¾¨ç‡æ˜¯æŒ‰æ¯”ä¾‹è€Œä¸æ˜¯ç›¸åŒçš„ã€‚ ç§»åŠ¨ç«¯ window å¯¹è±¡æœ‰ä¸ª devicePixelRatio å±æ€§ï¼Œ å®ƒè¡¨ç¤ºè®¾å¤‡ç‰©ç†åƒç´ å’Œ css åƒç´ çš„æ¯”ä¾‹ï¼Œ åœ¨ retina å±çš„ iphoneæ‰‹æœºä¸Š ï¼Œè¿™ä¸ªå€¼ä¸º 2 æˆ– 3 ï¼Œ css é‡Œå†™çš„ 1px é•¿åº¦æ˜ å°„åˆ°ç‰©ç†åƒç´ ä¸Šå°±æœ‰ 2px æˆ– 3px é‚£ä¹ˆé•¿ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<h4 id="1-background-æ¸å˜ï¼ˆç°æœ‰æ–¹æ³•ï¼‰"><a href="#1-background-æ¸å˜ï¼ˆç°æœ‰æ–¹æ³•ï¼‰" class="headerlink" title="1.background æ¸å˜ï¼ˆç°æœ‰æ–¹æ³•ï¼‰"></a>1.background æ¸å˜ï¼ˆç°æœ‰æ–¹æ³•ï¼‰</h4><p>èƒŒæ™¯æ¸å˜ï¼Œ æ¸å˜åœ¨é€æ˜è‰²å’Œè¾¹æ¡†è‰²ä¸­é—´åˆ†å‰²ï¼ŒfrozenUI ç”¨çš„å°±æ˜¯è¿™ç§æ–¹æ³•ï¼Œ å€Ÿç”¨å®ƒçš„ä¸Šè¾¹æ¡†å†™æ³•ï¼š<br>ä¸èƒ½å®ç°åœ†è§’ 1px æ•ˆæœï¼Œcss éœ€è¦åšå…¼å®¹å¤„ç†ï¼Œä¸ background-image æ–¹æ¡ˆç±»ä¼¼ï¼Œåªæ˜¯å°†å›¾ç‰‡æ›¿æ¢ä¸º css3 æ¸å˜ã€‚è®¾ç½® 1px çš„æ¸å˜èƒŒæ™¯ï¼Œ50% æœ‰é¢œè‰²ï¼Œ50% é€æ˜ã€‚</p>
<pre><code>.border-1px-bottom {
  background-image: linear-gradient(180deg, @border-default-color, @border-default-color 50%, transparent 0);
  background-size: 100% 1px;
  background-repeat: no-repeat;
  background-position: bottom;
}
</code></pre><ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>å¯ä»¥å®ç°å•æ¡ã€å¤šæ¡è¾¹æ¡†</li>
<li>è¾¹æ¡†çš„é¢œè‰²éšæ„è®¾ç½®</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>ä»£ç é‡ä¸å°‘</li>
<li>åœ†è§’æ²¡æ³•å®ç°</li>
<li>å¤šèƒŒæ™¯å›¾ç‰‡æœ‰å…¼å®¹æ€§é—®é¢˜</li>
</ul>
</li>
</ul>
<h5 id="æµè§ˆå™¨å…¼å®¹-2"><a href="#æµè§ˆå™¨å…¼å®¹-2" class="headerlink" title="æµè§ˆå™¨å…¼å®¹"></a>æµè§ˆå™¨å…¼å®¹</h5><ul>
<li>ä¸æ”¯æŒ IE 8.0 åŠä»¥ä¸‹ã€FireFox 3.5 åŠä»¥ä¸‹</li>
<li><img width="800px" height="200px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnwgdol47j21he0eydhu.jpg"></li>
</ul>
<h4 id="2-ä½¿ç”¨-border-image-å®ç°"><a href="#2-ä½¿ç”¨-border-image-å®ç°" class="headerlink" title="2.ä½¿ç”¨ border-image å®ç°"></a>2.ä½¿ç”¨ border-image å®ç°</h4><pre><code>.border-image-1px {
  border-bottom: 1px solid #666;
}
@media only screen and (-webkit-min-device-pixel-ratio: 2) {
  .border-image-1px {
    border-bottom: none;
    border-width: 0 0 1px 0;
    -webkit-border-image: url(../img/linenew.png) 0 0 2 0 stretch;
    border-image: url(../img/linenew.png) 0 0 2 0 stretch;
  }
}
</code></pre><ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>å¯ä»¥è®¾ç½®å•æ¡ï¼Œå¤šæ¡è¾¹æ¡†</li>
<li>æ²¡æœ‰æ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>è¾¹æ¡†é¢œè‰²ä¸ä¾¿ä¿®æ”¹ï¼Œä¿®æ”¹é¢œè‰²éº»çƒ¦ï¼Œ éœ€è¦æ›¿æ¢å›¾ç‰‡</li>
<li>åœ†è§’éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå¹¶ä¸”è¾¹ç¼˜ä¼šæ¨¡ç³Š</li>
</ul>
</li>
</ul>
<h5 id="æµè§ˆå™¨å…¼å®¹-3"><a href="#æµè§ˆå™¨å…¼å®¹-3" class="headerlink" title="æµè§ˆå™¨å…¼å®¹"></a>æµè§ˆå™¨å…¼å®¹</h5><ul>
<li>ä¸æ”¯æŒ IE 10.0 åŠä»¥ä¸‹ ï¼ˆå…¶ä»–æµè§ˆå™¨ç‰ˆæœ¬éƒ¨åˆ†æ”¯æŒï¼‰</li>
<li><img width="800px" height="200px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnwlgxe6ij21hi0fc40r.jpg"></li>
</ul>
<h4 id="3ã€ä½¿ç”¨-box-shadow-æ¨¡æ‹Ÿè¾¹æ¡†"><a href="#3ã€ä½¿ç”¨-box-shadow-æ¨¡æ‹Ÿè¾¹æ¡†" class="headerlink" title="3ã€ä½¿ç”¨ box-shadow æ¨¡æ‹Ÿè¾¹æ¡†"></a>3ã€ä½¿ç”¨ box-shadow æ¨¡æ‹Ÿè¾¹æ¡†</h4><p>åˆ©ç”¨ css å¯¹é˜´å½±å¤„ç†çš„æ–¹å¼å®ç° 0.5px çš„æ•ˆæœ</p>
<pre><code>.box-shadow-1px {
  box-shadow: inset 0px -1px 1px -1px #c8c7cc;
}
</code></pre><ul>
<li>ç¼ºç‚¹ï¼šé¢œè‰²ä¸ä¾¿æ§åˆ¶ï¼Œå¤ªæ·¡ï¼Œæœ‰è™šè¾¹</li>
</ul>
<h5 id="æµè§ˆå™¨å…¼å®¹-4"><a href="#æµè§ˆå™¨å…¼å®¹-4" class="headerlink" title="æµè§ˆå™¨å…¼å®¹"></a>æµè§ˆå™¨å…¼å®¹</h5><ul>
<li>ä¸æ”¯æŒ IE 8.0 åŠä»¥ä¸‹</li>
<li><img width="800px" height="200px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnwpb7mi1j21i40f4q4y.jpg"></li>
</ul>
<h4 id="4ã€viewport-rem-å®ç°ï¼ˆflexible-jsï¼‰"><a href="#4ã€viewport-rem-å®ç°ï¼ˆflexible-jsï¼‰" class="headerlink" title="4ã€viewport + rem å®ç°ï¼ˆflexible.jsï¼‰"></a>4ã€viewport + rem å®ç°ï¼ˆflexible.jsï¼‰</h4><p>åŒæ—¶é€šè¿‡è®¾ç½®å¯¹åº” viewport çš„ rem åŸºå‡†å€¼ï¼Œè¿™ç§æ–¹å¼å°±å¯ä»¥åƒä»¥å‰ä¸€æ ·è½»æ¾æ„‰å¿«çš„å†™ 1px äº†ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>æ‰€æœ‰åœºæ™¯éƒ½èƒ½æ»¡è¶³</li>
<li>ä¸€å¥—ä»£ç ï¼Œå¯ä»¥å…¼å®¹åŸºæœ¬æ‰€æœ‰å¸ƒå±€</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼šè€é¡¹ç›®ä¿®æ”¹ä»£ä»·è¿‡å¤§ï¼Œåªé€‚ç”¨äºæ–°é¡¹ç›®</li>
</ul>
<h5 id="æµè§ˆå™¨å…¼å®¹-5"><a href="#æµè§ˆå™¨å…¼å®¹-5" class="headerlink" title="æµè§ˆå™¨å…¼å®¹"></a>æµè§ˆå™¨å…¼å®¹</h5><ul>
<li>ä¸æ”¯æŒ IE 8.0 ä»¥ä¸‹ ã€Safari 4.0 ä»¥ä¸‹ã€FireFox 3.5ä»¥ä¸‹</li>
<li><img width="800px" height="200px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnvyg6do9j21he0f4ac2.jpg"></li>
</ul>
<h4 id="5ã€ä¼ªç±»-beforeï¼Œ-after-transform-å®ç°"><a href="#5ã€ä¼ªç±»-beforeï¼Œ-after-transform-å®ç°" class="headerlink" title="5ã€ä¼ªç±» ( :beforeï¼Œ :after ) + transform å®ç°"></a>5ã€ä¼ªç±» ( :beforeï¼Œ :after ) + transform å®ç°</h4><p>åŸç†æ˜¯æŠŠåŸå…ˆå…ƒç´ çš„ border å»æ‰ï¼Œç„¶ååˆ©ç”¨ :before æˆ–è€… :after é‡åš border ï¼Œå¹¶ transform çš„ scale ç¼©å°ä¸€åŠï¼ŒåŸå…ˆçš„å…ƒç´ ç›¸å¯¹å®šä½ï¼Œæ–°åšçš„ border ç»å¯¹å®šä½ã€‚</p>
<pre><code>.box-shadow-1px{
    position: relative;
    border:none;
}
.box-shadow-1px:after{
    content: &apos;&apos;;
    position: absolute;
    left: 0;
    background: #000;
    width: 100%;
    height: 1px;
    transform: scaleY(0.5);
    transform-origin: 50% 100%;
}
</code></pre><ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>æ‰€æœ‰åœºæ™¯éƒ½èƒ½æ»¡è¶³</li>
<li>æ”¯æŒåœ†è§’(ä¼ªç±»å’Œæœ¬ä½“ç±»éƒ½éœ€è¦åŠ  border-radius )</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>å ç”¨äº†ä¼ªç±»ï¼Œå®¹æ˜“å’ŒåŸæ ·å¼å†²çª</li>
<li>å¯¹äºå·²ç»ä½¿ç”¨ä¼ªç±»çš„å…ƒç´ (ä¾‹å¦‚ clearfix )ï¼Œå¯èƒ½éœ€è¦å¤šå±‚åµŒå¥—</li>
<li>å¯¹å•ä¸ªå…ƒç´ çš„è¾¹æ¡†è¿›è¡Œç¼©æ”¾çš„æ–¹æ¡ˆæ— æ³•å®ç°åœ†è§’</li>
</ul>
</li>
</ul>
<h5 id="æµè§ˆå™¨å…¼å®¹-6"><a href="#æµè§ˆå™¨å…¼å®¹-6" class="headerlink" title="æµè§ˆå™¨å…¼å®¹"></a>æµè§ˆå™¨å…¼å®¹</h5><ul>
<li>ä¸æ”¯æŒ IE 8.0 ä»¥ä¸‹</li>
<li><img width="800px" height="200px" src="https://ws1.sinaimg.cn/large/d0ba619egy1fqnwwok2wnj21hq0f00ur.jpg"></li>
</ul>
<h4 id="6-ä½¿ç”¨-0-5px-é€‚é…-iOS8-ä»¥ä¸Šçš„-iPhone-æœºå‹"><a href="#6-ä½¿ç”¨-0-5px-é€‚é…-iOS8-ä»¥ä¸Šçš„-iPhone-æœºå‹" class="headerlink" title="6. ä½¿ç”¨ 0.5px é€‚é… iOS8 ä»¥ä¸Šçš„ iPhone æœºå‹"></a>6. ä½¿ç”¨ 0.5px é€‚é… iOS8 ä»¥ä¸Šçš„ iPhone æœºå‹</h4><pre><code>@media (-webkit-min-device-pixel-ratio:2){
 .box5 {border-width:.5px}
}
</code></pre><ul>
<li>ç¼ºç‚¹ï¼š<ul>
<li>åªé€‚ç”¨äº iOS8+ ä»¥ä¸Šçš„ iOS ç³»ç»Ÿï¼Œå®‰å“æœºä¸æ”¯æŒ 0.5px</li>
<li>Chrome ä¼šæŠŠå°äº 0.5px çš„å½“æˆ 0ï¼Œè€Œ Firefox ä¼šæŠŠä¸å°äº 0.55px å½“æˆ 1pxï¼ŒSafari æ˜¯æŠŠä¸å°äº 0.75px å½“æˆ 1px</li>
</ul>
</li>
</ul>
<h3 id="äºŒã€Rem-å°æ•°é—®é¢˜"><a href="#äºŒã€Rem-å°æ•°é—®é¢˜" class="headerlink" title="äºŒã€Rem å°æ•°é—®é¢˜"></a>äºŒã€Rem å°æ•°é—®é¢˜</h3><p><strong>èµ·å› ï¼š</strong>åœ¨å¼€å‘æ‰‹æœºç«¯é¡µé¢çš„æ—¶å€™ï¼Œä½¿ç”¨äº† rem å•ä½ï¼Œå®ç°ä¸Šæ¯” %ã€em ç­‰å…¶ä»–çš„åšæ³•æ›´ç®€å•äº†ï¼Œå®ƒå¯ä»¥å®ç°é«˜åº¦å’Œå®½åº¦ç­‰æ¯”ä¾‹å˜åŒ–ã€‚å¥½ä¸œè¥¿æ˜¯å¥½ï¼Œä½†æ˜¯ä¸å¥½çš„ä¸€ç‚¹æ˜¯ rem çš„å°æ•°ç‚¹ã€‚ä½†æ˜¯æµè§ˆå™¨åœ¨å¤„ç†å°æ•°åƒç´ çš„æ—¶å€™å¹¶ä¸æ˜¯ç›´æ¥èˆå…¥å¤„ç†çš„ï¼Œå…ƒç´ ä¾æ—§å æ®ç€åº”æœ‰çš„ç©ºé—´ï¼Œåªæ˜¯åœ¨è®¡ç®—å…ƒç´ å°ºå¯¸çš„æ—¶å€™åšäº†èˆå…¥å¤„ç†ã€‚</p>
<p><code>ä¾‹ï¼šä¼šå‡ºç° font-sizeï¼š2.1444444444px çš„ç°è±¡</code></p>
<p><strong>ç›®å‰é‡åˆ°å…¶ä»–æœ€å¤šçš„é—®é¢˜å°±æ˜¯ background-image çš„é—®é¢˜ï¼Œç»å¸¸ä¼šå› ä¸ºå°æ•°åƒç´ å¯¼è‡´èƒŒæ™¯å›¾è¢«è£æ‰ä¸€éƒ¨åˆ†ã€‚</strong></p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ iconfont</li>
<li>å¦‚éœ€ä½¿ç”¨ background-imageï¼Œå°½é‡ä¸ºèƒŒæ™¯å›¾è®¾ç½®ä¸€å®šçš„ç©ºç™½é—´éš™</li>
</ul>
<h3 id="ä¸‰ã€é«˜æ¸…å›¾é—®é¢˜"><a href="#ä¸‰ã€é«˜æ¸…å›¾é—®é¢˜" class="headerlink" title="ä¸‰ã€é«˜æ¸…å›¾é—®é¢˜"></a>ä¸‰ã€é«˜æ¸…å›¾é—®é¢˜</h3><p><strong>èµ·å› ï¼š</strong>ç†è®ºä¸Šï¼Œ1 ä¸ªä½å›¾åƒç´ å¯¹åº”äº 1 ä¸ªç‰©ç†åƒç´ ï¼ˆçº¢è‰²ç‚¹ï¼‰ï¼Œå›¾ç‰‡æ‰èƒ½å¾—åˆ°å®Œç¾æ¸…æ™°çš„å±•ç¤ºã€‚åœ¨æ™®é€šå±å¹•ä¸‹æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨retinaå±å¹•ä¸‹å°±ä¼šå‡ºç°ä½å›¾åƒç´ ç‚¹ä¸å¤Ÿï¼Œä»è€Œå¯¼è‡´å›¾ç‰‡æ¨¡ç³Šçš„æƒ…å†µã€‚å¯¹äº dpr = 2 çš„Retina å±å¹•è€Œè¨€ï¼Œ1 ä¸ªä½å›¾åƒç´ å¯¹åº”äº 4 ä¸ªç‰©ç†åƒç´ ï¼Œç”±äºå•ä¸ªä½å›¾åƒç´ ä¸å¯ä»¥å†è¿›ä¸€æ­¥åˆ†å‰²ï¼Œæ‰€ä»¥åªèƒ½å°±è¿‘å–è‰²ï¼Œä»è€Œå¯¼è‡´å›¾ç‰‡æ¨¡ç³Š(æ³¨æ„ä¸Šè¿°çš„å‡ ä¸ªé¢œè‰²å€¼)ã€‚æ‰€ä»¥ï¼Œå¯¹äºå›¾ç‰‡é«˜æ¸…é—®é¢˜ï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆå°±æ˜¯ä¸¤å€å›¾ç‰‡(@2x)ã€‚</p>
<p><code>å¦‚ï¼š200Ã—300(css pixel)imgæ ‡ç­¾ï¼Œå°±éœ€è¦æä¾›400Ã—600çš„å›¾ç‰‡ã€‚</code></p>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œä½å›¾åƒç´ ç‚¹ä¸ªæ•°å°±æ˜¯åŸæ¥çš„ 4 å€ï¼Œåœ¨ Retina å±å¹•ä¸‹ï¼Œä½å›¾åƒç´ ç‚¹ä¸ªæ•°å°±å¯ä»¥è·Ÿç‰©ç†åƒç´ ç‚¹ä¸ªæ•°å½¢æˆ 1 : 1 çš„æ¯”ä¾‹ï¼Œå›¾ç‰‡è‡ªç„¶å°±æ¸…æ™°äº†ï¼ˆè¿™ä¹Ÿè§£é‡Šäº†ä¸ºå•¥è§†è§‰ç¨¿çš„ç”»å¸ƒå¤§å°è¦ Ã— 2 ï¼Ÿï¼‰ã€‚</p>
<p><strong>è¡ç”Ÿé—®é¢˜ï¼š</strong>å¦‚æœæ™®é€šå±å¹•ä¸‹ï¼Œä¹Ÿç”¨äº†ä¸¤å€ å›¾ç‰‡ï¼Œä¼šæ€æ ·å‘¢ ï¼Ÿ</p>
<p>åœ¨æ™®é€šå±å¹•ä¸‹ï¼Œ200 Ã— 300ï¼ˆCSS pixelï¼‰img æ ‡ç­¾ï¼Œæ‰€å¯¹åº”çš„ç‰©ç†åƒç´ ä¸ªæ•°å°±æ˜¯ 200 Ã— 300 ä¸ªï¼Œè€Œä¸¤å€å›¾ç‰‡çš„ä½å›¾åƒç´ ä¸ªæ•°æ˜¯ 200 Ã— 300 Ã— 4 ä¸ªï¼Œæ‰€ä»¥å°±å‡ºç°ä¸€ä¸ªç‰©ç†åƒç´ ç‚¹å¯¹åº” 4 ä¸ªä½å›¾åƒç´ ç‚¹ï¼Œä½†å®ƒçš„å–è‰²ä¹Ÿåªèƒ½é€šè¿‡ä¸€å®šçš„ç®—æ³•å–æŸä¸€ä¸ªä½å›¾åƒç´ ç‚¹ä¸Šçš„è‰²å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš downsamplingï¼ˆå¤§å›¾æ”¾å…¥æ¯”å›¾ç‰‡å°ºå¯¸å°çš„å®¹å™¨ä¸­æ—¶ï¼Œå‡ºç°åƒç´ åˆ†å‰²æˆå°±è¿‘è‰²ï¼‰ï¼Œè‚‰çœ¼çœ‹ä¸Šå»è™½ç„¶å›¾ç‰‡ä¸ä¼šæ¨¡ç³Šï¼Œä½†æ˜¯ä¼šè§‰å¾—å›¾ç‰‡ç¼ºå°‘ä¸€äº›é”åˆ©åº¦ï¼Œæˆ–è€…æ˜¯æœ‰ç‚¹è‰²å·®ã€‚æ‰€ä»¥æœ€å¥½çš„è§£å†³åŠæ³•æ˜¯ï¼šä¸åŒçš„ dpr ä¸‹ï¼ŒåŠ è½½ä¸åŒçš„å°ºå¯¸çš„å›¾ç‰‡ã€‚ä¸ç®¡æ˜¯é€šè¿‡ CSS åª’ä½“æŸ¥è¯¢ï¼Œè¿˜æ˜¯é€šè¿‡ JS æ¡ä»¶åˆ¤æ–­éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
<p><strong>å¾—å‡ºç»“è®º</strong>ï¼š<br>ä¸€èˆ¬æ¥è¯´ dpr = 2 ä¸ºå¤šï¼Œdpr = 1 ä¸ºæ™®é€šå±å¹•ï¼Œdpr = 3 å å°‘æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬è‡³å°‘åš 2 å¥—å›¾ç‰‡ï¼Œä¸€å¥—æ˜¯å…¼å®¹dpr = 1 çš„å°å›¾ï¼›ä¸€å¥—æ˜¯å…¼å®¹ dpr = 2 çš„å¤§å›¾ï¼›dpr = 3 çš„å¯ä»¥å…¼å®¹åˆ° dpr = 2 çš„å›¾ç‰‡ä¸­ï¼Œè™½ç„¶æœ‰ç‚¹å¤±è‰²ï¼Œä½†è¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<h2 id="å°ç»“ï¼ˆæˆ‘æ¨èï¼‰"><a href="#å°ç»“ï¼ˆæˆ‘æ¨èï¼‰" class="headerlink" title="å°ç»“ï¼ˆæˆ‘æ¨èï¼‰"></a>å°ç»“ï¼ˆæˆ‘æ¨èï¼‰</h2><h3 id="å±å¹•é€‚é…æ–¹æ¡ˆ"><a href="#å±å¹•é€‚é…æ–¹æ¡ˆ" class="headerlink" title="å±å¹•é€‚é…æ–¹æ¡ˆ"></a>å±å¹•é€‚é…æ–¹æ¡ˆ</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;ä½¿ç”¨ <a href="https://github.com/amfe/lib-flexible" target="_blank" rel="external"><strong>flexible.js</strong></a> æ–¹æ¡ˆï¼Œè¾ƒä¸ºç¨³å®šï¼Œæä¾›äº†ç”¨ä¸€å¥— CSS å»é€‚åº”å¤šç§å±å¹•çš„æ–¹æ³•ï¼Œä¸ç”¨è€ƒè™‘é€‚åº”å±å¹•çš„é«˜å®½æ¯”ã€ç‰©ç†å°ºå¯¸ç­‰ï¼Œåˆ‡å›¾æˆæœ¬æ¯”è¾ƒä½ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;flexible æ–¹æ¡ˆæ˜¯ç»¼åˆè¿ç”¨ rem å’Œ pxï¼ˆé¿å…å­—ä½“æ”¾å¤§æ¨¡ç³Šï¼‰ä¸¤ç§å•ä½ + js è®¾ç½® scale å’Œ html å­—ä½“è¾¾åˆ°æ•ˆæœã€‚å®ƒåŠ¨æ€æ”¹å†™ meta æ ‡ç­¾ï¼ŒåŠ¨æ€æ”¹å†™ dpr çš„å€¼ï¼ŒåŠ¨æ€æ”¹å†™ font-size çš„å€¼ã€‚æˆ‘ä»¬ç°æœ‰ä¹Ÿæ˜¯ rem æ–¹æ³•ï¼Œå¯ä»¥å‡å°‘ä»£ç ä¿®æ”¹ã€‚</p>
<p><strong>Install</strong></p>
<pre><code>npm i -S amfe-flexible
</code></pre><p><strong>Import</strong></p>
<pre><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no&quot;&gt;
&lt;script src=&quot;./node_modules/amfe-flexible/index.js&quot;&gt;&lt;/script&gt;
</code></pre><p>ps. è™½ç„¶ VW æ–¹æ¡ˆä¼¼ä¹ä¹Ÿä¸é”™ï¼Œä½†æ˜¯è€ƒè™‘å…¼å®¹æ€§é—®é¢˜ï¼Œflexible æ›´å®œã€‚</p>
<h3 id="1px-border-å•ç‹¬è§£å†³æ–¹æ¡ˆ"><a href="#1px-border-å•ç‹¬è§£å†³æ–¹æ¡ˆ" class="headerlink" title="1px border å•ç‹¬è§£å†³æ–¹æ¡ˆ"></a>1px border å•ç‹¬è§£å†³æ–¹æ¡ˆ</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;1px border é—®é¢˜ä½¿ç”¨ <strong>ä¼ªç±» + transform</strong> çš„æ–¹å¼å®ç°ã€‚<br>èƒ½è§£å†³ç°æœ‰è™šå‡ 1px é—®é¢˜ï¼Œå’Œæ— æ³•å®ç°åœ†è§’é—®é¢˜ï¼Œè€Œä¸”å…¼å®¹æ€§è‰¯å¥½ï¼Œå”¯ä¸€ä¸è¶³ï¼šå¯èƒ½éœ€è¦æ¯ä¸ªä½¿ç”¨ 1px border çš„åœ°æ–¹åšç›¸åº”çš„ css è°ƒæ•´ï¼Œé…åˆä½¿ç”¨ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é€šè¿‡å¯¹ç°æœ‰ Web ç«¯å±å¹•é€‚é…æ–¹æ¡ˆçš„æ€»ç»“ï¼Œå¼•èµ·å¯¹æ›´å¥½çš„ Web ç«¯å±å¹•é€‚é…æ–¹æ¡ˆçš„è°ƒç ”ã€‚åœ¨è°ƒç ”ä¸­å‘ç°äº†ç°å®ä¸­å‡ºç°çš„ Web ç«¯ç§»åŠ¨ç«¯é€‚é…ç›¸å…³é—®é¢˜ï¼Œå¹¶æ¨èç›¸åº”è§£å†³æ–¹æ¡ˆï¼Œå’Œå±å¹•é€‚é…æ–¹æ¡ˆã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="zhoushiqi" scheme="http://xgfe.github.io/categories/zhoushiqi/"/>
    
    
      <category term="CSS" scheme="http://xgfe.github.io/tags/CSS/"/>
    
      <category term="å±å¹•é€‚é…" scheme="http://xgfe.github.io/tags/%E5%B1%8F%E5%B9%95%E9%80%82%E9%85%8D/"/>
    
      <category term="ç§»åŠ¨ç«¯" scheme="http://xgfe.github.io/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>æ­£åˆ™è¡¨è¾¾å¼æ€»ç»“</title>
    <link href="http://xgfe.github.io/2018/01/22/liuhaifeng/Regular-Expression/"/>
    <id>http://xgfe.github.io/2018/01/22/liuhaifeng/Regular-Expression/</id>
    <published>2018-01-21T16:00:00.000Z</published>
    <updated>2018-03-20T03:07:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸»è¦è®²è§£JavaScriptè¯­è¨€ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ç”¨æ³•åŠåŒ¹é…åŸç†ã€‚</p>
<a id="more"></a>
<h2 id="å­—ç¬¦åŒ¹é…"><a href="#å­—ç¬¦åŒ¹é…" class="headerlink" title="å­—ç¬¦åŒ¹é…"></a>å­—ç¬¦åŒ¹é…</h2><blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯åŒ¹é…æ¨¡å¼ï¼Œè¦ä¹ˆåŒ¹é…å­—ç¬¦ï¼Œè¦ä¹ˆåŒ¹é…ä½ç½®ã€‚  </p>
</blockquote>
<h3 id="æ¨¡ç³ŠåŒ¹é…"><a href="#æ¨¡ç³ŠåŒ¹é…" class="headerlink" title="æ¨¡ç³ŠåŒ¹é…"></a>æ¨¡ç³ŠåŒ¹é…</h3><p>æ¨¡ç³ŠåŒ¹é…æœ‰ä¸¤ä¸ªæ–¹å‘ä¸Šçš„â€œæ¨¡ç³Šâ€ï¼š æ¨ªå‘æ¨¡ç³Šå’Œçºµå‘æ¨¡ç³Šã€‚   </p>
<p><strong>æ¨ªå‘æ¨¡ç³ŠåŒ¹é…ï¼š</strong> æŒ‡æ­£åˆ™å¯åŒ¹é…çš„å­—ç¬¦ä¸²çš„é•¿åº¦ä¸å›ºå®šï¼Œæˆ–æ˜¯åŒ¹é…å¤šç§æƒ…å†µã€‚</p>
<p>å…¶ä¸»è¦å®ç°æ–¹å¼æ˜¯ï¼šä½¿ç”¨é‡è¯ã€‚å¦‚ï¼š{m,n}   </p>
<p><strong>ä¾‹</strong> ï¼š<code>var regex = /ab{2,5}c/</code></p>
<p><strong>çºµå‘æ¨¡ç³ŠåŒ¹é…ï¼š</strong> æŒ‡å…·ä½“åˆ°ä¸€ä½å­—ç¬¦æ—¶ï¼Œä»–å¯ä»¥ä¸æ˜¯ç¡®å®šçš„å­—ç¬¦ï¼ŒåŒ¹é…å¤šç§å¯èƒ½ã€‚</p>
<p>å…¶ä¸»è¦å®ç°æ–¹å¼æ˜¯ï¼šä½¿ç”¨å­—ç¬¦ç»„ã€‚å¦‚ï¼š[abc]   </p>
<p><strong>ä¾‹</strong> ï¼š<code>var regex = /a[123]b/</code></p>
<h3 id="å­—ç¬¦ç»„"><a href="#å­—ç¬¦ç»„" class="headerlink" title="å­—ç¬¦ç»„"></a>å­—ç¬¦ç»„</h3><p><strong>å¸¸è§å†™æ³•</strong> ï¼š<code>[abc]</code> </p>
<p><strong>èŒƒå›´è¡¨ç¤ºæ³•</strong> ï¼š <code>[1-9] [a-z]</code> ç­‰  <strong>// æ³¨æ„ï¼š</strong> è¦åŒ¹é…<code>&quot;a&quot;</code>ã€<code>&quot;-&quot;</code>ã€<code>&quot;z&quot;</code>ä»»æ„ä¸€å­—ç¬¦ï¼Œæ’é™¤æ­§ä¹‰å†™æ³•å³å¯ã€‚â€”&gt; å³ä¸èƒ½å†™æˆ <code>[a-z]</code> ,è€Œåº”å½¢æˆ <code>[-az]</code> æˆ– <code>[az-]</code>ã€‚</p>
<p><strong>æ’é™¤å­—ç¬¦ç»„</strong> ï¼š<code>[^ab]</code>ï¼šè¡¨ç¤ºé™¤abä»¥å¤–çš„ä»»æ„å­—ç¬¦ï¼Œ^(è„±å­—ç¬¦)</p>
<p><strong>å¸¸è§ç®€å†™å½¢å¼</strong> ï¼š</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦ç»„</th>
<th>å…·ä½“å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>\d</td>
<td>è¡¨ç¤ºï¼šä¸€ä½æ•°å­—ï¼Œ<code>[0-9]</code>ã€‚</td>
</tr>
<tr>
<td>\D</td>
<td>è¡¨ç¤ºï¼šéæ•°å­—çš„ä»»æ„å­—ç¬¦ï¼Œ<code>[^0-9]</code> ã€‚</td>
</tr>
<tr>
<td>\w</td>
<td>è¡¨ç¤ºï¼šæ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œ<code>[0-9a-zA-Z]</code>ã€‚</td>
</tr>
<tr>
<td>\W</td>
<td>è¡¨ç¤ºï¼šéæ•°å­—ã€å¤§å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œ<code>[^0-9a-zA-Z]</code>ã€‚</td>
</tr>
<tr>
<td>\s</td>
<td>è¡¨ç¤ºï¼šç©ºç™½ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€æ°´å¹³åˆ¶è¡¨ç¬¦ã€å‚ç›´åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€å›è½¦ç¬¦ã€æ¢é¡µç¬¦,<code>[\t\v\n\r\f]</code>ã€‚</td>
</tr>
<tr>
<td>\S</td>
<td>è¡¨ç¤ºï¼šéç©ºç™½ç¬¦ï¼Œ<code>[^\t\v\n\r\f]</code>ã€‚</td>
</tr>
<tr>
<td>.</td>
<td>è¡¨è¿°ï¼šé€šé…ç¬¦ï¼Œå‡ ä¹ä»»æ„å­—ç¬¦ã€‚ä½†ä¸åŒ…æ‹¬ï¼šæ¢è¡Œç¬¦ã€å›è½¦ç¬¦ã€è¡Œåˆ†éš”ç¬¦ã€æ®µåˆ†éš”ç¬¦ã€‚<code>[^\n\r\u2028\u2029]</code>ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="é‡è¯"><a href="#é‡è¯" class="headerlink" title="é‡è¯"></a>é‡è¯</h3><table>
<thead>
<tr>
<th>é‡è¯</th>
<th>å…·ä½“å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>{m,}</td>
<td>è‡³å°‘å‡ºç°mæ¬¡ã€‚ </td>
</tr>
<tr>
<td>{m}</td>
<td>ç­‰ä»·äº{m,m}ï¼Œè¡¨ç¤ºå‡ºç°mæ¬¡ã€‚</td>
</tr>
<tr>
<td>?</td>
<td>ç­‰ä»·äº{0,1}è¡¨ç¤ºå‡ºç°æˆ–ä¸å‡ºç°ã€‚</td>
</tr>
<tr>
<td>+</td>
<td>ç­‰ä»·äº{1,}è¡¨ç¤ºå‡ºç°è‡³å°‘ä¸€æ¬¡ã€‚</td>
</tr>
<tr>
<td>*</td>
<td>ç­‰ä»·äº{0,}è¡¨ç¤ºå‡ºç°ä»»æ„æ¬¡ï¼Œæˆ–è€…ä¸å‡ºç°ã€‚</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æƒ°æ€§é‡è¯</th>
<th>è´ªå©ªé‡è¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>{m,}?</td>
<td>{m,}</td>
</tr>
<tr>
<td>{m}?</td>
<td>{m}</td>
</tr>
<tr>
<td>??</td>
<td>ï¼Ÿ</td>
</tr>
<tr>
<td>+?</td>
<td>+</td>
</tr>
<tr>
<td>*?</td>
<td>*</td>
</tr>
</tbody>
</table>
<h3 id="å¤šé€‰åˆ†æ”¯"><a href="#å¤šé€‰åˆ†æ”¯" class="headerlink" title="å¤šé€‰åˆ†æ”¯"></a>å¤šé€‰åˆ†æ”¯</h3><p><strong>å¸¸è§å†™æ³•</strong> ï¼š <code>/good|nice/</code>  <code>/(p1|p2|p3)ab/</code> , å…¶ä¸­ p1ã€p2ã€p3æ˜¯å­æ¨¡å¼ï¼Œç”¨ |ï¼ˆç®¡é“ç¬¦ï¼‰åˆ†å‰² ã€‚</p>
<p><strong>æ³¨æ„</strong> ï¼šåˆ†æ”¯ç»“æ„æ˜¯æƒ°æ€§çš„ï¼Œå³åŒ¹é…äº†å‰è¾¹å­æ¨¡å¼åï¼Œå°±ä¸å†å»å°è¯•åŒ¹é…äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var regex1 = /goodbye|good/g;</div><div class="line">var regex2 = /good|goodbye/g;</div><div class="line">var str = &quot;goodbye&quot;;</div><div class="line">console.log( str.match(regex1) ); // =&gt; [&quot;goodbye&quot;]</div><div class="line">console.log( str.match(regex2) ); // =&gt; [&quot;good&quot;]</div></pre></td></tr></table></figure>
<h2 id="ä½ç½®åŒ¹é…"><a href="#ä½ç½®åŒ¹é…" class="headerlink" title="ä½ç½®åŒ¹é…"></a>ä½ç½®åŒ¹é…</h2><blockquote>
<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯åŒ¹é…æ¨¡å¼ï¼Œè¦ä¹ˆåŒ¹é…å­—ç¬¦ï¼Œè¦ä¹ˆåŒ¹é…ä½ç½®ã€‚</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯ä½ç½®ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ä½ç½®ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ä½ç½®ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ä½ç½®ï¼Ÿ</h3><p>ä½ç½®ï¼ˆé”šï¼‰æ˜¯ç›¸é‚»å­—ç¬¦ä¹‹é—´çš„ä½ç½®ï¼ˆéå­—ç¬¦çš„ä½ç½®ï¼‰ã€‚</p>
<p>å¦‚<code>&#39;good&#39;</code>å­—ç¬¦ä¸²,å®ƒçš„ä½ç½®æœ‰5ä¸ªï¼Œç”¨*è¡¨ç¤ºä½ç½®å³ï¼š*g*o*o*d* ã€‚</p>
<p><strong>ä½ç½®åŒ¹é…ï¼š</strong></p>
<p>åœ¨ES5ä¸­ï¼Œå…±æœ‰<strong>6ä¸ªé”š</strong>ï¼ˆç”¨æ¥å®šä½çš„ç¬¦å·ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">\^</th>
<th style="text-align:left">\$</th>
<th style="text-align:left">\b</th>
<th style="text-align:left">\B</th>
<th style="text-align:left">(?=p)</th>
<th>(?!p)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">å¼€å¤´</td>
<td style="text-align:left">ç»“å°¾</td>
<td style="text-align:left"><strong>å•è¯è¾¹ç•Œ</strong>ã€‚å…·ä½“å°±æ˜¯\wä¸\Wä¹‹é—´çš„ä½ç½®ï¼Œä¹ŸåŒ…æ‹¬\wä¸\^å’Œ\wä¸\$ä¹‹é—´çš„ä½ç½®ã€‚å¦‚ï¼š<code>&quot;good\_nice&quot;</code>,å¯¹åº”ä¸ºï¼š<code>\*good\*_\*nice\*</code>ã€‚ï¼ˆ*å·ä½ç½®å³ä¸ºå•è¯è¾¹ç•Œï¼‰ã€‚</td>
<td style="text-align:left"><strong>éå•è¯è¾¹ç•Œ</strong>ã€‚å…·ä½“å°±æ˜¯\wä¸\wã€\Wä¸\Wã€\^ä¸\Wã€\Wä¸\$ä¹‹é—´çš„ä½ç½®ã€‚å¦‚ï¼š<code>&quot;[big\_go]&quot;</code>,å¯¹åº”ä¸ºï¼š<code>\*[b\*i\*g\_g\*o]\*</code>ã€‚ï¼ˆ*å·ä½ç½®å³ä¸ºå•è¯è¾¹ç•Œ,æ³¨æ„<code>[</code>ä¸<code>^</code>ã€<code>]</code>ä¸<code>$</code>ä¹‹é—´ä¹Ÿæ˜¯ï¼ï¼‰</td>
<td style="text-align:left"><strong>p å‰è¾¹çš„ä½ç½®</strong>ï¼ˆè¯¥ä½ç½®åè¾¹çš„å­—ç¬¦è¦åŒ¹é…pï¼Œ<em>å…¶ä¸­pæ˜¯ä¸€ä¸ªå­é›†</em>ï¼‰ã€‚å¦‚ï¼š<code>console.log(&quot;hello&quot;.replace(/(?=l)/g,&#39;#&#39;))// =&gt; &quot;he#l#l0&quot;</code>ã€‚</td>
<td><strong>ép å‰è¾¹çš„ä½ç½®</strong>ï¼ˆè¯¥ä½ç½®åè¾¹ä¸èƒ½åŒ¹é…på­é›†ï¼‰ã€‚å¦‚ï¼š<code>console.log(&quot;hello&quot;.replace(/(?ï¼l)/g,&#39;#&#39;))// =&gt; &quot;#h#ell#0#&quot;</code>ã€‚</td>
</tr>
</tbody>
</table>
<p>å¯ä»¥æŠŠä½ç½®ç†è§£æˆç©ºå­—ç¬¦ä¸²<code>&quot;&quot;</code>ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;hello&quot; == &quot;&quot; + &quot;h&quot; + &quot;&quot; + &quot;e&quot; + &quot;&quot; + &quot;l&quot; + &quot;&quot; + &quot;l&quot; + &quot;&quot; + &quot;o&quot;  + &quot;&quot; == &quot;&quot; + &quot;&quot; + &quot;h&quot;;</div></pre></td></tr></table></figure>
<h2 id="æ‹¬å·çš„ä½œç”¨"><a href="#æ‹¬å·çš„ä½œç”¨" class="headerlink" title="æ‹¬å·çš„ä½œç”¨"></a>æ‹¬å·çš„ä½œç”¨</h2><blockquote>
<p>å¹¶éä»…æ˜¯ä¸ºäº†æé«˜ä¼˜å…ˆçº§ï¼å®ƒçš„åŠŸèƒ½è›®å¼ºå¤§çš„ï¼</p>
</blockquote>
<h3 id="åˆ†ç»„å’Œåˆ†æ”¯ç»“æ„"><a href="#åˆ†ç»„å’Œåˆ†æ”¯ç»“æ„" class="headerlink" title="åˆ†ç»„å’Œåˆ†æ”¯ç»“æ„"></a>åˆ†ç»„å’Œåˆ†æ”¯ç»“æ„</h3><p><strong>åˆ†ç»„</strong> ï¼šåŒ¹é…è¿ç»­å‡ºç°å¤šä¸ª<code>&quot;ab&quot;</code>æ—¶ï¼Œç”¨<code>/(ab)+/</code>ã€‚(æ‹¬å·æä¾›äº†åˆ†ç»„åŠŸèƒ½ï¼Œä½¿é‡è¯+ä½œç”¨äº<code>&quot;ab&quot;</code>è¿™ä¸ªæ•´ä½“)</p>
<p><strong>åˆ†æ”¯ç»“æ„</strong> ï¼š(p1|p2)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var regex = /^I Love (JavaScript|CSS)$/;</div><div class="line">console.log( regex.test(&quot;I Love JavaScript&quot;) );</div><div class="line">console.log( regex.test(&quot;I Love CSS&quot;) );</div><div class="line">// =&gt; true </div><div class="line">// =&gt; true</div></pre></td></tr></table></figure>
<p>è‹¥å»æ‰æ‹¬å·ï¼Œå³ï¼š<code>/^I Love JavaScript|CSS$/</code>ï¼ŒåŒ¹é…çš„å­—ç¬¦ä¸²ä¾¿æ˜¯<code>&quot;I Love JavaScript&quot;</code>å’Œ<code>&quot;CSS&quot;</code>ã€‚</p>
<h3 id="åˆ†ç»„å¼•ç”¨"><a href="#åˆ†ç»„å¼•ç”¨" class="headerlink" title="åˆ†ç»„å¼•ç”¨"></a>åˆ†ç»„å¼•ç”¨</h3><p>æ­£åˆ™åœ¨åŒ¹é…æ—¶ï¼Œä¼šæŠŠæ¯ä¸ªæ‹¬å·çš„éƒ¨åˆ†åˆ†ç»„ç¼–å·ï¼Œä¸ºæ¯ä¸ªåˆ†ç»„å¼€è¾Ÿä¸ªç©ºé—´æ¥å­˜å‚¨å…³äºæ‹¬å·å†…çš„æ•°æ®ã€‚</p>
<p>å³ï¼šåˆ†ç»„æ˜¯å¯ä»¥æ•è·çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var regex = /(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/;</div><div class="line">var str = &quot;2018-01-12&quot;;</div><div class="line">console.log( str.match(regex) );</div><div class="line">// =&gt; [&quot;2018-01-12&quot;, &quot;2018&quot;, &quot;01&quot;, &quot;12&quot;, index: 0, input: &quot;2018-01-12&quot;]</div></pre></td></tr></table></figure>
<blockquote>
<p>NOTE : matchè¿”å›çš„ä¸€ä¸ªæ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ•´ä½“åŒ¹é…ç»“æœï¼Œç„¶åæ˜¯å„ä¸ªåˆ†ç»„ï¼ˆæ‹¬å·é‡Œï¼‰åŒ¹é…çš„å†…å®¹ï¼Œç„¶åæ˜¯åŒ¹é…ä¸‹æ ‡ï¼Œæœ€åæ˜¯è¾“å…¥çš„æ–‡æœ¬ã€‚å¦å¤–ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦æœ‰ä¿®é¥°ç¬¦gï¼Œmatchè¿”å›çš„æ•°ç»„æ ¼å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; var regex = /(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/g;</div><div class="line">&gt; var str = &quot;2018-01-12,2018-02-13&quot;;</div><div class="line">&gt; console.log( str.match(regex) );</div><div class="line">&gt; // =&gt; [&quot;2018-01-12&quot;, &quot;2018-02-13&quot;]</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>æ­£åˆ™æœ‰åˆ†ç»„è¡Œä¸ºåï¼Œæ„é€ å‡½æ•°ä¸Šå¯¹åº”çš„$1è‡³$9å±æ€§å°±è¢«èµ‹äºˆç›¸åº”åˆ†ç»„åŒ¹é…çš„å†…å®¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var regex = /(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/;</div><div class="line">var str = &quot;2018-01-12&quot;;</div><div class="line">regex.test(str);</div><div class="line">//regex.exec(str);</div><div class="line">//str.match(regex);</div><div class="line">console.log(RegExp.$1);// =&gt; &quot;2018&quot;</div><div class="line">console.log(RegExp.$2);// =&gt; &quot;01&quot;</div><div class="line">console.log(RegExp.$3);// =&gt; &quot;12&quot;</div><div class="line">console.log(RegExp.$4);// =&gt; &quot;&quot; (æ²¡æœ‰è¢«èµ‹å€¼)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var regex = /(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/;</div><div class="line">var str = &quot;2018-01-12&quot;;</div><div class="line">var result1 = str.replace(regex,&quot;$2/$3/$1&quot;);</div><div class="line">var result2 = str.replace(regex,function()&#123;</div><div class="line">  return RegExp.$2 + &quot;/&quot; + RegExp.$3 + &quot;/&quot; + RegExp.$1;</div><div class="line">&#125;);</div><div class="line">var result3 = str.replace(regex,function(match,year,month,day)&#123;</div><div class="line">  return month + &quot;/&quot; + day + &quot;/&quot; + year;</div><div class="line">&#125;);</div><div class="line">console.log(result1,result2,result3);// =&gt; &quot;01/12/2018&quot; &quot;01/12/2018&quot; &quot;01/12/2018&quot;</div></pre></td></tr></table></figure>
<h3 id="åå‘å¼•ç”¨"><a href="#åå‘å¼•ç”¨" class="headerlink" title="åå‘å¼•ç”¨"></a>åå‘å¼•ç”¨</h3><p>ä¸Šä¸€å°èŠ‚é€šè¿‡ä½¿ç”¨ç›¸åº”APIæ¥å¼•ç”¨åˆ†ç»„ï¼Œå…¶å®ä¹Ÿå¯ä»¥åœ¨æ­£åˆ™è‡ªèº«é‡Œå¼•ç”¨åˆ†ç»„ã€‚ä½†åªèƒ½å¼•ç”¨ä¹‹å‰å‡ºç°çš„åˆ†ç»„ï¼Œå³åå‘å¼•ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var regex = /\d&#123;4&#125;(-|\/|\.)\d&#123;2&#125;\1\d&#123;2&#125;/;</div><div class="line">var str1 = &quot;2018-01-12&quot;;</div><div class="line">var str2 = &quot;2018/01/12&quot;;</div><div class="line">var str3 = &quot;2018.01.12&quot;;</div><div class="line">var str4 = &quot;2018-01/12&quot;;</div><div class="line">console.log( regex.test(str1) ); //true</div><div class="line">console.log( regex.test(str2) ); //true</div><div class="line">console.log( regex.test(str3) ); //true</div><div class="line">console.log( regex.test(str4) ); //false</div></pre></td></tr></table></figure>
<p><strong>æ‹¬å·åµŒå¥—ï¼š</strong> ä»¥å·¦å¼€æ‹¬å·ä¸ºå‡†ï¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var regex = /^((\d)(\d(\d)))\1\2\3\4$/;</div><div class="line">var str = &quot;1231231233&quot;;</div><div class="line">console.log( regex.test(str) );// true</div><div class="line">console.log( RegExp.$1 );// 123</div><div class="line">console.log( RegExp.$2 );// 1</div><div class="line">console.log( RegExp.$3 );// 23</div><div class="line">console.log( RegExp.$4 );// 3</div><div class="line">console.log( str.match(regex) );</div><div class="line">// =&gt; [&quot;1231231233&quot;, &quot;123&quot;, &quot;1&quot;, &quot;23&quot;, &quot;3&quot;, index: 0, input: &quot;1231231233&quot;]</div></pre></td></tr></table></figure>
<p><strong><code>\10</code> ï¼šè¡¨ç¤ºç¬¬10ä¸ªåˆ†ç»„</strong>ï¼ˆä¸æ˜¯\1å’Œ0ï¼‰ã€‚</p>
<p><strong>å¼•ç”¨ä¸å­˜åœ¨çš„åˆ†ç»„æ—¶ï¼š</strong> ä¸æŠ¥é”™ï¼ŒåŒ¹é…è½¬ä¹‰çš„å­—ç¬¦ã€‚ä¾‹å¦‚ \2ï¼Œå°±åŒ¹é… \2ã€‚<code>&quot;\2&quot;</code>è¡¨ç¤ºå¯¹<code>&quot;2&quot;</code>è¿›è¡Œäº†è½¬ä¹‰ã€‚</p>
<p><strong>åˆ†ç»„åè¾¹æœ‰é‡ï¼ï¼š</strong> æ•è·åˆ°çš„æ•°æ®æ˜¯æœ€åä¸€æ¬¡çš„åŒ¹é…ã€‚ï¼ˆ<strong>åå‘å¼•ç”¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼</strong>ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var regex = /(\d)+/;</div><div class="line">var str = &quot;12345&quot;;</div><div class="line">console.log( str.match(regex) ); // [&quot;12345&quot;, &quot;5&quot;, index: 0, input: &quot;12345&quot;]</div><div class="line">var regex2 = /(\d)+ \1/;</div><div class="line">console.log( regex2.test(&quot;12345 1&quot;) );// false</div><div class="line">console.log( regex2.test(&quot;12345 5&quot;) );// true</div></pre></td></tr></table></figure>
<h3 id="éæ•è·æ‹¬å·"><a href="#éæ•è·æ‹¬å·" class="headerlink" title="éæ•è·æ‹¬å·"></a>éæ•è·æ‹¬å·</h3><p>ä¹‹å‰æ–‡ä¸­å‡ºç°çš„æ‹¬å·ï¼Œéƒ½ä¼šæ•è·å®ƒä»¬åŒ¹é…çš„æ•°æ®ï¼Œä»¥ä¾¿åç»­å¼•ç”¨ï¼Œå› æ­¤ä¹Ÿç§°å®ƒä»¬æ˜¯æ•è·å‹åˆ†ç»„å’Œæ•è·å‹åˆ†æ”¯ã€‚<br>å¦‚æœä¸æƒ³æ•è·ï¼Œåªæƒ³è¦æ‹¬å·çš„åŸå§‹åŠŸèƒ½ï¼Œå³:æ—¢ä¸åœ¨APIé‡Œå¼•ç”¨ï¼Œä¹Ÿä¸åœ¨æ­£åˆ™é‡Œå¼•ç”¨ã€‚æ­¤æ—¶ï¼š</p>
<p>ä½¿ç”¨éæ•è·å‹æ‹¬å·<code>(?:p)</code>å’Œ<code>(?:p1|p2)</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var regex1 = /(ab)+/;</div><div class="line">var regex2 = /(?:ab)+/;</div><div class="line">var str = &quot;ababa ccc&quot;;</div><div class="line">console.log( str.match(regex1) ); // [&quot;abab&quot;, &quot;ab&quot;, index: 0, input: &quot;ababa ccc&quot;]</div><div class="line">console.log( str.match(regex2) ); // [&quot;abab&quot;, index: 0, input: &quot;ababa ccc&quot;]</div></pre></td></tr></table></figure>
<h2 id="å›æº¯æ³•åŸç†"><a href="#å›æº¯æ³•åŸç†" class="headerlink" title="å›æº¯æ³•åŸç†"></a>å›æº¯æ³•åŸç†</h2><blockquote>
<p>å›æº¯æ³•ä¹Ÿç§°è¯•æ¢æ³•ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šä»é—®é¢˜çš„æŸä¸€ç§çŠ¶æ€ï¼ˆåˆå§‹çŠ¶æ€ï¼‰å‡ºå‘ï¼Œæœç´¢ä»è¿™ç§çŠ¶æ€å‡ºå‘æ‰€èƒ½è¾¾åˆ°çš„æ‰€æœ‰â€œçŠ¶æ€â€ï¼Œå½“ä¸€æ¡è·¯èµ°åˆ°â€œå°½å¤´â€çš„æ—¶å€™ï¼ˆä¸èƒ½å†å‰è¿›ï¼‰ï¼Œå†åé€€ä¸€æ­¥æˆ–è‹¥å¹²æ­¥ï¼Œä»å¦ä¸€ç§å¯èƒ½â€œçŠ¶æ€â€å‡ºå‘ï¼Œç»§ç»­æœç´¢ï¼Œç›´åˆ°æ‰€æœ‰çš„â€œè·¯å¾„â€ï¼ˆçŠ¶æ€ï¼‰éƒ½è¯•æ¢è¿‡ã€‚è¿™ç§ä¸æ–­â€œå‰è¿›â€ã€ä¸æ–­â€œå›æº¯â€å¯»æ‰¾è§£çš„æ–¹æ³•ï¼Œå°±ç§°ä½œâ€œå›æº¯æ³•â€ã€‚</p>
<p>ä¸ªäººç†è§£ï¼šå½“æ­£åˆ™åŒ¹é…å¤šç§æƒ…å†µæ—¶ï¼Œä¼šå¯¹æ¯ç§æƒ…å†µè¿›è¡Œå°è¯•ï¼Œè‹¥ç¬¬ä¸€æ¬¡æ²¡æœ‰å°è¯•æˆåŠŸï¼Œå°±ä¼šå›é€€åˆ°å¯ä»¥å‘ç”Ÿå…¶ä»–æƒ…å†µçš„åœ°æ–¹ï¼Œå†æ¬¡å°è¯•å¦ä¸€ç§åŒ¹é…ã€‚</p>
</blockquote>
<h3 id="æ²¡æœ‰å›æº¯çš„åŒ¹é…"><a href="#æ²¡æœ‰å›æº¯çš„åŒ¹é…" class="headerlink" title="æ²¡æœ‰å›æº¯çš„åŒ¹é…"></a>æ²¡æœ‰å›æº¯çš„åŒ¹é…</h3><p>å½“<code>/ab{1,3}c/</code>å»åŒ¹é…<code>&quot;abbbc&quot;</code>æ—¶ï¼Œè¿‡ç¨‹å¦‚å›¾ï¼š<img src="https://ws4.sinaimg.cn/large/006tKfTcly1fne19t4c22j30go0bydg0.jpg" alt=""></p>
<h3 id="æœ‰å›æº¯çš„åŒ¹é…"><a href="#æœ‰å›æº¯çš„åŒ¹é…" class="headerlink" title="æœ‰å›æº¯çš„åŒ¹é…"></a>æœ‰å›æº¯çš„åŒ¹é…</h3><p>å½“<code>/ab{1,3}c/</code>å»åŒ¹é…<code>&quot;abbc&quot;</code>æ—¶ï¼Œä¸­é—´å°±æœ‰å›æº¯ã€‚è¿‡ç¨‹å¦‚å›¾ï¼š<img src="https://ws4.sinaimg.cn/large/006tKfTcly1fne0xzz5lej30go0ehwf3.jpg" alt=""></p>
<p>å›¾ä¸­ç¬¬5æ­¥æœ‰çº¢é¢œè‰²ï¼Œè¡¨ç¤ºåŒ¹é…ä¸æˆåŠŸã€‚</p>
<p>å›¾ä¸­çš„ç¬¬6æ­¥ï¼Œå°±æ˜¯â€œå›æº¯â€ã€‚</p>
<p><strong>è¿™é‡Œå†çœ‹ä¸€ä¸ªæ¸…æ™°çš„å›æº¯ï¼Œæ­£åˆ™æ˜¯ï¼š</strong> <code>/&quot;.*&quot;/</code></p>
<p>ç›®æ ‡å­—ç¬¦ä¸²æ˜¯ï¼š<code>&quot;acd&quot;ef</code>ï¼ŒåŒ¹é…è¿‡ç¨‹æ˜¯ï¼š<img src="https://ws3.sinaimg.cn/large/006tKfTcly1fne1fi1yi2j30go0g7jrl.jpg" alt=""></p>
<p>å›¾ä¸­çœç•¥äº†å°è¯•åŒ¹é…åŒå¼•å·å¤±è´¥çš„è¿‡ç¨‹ã€‚å¯ä»¥çœ‹å‡º<code>.*</code>æ˜¯éå¸¸å½±å“æ•ˆç‡çš„ã€‚</p>
<p>ä¸ºäº†å‡å°‘ä¸€äº›ä¸å¿…è¦çš„å›æº¯ï¼Œå¯ä»¥æŠŠæ­£åˆ™ä¿®æ”¹ä¸º<code>/&quot;[^&quot;]*&quot;/</code>ã€‚</p>
<p><strong>è´ªå©ªé‡è¯</strong>  æ³¨æ„ï¼šå½“å¤šä¸ªè´ªå©ªé‡è¯æŒ¨ç€å­˜åœ¨ï¼Œå¹¶ç›¸äº’æœ‰å†²çªæ—¶ï¼Œå…ˆä¸‹æ‰‹ä¸ºå¼ºï¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var string = &quot;12345&quot;;</div><div class="line">var regex = /(\d&#123;1,3&#125;)(\d&#123;1,3&#125;)/;</div><div class="line">console.log( string.match(regex) );</div><div class="line">// =&gt; [&quot;12345&quot;, &quot;123&quot;, &quot;45&quot;, index: 0, input: &quot;12345&quot;]</div></pre></td></tr></table></figure>
<p><strong>æƒ°æ€§é‡è¯</strong>  è™½ç„¶ä¸è´ªå©ªï¼Œä½†ä¸ºäº†æ•´ä½“åŒ¹é…æˆåŠŸï¼Œå¯èƒ½ä¹Ÿä¼šå‘ç”Ÿå›æº¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var string = &quot;12345&quot;;</div><div class="line">var regex = /^\d&#123;1,3&#125;?\d&#123;1,3&#125;$/;</div><div class="line">console.log( string.match(regex) );</div></pre></td></tr></table></figure>
<p>å…¶åŒ¹é…è¿‡ç¨‹ä¸ºï¼š<img src="https://ws1.sinaimg.cn/large/006tKfTcly1fne1uulh11j30go0bldgo.jpg" alt=""></p>
<p><strong>åˆ†æ”¯ç»“æ„</strong>  å‰é¢çš„å­æ¨¡å¼ä¼šå½¢æˆå±€éƒ¨åŒ¹é…ï¼Œå¦‚æœæ¥ä¸‹æ¥è¡¨è¾¾å¼æ•´ä½“ä¸åŒ¹é…æ—¶ï¼Œä»ä¼šç»§ç»­å°è¯•å‰©ä¸‹çš„åˆ†æ”¯ã€‚è¿™ç§å°è¯•ä¹Ÿå¯ä»¥çœ‹æˆä¸€ç§å›æº¯ã€‚</p>
<h2 id="æ­£åˆ™è¡¨è¾¾å¼çš„æ‹†åˆ†"><a href="#æ­£åˆ™è¡¨è¾¾å¼çš„æ‹†åˆ†" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼çš„æ‹†åˆ†"></a>æ­£åˆ™è¡¨è¾¾å¼çš„æ‹†åˆ†</h2><h3 id="ç»“æ„å’Œæ“ä½œç¬¦"><a href="#ç»“æ„å’Œæ“ä½œç¬¦" class="headerlink" title="ç»“æ„å’Œæ“ä½œç¬¦"></a>ç»“æ„å’Œæ“ä½œç¬¦</h3><p>ç¼–ç¨‹è¯­è¨€ä¸€èˆ¬éƒ½æœ‰æ“ä½œç¬¦ã€‚æœ‰æ“ä½œç¬¦ï¼Œå¾€å¾€å°±éœ€è¦è¯­è¨€æœ¬èº«å®šä¹‰å¥½æ“ä½œé¡ºåºï¼Œå³æ‰€è°“çš„ä¼˜å…ˆçº§ã€‚</p>
<p><strong>JSæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç»“æ„ï¼š</strong></p>
<blockquote>
<p>å­—ç¬¦å­—é¢é‡ã€å­—ç¬¦ç»„ã€é‡è¯ã€é”šå­—ç¬¦ã€åˆ†ç»„ã€é€‰æ‹©åˆ†æ”¯ã€åå‘å¼•ç”¨ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th>ç»“æ„</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>å­—é¢é‡</td>
<td>åŒ¹é…ä¸€ä¸ªå…·ä½“å­—ç¬¦ï¼ŒåŒ…æ‹¬ä¸ç”¨è½¬ä¹‰çš„å’Œéœ€è¦è½¬ä¹‰çš„ã€‚æ¯”å¦‚aåŒ¹é…å­—ç¬¦<code>&quot;a&quot;</code>ï¼Œåˆæ¯”å¦‚<code>\n</code>åŒ¹é…æ¢è¡Œç¬¦ï¼Œåˆæ¯”å¦‚<code>\.</code>åŒ¹é…å°æ•°ç‚¹ã€‚</td>
</tr>
<tr>
<td>å­—ç¬¦ç»„</td>
<td>åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œå¯ä»¥æ˜¯å¤šç§å¯èƒ½ä¹‹ä¸€ï¼Œæ¯”å¦‚<code>[0-9]</code>ï¼Œè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæ•°å­—ã€‚ä¹Ÿæœ‰<code>\d</code>çš„ç®€å†™å½¢å¼ã€‚å¦å¤–è¿˜æœ‰åä¹‰å­—ç¬¦ç»„ï¼Œè¡¨ç¤ºå¯ä»¥æ˜¯é™¤äº†ç‰¹å®šå­—ç¬¦ä¹‹å¤–ä»»ä½•ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚<code>[^0-9]</code>ï¼Œè¡¨ç¤ºä¸€ä¸ªéæ•°å­—å­—ç¬¦ï¼Œä¹Ÿæœ‰<code>\D</code>çš„ç®€å†™å½¢å¼ã€‚</td>
</tr>
<tr>
<td>é‡è¯</td>
<td>è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç°ï¼Œæ¯”å¦‚<code>a{1,3}</code>è¡¨ç¤º<code>&quot;a&quot;</code>å­—ç¬¦è¿ç»­å‡ºç°3æ¬¡ã€‚å¦å¤–è¿˜æœ‰å¸¸è§çš„ç®€å†™å½¢å¼ï¼Œæ¯”å¦‚<code>a+</code>è¡¨ç¤º<code>&quot;a&quot;</code>å­—ç¬¦è¿ç»­å‡ºç°è‡³å°‘ä¸€æ¬¡ã€‚</td>
</tr>
<tr>
<td>é”š</td>
<td>åŒ¹é…ä¸€ä¸ªä½ç½®ï¼Œè€Œä¸æ˜¯å­—ç¬¦ã€‚æ¯”å¦‚^åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œåˆæ¯”å¦‚<code>\b</code>åŒ¹é…å•è¯è¾¹ç•Œï¼Œåˆæ¯”å¦‚<code>(?=\d)</code>è¡¨ç¤ºæ•°å­—å‰é¢çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td>åˆ†ç»„</td>
<td>ç”¨æ‹¬å·è¡¨ç¤ºä¸€ä¸ªæ•´ä½“ï¼Œæ¯”å¦‚<code>(ab)+</code>ï¼Œè¡¨ç¤º<code>&quot;ab&quot;</code>ä¸¤ä¸ªå­—ç¬¦è¿ç»­å‡ºç°å¤šæ¬¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨éæ•è·åˆ†ç»„<code>(?:ab)+</code>ã€‚</td>
</tr>
<tr>
<td>åˆ†æ”¯</td>
<td>å¤šä¸ªå­è¡¨è¾¾å¼å¤šé€‰ä¸€</td>
</tr>
</tbody>
</table>
<p>å…¶ä¸­æ¶‰åŠåˆ°çš„æ“ä½œç¬¦æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ“ä½œç¬¦æè¿°</th>
<th>æ“ä½œç¬¦</th>
<th>ä¼˜å…ˆçº§</th>
</tr>
</thead>
<tbody>
<tr>
<td>è½¬ä¹‰ç¬¦</td>
<td><code>\</code></td>
<td>1</td>
</tr>
<tr>
<td>æ‹¬å·å’Œæ–¹æ‹¬å·</td>
<td><code>(...)</code>ã€<code>(?:...)</code>ã€<code>(?=...)</code>ã€<code>(?!...)</code>ã€<code>[...]</code></td>
<td>2</td>
</tr>
<tr>
<td>é‡è¯é™å®šç¬¦</td>
<td><code>{m}</code>ã€<code>{m,n}</code>ã€<code>{m,}</code>ã€<code>?</code>ã€<code>*</code>ã€<code>+</code></td>
<td>3</td>
</tr>
<tr>
<td>ä½ç½®å’Œåºåˆ—</td>
<td><code>^</code> ã€<code>$</code>ã€<code>\</code>å…ƒå­—ç¬¦ã€ ä¸€èˆ¬å­—ç¬¦</td>
<td>4</td>
</tr>
<tr>
<td>ç®¡é“ç¬¦</td>
<td>ï¼ˆç«–æ ï¼‰</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>åˆ†æä¸€ä¸ªæ­£åˆ™ï¼š</strong></p>
<p><code>/ab?(c|de*)+|fg/</code></p>
<ol>
<li>ç”±äºæ‹¬å·çš„å­˜åœ¨ï¼Œæ‰€ä»¥ï¼Œ<code>(c|de*)</code>æ˜¯ä¸€ä¸ªæ•´ä½“ç»“æ„ã€‚</li>
<li>åœ¨<code>(c|de*)</code>ä¸­ï¼Œæ³¨æ„å…¶ä¸­çš„é‡è¯<code>*</code>ï¼Œå› æ­¤<code>e*</code>æ˜¯ä¸€ä¸ªæ•´ä½“ç»“æ„ã€‚</li>
<li>åˆå› ä¸ºåˆ†æ”¯ç»“æ„<code>&quot;|&quot;</code>ä¼˜å…ˆçº§æœ€ä½ï¼Œå› æ­¤<code>c</code>æ˜¯ä¸€ä¸ªæ•´ä½“ã€è€Œ<code>de*</code>æ˜¯å¦ä¸€ä¸ªæ•´ä½“ã€‚</li>
<li>åŒç†ï¼Œæ•´ä¸ªæ­£åˆ™åˆ†æˆäº† <code>a</code>ã€<code>b?</code>ã€<code>(...)+</code>ã€<code>f</code>ã€<code>g</code>ã€‚è€Œç”±äºåˆ†æ”¯çš„åŸå› ï¼Œåˆå¯ä»¥åˆ†æˆ<code>ab?(c|de*)+</code>å’Œ<code>fg</code>è¿™ä¸¤éƒ¨åˆ†ã€‚</li>
</ol>
<h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„:"></a>æ³¨æ„:</h3><p><strong>1. é‡è¯è¿ç¼€é—®é¢˜ï¼š</strong></p>
<p>å‡è®¾ï¼Œè¦åŒ¹é…è¿™æ ·çš„å­—ç¬¦ä¸²ï¼š</p>
<blockquote>
<ol>
<li>æ¯ä¸ªå­—ç¬¦ä¸ºaã€bã€cä»»é€‰å…¶ä¸€</li>
<li>å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯3çš„å€æ•°</li>
</ol>
</blockquote>
<p>æ­¤æ—¶æ­£åˆ™ä¸èƒ½æƒ³å½“ç„¶åœ°å†™æˆ<code>/^[abc]{3}+$/</code>ï¼Œè¿™æ ·ä¼šæŠ¥é”™ï¼Œè¯´<code>+</code>å‰é¢æ²¡ä»€ä¹ˆå¯é‡å¤çš„</p>
<p>æ­¤æ—¶è¦ä¿®æ”¹æˆï¼š<code>/^([abc]{3})+$/</code></p>
<p><strong>2. å…ƒå­—ç¬¦è½¬ä¹‰é—®é¢˜</strong></p>
<p>æ‰€è°“å…ƒå­—ç¬¦ï¼Œå°±æ˜¯æ­£åˆ™ä¸­æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ã€‚</p>
<p>æ‰€æœ‰ç»“æ„é‡Œï¼Œç”¨åˆ°çš„å…ƒå­—ç¬¦æ€»ç»“å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">^ &amp; . * + ? | \ / ( ) [ ] &#123; &#125; = ! : - ,</div></pre></td></tr></table></figure>
<p>å½“åŒ¹é…ä¸Šé¢çš„å­—ç¬¦æœ¬èº«æ—¶ï¼Œå¯ä»¥ä¸€å¾‹è½¬ä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var string = &quot;^$.*+?|\\/[]&#123;&#125;=!:-,&quot;;</div><div class="line">var regex = /\^\$\.\*\+\?\|\\\/\[\]\&#123;\&#125;\=\!\:\-\,/;</div><div class="line">console.log( regex.test(string) ); </div><div class="line">// =&gt; true</div></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>string</code>ä¸­çš„<code>\</code>å­—ç¬¦ä¹Ÿè¦è½¬ä¹‰çš„ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨<code>string</code>ä¸­ï¼Œä¹Ÿå¯ä»¥æŠŠæ¯ä¸ªå­—ç¬¦è½¬ä¹‰ï¼Œå½“ç„¶ï¼Œè½¬ä¹‰åçš„ç»“æœä»æ˜¯æœ¬èº«ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var string = &quot;^$.*+?|\\/[]&#123;&#125;=!:-,&quot;;</div><div class="line">var string2 = &quot;\^\$\.\*\+\?\|\\\/\[\]\&#123;\&#125;\=\!\:\-\,&quot;;</div><div class="line">console.log( string == string2 ); </div><div class="line">// =&gt; true</div></pre></td></tr></table></figure>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œæ˜¯ä¸æ˜¯æ¯ä¸ªå­—ç¬¦éƒ½éœ€è¦è½¬ä¹‰å‘¢ï¼Ÿå¦ï¼Œçœ‹æƒ…å†µã€‚</p>
<p><strong>3. å­—ç¬¦ç»„ä¸­çš„å…ƒå­—ç¬¦</strong></p>
<p>è·Ÿå­—ç¬¦ç»„ç›¸å…³çš„å…ƒå­—ç¬¦æœ‰<code>[]</code>ã€<code>^</code>ã€<code>-</code>ã€‚å› æ­¤åœ¨ä¼šå¼•èµ·æ­§ä¹‰çš„åœ°æ–¹è¿›è¡Œè½¬ä¹‰ã€‚ä¾‹å¦‚å¼€å¤´çš„<code>^</code>å¿…é¡»è½¬ä¹‰ï¼Œä¸ç„¶ä¼šæŠŠæ•´ä¸ªå­—ç¬¦ç»„ï¼Œçœ‹æˆåä¹‰å­—ç¬¦ç»„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var string = &quot;^$.*+?|\\/[]&#123;&#125;=!:-,&quot;;</div><div class="line">var regex = /[\^$.*+?|\\/\[\]&#123;&#125;=!:\-,]/g;</div><div class="line">console.log( string.match(regex) );</div><div class="line">// =&gt; [&quot;^&quot;, &quot;$&quot;, &quot;.&quot;, &quot;*&quot;, &quot;+&quot;, &quot;?&quot;, &quot;|&quot;, &quot;\&quot;, &quot;/&quot;, &quot;[&quot;, &quot;]&quot;, &quot;&#123;&quot;, &quot;&#125;&quot;, &quot;=&quot;, &quot;!&quot;, &quot;:&quot;, &quot;-&quot;, &quot;,&quot;]</div></pre></td></tr></table></figure>
<p><strong>4. åŒ¹é…<code>&quot;[abc]&quot;</code>å’Œ<code>&quot;{3,5}&quot;</code></strong></p>
<p>æˆ‘ä»¬çŸ¥é“<code>[abc]</code>ï¼Œæ˜¯ä¸ªå­—ç¬¦ç»„ã€‚å¦‚æœè¦åŒ¹é…å­—ç¬¦ä¸²<code>&quot;[abc]&quot;</code>æ—¶ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>å¯ä»¥å†™æˆ<code>/\[abc\]/</code>ï¼Œä¹Ÿå¯ä»¥å†™æˆ<code>/\[abc]/</code>ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var string = &quot;[abc]&quot;;</div><div class="line">var regex = /\[abc]/g;</div><div class="line">console.log( string.match(regex)[0] ); </div><div class="line">// =&gt; &quot;[abc]&quot;</div></pre></td></tr></table></figure>
<p>åªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªæ–¹æ‹¬å·è½¬ä¹‰å³å¯ï¼Œå› ä¸ºåé¢çš„æ–¹æ‹¬å·æ„ä¸æˆå­—ç¬¦ç»„ï¼Œæ­£åˆ™ä¸ä¼šå¼•å‘æ­§ä¹‰ï¼Œè‡ªç„¶ä¸éœ€è¦è½¬ä¹‰ã€‚</p>
<p>åŒç†ï¼Œè¦åŒ¹é…å­—ç¬¦ä¸²<code>&quot;{3,5}&quot;</code>ï¼Œåªéœ€è¦æŠŠæ­£åˆ™å†™æˆ<code>/\{3,5}/</code>å³å¯ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“é‡è¯æœ‰ç®€å†™å½¢å¼<code>{m,}</code>ï¼Œå´æ²¡æœ‰<code>{,n}</code>çš„æƒ…å†µã€‚è™½ç„¶åè€…ä¸æ„æˆé‡è¯çš„å½¢å¼ï¼Œä½†æ­¤æ—¶å¹¶ä¸ä¼šæŠ¥é”™ã€‚å½“ç„¶ï¼ŒåŒ¹é…çš„å­—ç¬¦ä¸²ä¹Ÿæ˜¯<code>&quot;{,n}&quot;</code>ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var string = &quot;&#123;,3&#125;&quot;;</div><div class="line">var regex = /&#123;,3&#125;/g;</div><div class="line">console.log( string.match(regex)[0] ); </div><div class="line">// =&gt; &quot;&#123;,3&#125;&quot;</div></pre></td></tr></table></figure>
<p><strong>5. å…¶ä½™æƒ…å†µ</strong></p>
<p>æ¯”å¦‚<code>=</code> <code>!</code> <code>:</code> <code>-</code> <code>,</code>ç­‰ç¬¦å·ï¼Œåªè¦ä¸åœ¨ç‰¹æ®Šç»“æ„ä¸­ï¼Œä¹Ÿä¸éœ€è¦è½¬ä¹‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ‹¬å·éœ€è¦å‰åéƒ½è½¬ä¹‰çš„ï¼Œå¦‚<code>/\(123\)/</code>ã€‚</p>
<p>è‡³äºå‰©ä¸‹çš„<code>^</code> <code>$</code> <code>.</code> <code>*</code> <code>+</code> <code>?</code> <code>|</code> <code>\</code> <code>/</code>ç­‰å­—ç¬¦ï¼Œåªè¦ä¸åœ¨å­—ç¬¦ç»„å†…ï¼Œéƒ½éœ€è¦è½¬ä¹‰çš„ã€‚</p>
<h2 id="æ­£åˆ™è¡¨è¾¾å¼çš„æ„å»º"><a href="#æ­£åˆ™è¡¨è¾¾å¼çš„æ„å»º" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼çš„æ„å»º"></a>æ­£åˆ™è¡¨è¾¾å¼çš„æ„å»º</h2><blockquote>
<p>é’ˆå¯¹æ¯ç§æƒ…å½¢ï¼Œåˆ†åˆ«å†™å‡ºæ­£åˆ™ï¼Œç„¶ç”¨åˆ†æ”¯æŠŠä»–ä»¬åˆå¹¶åœ¨ä¸€èµ·ï¼Œå†æå–åˆ†æ”¯å…¬å…±éƒ¨åˆ†ï¼Œå°±èƒ½å¾—åˆ°å‡†ç¡®çš„æ­£åˆ™ã€‚</p>
</blockquote>
<h3 id="å¹³è¡¡æ³•åˆ™"><a href="#å¹³è¡¡æ³•åˆ™" class="headerlink" title="å¹³è¡¡æ³•åˆ™"></a>å¹³è¡¡æ³•åˆ™</h3><p>æ„å»ºæ­£åˆ™æœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼Œéœ€è¦åšåˆ°ä¸‹é¢å‡ ç‚¹çš„å¹³è¡¡ï¼š</p>
<ol>
<li>åŒ¹é…é¢„æœŸçš„å­—ç¬¦ä¸²</li>
<li>ä¸åŒ¹é…éé¢„æœŸçš„å­—ç¬¦ä¸²</li>
<li>å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</li>
<li>æ•ˆç‡</li>
</ol>
<h3 id="æ„å»ºæ­£åˆ™å‰æ"><a href="#æ„å»ºæ­£åˆ™å‰æ" class="headerlink" title="æ„å»ºæ­£åˆ™å‰æ"></a>æ„å»ºæ­£åˆ™å‰æ</h3><p><strong>1. æ˜¯å¦èƒ½ä½¿ç”¨æ­£åˆ™:</strong>  å¦‚åŒ¹é…è¿™æ ·çš„å­—ç¬¦ä¸²ï¼š1010010001â€¦.ã€‚è™½ç„¶å¾ˆæœ‰è§„å¾‹ï¼Œä½†æ˜¯åªé æ­£åˆ™å°±æ˜¯æ— èƒ½ä¸ºåŠ›ã€‚</p>
<p><strong>2. æ˜¯å¦æœ‰å¿…è¦ä½¿ç”¨æ­£åˆ™:</strong>  èƒ½ç”¨å­—ç¬¦ä¸²APIè§£å†³çš„ç®€å•é—®é¢˜ï¼Œå°±ä¸è¯¥æ­£åˆ™å‡ºé©¬ã€‚</p>
<p> æ¯”å¦‚ï¼Œä»æ—¥æœŸä¸­æå–å‡ºå¹´æœˆæ—¥:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var string = &quot;2017-07-01&quot;;</div><div class="line">var regex = /^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)/;</div><div class="line">console.log( string.match(regex) );</div><div class="line">// =&gt; [&quot;2017-07-01&quot;, &quot;2017&quot;, &quot;07&quot;, &quot;01&quot;, index: 0, input: &quot;2017-07-01&quot;]</div><div class="line">var result = string.split(&quot;-&quot;); // ä¼˜å…ˆç”¨æ³•</div><div class="line">console.log( result );</div><div class="line">// =&gt; [&quot;2017&quot;, &quot;07&quot;, &quot;01&quot;]</div></pre></td></tr></table></figure>
<p> æ¯”å¦‚ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰é—®å·:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var string = &quot;?id=xx&amp;act=search&quot;;</div><div class="line">console.log( string.search(/\?/) );// =&gt; 0</div><div class="line">console.log( string.indexOf(&quot;?&quot;) );// =&gt; 0  ä¼˜å…ˆç”¨æ³•</div></pre></td></tr></table></figure>
<p> æ¯”å¦‚è·å–å­ä¸²:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var string = &quot;JavaScript&quot;;</div><div class="line">console.log( string.match(/.&#123;4&#125;(.+)/)[1] );// =&gt; Script</div><div class="line">console.log( string.substring(4) );// =&gt; Script</div></pre></td></tr></table></figure>
<p><strong>3. æ˜¯å¦æœ‰å¿…è¦æ„å»ºä¸€ä¸ªå¤æ‚çš„æ­£åˆ™ï¼š</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/(?!^[0-9]&#123;6,12&#125;$)(?!^[a-z]&#123;6,12&#125;$)(?!^[A-Z]&#123;6,12&#125;$)^[0-9A-Za-z]&#123;6,12&#125;$/</div></pre></td></tr></table></figure>
<p>ä¸Šè¾¹æ­£åˆ™å¯ä»¥ä½¿ç”¨å¤šä¸ªå°æ­£åˆ™æ¥åšï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var regex1 = /^[0-9A-Za-z]&#123;6,12&#125;$/;</div><div class="line">var regex2 = /^[0-9]&#123;6,12&#125;$/;</div><div class="line">var regex3 = /^[A-Z]&#123;6,12&#125;$/;</div><div class="line">var regex4 = /^[a-z]&#123;6,12&#125;$/;</div><div class="line">function checkPassword(string) &#123;</div><div class="line">	if (!regex1.test(string)) return false;</div><div class="line">	if (regex2.test(string)) return false;</div><div class="line">	if (regex3.test(string)) return false;</div><div class="line">	if (regex4.test(string)) return false;</div><div class="line">	return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å‡†ç¡®æ€§"><a href="#å‡†ç¡®æ€§" class="headerlink" title="å‡†ç¡®æ€§"></a>å‡†ç¡®æ€§</h3><p>æ‰€è°“å‡†ç¡®æ€§ï¼Œå°±æ˜¯èƒ½åŒ¹é…é¢„æœŸçš„ç›®æ ‡ï¼Œå¹¶ä¸”ä¸åŒ¹é…éé¢„æœŸçš„ç›®æ ‡ã€‚</p>
<p>è¿™é‡Œæåˆ°äº†â€œé¢„æœŸâ€äºŒå­—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦çŸ¥é“ç›®æ ‡çš„ç»„æˆè§„åˆ™ã€‚</p>
<h3 id="æ•ˆç‡"><a href="#æ•ˆç‡" class="headerlink" title="æ•ˆç‡"></a>æ•ˆç‡</h3><p>ä¿è¯äº†å‡†ç¡®æ€§åï¼Œæ‰éœ€è¦æ˜¯å¦è¦è€ƒè™‘è¦ä¼˜åŒ–ã€‚å¤§å¤šæ•°æƒ…å½¢æ˜¯ä¸éœ€è¦ä¼˜åŒ–çš„ï¼Œé™¤éè¿è¡Œçš„éå¸¸æ…¢ã€‚ä»€ä¹ˆæƒ…å½¢æ­£åˆ™è¡¨è¾¾å¼è¿è¡Œæ‰æ…¢å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦è€ƒå¯Ÿæ­£åˆ™è¡¨è¾¾å¼çš„è¿è¡Œè¿‡ç¨‹ï¼ˆåŸç†ï¼‰ã€‚</p>
<p>æ­£åˆ™è¡¨è¾¾å¼çš„è¿è¡Œåˆ†ä¸ºå¦‚ä¸‹çš„é˜¶æ®µï¼š</p>
<ol>
<li>ç¼–è¯‘</li>
<li>è®¾å®šèµ·å§‹ä½ç½®</li>
<li>å°è¯•åŒ¹é…</li>
<li>åŒ¹é…å¤±è´¥çš„è¯ï¼Œä»ä¸‹ä¸€ä½å¼€å§‹ç»§ç»­ç¬¬3æ­¥</li>
<li>æœ€ç»ˆç»“æœï¼šåŒ¹é…æˆåŠŸæˆ–å¤±è´¥</li>
</ol>
<p><strong>1. ä½¿ç”¨å…·ä½“å‹å­—ç¬¦ç»„æ¥ä»£æ›¿é€šé…ç¬¦ï¼Œæ¥æ¶ˆé™¤å›æº¯</strong></p>
<p>ä¾‹å¦‚ï¼ŒåŒ¹é…åŒå¼•ç”¨å·ä¹‹é—´çš„å­—ç¬¦ã€‚å¦‚ï¼ŒåŒ¹é…å­—ç¬¦ä¸²<code>123&quot;abc&quot;456</code>ä¸­çš„<code>&quot;abc&quot;</code>ã€‚</p>
<p>å¦‚æœæ­£åˆ™ç”¨çš„æ˜¯ï¼š<code>/&quot;.*&quot;/</code>ï¼Œï¼Œä¼šåœ¨ç¬¬3é˜¶æ®µäº§ç”Ÿ4æ¬¡å›æº¯</p>
<p>å¦‚æœæ­£åˆ™ç”¨çš„æ˜¯ï¼š<code>/&quot;.*?&quot;/</code>ï¼Œä¼šäº§ç”Ÿ2æ¬¡å›æº¯</p>
<p>å› ä¸ºå›æº¯çš„å­˜åœ¨ï¼Œéœ€è¦å¼•æ“ä¿å­˜å¤šç§å¯èƒ½ä¸­æœªå°è¯•è¿‡çš„çŠ¶æ€ï¼Œä»¥ä¾¿åç»­å›æº¯æ—¶ä½¿ç”¨ã€‚æ³¨å®šè¦å ç”¨ä¸€å®šçš„å†…å­˜ã€‚</p>
<p>æ­¤æ—¶è¦ä½¿ç”¨å…·ä½“åŒ–çš„å­—ç¬¦ç»„ï¼Œæ¥ä»£æ›¿é€šé…ç¬¦<code>.</code>ï¼Œä»¥ä¾¿æ¶ˆé™¤ä¸å¿…è¦çš„å­—ç¬¦ï¼Œæ­¤æ—¶ä½¿ç”¨æ­£åˆ™<code>/&quot;[^&quot;]*&quot;/</code>ï¼Œå³å¯ã€‚</p>
<p><strong>2. ä½¿ç”¨éæ•è·å‹åˆ†ç»„</strong></p>
<p>å› ä¸ºæ‹¬å·çš„ä½œç”¨ä¹‹ä¸€æ˜¯ï¼Œå¯ä»¥æ•è·åˆ†ç»„å’Œåˆ†æ”¯é‡Œçš„æ•°æ®ã€‚é‚£ä¹ˆå°±éœ€è¦å†…å­˜æ¥ä¿å­˜å®ƒä»¬ã€‚</p>
<p>å½“æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨åˆ†ç»„å¼•ç”¨å’Œåå‘å¼•ç”¨æ—¶ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨éæ•è·åˆ†ç»„ã€‚ä¾‹å¦‚ï¼š</p>
<p><code>/^[+-]?(\d+\.\d+|\d+|\.\d+)$/</code></p>
<p>å¯ä»¥ä¿®æ”¹æˆï¼š</p>
<p><code>/^[+-]?(?:\d+\.\d+|\d+|\.\d+)$/</code></p>
<p><strong>3. ç‹¬ç«‹å‡ºç¡®å®šå­—ç¬¦</strong></p>
<p>ä¾‹å¦‚<code>/a+/</code>ï¼Œå¯ä»¥ä¿®æ”¹æˆ<code>/aa*/</code>ã€‚</p>
<p><strong>4. æå–åˆ†æ”¯å…¬å…±éƒ¨åˆ†</strong></p>
<p>æ¯”å¦‚/<code>^abc|^def/</code>ï¼Œä¿®æ”¹æˆ<code>/^(?:abc|def)/</code>ã€‚</p>
<p>åˆæ¯”å¦‚<code>/this|that/</code>ï¼Œä¿®æ”¹æˆ<code>/th(?:is|at)/</code>ã€‚</p>
<p><strong>5. å‡å°‘åˆ†æ”¯çš„æ•°é‡ï¼Œç¼©å°å®ƒä»¬çš„èŒƒå›´</strong></p>
<p><code>/red|read/</code>ï¼Œå¯ä»¥ä¿®æ”¹æˆ<code>/rea?d/</code>ã€‚æ­¤æ—¶åˆ†æ”¯å’Œé‡è¯äº§ç”Ÿçš„å›æº¯çš„æˆæœ¬æ˜¯ä¸ä¸€æ ·çš„ã€‚ä½†è¿™æ ·ä¼˜åŒ–åï¼Œå¯è¯»æ€§ä¼šé™ä½çš„ã€‚</p>
<h2 id="æ­£åˆ™è¡¨è¾¾å¼ç¼–ç¨‹"><a href="#æ­£åˆ™è¡¨è¾¾å¼ç¼–ç¨‹" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼ç¼–ç¨‹"></a>æ­£åˆ™è¡¨è¾¾å¼ç¼–ç¨‹</h2><blockquote>
<p>ä»€ä¹ˆå«çŸ¥è¯†ï¼Œèƒ½æŒ‡å¯¼æˆ‘ä»¬å®è·µçš„ä¸œè¥¿æ‰å«çŸ¥è¯†ã€‚</p>
<p>çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚</p>
</blockquote>
<h3 id="æ­£åˆ™è¡¨è¾¾å¼çš„å››ç§æ“ä½œ"><a href="#æ­£åˆ™è¡¨è¾¾å¼çš„å››ç§æ“ä½œ" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼çš„å››ç§æ“ä½œ"></a>æ­£åˆ™è¡¨è¾¾å¼çš„å››ç§æ“ä½œ</h3><blockquote>
<p>éªŒè¯ã€åˆ‡åˆ†ã€æå–ã€æ›¿æ¢ã€‚</p>
</blockquote>
<p><strong>1. éªŒè¯</strong> </p>
<p>æ‰€è°“åŒ¹é…ï¼Œå°±æ˜¯çœ‹ç›®æ ‡å­—ç¬¦ä¸²é‡Œæ˜¯å¦æœ‰æ»¡è¶³åŒ¹é…çš„å­ä¸²ã€‚å› æ­¤ï¼Œâ€œåŒ¹é…â€çš„æœ¬è´¨å°±æ˜¯â€œæŸ¥æ‰¾â€ã€‚</p>
<p>æœ‰æ²¡æœ‰åŒ¹é…ï¼Œæ˜¯ä¸æ˜¯åŒ¹é…ä¸Šï¼Œåˆ¤æ–­æ˜¯å¦çš„æ“ä½œï¼Œå³ç§°ä¸ºâ€œéªŒè¯â€ã€‚</p>
<p>æ¯”å¦‚ï¼Œåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰æ•°å­—ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var regex= /\d/;</div><div class="line">var string = &quot;abc123&quot;;</div><div class="line">console.log( !!~string.search(regex) );// =&gt; true</div><div class="line">// (~ æ˜¯æŒ‰ä½éè¿ç®—ç¬¦ï¼Œç®€å•ç†è§£å°±æ˜¯ï¼Œæ”¹å˜è¿ç®—æ•°çš„ç¬¦å·å¹¶å‡å»1(å¥½å¤„æ˜¯ï¼Œå®ƒå¯ä»¥æŠŠNaNè½¬åŒ–ä¸º-1,å°†-1è½¬åŒ–ä¸º0)ã€‚</div><div class="line">console.log( regex.test(string) );// =&gt; true</div><div class="line">console.log( !!string.match(regex) );// =&gt; true</div><div class="line">console.log( !!regex.exec(string) );// =&gt; true</div></pre></td></tr></table></figure>
<p><strong>2. åˆ‡åˆ†</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var regex = /,/;</div><div class="line">var string = &quot;html,css,javascript&quot;;</div><div class="line">console.log( string.split(regex) );</div><div class="line">// =&gt; [&quot;html&quot;, &quot;css&quot;, &quot;javascript&quot;]</div></pre></td></tr></table></figure>
<p><strong>3. æå–</strong> </p>
<p>è™½ç„¶æ•´ä½“åŒ¹é…ä¸Šäº†ï¼Œä½†æœ‰æ—¶éœ€è¦æå–éƒ¨åˆ†åŒ¹é…çš„æ•°æ®ã€‚</p>
<p>æ­¤æ—¶æ­£åˆ™é€šå¸¸è¦ä½¿ç”¨åˆ†ç»„å¼•ç”¨ï¼ˆåˆ†ç»„æ•è·ï¼‰åŠŸèƒ½ï¼Œè¿˜éœ€è¦é…åˆä½¿ç”¨ç›¸å…³APIã€‚</p>
<p>è¿™é‡Œï¼Œè¿˜æ˜¯ä»¥æ—¥æœŸä¸ºä¾‹ï¼Œæå–å‡ºå¹´æœˆæ—¥ã€‚æ³¨æ„ä¸‹é¢æ­£åˆ™ä¸­çš„æ‹¬å·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">var regex = /^(\d&#123;4&#125;)\D(\d&#123;2&#125;)\D(\d&#123;2&#125;)$/;</div><div class="line">var string = &quot;2017-06-26&quot;;</div><div class="line"></div><div class="line">console.log( string.match(regex) );</div><div class="line">// =&gt;[&quot;2017-06-26&quot;, &quot;2017&quot;, &quot;06&quot;, &quot;26&quot;, index: 0, input: &quot;2017-06-26&quot;]</div><div class="line"></div><div class="line">console.log( regex.exec(string) );</div><div class="line">// =&gt;[&quot;2017-06-26&quot;, &quot;2017&quot;, &quot;06&quot;, &quot;26&quot;, index: 0, input: &quot;2017-06-26&quot;]</div><div class="line"></div><div class="line">regex.test(string);</div><div class="line">console.log( RegExp.$1, RegExp.$2, RegExp.$3 );</div><div class="line">// =&gt; &quot;2017&quot; &quot;06&quot; &quot;26&quot;</div><div class="line"></div><div class="line">string.search(regex);</div><div class="line">console.log( RegExp.$1, RegExp.$2, RegExp.$3 );</div><div class="line">// =&gt; &quot;2017&quot; &quot;06&quot; &quot;26&quot;</div><div class="line"></div><div class="line">var date = [];</div><div class="line">string.replace(regex, function(match, year, month, day) &#123;</div><div class="line">	date.push(year, month, day);</div><div class="line">&#125;);</div><div class="line">console.log(date);</div><div class="line">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;26&quot;]</div></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯<code>match</code>ã€‚</p>
<p><strong>4. æ›¿æ¢</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var string = &quot;2017-06-26&quot;;</div><div class="line">var today = new Date( string.replace(/-/g, &quot;/&quot;) );</div><div class="line">console.log( today );</div><div class="line">// =&gt; Mon Jun 26 2017 00:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)</div></pre></td></tr></table></figure>
<h3 id="ç›¸å…³APIæ³¨æ„è¦ç‚¹"><a href="#ç›¸å…³APIæ³¨æ„è¦ç‚¹" class="headerlink" title="ç›¸å…³APIæ³¨æ„è¦ç‚¹"></a>ç›¸å…³APIæ³¨æ„è¦ç‚¹</h3><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºç”¨äºæ­£åˆ™æ“ä½œçš„æ–¹æ³•ï¼Œå…±æœ‰6ä¸ªï¼Œå­—ç¬¦ä¸²å®ä¾‹4ä¸ªï¼Œæ­£åˆ™å®ä¾‹2ä¸ªï¼š</p>
<blockquote>
<p>String#search</p>
<p>String#split</p>
<p>String#match</p>
<p>String#replace</p>
<p>RegExp#test</p>
<p>RegExp#exec</p>
</blockquote>
<p>æ–¹æ³•ä½¿ç”¨ç»†èŠ‚ï¼Œå¯å‚è€ƒã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹çš„ç¬¬ä¸‰éƒ¨åˆ†</p>
<p><strong>1. searchå’Œmatchçš„å‚æ•°é—®é¢˜</strong></p>
<p>æˆ‘ä»¬çŸ¥é“å­—ç¬¦ä¸²å®ä¾‹çš„é‚£4ä¸ªæ–¹æ³•å‚æ•°éƒ½æ”¯æŒæ­£åˆ™å’Œå­—ç¬¦ä¸²ã€‚</p>
<p>ä½†<code>search</code>å’Œ<code>match</code>ï¼Œä¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ­£åˆ™çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">var string = &quot;2017.06.27&quot;;</div><div class="line"></div><div class="line">console.log( string.search(&quot;.&quot;) );</div><div class="line">// =&gt; 0</div><div class="line">//éœ€è¦ä¿®æ”¹æˆä¸‹åˆ—å½¢å¼ä¹‹ä¸€</div><div class="line">console.log( string.search(&quot;\\.&quot;) );</div><div class="line">console.log( string.search(/\./) );</div><div class="line">// =&gt; 4</div><div class="line">// =&gt; 4</div><div class="line"></div><div class="line">console.log( string.match(&quot;.&quot;) );</div><div class="line">// =&gt; [&quot;2&quot;, index: 0, input: &quot;2017.06.27&quot;]</div><div class="line">//éœ€è¦ä¿®æ”¹æˆä¸‹åˆ—å½¢å¼ä¹‹ä¸€</div><div class="line">console.log( string.match(&quot;\\.&quot;) );</div><div class="line">console.log( string.match(/\./) );</div><div class="line">// =&gt; [&quot;.&quot;, index: 4, input: &quot;2017.06.27&quot;]</div><div class="line">// =&gt; [&quot;.&quot;, index: 4, input: &quot;2017.06.27&quot;]</div><div class="line"></div><div class="line">console.log( string.split(&quot;.&quot;) );</div><div class="line">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;27&quot;]</div><div class="line"></div><div class="line">console.log( string.replace(&quot;.&quot;, &quot;/&quot;) );</div><div class="line">// =&gt; &quot;2017/06.27&quot;</div></pre></td></tr></table></figure>
<p><strong>2. matchè¿”å›ç»“æœçš„æ ¼å¼é—®é¢˜</strong></p>
<p><code>match</code>è¿”å›ç»“æœçš„æ ¼å¼ï¼Œä¸æ­£åˆ™å¯¹è±¡æ˜¯å¦æœ‰ä¿®é¥°ç¬¦<code>g</code>æœ‰å…³ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var string = &quot;2017.06.27&quot;;</div><div class="line">var regex1 = /\b(\d+)\b/;</div><div class="line">var regex2 = /\b(\d+)\b/g;</div><div class="line">console.log( string.match(regex1) );</div><div class="line">console.log( string.match(regex2) );</div><div class="line">// =&gt; [&quot;2017&quot;, &quot;2017&quot;, index: 0, input: &quot;2017.06.27&quot;]</div><div class="line">// =&gt; [&quot;2017&quot;, &quot;06&quot;, &quot;27&quot;]</div></pre></td></tr></table></figure>
<p>æ²¡æœ‰<code>g</code>ï¼Œè¿”å›çš„æ˜¯æ ‡å‡†åŒ¹é…æ ¼å¼ï¼Œå³ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ•´ä½“åŒ¹é…çš„å†…å®¹ï¼Œæ¥ä¸‹æ¥æ˜¯åˆ†ç»„æ•è·çš„å†…å®¹ï¼Œç„¶åæ˜¯æ•´ä½“åŒ¹é…çš„ç¬¬ä¸€ä¸ªä¸‹æ ‡ï¼Œæœ€åæ˜¯è¾“å…¥çš„ç›®æ ‡å­—ç¬¦ä¸²ã€‚</p>
<p>æœ‰<code>g</code>ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰åŒ¹é…çš„å†…å®¹ã€‚</p>
<p>å½“æ²¡æœ‰åŒ¹é…æ—¶ï¼Œä¸ç®¡æœ‰æ— <code>g</code>ï¼Œéƒ½è¿”å›<code>null</code>ã€‚</p>
<p><strong>3.  execæ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var string = &quot;2018.01.15&quot;;</div><div class="line">var regex2 = /\b(\d+)\b/g;</div><div class="line">console.log( regex2.exec(string) ); // =&gt; [&quot;2018&quot;, &quot;2018&quot;, index: 0, input: &quot;2018.01.15&quot;]</div><div class="line">console.log( regex2.lastIndex); // =&gt; 4</div><div class="line">console.log( regex2.exec(string) ); // =&gt; [&quot;01&quot;, &quot;01&quot;, index: 5, input: &quot;2018.01.15&quot;]</div><div class="line">console.log( regex2.lastIndex); // =&gt; 7</div><div class="line">console.log( regex2.exec(string) ); // =&gt; [&quot;15&quot;, &quot;15&quot;, index: 8, input: &quot;2018.01.15&quot;]</div><div class="line">console.log( regex2.lastIndex); // =&gt; 10</div><div class="line">console.log( regex2.exec(string) ); // =&gt; null</div><div class="line">console.log( regex2.lastIndex); // =&gt; 0</div></pre></td></tr></table></figure>
<p>å…¶ä¸­æ­£åˆ™å®ä¾‹<code>lastIndex</code>å±æ€§ï¼Œè¡¨ç¤ºä¸‹ä¸€æ¬¡åŒ¹é…å¼€å§‹çš„ä½ç½®ã€‚</p>
<p>æ¯”å¦‚ç¬¬ä¸€æ¬¡åŒ¹é…äº†<code>â€œ2018â€</code>ï¼Œå¼€å§‹ä¸‹æ ‡æ˜¯0ï¼Œå…±4ä¸ªå­—ç¬¦ï¼Œå› æ­¤è¿™æ¬¡åŒ¹é…ç»“æŸçš„ä½ç½®æ˜¯3ï¼Œä¸‹ä¸€æ¬¡å¼€å§‹åŒ¹é…çš„ä½ç½®æ˜¯4ã€‚</p>
<p>ä»ä¸Šè¿°ä»£ç çœ‹å‡ºï¼Œåœ¨ä½¿ç”¨<code>exec</code>æ—¶ï¼Œç»å¸¸éœ€è¦é…åˆä½¿ç”¨<code>while</code>å¾ªç¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var string = &quot;2018.01.15&quot;;</div><div class="line">var regex2 = /\b(\d+)\b/g;</div><div class="line">var result;</div><div class="line">while ( result = regex2.exec(string) ) &#123;</div><div class="line">	console.log( result, regex2.lastIndex );</div><div class="line">&#125;</div><div class="line">// =&gt; [&quot;2018&quot;, &quot;2018&quot;, index: 0, input: &quot;2018.01.15&quot;] 4</div><div class="line">// =&gt; [&quot;01&quot;, &quot;01&quot;, index: 5, input: &quot;2018.01.15&quot;] 7</div><div class="line">// =&gt; [&quot;15&quot;, &quot;15&quot;, index: 8, input: &quot;2018.01.15&quot;] 10</div></pre></td></tr></table></figure>
<p><strong>4. ä¿®é¥°ç¬¦gï¼Œå¯¹exexå’Œtestçš„å½±å“</strong></p>
<p>ä¸Šé¢æåˆ°äº†æ­£åˆ™å®ä¾‹çš„<code>lastIndex</code>å±æ€§ï¼Œè¡¨ç¤ºå°è¯•åŒ¹é…æ—¶ï¼Œä»å­—ç¬¦ä¸²çš„<code>lastIndex</code>ä½å¼€å§‹å»åŒ¹é…ã€‚</p>
<p>å­—ç¬¦ä¸²çš„å››ä¸ªæ–¹æ³•ï¼Œæ¯æ¬¡åŒ¹é…æ—¶ï¼Œéƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œå³<code>lastIndex</code>å±æ€§å§‹ç»ˆä¸å˜ã€‚</p>
<p>è€Œæ­£åˆ™å®ä¾‹çš„ä¸¤ä¸ªæ–¹æ³•<code>exec</code>ã€<code>test</code>ï¼Œå½“æ­£åˆ™æ˜¯å…¨å±€åŒ¹é…æ—¶ï¼Œæ¯ä¸€æ¬¡åŒ¹é…å®Œæˆåï¼Œéƒ½ä¼šä¿®æ”¹<code>lastIndex</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var regex = /a/g;</div><div class="line">console.log( regex.test(&quot;a&quot;), regex.lastIndex );</div><div class="line">console.log( regex.test(&quot;aba&quot;), regex.lastIndex );</div><div class="line">console.log( regex.test(&quot;ababc&quot;), regex.lastIndex );</div><div class="line">// =&gt; true 1</div><div class="line">// =&gt; true 3</div><div class="line">// =&gt; false 0</div></pre></td></tr></table></figure>
<p>æ³¨æ„ä¸Šé¢ä»£ç ä¸­çš„ç¬¬ä¸‰æ¬¡è°ƒç”¨<code>test</code>ï¼Œå› ä¸ºè¿™ä¸€æ¬¡å°è¯•åŒ¹é…ï¼Œå¼€å§‹ä»ä¸‹æ ‡<code>lastIndex</code>å³3ä½ç½®å¤„å¼€å§‹æŸ¥æ‰¾ï¼Œè‡ªç„¶å°±æ‰¾ä¸åˆ°äº†ã€‚</p>
<p>å¦‚æœæ²¡æœ‰<code>g</code>ï¼Œè‡ªç„¶éƒ½æ˜¯ä»å­—ç¬¦ä¸²ç¬¬0ä¸ªå­—ç¬¦å¤„å¼€å§‹å°è¯•åŒ¹é…ã€‚</p>
<p><strong>5. splitæ–¹æ³•</strong></p>
<ol>
<li><p>å®ƒå¯ä»¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºç»“æœæ•°ç»„çš„æœ€å¤§é•¿åº¦ã€‚</p>
</li>
<li><p>æ­£åˆ™ä½¿ç”¨åˆ†ç»„æ—¶ï¼Œç»“æœæ•°ç»„ä¸­æ˜¯åŒ…å«åˆ†éš”ç¬¦çš„ã€‚</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var string = &quot;good,nice,well&quot;;</div><div class="line">console.log( string.split(/,/, 2) ); // =&gt;[&quot;good&quot;, &quot;nice&quot;]</div><div class="line">console.log( string.split(/(,)/) ); // =&gt;[&quot;good&quot;, &quot;,&quot;, &quot;nice&quot;, &quot;,&quot;, &quot;well&quot;]</div></pre></td></tr></table></figure>
<p><strong>6. replaceæ–¹æ³•</strong></p>
<p><code>replace</code>æœ‰ä¸¤ç§ä½¿ç”¨å½¢å¼ï¼Œè¿™æ˜¯å› ä¸ºå®ƒçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ã€‚</p>
<p>å½“ç¬¬äºŒä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚ä¸‹çš„å­—ç¬¦æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$1,$2,...,$99 åŒ¹é…ç¬¬1~99ä¸ªåˆ†ç»„é‡Œæ•è·çš„æ–‡æœ¬   </div><div class="line">$&amp; åŒ¹é…åˆ°çš„å­ä¸²æ–‡æœ¬</div><div class="line">$` åŒ¹é…åˆ°çš„å­ä¸²çš„å·¦è¾¹æ–‡æœ¬ </div><div class="line">$&apos; åŒ¹é…åˆ°çš„å­ä¸²çš„å³è¾¹æ–‡æœ¬</div><div class="line">$$ ç¾å…ƒç¬¦å·</div></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼ŒæŠŠ<code>&quot;2,3,5&quot;</code>ï¼Œå˜æˆ<code>&quot;5=2+3&quot;</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var result = &quot;2,3,5&quot;.replace(/(\d+),(\d+),(\d+)/, &quot;$3=$1+$2&quot;);</div><div class="line">console.log(result);</div><div class="line">// =&gt; &quot;5=2+3&quot;</div></pre></td></tr></table></figure>
<p>åˆä¾‹å¦‚ï¼ŒæŠŠ<code>&quot;2,3,5&quot;</code>ï¼Œå˜æˆ<code>&quot;222,333,555&quot;</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var result = &quot;2,3,5&quot;.replace(/(\d+)/g, &quot;$&amp;$&amp;$&amp;&quot;);</div><div class="line">console.log(result);</div><div class="line">// =&gt; &quot;222,333,555&quot;</div></pre></td></tr></table></figure>
<p>å†ä¾‹å¦‚ï¼ŒæŠŠ<code>&quot;2+3=5&quot;</code>ï¼Œå˜æˆ<code>&quot;2+3=2+3=5=5&quot;</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var result = &quot;2+3=5&quot;.replace(/=/, &quot;$&amp;$`$&amp;$&apos;$&amp;&quot;);</div><div class="line">console.log(result);</div><div class="line">// =&gt; &quot;2+3=2+3=5=5&quot;</div></pre></td></tr></table></figure>
<p>å½“ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„è¯¥å›è°ƒå‡½æ•°çš„å‚æ•°å…·ä½“æ˜¯ä»€ä¹ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&quot;1234 2345 3456&quot;.replace(/(\d)\d&#123;2&#125;(\d)/g, function(match, $1, $2, index, input) &#123;</div><div class="line">	console.log([match, $1, $2, index, input]);</div><div class="line">&#125;);</div><div class="line">// =&gt; [&quot;1234&quot;, &quot;1&quot;, &quot;4&quot;, 0, &quot;1234 2345 3456&quot;]</div><div class="line">// =&gt; [&quot;2345&quot;, &quot;2&quot;, &quot;5&quot;, 5, &quot;1234 2345 3456&quot;]</div><div class="line">// =&gt; [&quot;3456&quot;, &quot;3&quot;, &quot;6&quot;, 10, &quot;1234 2345 3456&quot;]</div></pre></td></tr></table></figure>
<p><strong>7. ä½¿ç”¨æ„é€ å‡½æ•°éœ€è¦æ³¨æ„çš„é—®é¢˜</strong></p>
<p>ä¸€èˆ¬ä¸æ¨èä½¿ç”¨æ„é€ å‡½æ•°ç”Ÿæˆæ­£åˆ™ï¼Œè€Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨å­—é¢é‡ã€‚å› ä¸ºç”¨æ„é€ å‡½æ•°ä¼šå¤šå†™å¾ˆå¤š<code>\</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var string = &quot;2017-06-27 2017.06.27 2017/06/27&quot;;</div><div class="line">var regex = /\d&#123;4&#125;(-|\.|\/)\d&#123;2&#125;\1\d&#123;2&#125;/g;</div><div class="line">console.log( string.match(regex) );</div><div class="line">// =&gt; [&quot;2017-06-27&quot;, &quot;2017.06.27&quot;, &quot;2017/06/27&quot;]</div><div class="line"></div><div class="line">regex = new RegExp(&quot;\\d&#123;4&#125;(-|\\.|\\/)\\d&#123;2&#125;\\1\\d&#123;2&#125;&quot;, &quot;g&quot;);</div><div class="line">console.log( string.match(regex) );</div><div class="line">// =&gt; [&quot;2017-06-27&quot;, &quot;2017.06.27&quot;, &quot;2017/06/27&quot;]</div></pre></td></tr></table></figure>
<p><strong>8. ä¿®é¥°ç¬¦</strong></p>
<p>ES5ä¸­ä¿®é¥°ç¬¦ï¼Œå…±3ä¸ªï¼š</p>
<blockquote>
<p><code>g</code> å…¨å±€åŒ¹é…ï¼Œå³æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„ï¼Œå•è¯æ˜¯global</p>
<p><code>i</code> å¿½ç•¥å­—æ¯å¤§å°å†™ï¼Œå•è¯ingoreCase</p>
<p><code>m</code> å¤šè¡ŒåŒ¹é…ï¼Œåªå½±å“<code>^</code>å’Œ<code>$</code>ï¼ŒäºŒè€…å˜æˆè¡Œçš„æ¦‚å¿µï¼Œå³è¡Œå¼€å¤´å’Œè¡Œç»“å°¾ã€‚å•è¯æ˜¯multiline</p>
</blockquote>
<p>å½“ç„¶æ­£åˆ™å¯¹è±¡ä¹Ÿæœ‰ç›¸åº”çš„åªè¯»å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var regex = /\w/img;</div><div class="line">console.log( regex.global );</div><div class="line">console.log( regex.ignoreCase );</div><div class="line">console.log( regex.multiline );</div><div class="line">// =&gt; true</div><div class="line">// =&gt; true</div><div class="line">// =&gt; true</div></pre></td></tr></table></figure>
<p><strong>9. sourceå±æ€§</strong></p>
<p>æ­£åˆ™å®ä¾‹å¯¹è±¡å±æ€§ï¼Œé™¤äº†<code>global</code>ã€<code>ingnoreCase</code>ã€<code>multiline</code>ã€<code>lastIndex</code>å±æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>source</code>å±æ€§ã€‚å¯ä»¥é€šè¿‡æŸ¥çœ‹è¯¥å±æ€§ï¼Œæ¥ç¡®è®¤æ„å»ºå‡ºçš„æ­£åˆ™åˆ°åº•æ˜¯ä»€ä¹ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var className = &quot;high&quot;;</div><div class="line">var regex = new RegExp(&quot;(^|\\s)&quot; + className + &quot;(\\s|$)&quot;);</div><div class="line">console.log( regex.source )</div><div class="line">// =&gt; (^|\s)high(\s|$) å³å­—ç¬¦ä¸²&quot;(^|\\s)high(\\s|$)&quot;</div></pre></td></tr></table></figure>
<p><strong>10. æ„é€ å‡½æ•°å±æ€§</strong></p>
<p>æ„é€ å‡½æ•°çš„é™æ€å±æ€§åŸºäºæ‰€æ‰§è¡Œçš„æœ€è¿‘ä¸€æ¬¡æ­£åˆ™æ“ä½œè€Œå˜åŒ–ã€‚é™¤äº†æ˜¯<code>$1,...,$9</code>ä¹‹å¤–ï¼Œè¿˜æœ‰å‡ ä¸ªä¸å¤ªå¸¸ç”¨çš„å±æ€§ï¼ˆæœ‰å…¼å®¹æ€§é—®é¢˜ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">RegExp.input æœ€è¿‘ä¸€æ¬¡ç›®æ ‡å­—ç¬¦ä¸²ï¼Œç®€å†™æˆRegExp[&quot;$_&quot;]</div><div class="line">RegExp.lastMatch æœ€è¿‘ä¸€æ¬¡åŒ¹é…çš„æ–‡æœ¬ï¼Œç®€å†™æˆRegExp[&quot;$&amp;&quot;]</div><div class="line">RegExp.lastParen æœ€è¿‘ä¸€æ¬¡æ•è·çš„æ–‡æœ¬ï¼Œç®€å†™æˆRegExp[&quot;$+&quot;]</div><div class="line">RegExp.leftContext ç›®æ ‡å­—ç¬¦ä¸²ä¸­`lastMatch`ä¹‹å‰çš„æ–‡æœ¬ï¼Œç®€å†™æˆRegExp[&quot;$`&quot;]</div><div class="line">RegExp.rightContextç›®æ ‡å­—ç¬¦ä¸²ä¸­`lastMatch`ä¹‹åçš„æ–‡æœ¬ï¼Œç®€å†™æˆRegExp[&quot;$&apos;&quot;]</div></pre></td></tr></table></figure>
<p><strong>æ€»ç»“è‡ªï¼šè€å§šçš„ã€Šæ­£åˆ™è¡¨è¾¾å¼è¿·ä½ ä¹¦ã€‹ã€‚</strong></p>
<p>æ¨èé€šè¯»ï¼š<a href="https://juejin.im/post/5965943ff265da6c30653879" target="_blank" rel="external">JSæ­£åˆ™è¡¨è¾¾å¼å®Œæ•´æ•™ç¨‹</a></p>
<p>ä½œè€…æ¨èé˜…è¯»ï¼š ã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹ã€ã€Šç²¾é€šæ­£åˆ™è¡¨è¾¾å¼ã€‹ã€ã€Šæ­£åˆ™è¡¨è¾¾å¼å¿…çŸ¥å¿…ä¼šã€‹ã€ã€Šæ­£åˆ™æŒ‡å¼•ã€‹ã€ã€Šæ­£åˆ™è¡¨è¾¾å¼å…¥é—¨ã€‹ã€ã€Šæ­£åˆ™è¡¨è¾¾å¼ç»å…¸å®ä¾‹ã€‹ã€ã€ŠJavaScript Regular Expressionsã€‹ã€ã€Šé«˜æ€§èƒ½JavaScript ã€‹ã€ã€ŠJavaScriptå¿è€…ç§˜ç±ã€‹ã€ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸»è¦è®²è§£JavaScriptè¯­è¨€ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ç”¨æ³•åŠåŒ¹é…åŸç†ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="liuhaifeng" scheme="http://xgfe.github.io/categories/liuhaifeng/"/>
    
    
      <category term="æ­£åˆ™è¡¨è¾¾å¼" scheme="http://xgfe.github.io/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
      <category term="Regular Expression" scheme="http://xgfe.github.io/tags/Regular-Expression/"/>
    
  </entry>
  
  <entry>
    <title>ç§»åŠ¨ç«¯åŸºäºvue-routerçš„æ»šåŠ¨ä½ç½®è®°å½•(keep-alive)</title>
    <link href="http://xgfe.github.io/2018/01/19/lulutia/keep-alive/"/>
    <id>http://xgfe.github.io/2018/01/19/lulutia/keep-alive/</id>
    <published>2018-01-19T02:57:00.000Z</published>
    <updated>2018-01-19T03:40:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦å¯¹äºå¦‚ä½•åœ¨åŸºäºvueçš„ç§»åŠ¨ç«¯å®ç°æ»šåŠ¨ä½ç½®è®°å½•è¿›è¡Œäº†æ¢è®¨ã€‚</p>
<a id="more"></a>
<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çš„ä¼šé‡è§ä¸æ»šåŠ¨ä½ç½®è®°å½•ç›¸å…³çš„éœ€æ±‚ã€‚å¤šè§äºä»åˆ—è¡¨é¡µè¿›å…¥è¯¦æƒ…é¡µï¼Œç„¶åè¿›è¡Œå›é€€ã€‚å¯¹è¿™ç§æƒ…å†µæç‚¼å‡ºä¸€å¥—è§£å†³æ–¹æ¡ˆæ˜¯ç›¸å½“æœ‰å¿…è¦çš„ã€‚</p>
<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çš„ä¼šé‡è§ä¸æ»šåŠ¨ä½ç½®è®°å½•ç›¸å…³çš„éœ€æ±‚ã€‚å¤šè§äºä»åˆ—è¡¨é¡µè¿›å…¥è¯¦æƒ…é¡µï¼Œç„¶åè¿›è¡Œå›é€€ã€‚åŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨ç§»åŠ¨å¼€å‘ä¸­ï¼Œåˆ—è¡¨å¤šæ˜¯ç”±æ— é™æ»šåŠ¨è¿›è¡ŒåŠ è½½çš„ï¼Œå› æ­¤å¦‚æœå›é€€ååˆä»å¤´è¿›è¡ŒåŠ è½½å®é™…ä¸Šç”¨æˆ·ä½“éªŒæ˜¯ç›¸å½“ä¸å¥½çš„</li>
<li>å¦‚æœåˆ—è¡¨é¡µçš„å±•ç°å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ç”šè‡³é•¿æœŸä¸å˜ï¼Œåˆ™å›é€€ååˆè¿›è¡Œçš„é‡æ–°åŠ è½½å®é™…ä¸Šæ˜¯æ€§èƒ½çš„æµªè´¹<br>é’ˆå¯¹ä¸Šé¢ï¼Œåœ¨å®é™…æ“ä½œæ—¶æ›´ç†æƒ³çš„æƒ…å†µæ˜¯ï¼Œå¯¹äºå®æ—¶æ€§ä¸é«˜çš„åˆ—è¡¨ï¼Œä»åˆ—è¡¨é¡µè¿›å…¥è¯¦æƒ…é¡µåˆå›é€€åï¼Œåˆ—è¡¨é¡µä¼šä¿å­˜ä¹‹å‰çš„ä½ç½®ã€‚<br>åœ¨åŸºäºvue-routerçš„é¡¹ç›®ä¸­ï¼Œä¸ºäº†å®ç°ä¸Šè¿°æ•ˆæœå¯ä»¥ä½¿ç”¨å…¶æä¾›çš„keep-aliveåŠŸèƒ½ä¸scrollBehaviorè¿›è¡Œé…åˆã€‚</li>
</ul>
<h4 id="keep-aliveä¸scrollBehavior"><a href="#keep-aliveä¸scrollBehavior" class="headerlink" title="keep-aliveä¸scrollBehavior"></a>keep-aliveä¸scrollBehavior</h4><ul>
<li>keep-alive: keep-aliveæ˜¯Vueå†…ç½®çš„ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼Œå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“DOMå…ƒç´ ä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ï¼Œå®ƒåªæ˜¯åœ¨åŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ä¼šç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚<a href="https://cn.vuejs.org/v2/api/#keep-alive" target="_blank" rel="external">æ›´å¤šä½¿ç”¨æ–¹æ³•è¯¦è§Vueå®˜æ–¹æ–‡æ¡£</a>ã€‚</li>
<li>scrollBehavior: scrollBehavioræ˜¯ç”±vue-routerä¸­Routerå®ä¾‹æä¾›çš„æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º(to, from, savedPosition)ï¼Œå…¶ä¸­toå’Œfromæ˜¯è·¯ç”±å¯¹è±¡ï¼Œè€ŒsavedPositionæ˜¯å½“ popstateå¯¼èˆª(é€šè¿‡æµè§ˆå™¨çš„ å‰è¿›/åé€€ æŒ‰é’®è§¦å‘)æ—¶è®°å½•çš„ä½ç½®ä¿¡æ¯ã€‚<ul>
<li>scrollBehaviorè¿”å›æ»šåŠ¨ä½ç½®çš„å¯¹è±¡ä¿¡æ¯ï¼Œå¦‚{ x: number, y: number}ï¼Œå¦‚æœè¿”å›çš„æ˜¯<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy" target="_blank" rel="external">falsy</a>æˆ–è€…ç©ºå¯¹è±¡åˆ™ä¸ä¼šå‘ç”Ÿæ»šåŠ¨ã€‚</li>
<li>æ³¨æ„scrollBehavioråªåœ¨HTML5 historyæ¨¡å¼ä¸‹å¯ç”¨ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å®é™…ä½¿ç”¨"><a href="#å®é™…ä½¿ç”¨" class="headerlink" title="å®é™…ä½¿ç”¨"></a>å®é™…ä½¿ç”¨</h4><ul>
<li>ä½¿ç”¨router-viewé…åˆkeep-alive: åœ¨å…¥å£æ–‡ä»¶é€šè¿‡v-ifè¿›è¡Œå¯¹ç‰¹å®šé¡µé¢çš„ç¼“å­˜ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"page-group"</span>&gt;</div><div class="line">  &lt;keep-alive&gt;</div><div class="line">    &lt;router-view class="view" v-if="$route.meta.keep_alive"&gt;&lt;/router-view&gt;</div><div class="line">  &lt;/keep-alive&gt;</div><div class="line">  &lt;router-view class="view" v-if="!$route.meta.keep_alive"&gt;&lt;/router-view&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<ul>
<li>å¯¹è·¯ç”±è¿›è¡Œé…ç½®ï¼Œå¼€å¯HTML5 historyæ¨¡å¼å¹¶é…ç½®scrollBehaviorï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</div><div class="line">		<span class="attr">mode</span>: <span class="string">'history'</span>,</div><div class="line">		<span class="attr">scrollBehavior</span>: scrollBehavior,</div><div class="line">		routes</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li><p>å¯¹è·¯ç”±è¿›è¡Œé…ç½®ï¼Œå®šåˆ¶scrollBehavioræ–¹æ³•ï¼Œåœ¨è¿™é‡Œä¼šé‡è§ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š        </p>
<ul>
<li><p>å¦‚ä½•åˆ¤æ–­é¡µé¢æ˜¯å¦éœ€è¦ä¿ç•™ä½ç½®ä¿¡æ¯: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</div><div class="line">  <span class="attr">name</span>: constants.NAME,</div><div class="line">  <span class="attr">path</span>: constants.PATH,</div><div class="line">  <span class="attr">component</span>: <span class="built_in">module</span>,</div><div class="line">  <span class="attr">meta</span>: &#123;</div><div class="line">    <span class="attr">title</span>: constants.TITLE,</div><div class="line">    <span class="attr">val_cid</span>: constants.VAL_CID,</div><div class="line">    <span class="attr">requireAuth</span>: constants.REQUIRE_AUTH,</div><div class="line">    <span class="attr">keep_alive</span>: <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line">  constants</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡åœ¨è·¯ç”±ä¸Šæ·»åŠ äº†ä¸€ä¸ªå‚æ•°keep_aliveæ¥å£°æ˜å½“å‰è·¯ç”±æ˜¯å¦è¦å¯åŠ¨keep_aliveçš„åŠŸèƒ½ã€‚</p>
</li>
<li><p>å¦‚ä½•æ ¹æ®éœ€è¦åˆ·æ–°é¡µé¢ï¼Œé‡æ–°è·å–æ•°æ®: å‡å¦‚æˆ‘ä»¬æœ‰ä¸‰ä¸ªé¡µé¢ï¼Œé€šè¿‡Aè¿›å…¥Bï¼Œé€šè¿‡Bè¿›å…¥Cã€‚é‚£ä¹ˆå…¶ä¸­é€šè¿‡Aè¿›å…¥Bæ˜¯éœ€è¦è¿›è¡Œæ•°æ®åˆ·æ–°çš„ï¼›è€Œä»Bè¿›å…¥Cï¼Œå†ä»Cè¿”å›Båˆ™ä¸éœ€è¦è¿›è¡Œæ•°æ®åˆ·æ–°ã€‚å› æ­¤é’ˆå¯¹åŒä¸€ä¸ªé¡µé¢æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç§æœºåˆ¶æ¥åˆ¤æ–­å¤šä¹…éœ€è¦æ•°æ®åˆ·æ–°ã€‚<br>åŸºæœ¬æˆ‘ä»¬å¯ä»¥æç‚¼å‡ºï¼šé€šè¿‡<strong>è·³è½¬</strong>çš„æ˜¯éœ€è¦è¿›è¡Œæ•°æ®åˆ·æ–°çš„ï¼›è€Œé€šè¿‡é»˜è®¤æµè§ˆå™¨è¡Œä¸ºçš„æ˜¯ä¸éœ€è¦è¿›è¡Œæµè§ˆå™¨åˆ·æ–°çš„ã€‚<br>çœ‹vue-routerçš„æºç ä¸­æˆ‘ä»¬ä¼šå‘ç°ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, e =&gt; &#123;</div><div class="line">	.......</div><div class="line">    	this.transitionTo(location, route =&gt; &#123;</div><div class="line">      <span class="keyword">if</span> (supportsScroll) &#123;</div><div class="line">        handleScroll(router, route, current, <span class="literal">true</span>)</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">push (location: RawLocation, onComplete?: <span class="built_in">Function</span>, onAbort?: <span class="built_in">Function</span>) &#123;</div><div class="line">  ...</div><div class="line">  this.transitionTo(location, route =&gt; &#123;</div><div class="line">    ...</div><div class="line">    handleScroll(<span class="keyword">this</span>.router, route, fromRoute, <span class="literal">false</span>)</div><div class="line">    ...</div><div class="line">  &#125;, onAbort)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç åœ¨å¤„ç†popstateæ—¶è°ƒç”¨çš„handleScrollæ–¹æ³•ä¼ å…¥çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯trueï¼Œä½†æ˜¯è‡ªå·±é‡å†™çš„pushã€replaceç­‰å‡½æ•°è°ƒç”¨handleScrollæ—¶ä¼ å…¥çš„æœ€åä¸€ä¸ªå‚æ•°éƒ½æ˜¯falseã€‚<br>è€Œåœ¨scroll.jsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°handleScrollå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°å°±æ˜¯ç”¨æ¥åŒºåˆ†æµè§ˆå™¨é»˜è®¤è¡Œä¸ºï¼Œå’Œrouter-linkçš„è¡Œä¸ºçš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">const behavior = router.options.scrollBehavior</div><div class="line">......</div><div class="line">router.app.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">   <span class="keyword">const</span> position = getScrollPosition()</div><div class="line">   <span class="keyword">const</span> shouldScroll = behavior.call(router, to, <span class="keyword">from</span>, isPop ? position : <span class="literal">null</span>)</div><div class="line">......</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ä¸€æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºæµè§ˆå™¨é»˜è®¤è¡Œä¸ºï¼Œè°ƒç”¨è‡ªå®šä¹‰çš„scrollBehaviorå‡½æ•°åä¼ å‚çš„savedPositionä¸ºä¿å­˜çš„positionï¼Œå¯¹äºè·³è½¬è¿™ç§åˆ™ä¼ å‚çš„savedPositionä¸ºnullã€‚<br><strong>é€šè¿‡ä¸Šé¢ï¼Œæˆ‘ä»¬å·²ç»èƒ½åŒºåˆ†ä»€ä¹ˆæ—¶å€™éœ€è¦è¿›è¡Œæ•°æ®åˆ·æ–°äº†</strong>ã€‚ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸¤éƒ¨åˆ†çš„ä»£ç ï¼Œä¸€éƒ¨åˆ†æ˜¯scrollBehaviorï¼Œä¿®æ”¹å®ƒæ¥æ ¹æ®ä¸åŒçš„æƒ…å†µè¿”å›ä¸åŒçš„æ»šåŠ¨å€¼ï¼›å¦å¤–ä¸€éƒ¨åˆ†æ˜¯å®é™…keep-aliveçš„é¡µé¢çš„æ¸²æŸ“é€»è¾‘ï¼Œå®ƒéœ€è¦æ ¹æ®ä¸åŒçš„æƒ…å†µæ¥é€‰æ‹©æ˜¯å¦è¿›è¡Œæ•°æ®è·å–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> scrollBehavior = <span class="function">(<span class="params">to, <span class="keyword">from</span>, savedPosition</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span> (to.matched.some(<span class="function"><span class="params">t</span> =&gt;</span> t.meta.keep_alive)) &#123;</div><div class="line">  	to.meta.saved_position = savedPosition; <span class="comment">// ä¼ é€’è¿™ä¸ªå€¼åˆ°å…·ä½“é¡µé¢æ¥åˆ¤æ–­æ˜¯å¦è¿›è¡Œæ•°æ®åˆ·æ–°</span></div><div class="line">    <span class="keyword">let</span> back = savedPosition ? savedPosition : &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">return</span> back;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">beforeRouteEnter: <span class="function"><span class="keyword">function</span>(<span class="params">to ,from, next</span>)</span>&#123;</div><div class="line">     next(<span class="function"><span class="params">vm</span> =&gt;</span> &#123;</div><div class="line">     	<span class="comment">// é€šè¿‡å¯¹nullçš„åˆ¤æ–­å†³å®šæ˜¯å¦è¿›è¡Œæ•°æ®åˆ·æ–°</span></div><div class="line">       <span class="keyword">if</span> (to.meta.saved_position === <span class="literal">null</span>) &#123;</div><div class="line">         vm.initAll();</div><div class="line">       &#125;</div><div class="line">     &#125;)</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œéœ€è¦æ³¨æ„å¿…é¡»è¦åœ¨beforeRouteEnterçš„nexté‡Œé¢è¿›è¡Œè°ƒç”¨ï¼Œå› ä¸ºä¸€èˆ¬çš„ç”Ÿå‘½å‘¨æœŸé’©å­æ¯”å¦‚mountedç­‰éƒ½ä¼šè¢«keep-aliveç»™åƒæ‰ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="éœ€è¦æ³¨æ„çš„ç‚¹"><a href="#éœ€è¦æ³¨æ„çš„ç‚¹" class="headerlink" title="éœ€è¦æ³¨æ„çš„ç‚¹"></a>éœ€è¦æ³¨æ„çš„ç‚¹</h4><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå…¶å®ä¸Šé¢è¿™ç§åšæ³•ä¼šæœ‰é—®é¢˜ã€‚æˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨Aé¡µé¢è¿›è¡Œåˆ·æ–°ï¼Œç„¶åç¬¬ä¸€æ¬¡ä»Aè¿›å…¥Bï¼Œåˆä»Bè¿”å›Açš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ»šåŠ¨åˆ°ç‰¹å®šçš„ä½ç½®ã€‚å®ƒæ»šåŠ¨åˆ°äº†é¡¶éƒ¨ã€‚é€šè¿‡ä»£ç è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸€æ¬¡è¿”å›çš„savedPositionä¸ºundefinedï¼Œå› æ­¤åœ¨åˆ¤æ–­backçš„æ—¶å€™ä¼šèµ‹å€¼{x: 0, y: 0}ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®°å½•ä¸€ä¸‹æ»šåŠ¨çš„ä½ç½®ã€‚</p>
<p>åœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™ï¼Œå¦‚æœfromçš„æ˜¯keep-aliveçš„é¡µé¢ï¼Œåˆ™è®°å½•å®ƒçš„ä½ç½®ï¼Œå¹¶ä¿å­˜åœ¨è·¯ç”±ä¸Šã€‚ä¹‹åé€šè¿‡æµè§ˆå™¨è¡Œä¸ºè¿›å…¥è¿™ä¸ªé¡µé¢çš„æ—¶å€™å¯¹ä½ç½®è¿›è¡Œåˆ¤å®šï¼Œå¦‚æœæœ‰å°±å–è¿™ä¸ªå€¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> scrollBehavior = <span class="function">(<span class="params">to, <span class="keyword">from</span>, savedPosition</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">if</span> (to.matched.some(<span class="function"><span class="params">t</span> =&gt;</span> t.meta.keep_alive)) &#123;</div><div class="line">    <span class="keyword">if</span> (savedPosition === <span class="literal">null</span>) &#123;</div><div class="line">      to.meta.saved_position = <span class="literal">null</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      savedPosition = to.meta.saved_position;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">let</span> back = savedPosition ? savedPosition : &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">return</span> back;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</div><div class="line">	...</div><div class="line">	if (<span class="keyword">from</span>.meta.keep_alive) &#123;</div><div class="line">    <span class="keyword">from</span>.meta.saved_position = &#123;<span class="attr">x</span>: <span class="built_in">window</span>.pageXOffset, <span class="attr">y</span>: <span class="built_in">window</span>.pageXOffset&#125;;</div><div class="line">  &#125;</div><div class="line">  ...</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>è‡ªæ­¤ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸‹ï¼Œä¸ºå•¥ä¼šå‡ºç°undefinedã€‚åœ¨vue-routerçš„ä»£ç ä¸­ï¼Œæœ‰ä¸‹é¢å‡ æ®µï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> router.app.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">   <span class="keyword">const</span> position = getScrollPosition()</div><div class="line">   <span class="keyword">const</span> shouldScroll = behavior.call(router, to, <span class="keyword">from</span>, isPop ? position : <span class="literal">null</span>)</div><div class="line">......</div><div class="line"> &#125;)</div><div class="line"> </div><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">getScrollPosition</span> (<span class="params"></span>): ?<span class="title">Object</span> </span>&#123;</div><div class="line">  <span class="keyword">const</span> key = getStateKey()</div><div class="line">  <span class="keyword">if</span> (key) &#123;</div><div class="line">    <span class="keyword">return</span> positionStore[key]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœåœ¨è°ƒç”¨getScrollPositionæ–¹æ³•æ—¶ï¼Œå¦‚æœåœ¨positionStoreé‡Œé¢æ²¡æœ‰æ‰¾åˆ°å¯¹åº”å½“å‰keyçš„æ•°æ®ï¼Œåˆ™ä¼šè¿”å›undefinedã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæ²¡æ‰¾åˆ°å½“å‰çš„keyå‘¢ï¼Œå› ä¸ºåˆ·æ–°åï¼Œä¹Ÿå°±æ˜¯å½“routerè¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œå½“å‰çš„è·¯ç”±çŠ¶æ€å¹¶æ²¡æœ‰åœ¨historyä¸Šè¿›è¡Œæ³¨å†Œï¼Œå³window.history.stateä¸ºnullã€‚æ­¤æ—¶ï¼Œå½“åœ¨å½“å‰é¡µé¢Aè¿›è¡Œæ»‘åŠ¨åè·³è½¬åˆ°å…¶ä»–é¡µé¢Bæ—¶ï¼Œä¼šå°†ä½ç½®ä¿¡æ¯å­˜å‚¨åˆ°positionStoreä¸Šé¢ï¼Œkeyä¸ºåˆå§‹åŒ–çš„window.performance.now().toFixed(3)ã€‚æ­¤æ—¶ï¼Œç‚¹å‡»å›é€€æŒ‰é’®ï¼Œä¼šè§¦å‘popstateæ¥è·å–Açš„ä¿¡æ¯ã€‚ä½†æ˜¯å› ä¸ºAçš„history stateå¹¶æ²¡æœ‰æ³¨å†Œã€‚æ‰€ä»¥æ— æ³•æ‰¾åˆ°åŒ¹é…çš„ä½ç½®ä¿¡æ¯ã€‚</p>
<p>ä¸è¿‡å¥½çš„æ˜¯ç°åœ¨è¿™ä¸ªé—®é¢˜å·²ç»è¢«ä¿®å¤äº†ï¼Œåœ¨<a href="https://github.com/vuejs/vue-router/releases/tag/v2.8.0" target="_blank" rel="external">2.8.0åŠå…¶ä»¥ä¸Šç‰ˆæœ¬</a>ä¸­å¯ä»¥çœ‹åˆ°ã€‚ä¿®å¤æ€è·¯å°±æ˜¯åœ¨è·¯ç”±è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨window.history.replaceState({ key: getStateKey() }, â€˜â€™)æ¥è¿›è¡Œä¸€ä¸ªæ³¨å†Œã€‚å…·ä½“è§<a href="https://github.com/vuejs/vue-router/issues/1585" target="_blank" rel="external">é“¾æ¥</a></p>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><ul>
<li><a href="https://www.jianshu.com/p/fe238d8e7c6d" target="_blank" rel="external">vue-router ä¸­ä½¿ç”¨ keep-alive æ§åˆ¶ ajax è¯·æ±‚çš„ç¼“å­˜ç­–ç•¥(äºŒ)</a></li>
<li><a href="https://github.com/vuejs/vue-router/blob/dev/src/util/scroll.js" target="_blank" rel="external">vue-router devåˆ†æ”¯æºç </a></li>
<li><a href="https://github.com/vuejs/vue-router/issues/772" target="_blank" rel="external">scrollBehavior doesnâ€™t store a scrolling position on the first page #772</a></li>
<li><a href="https://github.com/vuejs/vue-router/issues/1585" target="_blank" rel="external">scrollBehavior doesnâ€™t work for initial route in Firefox #1585</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä¸»è¦å¯¹äºå¦‚ä½•åœ¨åŸºäºvueçš„ç§»åŠ¨ç«¯å®ç°æ»šåŠ¨ä½ç½®è®°å½•è¿›è¡Œäº†æ¢è®¨ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="lulutia" scheme="http://xgfe.github.io/categories/lulutia/"/>
    
    
      <category term="Vue" scheme="http://xgfe.github.io/tags/Vue/"/>
    
      <category term="keep-alive" scheme="http://xgfe.github.io/tags/keep-alive/"/>
    
      <category term="vue-router" scheme="http://xgfe.github.io/tags/vue-router/"/>
    
  </entry>
  
  <entry>
    <title>Nodeå­¦ä¹ ç³»åˆ—(1) -- Nodeå®ç°çˆ¬è™«</title>
    <link href="http://xgfe.github.io/2018/01/05/hardhpp/node_crawler/"/>
    <id>http://xgfe.github.io/2018/01/05/hardhpp/node_crawler/</id>
    <published>2018-01-04T16:00:00.000Z</published>
    <updated>2018-01-16T03:23:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>Nodeå­¦ä¹ ç³»åˆ—(1) â€“ ä½¿ç”¨Nodeå®ç°çˆ¬è™«ï¼Œä»‹ç»äº†å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„çˆ¬è™«ç¨‹åºã€å¤šé¡µé¢çš„çˆ¬è™«ç¨‹åºã€å¦‚ä½•ä¿å­˜çˆ¬è™«çš„ç»“æœç­‰å†…å®¹ã€‚</p>
<a id="more"></a>
<p><strong>å‰æ</strong>ï¼šå·²å®‰è£…Node.jså’Œnpm<br><strong>å¼€å‘ç¯å¢ƒ</strong>ï¼šæ¨èVisual Studio Code<br><strong>ä½¿ç”¨åˆ°çš„æ¨¡å—</strong>ï¼šhttp cheerio fs (è¯´æ˜ï¼šNodeä¸­çš„åŸç”Ÿæ¨¡å—ä¹‹å¤–çš„å…¶ä»–æ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨<code>npm install &lt;package&gt;</code>è¿›è¡Œå®‰è£…)</p>
<p><strong>blogèƒŒæ™¯</strong>ï¼šç°åœ¨éœ€è¦è·å–xgfeåšå®¢(<a href="http://xgfe.github.io/">http://xgfe.github.io/</a>) ä¸­æ‰€æœ‰åšå®¢çš„ç›¸å…³æ•°æ®ï¼Œæ•°æ®åŒ…æ‹¬ï¼šåšå®¢çš„é¢˜ç›®ã€é“¾æ¥åœ°å€ã€åˆ›å»ºæ—¶é—´ã€ä½œè€…ä»¥åŠå…³é”®å­—ã€‚</p>
<h2 id="Step1ï¼šç¡®å®šè¦çˆ¬å–çš„ç½‘é¡µ"><a href="#Step1ï¼šç¡®å®šè¦çˆ¬å–çš„ç½‘é¡µ" class="headerlink" title="Step1ï¼šç¡®å®šè¦çˆ¬å–çš„ç½‘é¡µ"></a>Step1ï¼šç¡®å®šè¦çˆ¬å–çš„ç½‘é¡µ</h2><p>åœ¨å¼€å§‹çˆ¬è™«ç¨‹åºå¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆæ˜ç¡®éœ€è¦çˆ¬å–çš„ç½‘é¡µä»¥åŠå†…å®¹ã€‚  </p>
<p>æœ¬æ–‡è¦çˆ¬å–çš„ç½‘é¡µæ˜¯ï¼š<a href="http://xgfe.github.io/">http://xgfe.github.io/</a>   </p>
<p>çˆ¬å–ç½‘é¡µå…¨éƒ¨æ•°æ®ï¼Œç¨‹åºå¦‚ä¸‹ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// app01.js</div><div class="line">var http = require(&apos;http&apos;)</div><div class="line">var url = &apos;http://xgfe.github.io/&apos;</div><div class="line"></div><div class="line">http.get(url,function(res)&#123;</div><div class="line">    var html = &apos;&apos;;</div><div class="line"></div><div class="line">    res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">        html+=data;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    res.on(&apos;end&apos;,function()&#123;</div><div class="line">        console.log(html);</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼šè¾“å‡ºç½‘é¡µçš„æºä»£ç ï¼ˆå›¾ç•¥ï¼‰<br>æœ¬æ­¥éª¤è·å–åˆ°é¡µé¢çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä¸ºä¹‹åè·å–æŒ‡å®šä¿¡æ¯åšé“ºå«ã€‚</p>
<h3 id="httpæ¨¡å—ç®€å•ä»‹ç»"><a href="#httpæ¨¡å—ç®€å•ä»‹ç»" class="headerlink" title="httpæ¨¡å—ç®€å•ä»‹ç»"></a>httpæ¨¡å—ç®€å•ä»‹ç»</h3><p>httpæ¨¡å—æ˜¯Nodeä¸­çš„åŸç”Ÿæ¨¡å—ï¼Œè¯¥éƒ¨åˆ†åœ¨Nodeè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œå°±è¢«ç›´æ¥åŠ è½½è¿›å†…å­˜ä¸­ï¼Œä¸éœ€è¦å†æ¬¡å®‰è£…ã€‚<br>Nodeçš„httpæ¨¡å—åŒ…å«å¯¹HTTPå¤„ç†çš„å°è£…ã€‚httpæœåŠ¡ç»§æ‰¿è‡ªTCPæœåŠ¡å™¨ï¼Œèƒ½å¤Ÿä¸å¤šä¸ªå®¢æˆ·ç«¯ä¿æŒè¿æ¥ï¼Œé‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„å½¢å¼ï¼Œä½å†…å­˜å ç”¨ï¼Œé«˜å¹¶å‘ã€‚   </p>
<p>å¼•å…¥httpæ¨¡å—ï¼š <code>require(&#39;http&#39;)</code></p>
<ul>
<li><p>HTTPæœåŠ¡å™¨</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// http_createServer.js</div><div class="line">var http = require(&apos;http&apos;);</div><div class="line"></div><div class="line">http.createServer(function(req, res)&#123;</div><div class="line">    res.writeHead(200, &#123;&apos;Content-type&apos; : &apos;text/html&apos;&#125;);</div><div class="line">    res.write(&apos;&lt;h1&gt;Node&lt;/h1&gt;&apos;);</div><div class="line">    res.end(&apos;&lt;p&gt;Hello World&lt;/p&gt;&apos;);</div><div class="line">&#125;).listen(3000);</div></pre></td></tr></table></figure>
<p>  è¿è¡Œä»£ç ï¼Œåœ¨æµè§ˆå™¨è®¿é—®<code>http://localhost:3000</code></p>
</li>
<li><p>HTTPå®¢æˆ·ç«¯(httpæ¨¡å—æä¾›äº†ä¸¤ä¸ªå‡½æ•°http.requestå’Œhttp.getï¼ŒåŠŸèƒ½æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚)</p>
<ol>
<li><p>http.request(options,callback)ç”¨äºå‘èµ·httpè¯·æ±‚ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œoptionsæ˜¯ä¸€ä¸ªç±»ä¼¼å…³è”æ•°ç»„çš„å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«ä¸€äº›è¯·æ±‚çš„å‚æ•°ï¼Œcallbackè¡¨ç¤ºè¯·æ±‚åçš„å›è°ƒã€‚</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">// http_request.js</div><div class="line">var http = require(&apos;http&apos;)</div><div class="line">var querystring = require(&apos;querystring&apos;)   // querystringæ¨¡å—éœ€è¦ä½¿ç”¨npmå®‰è£…</div><div class="line"></div><div class="line">var postData = querystring.stringify(&#123;</div><div class="line">    &apos;msg&apos;: Hello World!&apos;</div><div class="line"> &#125;);</div><div class="line">  </div><div class="line">var options = &#123;</div><div class="line">    hostname: &apos;www.baidu.com&apos;,</div><div class="line">    port: null,</div><div class="line">    path: &apos;/&apos;,</div><div class="line">    method: &apos;POST&apos;,</div><div class="line">    headers: &#123;</div><div class="line">        &apos;Content-Type&apos;: &apos;application/x-www-form-urlencoded&apos;,</div><div class="line">        &apos;Content-Length&apos;: Buffer.byteLength(postData)</div><div class="line">    &#125;</div><div class="line">&#125;;		</div><div class="line"></div><div class="line">var req = http.request(options, function (res) &#123;</div><div class="line">    var html = &apos;&apos;</div><div class="line"></div><div class="line">    console.log(&apos;çŠ¶æ€ç :&apos; + res.statusCode);</div><div class="line">    console.log(&apos;å¤´éƒ¨ä¿¡æ¯:&apos; + JSON.stringify(res.headers));</div><div class="line">    res.setEncoding(&apos;utf8&apos;);</div><div class="line">    res.on(&apos;data&apos;, function (chunk) &#123;</div><div class="line">        html += chunk;</div><div class="line">    &#125;)</div><div class="line">    res.on(&apos;end&apos;, function () &#123;</div><div class="line">        console.log(html);</div><div class="line">    &#125;);</div><div class="line">&#125;).on(&apos;error&apos;, function (e) &#123;</div><div class="line">   	console.error(&apos;è¯·æ±‚å‡ºé”™äº†ï¼&apos;);	</div><div class="line">&#125;);</div><div class="line">  </div><div class="line">// write data to request body</div><div class="line">req.write(postData);</div><div class="line">req.end();</div></pre></td></tr></table></figure>
</li>
<li><p>http.get(options,callback)ï¼Œç”¨æ¥æ›´ç®€å•çš„å¤„ç†GETæ–¹å¼çš„è¯·æ±‚ï¼Œå®ƒæ˜¯http.requestçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºhttp.getè‡ªåŠ¨å°†è¯·æ±‚æ–¹æ³•è®¾ä¸ºGETè¯·æ±‚ï¼ŒåŒæ—¶ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨req.end()ã€‚</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// http_get.js</div><div class="line">var http = require(&apos;http&apos;)</div><div class="line">	</div><div class="line">http.get(&apos;http://www.baidu.com&apos;,function (res) &#123;</div><div class="line">    var html = &apos;&apos;;</div><div class="line">    </div><div class="line">    console.log(&apos;çŠ¶æ€ç :&apos; + res.statusCode);</div><div class="line">    res.on(&apos;data&apos;, function (data) &#123;</div><div class="line">        html += data</div><div class="line">    &#125;)</div><div class="line">    res.on(&apos;end&apos;, function ()&#123;</div><div class="line">        console.log(html)</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&apos;error&apos;, function () &#123;</div><div class="line">    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h2 id="Step2ï¼šåˆ†æç½‘é¡µç»“æ„ï¼Œç¡®å®šæ•°æ®çš„ç»“æ„"><a href="#Step2ï¼šåˆ†æç½‘é¡µç»“æ„ï¼Œç¡®å®šæ•°æ®çš„ç»“æ„" class="headerlink" title="Step2ï¼šåˆ†æç½‘é¡µç»“æ„ï¼Œç¡®å®šæ•°æ®çš„ç»“æ„"></a>Step2ï¼šåˆ†æç½‘é¡µç»“æ„ï¼Œç¡®å®šæ•°æ®çš„ç»“æ„</h2><p>åˆ†æç½‘é¡µç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://github.com/hardhpp/Node/blob/master/crawler/picture/picture1.png?raw=true" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œå›¾ä¸­æ–¹æ¡†å†…æ˜¾ç¤ºçš„æ•°æ®ï¼Œæ˜¯æœ€ç»ˆåº”è¯¥è·å–çš„æ•°æ®ã€‚</p>
<h3 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h3><p>æ ¹æ®æœ€ç»ˆçš„éœ€æ±‚ä»¥åŠç½‘é¡µçš„ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[&#123;</div><div class="line">    blogTitle: blogTitle,       // åšå®¢åç§°</div><div class="line">    blogHref: blogHref,         // åšå®¢é“¾æ¥</div><div class="line">    blogTime: blogTime,	         // åšå®¢åˆ›å»ºæ—¶é—´</div><div class="line">    blogAuthor: blogAuthor,     // åšå®¢ä½œè€…</div><div class="line">    blogKeywords: [],           // åšå®¢å…³é”®è¯</div><div class="line">    blogAbstract: blogAbstract  // åšå®¢ç®€ä»‹</div><div class="line">&#125;]</div></pre></td></tr></table></figure>
<p>xgfeåšå®¢çš„æ•°æ®ä¸é¡µé¢çš„å¯¹åº”å¦‚ä¸‹ï¼š</p>
<p><img src="https://github.com/hardhpp/Node/blob/master/crawler/picture/picture2.png?raw=true" alt=""></p>
<p>å¼•å…¥chreeioæ¨¡å—(chreeioæ¨¡å—éœ€è¦ä½¿ç”¨<code>npm</code>è¿›è¡Œå®‰è£…)ï¼Œä½¿å¾—å¯ä»¥æ›´æ–¹ä¾¿çš„è®¿é—®htmlçš„ç»“ç‚¹ï¼Œæ–¹ä¾¿æŸ¥æ‰¾æ‰€éœ€æ•°æ®ã€‚  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">// app02.js</div><div class="line">var http = require(&apos;http&apos;)</div><div class="line">var cheerio = require(&apos;cheerio&apos;)</div><div class="line">var url = &apos;http://xgfe.github.io/&apos;</div><div class="line"></div><div class="line">var urlArr = url.split(&apos;&apos;)</div><div class="line">urlArr.splice(-1)</div><div class="line">var rootUrl = urlArr.join(&apos;&apos;)</div><div class="line"></div><div class="line">var index =0 </div><div class="line"></div><div class="line">// è·å–å†…å®¹</div><div class="line">function filterBlogInfo(html) &#123;</div><div class="line"></div><div class="line">    var $ = cheerio.load(html)</div><div class="line">    var blogContent = $(&apos;#content .post&apos;)</div><div class="line">    var blogInfo =  []</div><div class="line">    var root</div><div class="line"></div><div class="line">    blogContent.each(function (index,item) &#123;</div><div class="line">        var blogItemHeader = $(this).find(&apos;.post-header&apos;)</div><div class="line">        var blogItemBody = $(this).find(&apos;.post-body&apos;)</div><div class="line">        var blogArticleInfo = &#123;&#125;</div><div class="line">        var blogTitle = blogItemHeader.find(&apos;.post-title-link&apos;).text().trim()</div><div class="line">        var blogHref = rootUrl + blogItemHeader.find(&apos;.post-title-link&apos;).attr(&apos;href&apos;)</div><div class="line">        var blogTime = blogItemHeader.find(&apos;.post-time time&apos;).text().trim()</div><div class="line">        var blogAuthor = blogItemHeader.find(&apos;.post-category a&apos;).text().trim()</div><div class="line">        var blogKeywords = []</div><div class="line">        blogItemHeader.find(&apos;.post-tags a&apos;).each(function (tagItem) &#123;</div><div class="line">            blogKeywords.push($(this).text().trim())</div><div class="line">        &#125;)</div><div class="line">        var blogAbstract = blogItemBody.find(&apos;p&apos;).text().trim()</div><div class="line"></div><div class="line">        blogArticleInfo.blogTitle = blogTitle</div><div class="line">        blogArticleInfo.blogHref = blogHref</div><div class="line">        blogArticleInfo.blogTime = blogTime</div><div class="line">        blogArticleInfo.blogAuthor = blogAuthor</div><div class="line">        blogArticleInfo.blogKeywords = blogKeywords</div><div class="line">        blogArticleInfo.blogAbstract = blogAbstract</div><div class="line"></div><div class="line">        blogInfo.push(blogArticleInfo)</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    return blogInfo</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æ‰“å°æ•°æ®</div><div class="line">function printBlogInfo (blogInfo) &#123;</div><div class="line"></div><div class="line">    blogInfo.forEach(function (item) &#123;</div><div class="line">        console.log(index++)</div><div class="line">        console.log(&apos;é¢˜ç›®ï¼š &apos; + item.blogTitle)</div><div class="line">        console.log(&apos;é“¾æ¥ï¼š &apos; + item.blogHref)</div><div class="line">        console.log(&apos;æ—¶é—´ï¼š &apos; + item.blogTime)</div><div class="line">        console.log(&apos;ä½œè€…ï¼š &apos; + item.blogAuthor)</div><div class="line">        console.log(&apos;å…³é”®å­—ï¼š &apos;)</div><div class="line">        item.blogKeywords.forEach( function (tagItem) &#123;</div><div class="line">            console.log(tagItem)</div><div class="line">        &#125;)</div><div class="line">        console.log(&quot;ç®€ä»‹ï¼š &quot; + item.blogAbstract +&apos;\n&apos;)</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// è·å–ç½‘é¡µæºä»£ç </div><div class="line">http.get(url,function(res)&#123;</div><div class="line">    var html = &apos;&apos;;</div><div class="line"></div><div class="line">    res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">        html+=data;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    res.on(&apos;end&apos;,function()&#123;</div><div class="line">        var data = filterBlogInfo(html)</div><div class="line">        printBlogInfo(data)</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚å›¾ï¼š<br><img src="https://github.com/hardhpp/Node/blob/master/crawler/picture/picture3.png?raw=true" alt=""></p>
<h3 id="cheerioæ¨¡å—ç®€å•ä»‹ç»"><a href="#cheerioæ¨¡å—ç®€å•ä»‹ç»" class="headerlink" title="cheerioæ¨¡å—ç®€å•ä»‹ç»"></a>cheerioæ¨¡å—ç®€å•ä»‹ç»</h3><p>cheerioæ¨¡å—ä¸æ˜¯Nodeçš„åŸç”Ÿæ¨¡å—ï¼Œéœ€è¦å®‰è£…<br>å®‰è£…ï¼š<code>npm install cheerio</code>    </p>
<p>cheerioæ¨¡å—æ˜¯ä¸ºæœåŠ¡å™¨ç‰¹åˆ«å®šåˆ¶çš„ï¼Œå¿«é€Ÿã€çµæ´»ã€å®æ–½çš„jQueryæ ¸å¿ƒå®ç°ã€‚  </p>
<ol>
<li><strong>ç›¸ä¼¼çš„è¯­æ³•:</strong> Cheerio åŒ…æ‹¬äº† jQuery æ ¸å¿ƒçš„å­é›†ã€‚Cheerio  ä»jQueryåº“ä¸­å»é™¤äº†æ‰€æœ‰ DOMä¸ä¸€è‡´æ€§å’Œæµè§ˆå™¨å°´å°¬çš„éƒ¨åˆ†ï¼Œæ­ç¤ºäº†å®ƒçœŸæ­£ä¼˜é›…çš„APIã€‚</li>
<li><strong>é—ªç”µèˆ¬çš„å—:</strong> Cheerio å·¥ä½œåœ¨ä¸€ä¸ªéå¸¸ç®€å•ï¼Œä¸€è‡´çš„DOMæ¨¡å‹ä¹‹ä¸Šã€‚è§£æï¼Œæ“ä½œï¼Œå‘ˆé€éƒ½å˜å¾—éš¾ä»¥ç½®ä¿¡çš„é«˜æ•ˆã€‚åŸºç¡€çš„ç«¯åˆ°ç«¯çš„åŸºå‡†æµ‹è¯•æ˜¾ç¤ºCheerio å¤§çº¦æ¯”JSDOMå¿«å…«å€(8x)ã€‚ </li>
<li><strong>å·¨çµæ´»:</strong> Cheerio å°è£…äº†å…¼å®¹çš„htmlparserã€‚Cheerio å‡ ä¹èƒ½å¤Ÿè§£æä»»ä½•çš„ HTML å’Œ XML documentã€‚</li>
</ol>
<p>ä½¿ç”¨ï¼š<br>step1: éœ€è¦åŠ è½½HTML    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var html = &apos;&lt;ul id=&quot;fruits&quot;&gt;...&lt;/ul&gt;&apos;</div><div class="line">var $ = cheerio.load(html)</div></pre></td></tr></table></figure>
<p>step2: ä½¿ç”¨é€‰æ‹©å™¨ï¼Œé€‰æ‹©éœ€è¦å¤„ç†çš„å…ƒç´   <code>$(selectior,[context],[root])</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// é€‰æ‹©å™¨åœ¨ Context èŒƒå›´å†…æœç´¢ï¼ŒContextåˆåœ¨RootèŒƒå›´å†…æœç´¢</div><div class="line">$(&apos;.apple&apos;, &apos;#fruits&apos;)</div><div class="line">// selector å’Œ contextå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼</div><div class="line">$(&apos;#fruits .apple&apos;)</div><div class="line"></div><div class="line">// ä½¿ç”¨find()</div><div class="line">$(&apos;#fruits&apos;).find(&apos;.apple&apos;)</div><div class="line">// ä½¿ç”¨parent()</div><div class="line">$(&apos;.apple&apos;).parent()</div></pre></td></tr></table></figure>
<p>step3: è·å¾—å’Œä¿®æ”¹ç›¸åº”çš„å±æ€§     </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(&apos;.apple&apos;, &apos;#fruits&apos;).val([value])</div><div class="line">$(&apos;#fruits .apple&apos;).text([textString])</div><div class="line">$(&apos;#fruits .apple&apos;).attr(name,value)</div><div class="line">$(&apos;#fruits .apple&apos;).addClass(&apos;.red&apos;)</div></pre></td></tr></table></figure>
<h2 id="Step3ï¼šå¤šé¡µé¢çˆ¬è™«"><a href="#Step3ï¼šå¤šé¡µé¢çˆ¬è™«" class="headerlink" title="Step3ï¼šå¤šé¡µé¢çˆ¬è™«"></a>Step3ï¼šå¤šé¡µé¢çˆ¬è™«</h2><p>åœ¨Step2ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥çˆ¬å–æœ€ç»ˆæ‰€éœ€è¦çš„æ•°æ®ï¼Œä¸è¿‡ï¼Œç°åœ¨çˆ¬å–çš„æ•°æ®ä»…ä»…æ˜¯ç¬¬ä¸€é¡µçš„æ•°æ®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çˆ¬å–å…¶ä»–é¡µçš„æ•°æ®ã€‚</p>
<p>ç°åœ¨ï¼Œä¸ºäº†è·å–å…¶ä»–é¡µé¢çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è·å–å…¶ä»–é¡µé¢çš„urlã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æé¡µé¢ï¼š<br><img src="https://github.com/hardhpp/Node/blob/master/crawler/picture/picture4.png?raw=true" alt=""></p>
<p>è§‚å¯Ÿé¡µé¢å¯å¾—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‹¼æ¥urlï¼Œè·å–æ¯ä¸ªé¡µé¢çš„urlã€‚</p>
<p>å…·ä½“ç¨‹åºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">// app03.js</div><div class="line">var http = require(&apos;http&apos;)</div><div class="line">var cheerio = require(&apos;cheerio&apos;)</div><div class="line">var url = &apos;http://xgfe.github.io/&apos;</div><div class="line"></div><div class="line">var urlArr = url.split(&apos;&apos;)</div><div class="line">urlArr.splice(-1)</div><div class="line">var rootUrl = urlArr.join(&apos;&apos;)</div><div class="line"></div><div class="line">// è·å–åˆ†é¡µçš„url</div><div class="line">function fetchPageUrl(html) &#123;</div><div class="line"></div><div class="line">    var $ = cheerio.load(html)</div><div class="line">    var blogPageTotal = $(&apos;#content .pagination .page-number&apos;).eq(2)</div><div class="line">    var blogPageHref = blogPageTotal.attr(&apos;href&apos;).split(&apos;&apos;)</div><div class="line">    blogPageHref.splice(-2)</div><div class="line">    var blogPageTotalNumber = parseInt(blogPageTotal.text()) </div><div class="line">    var pageUrl =  [url]</div><div class="line"></div><div class="line">    for(var i=2; i &lt;= blogPageTotalNumber; i++)&#123;</div><div class="line">        pageUrl.push(rootUrl + blogPageHref.join(&apos;&apos;)+i+&apos;/&apos;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return pageUrl</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æ‰“å°æ•°æ®</div><div class="line">function printPageUrl(pageUrl) &#123;</div><div class="line"></div><div class="line">    pageUrl.forEach(function (item, index) &#123;</div><div class="line">        console.log(item)</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// è·å–é¡µé¢æºä»£ç </div><div class="line">http.get(url,function(res)&#123;</div><div class="line">    var html = &apos;&apos;;</div><div class="line"></div><div class="line">    res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">        html+=data;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    res.on(&apos;end&apos;,function()&#123;</div><div class="line">        var data = fetchPageUrl(html)</div><div class="line">        printPageUrl(data)</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š<br><img src="https://github.com/hardhpp/Node/blob/master/crawler/picture/picture5.png?raw=true" alt=""></p>
<p>æ‰€ä»¥ï¼Œåœ¨è·å–åˆ°æ‰€æœ‰çš„urlä¹‹åï¼Œå¯ä»¥æŒ‰ç…§Step2è¿›è¡Œè·å–æ•°æ®ã€‚<br>æ­¤æ—¶ï¼Œ<strong>å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼</strong></p>
<p>æˆ‘ä»¬éœ€è¦è®¿é—®å®Œä¸€ä¸ªé¡µé¢ä¹‹åï¼Œå†å»è®¿é—®å¦å¤–ä¸€ä¸ªï¼Œæ­¤æ—¶ï¼Œéœ€è¦ç”¨åˆ°å›è°ƒï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">// ç¬¬ä¸€å±‚ï¼šè·å–æ‰€æœ‰é¡µé¢çš„url</div><div class="line">http.get(url1,function(res)&#123;</div><div class="line">    var html = &apos;&apos;;</div><div class="line"></div><div class="line">    res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">        html+=data;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    res.on(&apos;end&apos;,function()&#123;</div><div class="line">        var data1 = filterPageUrl(html)</div><div class="line">        printPageUrl(data1)</div><div class="line">        </div><div class="line">        // ç¬¬äºŒå±‚ï¼š è·å–ç¬¬ä¸€ä¸ªé¡µé¢çš„æºä»£ç å¹¶å¤„ç†</div><div class="line">        http.get(url2,function(res)&#123;</div><div class="line">            var html = &apos;&apos;;</div><div class="line">        </div><div class="line">            res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">                html+=data;</div><div class="line">            &#125;)</div><div class="line">            </div><div class="line">            res.on(&apos;end&apos;,function()&#123;</div><div class="line">                var data2 = filterBlogInfo(html)</div><div class="line">                printBlogInfo(data2)</div><div class="line">                // ç¬¬ä¸‰å±‚ï¼š è·å–ç¬¬äºŒä¸ªé¡µé¢çš„æºä»£ç å¹¶å¤„ç†</div><div class="line">                http.get(url3,function(res)&#123;</div><div class="line">                    var html = &apos;&apos;;</div><div class="line">                </div><div class="line">                    res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">                        html+=data;</div><div class="line">                    &#125;)</div><div class="line">                    res.on(&apos;end&apos;,function()&#123;</div><div class="line">                        var data3 = filterBlogInfo(html)</div><div class="line">                        printBlogInfo(data3)</div><div class="line">                        </div><div class="line">                        </div><div class="line">                        // **** æ­¤å¤„çœç•¥äº†6æ¬¡å›è°ƒ ****</div><div class="line">                        </div><div class="line">                        </div><div class="line">                    &#125;)</div><div class="line">                &#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">                    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">                &#125;)</div><div class="line">            &#125;)</div><div class="line">        &#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">            console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><strong>é—®é¢˜ï¼š</strong> å•çº¯çš„ä½¿ç”¨å›è°ƒï¼Œä¼šå½¢æˆå›è°ƒåœ°ç‹±ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨å…¶ä»–çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p><strong>è§£å†³æ–¹æ³•ï¼šé‡‡ç”¨promise</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">// app04.js</div><div class="line">var http = require(&apos;http&apos;)</div><div class="line">var cheerio = require(&apos;cheerio&apos;)</div><div class="line">var url = &apos;http://xgfe.github.io/&apos;</div><div class="line"></div><div class="line">var urlArr = url.split(&apos;&apos;)</div><div class="line">urlArr.splice(-1)</div><div class="line">var rootUrl = urlArr.join(&apos;&apos;)</div><div class="line"></div><div class="line">var index = 0</div><div class="line"></div><div class="line">// è·å–åˆ†é¡µçš„url</div><div class="line">function fetchPageUrl(html) &#123;</div><div class="line">    // æ­¤å¤„çœç•¥ï¼Œä¸ä¹‹å‰ç¤ºä¾‹ç›¸åŒ</div><div class="line">&#125;</div><div class="line"></div><div class="line">// è·å–å†…å®¹</div><div class="line">function filterBlogInfo(html) &#123;</div><div class="line">    // æ­¤å¤„çœç•¥ï¼Œä¸ä¹‹å‰ç¤ºä¾‹ç›¸åŒ</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æ‰“å°æ•°æ®</div><div class="line">function printBlogInfo (blogInfo) &#123;</div><div class="line">    // æ­¤å¤„çœç•¥ï¼Œä¸ä¹‹å‰ç¤ºä¾‹ç›¸åŒ</div><div class="line">&#125;</div><div class="line"></div><div class="line">function getUrlAsync(url) &#123;</div><div class="line">    return new Promise(function (resolve, reject)&#123;</div><div class="line">        console.log(&apos;æ­£åœ¨çˆ¬å–ï¼š &apos; + url)</div><div class="line">        http.get(url, function(res)&#123;</div><div class="line">            var html = &apos;&apos;</div><div class="line">            res.on(&apos;data&apos;,function (data) &#123;</div><div class="line">                html += data</div><div class="line">            &#125;)</div><div class="line"></div><div class="line">            res.on(&apos;end&apos;,function ()&#123;</div><div class="line">                resolve(html)</div><div class="line">            &#125;)</div><div class="line">        &#125;).on(&apos;error&apos;, function () &#123;</div><div class="line">            reject(e)</div><div class="line">            console.log(&apos;è·å–&apos; + url + &apos;é¡µé¢æ•°æ®å‡ºé”™!&apos;)</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">// è·å–é¡µé¢æºä»£ç </div><div class="line">http.get(url,function(res)&#123;</div><div class="line">    var html = &apos;&apos;;</div><div class="line"></div><div class="line">    res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">        html+=data;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    res.on(&apos;end&apos;,function()&#123;</div><div class="line">        var URLs = fetchPageUrl(html)</div><div class="line">        </div><div class="line">        var fetchPageDataArray = []</div><div class="line"></div><div class="line">        URLs.forEach(function (url) &#123;</div><div class="line">            fetchPageDataArray.push(getUrlAsync(url))</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        // æ‰§è¡Œpromise </div><div class="line">        Promise</div><div class="line">            .all(fetchPageDataArray)</div><div class="line">            .then(function (pages) &#123;</div><div class="line">                pages.forEach( function (pageItem)&#123;</div><div class="line">                    printBlogInfo(filterBlogInfo(pageItem))</div><div class="line">                &#125;)</div><div class="line">            &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼šä¸Step2ç›¸ä¼¼ï¼Œè·å–äº†å…¨éƒ¨çš„æ•°æ®ã€‚ï¼ˆå›¾ç•¥ï¼‰</p>
<h3 id="promiseç®€å•ä»‹ç»"><a href="#promiseç®€å•ä»‹ç»" class="headerlink" title="promiseç®€å•ä»‹ç»"></a>promiseç®€å•ä»‹ç»</h3><p>å…ˆæ¥å›é¡¾ä¸€ä¸‹promiseçš„åŸºæœ¬æ¦‚å¿µï¼š</p>
<ul>
<li>promiseåªæœ‰ä¸‰ç§çŠ¶æ€ï¼Œæœªå®Œæˆï¼Œå®Œæˆ(fulfilled)å’Œå¤±è´¥(rejected)ã€‚</li>
<li>promiseçš„çŠ¶æ€å¯ä»¥ç”±æœªå®Œæˆè½¬æ¢æˆå®Œæˆï¼Œæˆ–è€…æœªå®Œæˆè½¬æ¢æˆå¤±è´¥ã€‚</li>
<li>promiseçš„çŠ¶æ€è½¬æ¢åªå‘ç”Ÿä¸€æ¬¡</li>
</ul>
<p>æ–¹æ³•ï¼š<br>1.Promise.then æ¥å—3ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚å‰ä¸¤ä¸ªå‡½æ•°å¯¹åº”promiseçš„ä¸¤ç§çŠ¶æ€fulfilled, rejectedçš„å›è°ƒå‡½æ•°ã€‚ç¬¬ä¸‰ä¸ªå‡½æ•°ç”¨äºå¤„ç†è¿›åº¦ä¿¡æ¯ã€‚ </p>
<p>2.Promise.all æ¥æ”¶ä¸€ä¸ª promiseå¯¹è±¡çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå½“è¿™ä¸ªæ•°ç»„é‡Œçš„æ‰€æœ‰promiseå¯¹è±¡å…¨éƒ¨å˜ä¸ºresolveæˆ–rejectçŠ¶æ€çš„æ—¶å€™ï¼Œå®ƒæ‰ä¼šå»è°ƒç”¨ .then æ–¹æ³•ã€‚</p>
<p>ä½¿ç”¨promiseçš„å¥½å¤„ï¼š</p>
<ul>
<li>é“¾å¼å¤„ç†ï¼Œæ–¹ä¾¿ä¹‹åçš„ä»£ç ç»´æŠ¤</li>
<li>åœ¨Promise.allä¸­è¿›è¡Œå¹¶å‘å¤„ç†ï¼Œé¿å…é˜»å¡</li>
</ul>
<h2 id="Step4ï¼šä¿å­˜ä¸ºæ–‡ä»¶"><a href="#Step4ï¼šä¿å­˜ä¸ºæ–‡ä»¶" class="headerlink" title="Step4ï¼šä¿å­˜ä¸ºæ–‡ä»¶"></a>Step4ï¼šä¿å­˜ä¸ºæ–‡ä»¶</h2><p>åœ¨Step3ä¸­ï¼Œè¿è¡Œä¹‹åï¼Œä¼šè¾“å‡ºç‰¹åˆ«å¤šçš„ä¿¡æ¯ï¼Œè¿™æ ·ï¼Œä¸ä»…ä¸å®¹æ˜“è§‚å¯Ÿæœ€ç»ˆæ•°æ®ï¼Œä¹Ÿä¸åˆ©äºåæœŸçš„å†å¤„ç†ï¼ˆä¾‹å¦‚ï¼šå“ªä¸ªä½œè€…å‘è¡¨çš„æ–‡ç« æœ€å¤šã€å“ªä¸ªç±»å‹çš„æ–‡ç« å‘è¡¨æœ€å¤šä¹‹ç±»çš„ç»Ÿè®¡ï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœ€ç»ˆè¾“å‡ºçš„ç»“æœä¿å­˜åœ¨æ–‡ä»¶ä¸­ã€‚</p>
<p>åœ¨nodeä¸­ï¼Œfsæ¨¡å—è´Ÿè´£æ–‡ä»¶çš„æ“ä½œã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¼•å…¥fsæ¨¡å—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">// app05.js</div><div class="line">var http = require(&apos;http&apos;)</div><div class="line">var cheerio = require(&apos;cheerio&apos;)</div><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line">var url = &apos;http://xgfe.github.io/&apos;</div><div class="line"></div><div class="line">var urlArr = url.split(&apos;&apos;)</div><div class="line">urlArr.splice(-1)</div><div class="line">var rootUrl = urlArr.join(&apos;&apos;)</div><div class="line"></div><div class="line">var index = 0</div><div class="line">var dataStr = &quot;&quot;</div><div class="line"></div><div class="line">// è·å–åˆ†é¡µçš„url</div><div class="line">function fetchPageUrl(html) &#123;</div><div class="line">    // æ­¤å¤„çœç•¥ï¼Œä¸ä¹‹å‰ç¤ºä¾‹ç›¸åŒ</div><div class="line">&#125;</div><div class="line"></div><div class="line">// è·å–å†…å®¹</div><div class="line">function filterBlogInfo(html) &#123;</div><div class="line">    // æ­¤å¤„çœç•¥ï¼Œä¸ä¹‹å‰ç¤ºä¾‹ç›¸åŒ</div><div class="line">&#125;</div><div class="line"></div><div class="line">// æ‰“å°æ•°æ®</div><div class="line">function printBlogInfo (blogInfo) &#123;</div><div class="line"></div><div class="line">    var blogInfoStr = &apos;&apos;</div><div class="line">    blogInfo.forEach(function (item) &#123;</div><div class="line">        blogInfoStr += (index++) + &apos;\n&apos;</div><div class="line">        blogInfoStr += &apos;é¢˜ç›®ï¼š &apos; + item.blogTitle + &apos;\n&apos;</div><div class="line">        blogInfoStr += &apos;é“¾æ¥ï¼š &apos; + item.blogHref + &apos;\n&apos;</div><div class="line">        blogInfoStr += &apos;æ—¶é—´ï¼š &apos; + item.blogTime + &apos;\n&apos;</div><div class="line">        blogInfoStr += &apos;ä½œè€…ï¼š &apos; + item.blogAuthor + &apos;\n&apos;</div><div class="line">        blogInfoStr += &apos;å…³é”®å­—ï¼š &apos;</div><div class="line">        item.blogKeywords.forEach( function (tagItem) &#123;</div><div class="line">            blogInfoStr += tagItem + &apos; &apos;</div><div class="line">        &#125;)</div><div class="line">        blogInfoStr += &quot;\nç®€ä»‹ï¼š&quot; + item.blogAbstract +&apos;\n\n&apos;</div><div class="line">    &#125;)</div><div class="line">    return blogInfoStr</div><div class="line">&#125;</div><div class="line"></div><div class="line">function getUrlAsync(url) &#123;</div><div class="line">	// æ­¤å¤„çœç•¥ï¼Œä¸ä¹‹å‰ç¤ºä¾‹ç›¸åŒ</div><div class="line">&#125;</div><div class="line"></div><div class="line">// è·å–é¡µé¢æºä»£ç </div><div class="line">http.get(url,function(res)&#123;</div><div class="line">    var html = &apos;&apos;;</div><div class="line"></div><div class="line">    res.on(&apos;data&apos;,function(data)&#123;</div><div class="line">        html+=data;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    res.on(&apos;end&apos;,function()&#123;</div><div class="line">        var URLs = fetchPageUrl(html)</div><div class="line">        </div><div class="line">        var fetchPageDataArray = []</div><div class="line"></div><div class="line">        URLs.forEach(function (url) &#123;</div><div class="line">            fetchPageDataArray.push(getUrlAsync(url))</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        // æ‰§è¡Œpromise</div><div class="line">        Promise</div><div class="line">            .all(fetchPageDataArray)</div><div class="line">            .then(function (pages) &#123;</div><div class="line">                pages.forEach( function (pageItem)&#123;</div><div class="line">                    dataStr += printBlogInfo(filterBlogInfo(pageItem))</div><div class="line">                &#125;)</div><div class="line"></div><div class="line">                // å†™å…¥æ–‡ä»¶</div><div class="line">                fs.writeFile(&apos;data.txt&apos;, dataStr, function (err) &#123;</div><div class="line">                    if (err) console.log(&apos;write error&apos;)</div><div class="line">                    console.log(&apos;file saved!&apos;)</div><div class="line">                &#125;)</div><div class="line">            &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&apos;error&apos;,function()&#123;</div><div class="line">    console.log(&apos;è·å–æ•°æ®å‡ºé”™&apos;);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="fsæ¨¡å—ç®€å•ä»‹ç»"><a href="#fsæ¨¡å—ç®€å•ä»‹ç»" class="headerlink" title="fsæ¨¡å—ç®€å•ä»‹ç»"></a>fsæ¨¡å—ç®€å•ä»‹ç»</h3><p>fsæ¨¡å—ç”¨äºå¯¹ç³»ç»Ÿæ–‡ä»¶åŠç›®å½•è¿›è¡Œè¯»å†™æ“ä½œã€‚</p>
<p><strong>è¯»æ–‡ä»¶</strong> </p>
<p>1.å¼‚æ­¥è¯»æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">fs.readFile(&apos;simple.txt&apos;, &apos;utf-8&apos;, function (err, data)&#123; </div><div class="line">    if (err) &#123;</div><div class="line">        // å‡ºé”™äº†</div><div class="line">    &#125; else &#123;</div><div class="line">        // å¤„ç†æ–‡ä»¶æ•°æ®</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>å¼‚æ­¥è¯»å–æ–‡ä»¶æ—¶ï¼Œä¼ å…¥çš„å›è°ƒå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚<br>1) å½“æ­£å¸¸è¯»å–æ—¶ï¼Œerrå‚æ•°ä¸ºnullï¼Œdataå‚æ•°ä¸ºè¯»å–åˆ°çš„String;<br>2) å½“è¯»å–å‘ç”Ÿé”™è¯¯æ—¶ï¼Œerrå‚æ•°ä»£è¡¨ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼Œdataä¸ºundefinedã€‚<br>å½“è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œä¸ä¼ å…¥æ–‡ä»¶ç¼–ç ï¼Œå›è°ƒå‡½æ•°çš„dataå‚æ•°å°†è¿”å›ä¸€ä¸ªBufferå¯¹è±¡ã€‚</p>
<p><strong>æ‰©å±•ï¼šBufferå¯¹è±¡ä¸Stringå¯¹è±¡è½¬æ¢ï¼š</strong><br>Bufferå¯¹è±¡ -&gt; Stringå¯¹è±¡: <code>var str = buf.toString(&#39;utf-8&#39;)</code><br>Stringå¯¹è±¡ -&gt; Bufferå¯¹è±¡: <code>var buf = Buffer.from(str, &#39;utf-8&#39;)</code></p>
<p>2.åŒæ­¥è¯»æ–‡ä»¶ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line">var data = fs.readFileSync(&apos;simple.txt&apos;, &apos;utf-8&apos;)</div></pre></td></tr></table></figure>
<p>åŒæ­¥è¯»æ–‡ä»¶æ—¶ï¼Œè¯»å–åˆ°çš„æ•°æ®è¢«ç›´æ¥è¿”å›,éœ€è¦ä½¿ç”¨<strong>tryâ€¦catch</strong>æ•è·é”™è¯¯ã€‚ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">try &#123;</div><div class="line">    var data = fs.readFileSync(&apos;simple.txt&apos;, &apos;utf-8&apos;)</div><div class="line">&#125; catch (err) &#123;</div><div class="line">    // å‡ºé”™äº†</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>å†™æ–‡ä»¶</strong><br>1.å¼‚æ­¥å†™æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">var data = &apos;write something.&apos;</div><div class="line">fs.writeFile(&apos;output.txt&apos;, data, function (err)&#123;</div><div class="line">    if (err) &#123;</div><div class="line">        // å‡ºé”™äº†</div><div class="line">    &#125; else&#123;</div><div class="line">        // å†™æ–‡ä»¶æˆåŠŸ</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><code>writeFile()</code>çš„å‚æ•°ä¾æ¬¡ä¸ºæ–‡ä»¶åã€æ•°æ®å’Œå›è°ƒå‡½æ•°ã€‚<br>å¦‚æœä¼ å…¥çš„æ•°æ®æ˜¯String,é»˜è®¤æŒ‰<code>UTF-8</code>ç¼–ç å†™å…¥æ–‡ä»¶ï¼›<br>å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯Buffer,åˆ™å†™å…¥çš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<p>2.åŒæ­¥å†™æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var fs = require(&apos;fs&apos;)  </div><div class="line"></div><div class="line">var data = &apos;write something again.&apos;  </div><div class="line">fs.writeFileSync(&apos;output.txt&apos;, data)</div></pre></td></tr></table></figure>
<p><strong>è·å–æ–‡ä»¶ä¿¡æ¯</strong></p>
<p>Statså¯¹è±¡ï¼šåŒ…å«æ–‡ä»¶æˆ–ç›®å½•çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šæ–‡ä»¶å¤§å°ã€åˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯ã€‚<br>Statså¯¹è±¡å…·æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼š<br><code>size                        // æ–‡ä»¶å¤§å°</code><br><code>birthtime                   // æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ï¼ŒDateå¯¹è±¡</code><br><code>mtime                       // æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼ŒDateå¯¹è±¡</code><br><code>isFile()                    // å¦‚æœæ˜¯æ–‡ä»¶è¿”å›trueï¼Œå¦åˆ™è¿”å›false</code><br><code>isDirectory()               // å¦‚æœæ˜¯ç›®å½•è¿”å›trueï¼Œå¦åˆ™è¿”å›false</code>    </p>
<p>1.å¼‚æ­¥è·å–æ–‡ä»¶ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">fs.stat(&apos;simple.txt&apos;, function (err, stat) &#123;</div><div class="line">    if (err) &#123;</div><div class="line">        // å‡ºé”™äº†</div><div class="line">    &#125; else &#123;</div><div class="line">        // è·å–æ–‡ä»¶ä¿¡æ¯</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>2.åŒæ­¥è·å–æ–‡ä»¶ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">var stat = fs.statSync(&apos;simple.txt&apos;)</div></pre></td></tr></table></figure>
<p><strong>å¼‚æ­¥oråŒæ­¥</strong><br>ç»å¤§éƒ¨åˆ†éœ€è¦å†æœåŠ¡å™¨è¿è¡ŒæœŸåå¤æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„ä»£ç ï¼Œå¿…é¡»ä½¿ç”¨<strong>å¼‚æ­¥ä»£ç </strong>ï¼Œé¿å…åŒæ­¥ä»£ç åœ¨æ‰§è¡ŒæœŸé—´ï¼ŒæœåŠ¡å™¨åœæ­¢å“åº”ï¼Œå› ä¸ºJavaScriptåªæœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ã€‚<br>æœåŠ¡å™¨å¯åŠ¨æ—¶å¦‚æœéœ€è¦è¯»å–é…ç½®æ–‡ä»¶ï¼Œæˆ–ç»“æŸæ—¶éœ€è¦å†™å…¥åˆ°çŠ¶æ€æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<strong>åŒæ­¥ä»£ç </strong>ï¼Œå› ä¸ºè¿™äº›ä»£ç åªåœ¨å¯åŠ¨å’Œç»“æŸæ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¸å½±å“æœåŠ¡å™¨æ­£å¸¸è¿è¡Œæ—¶çš„å¼‚æ­¥æ‰§è¡Œã€‚  </p>
<p><strong>ä»æ–‡ä»¶æµè¯»å–æ–‡ä»¶</strong><br><strong>å…³äºæµ</strong><br>åœ¨Node.jsä¸­ï¼Œæµæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‹¥æœ‰ä»¥ä¸‹äº‹ä»¶ï¼š<br>dataäº‹ä»¶ è¡¨ç¤ºæµçš„æ•°æ®å·²ç»å¯ä»¥è¯»å–ï¼›<br>endäº‹ä»¶ è¡¨ç¤ºè¿™ä¸ªæµå·²ç»åˆ°æœ«å°¾ï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥è¯»å–ï¼›<br>erroräº‹ä»¶ è¡¨ç¤ºå‡ºé”™äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;</div><div class="line"></div><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">// æ‰“å¼€ä¸€ä¸ªæµ</div><div class="line">var rs = fs.createReadStream(&apos;sample.txt&apos;, &apos;utf-8&apos;)</div><div class="line"></div><div class="line">rs.on(&apos;data&apos;,function (chunk) &#123;</div><div class="line">    // æ•°æ®å·²ç»å¯ä»¥è¯»å–</div><div class="line">&#125;)</div><div class="line"></div><div class="line">rs.on(&apos;end&apos;, function () &#123;</div><div class="line">    // æ•°æ®å·²ç»è¯»å–åˆ°æœ«å°¾ï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥è¯»å–</div><div class="line">&#125;)</div><div class="line"></div><div class="line">rs.on(&apos;error&apos;, function (err) &#123;</div><div class="line">    // è¯»å–æ•°æ®å‘ç”Ÿé”™è¯¯</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼š</strong>dataäº‹ä»¶å¯èƒ½ä¼šæœ‰å¾ˆå¤šæ¬¡ï¼Œæ¯æ¬¡ä¼ é€’çš„chunkæ˜¯æµçš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p>
<p><strong>ä»¥æµçš„å½¢å¼å†™å…¥æ–‡ä»¶</strong></p>
<p><strong>æ³¨æ„ï¼š</strong>ä»¥æµçš„å½¢å¼å†™å…¥æ–‡ä»¶ï¼Œå¯ä»¥ä¸æ–­è°ƒç”¨write()æ–¹æ³•ï¼Œæœ€åä»¥end()ç»“æŸã€‚</p>
<ol>
<li>å†™å…¥æ–‡æœ¬æ•°æ®</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;</div><div class="line"></div><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">var ws1 = fs.createWriteStream(&apos;output1.txt&apos;, &apos;utf-8&apos;)</div><div class="line">ws1.write(&apos;ä½¿ç”¨Streamå†™å…¥æ–‡æœ¬æ•°æ®...\n&apos;)</div><div class="line">ws1.write(&apos;END.&apos;)</div><div class="line">ws1.end()</div></pre></td></tr></table></figure>
<ol>
<li>å†™å…¥äºŒè¿›åˆ¶æ•°æ®</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">â€˜use strictâ€™</div><div class="line"></div><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">var ws2 = fs.createWriteStream(&apos;output2.txt&apos;)</div><div class="line">ws2.write(new Buffer(&apos;ä½¿ç”¨Streamå†™å…¥äºŒè¿›åˆ¶æ•°æ®...\n&apos;, &apos;utf-8&apos;))</div><div class="line">ws2.write(new Buffer(&apos;END.&apos;, &apos;UTF-8&apos;))</div><div class="line">ws2.end()</div></pre></td></tr></table></figure>
<p>æ‰€æœ‰å¯ä»¥è¯»å–æ•°æ®çš„æµéƒ½ç»§æ‰¿è‡ªstream.Readableï¼Œæ‰€æœ‰å¯ä»¥å†™å…¥çš„æµéƒ½ç»§æ‰¿è‡ªstream.Writableã€‚</p>
<p><strong>å¤åˆ¶æ–‡ä»¶pipe</strong><br>ä¸€ä¸ªReadableæµå’Œä¸€ä¸ªWritableæµä¸²èµ·æ¥åï¼Œæ‰€æœ‰çš„æ•°æ®è‡ªåŠ¨ä»Readableæµè¿›å…¥Writableæµï¼Œè¿™ç§æ“ä½œå«pipeã€‚<br>åœ¨Node.jsä¸­ï¼ŒReadableæµæœ‰ä¸€ä¸ªpipe()æ–¹æ³•ï¼Œpipe()æŠŠä¸€ä¸ªæ–‡ä»¶æµå’Œå¦ä¸€ä¸ªæ–‡ä»¶æµä¸²èµ·æ¥ï¼Œè¿™æ ·æºæ–‡ä»¶çš„æ‰€æœ‰æ•°æ®å°±è‡ªåŠ¨å†™å…¥åˆ°ç›®æ ‡æ–‡ä»¶é‡Œäº†ï¼Œæ‰€ä»¥ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¤åˆ¶æ–‡ä»¶çš„ç¨‹åºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&apos;use strict&apos;</div><div class="line"></div><div class="line">var fs = require(&apos;fs&apos;)</div><div class="line"></div><div class="line">var rs = fs.createReadStream(&apos;sample.txt&apos;)</div><div class="line">var ws = fs.createWriteStream(&apos;copied.txt&apos;)</div><div class="line"></div><div class="line">rs.pipe(ws)</div></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Readableæµçš„æ•°æ®è¯»å–å®Œæ¯•ï¼Œendäº‹ä»¶è§¦å‘åï¼Œå°†è‡ªåŠ¨å…³é—­Writableæµã€‚å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›è‡ªåŠ¨å…³é—­Writableæµï¼Œéœ€è¦ä¼ å…¥å‚æ•°:<code>readable.pipe(writable, { end: false });</code></p>
<h2 id="Step5ï¼šå®Œæ•´çš„çˆ¬è™«ç¨‹åº"><a href="#Step5ï¼šå®Œæ•´çš„çˆ¬è™«ç¨‹åº" class="headerlink" title="Step5ï¼šå®Œæ•´çš„çˆ¬è™«ç¨‹åº"></a>Step5ï¼šå®Œæ•´çš„çˆ¬è™«ç¨‹åº</h2><p><a href="https://github.com/hardhpp/Node/tree/master/crawler" target="_blank" rel="external">ç¨‹åºç¤ºä¾‹</a></p>
<blockquote>
<p>ç›¸å…³å‚è€ƒ<br><a href="http://www.imooc.com/learn/348" target="_blank" rel="external">æ…•è¯¾è§†é¢‘</a><br><a href="http://blog.csdn.net/hard_hpp/article/details/77181681" target="_blank" rel="external">Node.js å®ç°çˆ¬è™«ï¼ˆ1ï¼‰ â€”â€” ç®€å•çš„çˆ¬è™«ç¨‹åº</a><br><a href="http://blog.csdn.net/hard_hpp/article/details/77247326" target="_blank" rel="external">Node.js å®ç°çˆ¬è™«ï¼ˆ2ï¼‰ â€”â€” å¤šé¡µé¢çš„çˆ¬è™«ç¨‹åº</a><br><a href="http://blog.csdn.net/hard_hpp/article/details/77248298" target="_blank" rel="external">Node.js å®ç°çˆ¬è™«ï¼ˆ3ï¼‰ â€”â€” ä¿å­˜çˆ¬å–çš„æ•°æ®</a><br><a href="http://cnodejs.org/topic/5203a71844e76d216a727d2e" target="_blank" rel="external">cheerio API</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Nodeå­¦ä¹ ç³»åˆ—(1) â€“ ä½¿ç”¨Nodeå®ç°çˆ¬è™«ï¼Œä»‹ç»äº†å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„çˆ¬è™«ç¨‹åºã€å¤šé¡µé¢çš„çˆ¬è™«ç¨‹åºã€å¦‚ä½•ä¿å­˜çˆ¬è™«çš„ç»“æœç­‰å†…å®¹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="hardhpp" scheme="http://xgfe.github.io/categories/hardhpp/"/>
    
    
      <category term="Node" scheme="http://xgfe.github.io/tags/Node/"/>
    
      <category term="çˆ¬è™«" scheme="http://xgfe.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>Epoxyï¼šæ„å»ºå¤æ‚é¡µé¢çš„æ¡†æ¶ï¼ˆä¸€ï¼‰</title>
    <link href="http://xgfe.github.io/2018/01/04/lwp/Epoxy_RecyclerView_1/"/>
    <id>http://xgfe.github.io/2018/01/04/lwp/Epoxy_RecyclerView_1/</id>
    <published>2018-01-04T06:13:36.000Z</published>
    <updated>2018-03-20T03:07:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä»…ä»å®è§‚ä¸Šä»‹ç»äº† Epoxy çš„ç‰¹è‰²å’Œä¼˜åŠ¿ï¼Œå¹¶è¯´æ˜äº†åŸºæœ¬ä½¿ç”¨æ­¥éª¤ã€‚</p>
<p>Epoxy æ˜¯ç”± Airbnb å›¢é˜Ÿå¼€å‘çš„ ï¼Œä»¥ç®€åŒ–ä½¿ç”¨ <code>RecyclerView</code> çš„è¿‡ç¨‹ï¼Œå¹¶æ·»åŠ äº†å¿…è¦çš„ç¼ºå¤±åŠŸèƒ½ã€‚Airbnb åœ¨ä»–ä»¬çš„åº”ç”¨ä¸­çš„å¤§éƒ¨åˆ†é¡µé¢ä¸Šä½¿ç”¨ Epoxy ï¼Œè¿™å¤§å¤§æé«˜äº†å¼€å‘äººå‘˜çš„ç»éªŒã€‚</p>
<a id="more"></a>
<p>Epoxyï¼ˆç¯æ°§æ ‘è„‚ï¼‰æ˜¯ä¸€ä¸ªAndroidåº“ï¼Œç”¨äºåœ¨ <code>RecyclerView</code> ä¸­æ„å»ºå¤æ‚çš„é¡µé¢ã€‚ç•Œé¢æ¨¡å‹æ˜¯é€šè¿‡è‡ªå®šä¹‰è§†å›¾ã€æ•°æ®ç»‘å®šå¸ƒå±€æˆ– Litho ç»„ä»¶é€šè¿‡æ³¨é‡Šå¤„ç†è‡ªåŠ¨ç”Ÿæˆçš„ã€‚è¿™äº›æ¨¡å‹ä¼šåœ¨ <code>EpoxyController</code> ä¸­ç”¨äºå£°æ˜åœ¨ <code>RecyclerView</code> ä¸­æ˜¾ç¤ºå“ªäº›é¡¹ç›®ã€‚</p>
<p>è¿™å°†æŠ½è±¡åŒ– <code>ViewHolder</code> çš„æ ·æ¿ï¼ŒåŒºåˆ†é¡¹ç›®å’Œç»‘å®šæœ‰æ•ˆè´Ÿè½½å˜åŒ–ï¼Œé¡¹ç›®ç±»å‹ï¼Œé¡¹ç›®IDï¼Œè·¨åº¦è®¡æ•°ç­‰ç­‰ï¼Œä»¥ç®€åŒ–å…·æœ‰å¤šç§è§†å›¾ç±»å‹çš„æ„å»ºå±å¹•ã€‚æ­¤å¤–ï¼ŒEpoxy å¢åŠ äº†å¯¹ä¿å­˜è§†å›¾çŠ¶æ€å’Œè‡ªåŠ¨æ¯”è¾ƒé¡¹ç›®å˜åŒ–çš„æ”¯æŒã€‚</p>
<h2 id="Epoxy-çš„ç‰¹ç‚¹"><a href="#Epoxy-çš„ç‰¹ç‚¹" class="headerlink" title="Epoxy çš„ç‰¹ç‚¹"></a>Epoxy çš„ç‰¹ç‚¹</h2><p>Android ä¸­çš„ RecyclerView æ˜¯ä¸€ä¸ªæ˜¾ç¤ºåˆ—è¡¨çš„å¼ºå¤§å·¥å…·ï¼Œä½†æ˜¯å®ƒçš„ç”¨æ³•æ¯”è¾ƒçç¢ã€‚æ˜¾ç¤ºå¤æ‚åº¦é«˜çš„åˆ—è¡¨æ˜¯æˆ‘ä»¬å›¢é˜Ÿçš„ä¸€ä¸ªå¸¸ç”¨éœ€æ±‚ï¼Œæ¯”å¦‚å…·æœ‰å¤šç§è§†å›¾ç±»å‹ï¼Œåˆ†é¡µåŠŸèƒ½ï¼Œæ”¯æŒå¹³æ¿å’Œ item åŠ¨ç”»çš„åˆ—è¡¨ã€‚æˆ‘ä»¬å‘ç°è‡ªå·±æ€»æ˜¯ä¸æ–­çš„é‡å¤ç›¸åŒçš„è®¾ç½®ã€‚æ‰€ä»¥ Airbnb å¼€å‘äº† Epoxy æ¥å‡è½»è¿™ä¸ªè¶‹åŠ¿ï¼Œä»¥ç®€åŒ–åŸºäºåˆ—è¡¨çš„è§†å›¾çš„åˆ›å»ºï¼ŒåŠ è½½é™æ€æˆ–è€…åŠ¨æ€çš„å†…å®¹ã€‚</p>
<p>Epoxy é‡‡ç”¨å¯ç»„åˆçš„æ–¹å¼æ¥åˆ›å»ºåˆ—è¡¨ã€‚åˆ—è¡¨ä¸­çš„æ¯ä¸ª item ç”±ä¸€ä¸ª Model ä»£è¡¨ï¼ŒModel å®šä¹‰äº† item çš„å¸ƒå±€ï¼Œid ä»¥åŠ spanã€‚Model è¿˜è´Ÿè´£å¤„ç†æ•°æ®åˆ°è§†å›¾çš„ç»‘å®šï¼Œåœ¨è§†å›¾è¢«å›æ”¶çš„æ—¶å€™é‡Šæ”¾èµ„æºã€‚å¦‚æœè¦æ˜¾ç¤ºè¿™äº› Model åˆ™æŠŠå®ƒä»¬æ·»åŠ åˆ° Epoxy çš„ Adapter ä¸­ï¼ŒAdapter ä¸ºä½ å¤„ç†å¤æ‚çš„æ˜¾ç¤ºé—®é¢˜ã€‚</p>
<h3 id="è¿½è¸ª-Item-å˜åŒ–"><a href="#è¿½è¸ª-Item-å˜åŒ–" class="headerlink" title="è¿½è¸ª Item å˜åŒ–"></a>è¿½è¸ª Item å˜åŒ–</h3><p>Epoxy é€šè¿‡åœ¨ Models ä¸­ä½¿ç”¨ä¸€ç§ Diffing ç®—æ³•å¸®ä½ è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚åªè¦ä½ æ”¹å˜äº† Model çš„è®¾ç½®ï¼ŒEpoxy å°±ä¼šæ‰¾åˆ°å˜åŒ–ç„¶åé€šçŸ¥ RecyclerViewã€‚è¿™ç®€åŒ–äº†ä½ çš„ Adapter ï¼Œæé«˜äº†æ€§èƒ½ï¼Œè¿˜é¡ºä¾¿æä¾›äº† Item Change åŠ¨ç”»ã€‚</p>
<p>è¿™ä¸ª Diffing ç®—æ³•ä¾èµ–äºæ¯ä¸ª Model å®ç°äº† HashCodeï¼Œè¿™æ ·å½“ä¸€ä¸ª Model å‘ç”Ÿå˜åŒ–çš„æ—¶å€™å°±å¯ä»¥è¢«æ£€æµ‹åˆ°ã€‚Epoxy æä¾›äº†ä¸€ä¸ªæ³¨è§£å¤„ç†å™¨ï¼Œè¿™æ ·ä½ çš„ Model å°±å¯ä»¥ä¸ºé‚£äº›èƒ½ä»£è¡¨ Model çŠ¶æ€çš„æˆå‘˜æ·»åŠ æ³¨è§£ã€‚ä¸€ä¸ªç”Ÿæˆçš„ subclass å¯ä»¥ä¸ºä½ å®ç°æ­£ç¡®çš„ HashCode æ–¹æ³•ï¼ŒåŒæ—¶ä¸ºæ¯ä¸ªæˆå‘˜å˜é‡ç”Ÿæˆgetter &amp; setter æ–¹æ³•ã€‚</p>
<p>ä½ è¿˜ä¼šæ³¨æ„åˆ°è¿™ä¸ª Model å®ç°äº†getDefaultLayout() æ¥è¿”å›ä¸€ä¸ªå¸ƒå±€èµ„æºã€‚è¿™ä¸ªèµ„æºç”¨äº inflate ä¼ é€’ç»™ model bind æ–¹æ³•çš„ viewï¼Œbind æ–¹æ³•ä¸­æŠŠæ•°æ®è®¾ç½®åˆ° view ä¸Šã€‚å¦å¤–ï¼Œåœ¨ Adapter ä¸­ layoutï¼ˆèµ„æºidï¼‰è¿˜è¢«ç”¨ä½œè¿™ä¸ª item çš„ view type idã€‚</p>
<h3 id="Stable-IDs-By-Default"><a href="#Stable-IDs-By-Default" class="headerlink" title="Stable IDs By Default"></a>Stable IDs By Default</h3><p>ä¸ºäº†è®©åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ŒEpoxyé»˜è®¤å¯ç”¨äº†RecyclerViewçš„stable idï¼ˆè¦äº†è§£ä»€ä¹ˆæ˜¯stable idï¼Œå‚è§RecyclerView Adapterçš„setHasStableIds(boolean hasStableIds)æ–¹æ³•ï¼‰ã€‚</p>
<p>è¿™ä½¿å¾—diffingï¼ŒitemåŠ¨ç”»ä»¥åŠçŠ¶æ€ä¿å­˜æˆä¸ºå¯èƒ½ï¼Œæ¯ä¸ªmodelè´Ÿè´£å®šä¹‰å®ƒçš„id,æˆ‘ä»¬ä¸ºåŠ¨æ€ç”Ÿæˆçš„modelæ‰‹åŠ¨è®¾ç½®idã€‚æ¯”å¦‚æ¯ä¸ªneighborhood carousel modelç”¨ç½‘ç»œè¯·æ±‚ä¸­çš„neighborhoodå¯¹è±¡æä¾›çš„idè®¾ç½®ã€‚</p>
<p>é™æ€è§†å›¾æ¯”å¦‚headerå°±è¦å¤æ‚ç‚¹ã€‚å®ƒæ²¡æœ‰ä¸€ä¸ªå›ºæœ‰çš„idä¸ä¹‹å…³è”ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ¶ä½œä¸€ä¸ªã€‚Epoxyä¸ºæ¯ä¸ªæ–°åˆ›å»ºçš„modelè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªidã€‚è¿™ä¸ªidå¯ä»¥ä¿è¯åœ¨appç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šå’Œå…¶ä»–ç”Ÿæˆçš„model idé‡å¤ï¼Œè€Œè´Ÿidè¢«ç”¨æ¥é¿å…å’Œæ‰‹åŠ¨è®¾ç½®çš„idé‡å¤ã€‚</p>
<h3 id="ä¿å­˜-View-çš„çŠ¶æ€"><a href="#ä¿å­˜-View-çš„çŠ¶æ€" class="headerlink" title="ä¿å­˜ View çš„çŠ¶æ€"></a>ä¿å­˜ View çš„çŠ¶æ€</h3><p>Epoxyè¿˜æ·»åŠ äº†å¯¹ä¿å­˜è§†å›¾çŠ¶æ€çš„æ”¯æŒï¼Œè¿™æ˜¯é»˜è®¤çš„RecyclerViewæ‰€ç¼ºä¹çš„ã€‚æ¯”å¦‚ï¼Œä¸Šé¢searchè®¾è®¡ä¸­çš„carouselsæ˜¯å¯ä»¥æ¨ªå‘æ»‘åŠ¨çš„ï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒæˆ‘ä»¬æƒ³ä¿å­˜è¿™ä¸ªcarouselçš„æ»šåŠ¨ä½ç½®ã€‚å¦‚æœç”¨æˆ·å‘ä¸‹æ»šåŠ¨ä¹‹åå†å›åˆ°è¿™é‡Œæ—¶ä»–ä»¬åº”è¯¥çœ‹åˆ°carouselä¿æŒäº†åŸæ¥çš„çŠ¶æ€ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœä»–ä»¬æ—‹è½¬æ‰‹æœºæˆ–è€…åˆ‡æ¢appä¹‹åå†å›æ¥ï¼Œå°½ç®¡activityå‘ç”Ÿäº†é‡å»ºï¼Œæˆ‘ä»¬è¿˜æ˜¯åº”è¯¥å‘ˆç°å‡ºç›¸åŒçš„çŠ¶æ€ã€‚</p>
<p>å¦‚æœä½¿ç”¨æ™®é€šçš„RecyclerView adapterè¿™å°±éš¾ä»¥å®ç°äº†ã€‚Epoxyæ”¯æŒä¿å­˜ä»»æ„modelçš„viewçŠ¶æ€ï¼Œä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œå®ƒæ˜¯ç”¨äº†stable idsæŠŠviewçš„çŠ¶æ€å’Œmodel idè”ç³»èµ·æ¥ã€‚</p>
<p>è¦ä¿å­˜viewçš„çŠ¶æ€åªéœ€å†modelä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> shouldSaveViewState &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Epoxyå°†åœ¨å®ƒç¦»å¼€å±å¹•çš„æ—¶å€™ä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œå¹¶åœ¨è¿”å›çš„æ—¶å€™æ¢å¤ã€‚é»˜è®¤è¿™ä¸ªè®¾ç½®ä¸ºfalseï¼Œè¿™æ ·å†…å­˜å’Œæ»šåŠ¨çš„æ€§èƒ½å°±ä¸ä¼šå› ä¸ºä¿å­˜äº†ä¸å¿…è¦çš„è§†å›¾çŠ¶æ€è€Œå—å½±å“ã€‚</p>
<h3 id="Epoxyåœ¨é™æ€å†…å®¹ä¸­çš„åº”ç”¨"><a href="#Epoxyåœ¨é™æ€å†…å®¹ä¸­çš„åº”ç”¨" class="headerlink" title="Epoxyåœ¨é™æ€å†…å®¹ä¸­çš„åº”ç”¨"></a>Epoxyåœ¨é™æ€å†…å®¹ä¸­çš„åº”ç”¨</h3><p>RecyclerViewé€šå¸¸ç”¨äºæ˜¾ç¤ºä»è¿œç¨‹æ•°æ®ï¼ˆæ¯”å¦‚ç½‘ç»œæˆ–è€…æ•°æ®åº“ï¼‰åŠ è½½çš„åŠ¨æ€å†…å®¹ï¼Œå¦åˆ™ä½¿ç”¨scrollviewè¦ç®€å•äº›ã€‚ä½†æ˜¯Epoxyå¯ä»¥è®©RecyclerViewçš„ä½¿ç”¨å’ŒScrollViewä¸€æ ·ç®€å•ï¼Œæˆ‘ä»¬çš„è¯¦æƒ…ç•Œé¢å°±æ˜¯è¿™æ ·åšçš„ã€‚</p>
<p>è¿™ç§æ•ˆæœä½¿ç”¨ScrollViewæ¥å®ç°å¯èƒ½æ˜¯æœ€ç®€å•çš„ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨Epoxyé…åˆRecyclerViewå¯ä»¥å¾—åˆ°æ›´å¿«çš„åŠ è½½é€Ÿåº¦ï¼Œä¹Ÿæ›´å®¹æ˜“å®ç°åŠ¨ç”»ã€‚</p>
<p>æ€§èƒ½å¯¹æˆ‘ä»¬æ¥è¯´è‡³å…³é‡è¦ï¼Œè¿™ä¸ªé¡µé¢é€šå¸¸åœ¨ç”¨æˆ·æœç´¢çš„æ—¶å€™å±•ç¤ºï¼Œç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæœç´¢ç»“æœçš„å›¾ç‰‡ï¼Œç„¶åä½¿ç”¨å…±äº«å…ƒç´ åŠ¨ç”»åˆ‡æ¢åˆ°è¯¦æƒ…é¡µé¢ï¼Œä¸ºäº†è®©æœç´¢ä½“éªŒè‰¯å¥½ï¼ŒåŠ¨ç”»å¿…é¡»æµç•…ï¼Œå› æ­¤details viewçš„åŠ è½½å¿…é¡»éå¸¸å¿«ã€‚</p>
<p>è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹è¿™ä¸ªviewäº†è§£ä¸ºä»€ä¹ˆå®ƒä»¬ä¼šå½±å“æ€§èƒ½ã€‚é¦–å…ˆï¼Œæœ€é¡¶ä¸Šçš„å›¾ç‰‡å®é™…æ˜¯ä¸€ä¸ªæ¨ªå‘çš„RecyclerViewï¼Œè¿™æ ·ç”¨æˆ·å°±èƒ½æ»‘åŠ¨æŸ¥çœ‹æˆ¿é—´çš„å›¾ç‰‡ã€‚åœ¨ä¸­é—´æˆ‘ä»¬æœ‰ä¸€å¼ é™æ€çš„åœ°å›¾æ˜¾ç¤ºæˆ¿æºçš„ä½ç½®ï¼Œè€Œåœ¨åº•éƒ¨æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªRecyclerViewï¼Œæ˜¾ç¤ºè¯¥åœ°åŒºçš„ç±»ä¼¼æˆ¿æºã€‚è€Œåœ¨è¿™ä¸‰ä¸ªæ¯”è¾ƒå¤§çš„è§†å›¾ä¸­é—´è¿˜ç©¿æ’ç€ä¸€äº›æ–‡å­—ä¿¡æ¯å’Œå°å›¾ç‰‡ã€‚</p>
<p>è¿™äº›åŠ åœ¨ä¸€èµ·å°±å¾—åˆ°äº†ä¸€ä¸ªå¸¦æœ‰å¾ˆå¤šä½å›¾çš„éå¸¸å¤æ‚çš„ç»“æ„ã€‚è¿™ä½¿å¾—æµ‹é‡å’Œå¸ƒå±€çš„è¿‡ç¨‹è¦èŠ±æ›´é•¿çš„æ—¶é—´ï¼ŒåŒæ—¶è¿˜éœ€è¦æ›´å¤šçš„å†…å­˜æ¥åŠ è½½å›¾ç‰‡ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜ä»ä¸åŒçš„æ¸ é“åŠ è½½æ•°æ®ï¼databases, in-memory caches, ä»¥åŠå¤šä¸ªç½‘ç»œè¯·æ±‚ã€‚è¿™å¯¹ä¸ºç”¨æˆ·æ˜¾ç¤ºå³æ—¶æ•°æ®æœ‰å¥½å¤„ï¼Œä½†æ˜¯å¦‚æœå¤„ç†ä¸å¥½ä¹Ÿä¼šå¢åŠ æ›´å¤šçš„æ—¶é—´å¼€é”€ã€‚</p>
<p>åºå¤§çš„è§†å›¾ç»“æ„ï¼Œå¤šä¸ªbitmapï¼Œå¤šä¸ªviewåˆ·æ–°ï¼Œè¿™äº›è¦æ±‚ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±å»å…³æ³¨æ€§èƒ½é—®é¢˜ã€‚å¤šäºäº†Epoxyæˆ‘ä»¬å¯ä»¥åœ¨å…¼é¡¾è¿™äº›è€ƒè™‘çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æä¾›å¾ˆæ£’çš„ç”¨æˆ·ä½“éªŒã€‚è¿™æ˜¯å› ä¸ºï¼š</p>
<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯RecyclerViewï¼Œå½“ç”¨æˆ·é¦–æ¬¡æ‰“å¼€è¿™ä¸ªå±å¹•çš„æ—¶å€™åªæœ‰ä¸€å°éƒ¨åˆ†è§†å›¾è¢«åŠ è½½ã€‚é¿å…äº†è¿‡æ—©çš„åŠ è½½mapå›¾ç‰‡ï¼Œåº•éƒ¨çš„ç”»å»Šä»¥åŠå®ƒä»¬ä¹‹é—´çš„æ‰€æœ‰è§†å›¾ã€‚è¿™å°±ä½¿å¾—å¸ƒå±€æ›´å¿«ï¼Œå†…å­˜ä½¿ç”¨æ›´å°ï¼Œè¿‡åº¦åŠ¨ç”»æ›´æµç•…ã€‚</p>
<p>å½“æ–°æ•°æ®è¢«åŠ è½½çš„æ—¶å€™æˆ‘ä»¬æ— éœ€åå¤çš„åˆ·æ–°viewï¼Œå‡å°äº†ä¸¢å¸§çš„æ¦‚ç‡ã€‚å¦‚æœé‡åˆ°ç±»ä¼¼çš„åˆ—è¡¨è¯·æ±‚ï¼Œè€Œé‚£ä¸ªcarouselä¸åœ¨å±å¹•ä¸Šï¼Œæˆ‘ä»¬ä»€ä¹ˆå¤œä¸ç”¨åšã€‚å¦‚æœä»·æ ¼å‘ç”Ÿäº†å˜æ¢ï¼ŒEpoxyåªæ˜¯æ›´æ–°ä»·æ ¼æ ‡ç­¾ã€‚è¿™å¢åŠ äº†è¿›å…¥åŠ¨ç”»çš„æµç•…åº¦ï¼ŒåŒæ—¶é˜²æ­¢ç”¨æˆ·æ»šåŠ¨çš„æ—¶å€™ä¸¢å¸§ã€‚</p>
<p>è‡ªå¸¦Item changeåŠ¨ç”»ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ä»¥ç›¸åº”çš„åŠ¨ç”»æ˜¾ç¤ºï¼Œéšè—æˆ–è€…æ›´æ–°viewã€‚æ¯”å¦‚ï¼Œç‚¹å‡»ç¿»è¯‘æŒ‰é’®å¯ä»¥æ’å…¥ä¸€ä¸ªåŠ è½½å™¨ï¼Œå½“åŠ è½½å®Œæˆå†è¿‡æ¸¡åˆ°ç¿»è¯‘åçš„textï¼Œè¿™é¿å…äº†çªå…€çš„å˜åŒ–ã€‚</p>
<h2 id="é¡¹ç›®ä¸­å¼•å…¥-Epoxy"><a href="#é¡¹ç›®ä¸­å¼•å…¥-Epoxy" class="headerlink" title="é¡¹ç›®ä¸­å¼•å…¥ Epoxy"></a>é¡¹ç›®ä¸­å¼•å…¥ Epoxy</h2><p>ä½¿ç”¨ gradle ä¾èµ– Epoxy å’Œ Annotation Processorï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬ä¸º 2.8.0 ã€‚ <a href="https://github.com/airbnb/epoxy/releases/latest" target="_blank" rel="external">æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬</a></p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">  implementation <span class="string">'com.airbnb.android:epoxy:2.8.0'</span></div><div class="line">  <span class="comment">// ä¾èµ– Epoxy çš„æ³¨è§£å¤„ç†å·¥å…·</span></div><div class="line">  annotationProcessor <span class="string">'com.airbnb.android:epoxy-processor:2.8.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="åŸºæœ¬ä½¿ç”¨æ–¹æ³•"><a href="#åŸºæœ¬ä½¿ç”¨æ–¹æ³•" class="headerlink" title="åŸºæœ¬ä½¿ç”¨æ–¹æ³•"></a>åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h2><p>Epoxy æœ‰ä¸¤ä¸ªä¸»è¦çš„ç»„ä»¶ï¼Œå„å¸å…¶èŒï¼š</p>
<ol>
<li><code>EpoxyModel</code>ï¼šè´Ÿè´£åˆ—è¡¨é¡¹çš„æ ·å¼å’Œæ•°æ®ï¼›</li>
<li><code>EpoxyController</code>ï¼šè´Ÿè´£åˆ—è¡¨ä¸­å¦‚ä½•æ’åˆ—å„ç§ç±»å‹çš„ <code>EpoxyModel</code> æ¥æ˜¾ç¤ºåˆ—è¡¨é¡¹å’Œæ•°æ®ã€‚</li>
</ol>
<h3 id="1-åˆ›å»º-EpoxyModel"><a href="#1-åˆ›å»º-EpoxyModel" class="headerlink" title="1. åˆ›å»º EpoxyModel"></a>1. åˆ›å»º EpoxyModel</h3><p>Epoxy æ ¹æ®ä½ è®¾ç½®çš„è‡ªå®šä¹‰æ§ä»¶æˆ–å¸ƒå±€æ–‡ä»¶æ¥æ„é€ ä¸€ä¸ª Model ç±»ï¼Œè¿™ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ç±»ä½¿ç”¨ <code>_</code> ä½œä¸ºç±»åçš„åç¼€ï¼Œåœ¨ <code>EpoxyController</code> ä¸­åº”è¯¥ä½¿ç”¨è¿™ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ç±»ã€‚</p>
<p>ä¸‹é¢æ˜¯åˆ›å»º <code>EpoxyModel</code> ç±»çš„ä¸‰ç§æ–¹æ³•ï¼š</p>
<h4 id="è‡ªå®šä¹‰æ§ä»¶"><a href="#è‡ªå®šä¹‰æ§ä»¶" class="headerlink" title="è‡ªå®šä¹‰æ§ä»¶"></a>è‡ªå®šä¹‰æ§ä»¶</h4><p>é€šè¿‡è‡ªå®šä¹‰æ§ä»¶åˆ›å»º <code>EpoxyModel</code> çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>é¦–å…ˆæŒ‰ç…§æ™®é€šçš„è‡ªå®šä¹‰æ§ä»¶çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ª View çš„å­ç±»ï¼›</li>
<li>ç„¶ååœ¨ç±»åä¸Šæ·»åŠ æ³¨è§£ <code>@ModelView</code> ï¼›</li>
<li>åœ¨éœ€è¦ä½œä¸º <code>EpoxyModel</code> çš„å±æ€§çš„ setter æ–¹æ³•ä¸Šæ·»åŠ  â€œpropâ€ æ³¨è§£ï¼ˆ<code>@TextProp</code>ã€<code>@ModelProp</code>ã€<code>@CallbackProp</code>ï¼‰ã€‚</li>
</ul>
<p>ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ModelView</span>(autoLayout = Size.MATCH_WIDTH_WRAP_HEIGHT)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeaderView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</div><div class="line"></div><div class="line">  ... <span class="comment">// Initialization omitted</span></div><div class="line"></div><div class="line">  <span class="meta">@TextProp</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(CharSequence text)</span> </span>&#123;</div><div class="line">    titleView.setText(text);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¡¹ç›® Rebuild åï¼Œå°†ä¼šç”Ÿæˆç±» <code>HeaderViewModel_</code>ï¼ŒåŒ…åä¸ <code>HeaderView</code> ç›¸åŒã€‚</p>
<h4 id="æ•°æ®ç»‘å®š"><a href="#æ•°æ®ç»‘å®š" class="headerlink" title="æ•°æ®ç»‘å®š"></a>æ•°æ®ç»‘å®š</h4><p>å¦‚æœä½¿ç”¨äº† Android çš„ DataBindingï¼Œä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ç®€å•æ–¹æ³•åˆ›å»ºå¸ƒå±€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">"title"</span> <span class="attr">type</span>=<span class="string">"String"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"120dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"40dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"@&#123;title&#125;"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ç„¶å, åœ¨ä»»æ„åˆé€‚çš„åŒ…ä¸­åˆ›å»º <code>package-info.java</code> æ–‡ä»¶ï¼Œå¹¶æ·»åŠ æ³¨è§£ <code>@EpoxyDataBindingLayouts</code> æŒ‡å®šä»¥ä¸Šå¸ƒå±€.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EpoxyDataBindingLayouts</span>(&#123;R.layout.header_view, ... <span class="comment">// other layouts &#125;)</span></div><div class="line"><span class="keyword">package</span> com.airbnb.epoxy.sample;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.airbnb.epoxy.EpoxyDataBindingLayouts;</div><div class="line"><span class="keyword">import</span> com.airbnb.epoxy.R;</div></pre></td></tr></table></figure>
<p>é¡¹ç›® Rebuild åï¼Œå°†ä¼šç”Ÿæˆç±» <code>HeaderViewBindingModel_</code>ã€‚</p>
<h4 id="ViewHolder-æ–¹å¼"><a href="#ViewHolder-æ–¹å¼" class="headerlink" title="ViewHolder æ–¹å¼"></a>ViewHolder æ–¹å¼</h4><p>ä½¿ç”¨ xml å¸ƒå±€æ¥åˆ›å»º <code>EpoxyModel</code> ï¼Œå¯ä»¥ç»§æ‰¿ <code>EpoxyModelWithHolder</code> åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EpoxyModelClass</span>(layout = R.layout.header_view)</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HeaderModel</span> <span class="keyword">extends</span> <span class="title">EpoxyModelWithHolder</span>&lt;<span class="title">Holder</span>&gt; </span>&#123;</div><div class="line">  <span class="meta">@EpoxyAttribute</span> String title;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(Holder holder)</span> </span>&#123;</div><div class="line">    holder.header.setText(title);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Holder</span> <span class="keyword">extends</span> <span class="title">BaseEpoxyHolder</span> </span>&#123;</div><div class="line">    <span class="meta">@BindView</span>(R.id.text) TextView header;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¡¹ç›® Rebuild åï¼Œä¼šç”Ÿæˆç±» <code>HeaderModel_</code>ï¼Œç»§æ‰¿äº†æŠ½è±¡ç±» <code>HeaderModel</code> å¹¶å®ç°äº†å…¶æŠ½è±¡æ–¹æ³•ã€‚<code>HeaderModel</code> ä¸­æ ‡æ³¨äº† <code>@EpoxyAttribute</code> æ³¨è§£çš„æˆå‘˜å˜é‡ï¼Œä¼šåœ¨ <code>HeaderModel_</code> ä¸­ç”Ÿæˆ getter &amp; setter æ–¹æ³•ã€‚</p>
<h3 id="2-åˆ›å»º-EpoxyController"><a href="#2-åˆ›å»º-EpoxyController" class="headerlink" title="2. åˆ›å»º EpoxyController"></a>2. åˆ›å»º EpoxyController</h3><p>Epoxy çš„æ§åˆ¶å™¨å¯ä»¥æŒ‡å®šåˆ—è¡¨æ˜¾ç¤ºçš„é¡¹ç›®ç±»å‹ã€æ•°é‡å’Œé¡ºåºï¼ŒåŒæ—¶æŒ‡å®šæ¯ä¸ªé¡¹ç›®çš„æ•°æ®ã€‚</p>
<p>åœ¨æœ€é‡è¦çš„ <code>buildModels</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ¯ä¸€é¡¹ model ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æˆ‘ä»¬æ¯æ¬¡è°ƒç”¨ <code>requestModelBuild</code> æ–¹æ³•æ›´æ–°æ•°æ®åè¢«è§¦å‘ï¼ŒEpoxy è·Ÿè¸ªæ¨¡å‹ä¸­çš„å˜åŒ–ï¼Œå¹¶è‡ªåŠ¨ç»‘å®šå’Œæ›´æ–°è§†å›¾ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåˆ—è¡¨æœ‰ä¸€ä¸ªå¤´éƒ¨ï¼Œå¤§é‡çš„ç…§ç‰‡åˆ—è¡¨é¡¹ï¼Œæœ€åæ˜¯åŠ è½½æ›´å¤šæ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhotoController</span> <span class="keyword">extends</span> <span class="title">Typed2EpoxyController</span>&lt;<span class="title">List</span>&lt;<span class="title">Photo</span>&gt;, <span class="title">Boolean</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@AutoModel</span> HeaderModel_ headerModel;</div><div class="line">    <span class="meta">@AutoModel</span> LoaderModel_ loaderModel;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">buildModels</span><span class="params">(List&lt;Photo&gt; photos, Boolean loadingMore)</span> </span>&#123;</div><div class="line">      headerModel</div><div class="line">          .title(<span class="string">"My Photos"</span>)</div><div class="line">          .description(<span class="string">"My album description!"</span>)</div><div class="line">          .addTo(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">      <span class="keyword">for</span> (Photo photo : photos) &#123;</div><div class="line">        <span class="keyword">new</span> PhotoModel()</div><div class="line">           .id(photo.id())</div><div class="line">           .url(photo.url())</div><div class="line">           .addTo(<span class="keyword">this</span>);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      loaderModel</div><div class="line">          .addIf(loadingMore, <span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="3-æ•´åˆåˆ°-RecyclerView"><a href="#3-æ•´åˆåˆ°-RecyclerView" class="headerlink" title="3. æ•´åˆåˆ° RecyclerView"></a>3. æ•´åˆåˆ° RecyclerView</h3><p>åˆ—è¡¨æ§ä»¶æ—¢å¯ä»¥ä½¿ç”¨ Android Support Library ä¸­çš„ <code>RecyclerView</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Epoxy æä¾›çš„ <code>EpoxyRecyclerView</code>ã€‚æ¨èä½¿ç”¨åè€…ï¼Œæ›´åŠ ç®€ä¾¿ã€‚</p>
<h4 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a>RecyclerView</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MyController controller = <span class="keyword">new</span> MyController();</div><div class="line">recyclerView.setAdapter(controller.getAdapter());</div><div class="line"></div><div class="line"><span class="comment">// Request a model build whenever your data changes</span></div><div class="line">controller.requestModelBuild();</div><div class="line"></div><div class="line"><span class="comment">// Or if you are using a TypedEpoxyController</span></div><div class="line">controller.setData(myData);</div></pre></td></tr></table></figure>
<h4 id="EpoxyRecyclerView"><a href="#EpoxyRecyclerView" class="headerlink" title="EpoxyRecyclerView"></a>EpoxyRecyclerView</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">epoxyRecyclerView.setControllerAndBuildModels(<span class="keyword">new</span> MyController());</div><div class="line"></div><div class="line"><span class="comment">// Request a model build on the recyclerview when data changes</span></div><div class="line">epoxyRecyclerView.requestModelBuild();</div></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>éå¸¸æ„Ÿè°¢ Airbnb å’Œå…¶ä»–å¼€å‘è€…å¯¹æ­¤å¼€æºé¡¹ç›®çš„è´¡çŒ®ï¼Œè®©æˆ‘ä»¬å¾—ä»¥ä½“éªŒåˆ°å…¨æ–°çš„åˆ—è¡¨å¼€å‘æ–¹å¼ï¼Œå¹¶äº«å—åˆ°äº† Epoxy çš„æ³¨è§£å¤„ç†å™¨ã€Diffing ç®—æ³•ä»¥åŠé€šç”¨å·¥å…·å¸¦ç»™æˆ‘ä»¬çš„æ–¹ä¾¿ã€‚</p>
<p>æœ¬æ–‡ä»…ä»å®è§‚ä¸Šä»‹ç»äº† Epoxy çš„åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼Œæ•¬è¯·æœŸå¾…åç»­æ–‡ç« ï¼Œä»‹ç» Epoxy çš„æ›´å¤šç»†èŠ‚ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://github.com/airbnb/epoxy" target="_blank" rel="external">GitHub - Airbnb/Epoxy</a></li>
<li><a href="https://github.com/airbnb/epoxy/wiki" target="_blank" rel="external">Epoxy Wiki</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ–‡ä»…ä»å®è§‚ä¸Šä»‹ç»äº† Epoxy çš„ç‰¹è‰²å’Œä¼˜åŠ¿ï¼Œå¹¶è¯´æ˜äº†åŸºæœ¬ä½¿ç”¨æ­¥éª¤ã€‚&lt;/p&gt;
&lt;p&gt;Epoxy æ˜¯ç”± Airbnb å›¢é˜Ÿå¼€å‘çš„ ï¼Œä»¥ç®€åŒ–ä½¿ç”¨ &lt;code&gt;RecyclerView&lt;/code&gt; çš„è¿‡ç¨‹ï¼Œå¹¶æ·»åŠ äº†å¿…è¦çš„ç¼ºå¤±åŠŸèƒ½ã€‚Airbnb åœ¨ä»–ä»¬çš„åº”ç”¨ä¸­çš„å¤§éƒ¨åˆ†é¡µé¢ä¸Šä½¿ç”¨ Epoxy ï¼Œè¿™å¤§å¤§æé«˜äº†å¼€å‘äººå‘˜çš„ç»éªŒã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="lwp" scheme="http://xgfe.github.io/categories/lwp/"/>
    
    
      <category term="Android" scheme="http://xgfe.github.io/tags/Android/"/>
    
      <category term="Epoxy" scheme="http://xgfe.github.io/tags/Epoxy/"/>
    
  </entry>
  
</feed>
